head	1.9;
access;
symbols
	pre_getangas:1.9
	GPL2010:1.9
	pre_GPL2010:1.8
	pre_var_equation:1.8
	pre_fftwrings:1.8
	pre_opfiles:1.8
	src:1.8
	best-code:1.8
	x-named-regs:1.7
	x:1.7
	v13-00:1.7
	pre_GPL:1.5
	prec_CA:1.5
	noindx:1.5
	Bproc:1.4;
locks; strict;
comment	@c @;


1.9
date	2010.06.24.13.25.20;	author leith;	state Exp;
branches;
next	1.8;

1.8
date	2006.03.09.17.32.14;	author leith;	state Exp;
branches;
next	1.7;

1.7
date	2005.10.17.20.22.37;	author leith;	state Exp;
branches;
next	1.6;

1.6
date	2005.10.17.18.14.58;	author leith;	state Exp;
branches;
next	1.5;

1.5
date	2002.03.11.14.08.10;	author leith;	state Exp;
branches;
next	1.4;

1.4
date	2000.03.24.19.36.46;	author bimal;	state Exp;
branches;
next	1.3;

1.3
date	2000.03.07.20.00.12;	author pawel;	state Exp;
branches;
next	1.2;

1.2
date	99.11.15.19.29.21;	author leith;	state Exp;
branches;
next	1.1;

1.1
date	99.10.21.18.56.59;	author bimal;	state Exp;
branches;
next	;


desc
@created
@


1.9
log
@GPL_2010
@
text
@C++*********************************************************************
C
C  COPYTOXPLOR.F  --              CREATED    OCT 99     PAWEL PENCZEK                
C                                 REFINED    10/21/99   BIMAL RATH
C                                 KX... +1   03/08/06   ARDEAN LEITH
C
C **********************************************************************
C=*                                                                    *
C=* This file is part of:   SPIDER - Modular Image Processing System.  *
C=* SPIDER System Authors:  Joachim Frank & ArDean Leith               *
C=* Copyright 1985-2010  Health Research Inc.,                         *
C=* Riverview Center, 150 Broadway, Suite 560, Menands, NY 12204.      *
C=* Email: spider@@wadsworth.org                                        *
C=*                                                                    *
C=* SPIDER is free software; you can redistribute it and/or            *
C=* modify it under the terms of the GNU General Public License as     *
C=* published by the Free Software Foundation; either version 2 of the *
C=* License, or (at your option) any later version.                    *
C=*                                                                    *
C=* SPIDER is distributed in the hope that it will be useful,          *
C=* but WITHOUT ANY WARRANTY; without even the implied warranty of     *
C=* merchantability or fitness for a particular purpose.  See the GNU  *
C=* General Public License for more details.                           *
C=* You should have received a copy of the GNU General Public License  *
C=* along with this program. If not, see <http://www.gnu.org/licenses> *
C=*                                                                    *
C **********************************************************************
C
C COPYTOXPLOR(LUN1,FIOLD,LUN2,NSAM,NROW,NSLICE)
C 
C PURPOSE:     CONVERTS SPIDER IMAGE FILE TO EXPLORER FORMAT
C  
C PARAMETERS:
C        LUN1                LOGICAL UNIT NUMBER OF INPUT IMAGE
C        FIOLD               INPUT FILE NAME (WITHOUT EXTENSION)
C        LUN2                LOGICAL UNIT NUMBER OF OUTPUT IMAGE
C        NSAM,NROW,NSLICE    DIMENSIONS OF VOLUME
C        
C23456789012345678901234567890123456789012345678901234567890123456789012
C--*********************************************************************

        SUBROUTINE COPYTOXPLOR(LUN1,FILOLD,LUN2,NSAM,NROW,NSLICE)

        INCLUDE 'CMBLOCK.INC'
        INCLUDE 'CMLIMIT.INC'

        REAL, ALLOCATABLE, DIMENSION(:,:) :: AIMG
        CHARACTER(LEN=MAXNAM) :: FILOLD,FILNEW,FILENAME 
        
        CALL RDPRM(A,NOT_USED,'PIXEL SIZE')
	IF (IMAMI .NE. 1) THEN
           CALL NORM3(LUN1,NSAM,NROW,NSLICE,FMAX,FMIN,AV)
        ENDIF

        BMIN   = FMIN
        BMAX   = FMAX
        SUM    = AV
        SIGMA  = SIG
        LENREC = 0

        CALL OPAUXFILE(.TRUE.,FILNEW,DATEXC,LUN2,LENREC,'N',
     &	    'OUTPUT',.TRUE.,IRTFLG)
        IF (IRTFLG .NE. 0) RETURN

C       WRITE HEADER
        WRITE(LUN2,201)
201     FORMAT(/,'       2')
        CALL FILNAMANDEXT(FILOLD,DATEXC,FILENAME,NLET,.TRUE.,IRTFLG)
	IF (IRTFLG .NE. 0) RETURN 
	
        WRITE(LUN2,202) FILENAME
202     FORMAT('REMARKS FILENAME= ',A40)

        WRITE(LUN2,203)
cc203     FORMAT('REMARKS CREATED BY SPIDER     CP TO XPLOR')
203     FORMAT('REMARKS CREATED BY MAPMAN V. 960827/4.6.2')

C       AL Mar 06
        IF (MOD(NSAM,2) .EQ. 0) THEN               !EVEN
           KX  = -NSAM/2    + 0
        ELSE
           KX  = -NSAM/2    + MOD(NSAM+1,2)
        ENDIF

        IF (MOD(NROW,2) .EQ. 0) THEN               !EVEN
           KY  = -NROW/2    + 0
        ELSE
           KY  = -NROW/2    + MOD(NROW+1,2)
        ENDIF

        IF (MOD(KX,2) .EQ. 0) THEN               !EVEN
           KZ  = -NSLICE/2    + 0
        ELSE
           KZ  = -NSLICE/2    + MOD(NSLICE+1,2)
        ENDIF

C       BEFORE AL Mar 06
        IEX = NSAM/2
        IEY = NROW/2
        IEZ = NSLICE/2

C       AL Mar 06
        IEX = KX + NSAM   - 1
        IEY = KY + NROW   - 1
        IEZ = KZ + NSLICE - 1

	
        WRITE(LUN2,204) NSAM,KX,IEX,NROW,KY,IEY,NSLICE,KZ,IEZ
204     FORMAT(9I8)

        ANG = 90.0
        WRITE(LUN2,206)  A*NSAM,A*NROW,A*NSLICE,ANG,ANG,ANG
206     FORMAT(6(1PE12.5))

        WRITE(LUN2,205)
205     FORMAT('ZYX')
      
        ALLOCATE (AIMG(NSAM,NROW), STAT=IRTFLG)
        IF (IRTFLG.NE.0) THEN 
           CALL ERRT(46,'COPYTOEXPLOR',IER)
           RETURN
        ENDIF

        DO  K=NSLICE,1,-1
           DO J=1,NROW
              CALL  REDLIN(LUN1,AIMG(1,J),NSAM,J+(K-1)*NROW)
           ENDDO

           WRITE(LUN2,504)  NSLICE-K
504        FORMAT(I8)
           WRITE(LUN2,505)  ((AIMG(I,J),J=1,NROW),I=1,NSAM)
505        FORMAT(6E12.5)
        ENDDO
	
        K     = -9999
        WRITE(LUN2,504)  K
        WRITE(LUN2,506)  SUM,SIGMA**2
506     FORMAT(1X,6E12.5)
        DEALLOCATE (AIMG)

        END
@


1.8
log
@kx... for even changed
@
text
@a7 2
C=* FROM: SPIDER - MODULAR IMAGE PROCESSING SYSTEM.   AUTHOR: J.FRANK  *
C=* Copyright (C) 1985-2005  Health Research Inc.                      *
d9 5
a13 2
C=* HEALTH RESEARCH INCORPORATED (HRI),                                *   
C=* ONE UNIVERSITY PLACE, RENSSELAER, NY 12144-3455.                   *
d15 1
a15 3
C=* Email:  spider@@wadsworth.org                                       *
C=*                                                                    *
C=* This program is free software; you can redistribute it and/or      *
d20 1
a20 1
C=* This program is distributed in the hope that it will be useful,    *
d22 1
a22 1
C=* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  *
a23 1
C=*                                                                    *
d25 1
a25 3
C=* along with this program; if not, write to the                      *
C=* Free Software Foundation, Inc.,                                    *
C=* 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.      *
@


1.7
log
@GPL License fixed
@
text
@d3 3
a5 2
C  COPYTOXPLOR.F  -- CREATED OCT 99                        PAWEL PENCZEK                
C                                     10/21/99 REFINED  BY BIMAL RATH
a42 3
C
C SUPPORT_ROUTINE
C
d49 1
d52 1
a52 1
        CHARACTER *81      FILOLD,FILNEW,FILENAME 
d58 1
d79 1
d82 20
a101 3
        KX  = -NSAM/2+MOD(NSAM+1,2)
        KY  = -NROW/2+MOD(NROW+1,2)
        KZ  = -NSLICE/2+MOD(NSLICE+1,2)
d105 6
d112 1
a112 1
        WRITE(LUN2,204)  NSAM,KX,IEX,NROW,KY,IEY,NSLICE,KZ,IEZ
d129 1
a129 1
           DO  J=1,NROW
d132 1
@


1.6
log
@HRI GPL License used
@
text
@a6 2
C * SPIDER - MODULAR IMAGE PROCESSING SYSTEM.  AUTHOR: J.FRANK        **
C *  SPIDER - MODULAR IMAGE PROCESSING SYSTEM.  AUTHOR: J.FRANK        *
d10 1
a10 1
C=* HEALTH RESEARCH INCORPORATED (HRI),                                *  
a29 7

C *  COPYRIGHT (C)1981,1987, WADSWORTH CENTER FOR LABORATORIES AND     *
C *    RESEARCH, NEW YORK STATE DEPARTMENT OF HEALTH, ALBANY, NY 12201 *
C *    THE CONTENTS OF THIS DOCUMENT ARE PROPRIETARY TO THE CENTER FOR *
C *    LABORATORIES AND RESEARCH AND ARE NOT TO BE DISCLOSED TO OTHERS *
C *    OR USED FOR PURPOSES OTHER THAN INTENDED WITHOUT WRITTEN        *
C *    APPROVAL OF THE CENTER FOR LABORATORIES AND RESEARCH.           *
@


1.5
log
@nloop,iloop_removed
@
text
@d7 1
d9 24
@


1.4
log
@*** empty log message ***
@
text
@d39 1
a39 1
        CALL RDPRM(A,NLOOP,ILOOP,'PIXEL SIZE')
@


1.3
log
@rotation and center of the map corrected
@
text
@d82 1
a82 1
        ALLOCATE (AIMG(NROW,NSAM), STAT=IRTFLG)
@


1.2
log
@bad NAME2 variable replace with constant string
@
text
@d65 6
a70 6
        KX  = 0
        KY  = 0
        KZ  = 0
        IEX = NSAM-KX-1
        IEY = NROW-KY-1
        IEZ = NSLICE-KZ-1
d88 1
a88 1
        DO  K=1,NSLICE
d92 1
a92 1
           WRITE(LUN2,504)  K-1
d94 1
a94 2

           WRITE(LUN2,505)  ((AIMG(I,J),J=1,NROW),I=NSAM,1,-1)
a98 1
        SIGMA = (SIGMA**2)
d100 1
a100 1
        WRITE(LUN2,506)  SUM,SIGMA
a103 1
        RETURN
@


1.1
log
@Initial revision
@
text
@d28 1
a28 1
C        1         2         3         4         5         6         7
a31 1
        
d35 1
d37 1
a37 1
        CHARACTER *81   FILOLD,FILNEW,FILENAME 
d39 1
a39 1
        CALL RDPRM(A,NLOOP,ILOOP,'PIXEL SIZE ')
d43 4
a46 4
        BMIN = FMIN
        BMAX = FMAX
        SUM = AV
        SIGMA = SIG
d50 1
a50 1
     &	'OUTPUT',.TRUE.,IRTFLG)
d61 1
d65 6
a70 6
        KX=0
        KY=0
        KZ=0
        IEX=NSAM-KX-1
        IEY=NROW-KY-1
        IEZ=NSLICE-KZ-1
d74 2
a75 1
        ANG=90.0
d78 1
a80 1
C
d84 1
a84 1
           CALL ERRT(46,NAME2,IER)
d87 1
d93 2
a95 1
504        FORMAT(I8)
d99 1
a99 1
        K=-9999
d105 2
@
