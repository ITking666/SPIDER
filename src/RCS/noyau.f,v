head	1.27;
access;
symbols
	healthdept_2018:1.27
	pre_getangas:1.24
	GPL2010:1.24
	pre_GPL2010:1.23
	pre_var_equation:1.23
	pre_fftwrings:1.21
	pre_opfiles:1.20
	src:1.20
	best-code:1.20
	x-named-regs:1.20
	x:1.20
	v13-00:1.20
	pre_GPL:1.18
	prec_CA:1.13
	noindx:1.13
	Bproc:1.8
	oct21:1.8
	last77:1.7;
locks; strict;
comment	@c @;


1.27
date	2018.10.03.14.34.11;	author leith;	state Exp;
branches;
next	1.26;

1.26
date	2013.05.06.16.20.02;	author leith;	state Exp;
branches;
next	1.25;

1.25
date	2011.11.30.13.50.50;	author leith;	state Exp;
branches;
next	1.24;

1.24
date	2010.06.24.13.26.22;	author leith;	state Exp;
branches;
next	1.23;

1.23
date	2009.06.11.12.48.51;	author leith;	state Exp;
branches;
next	1.22;

1.22
date	2008.12.05.13.28.47;	author leith;	state Exp;
branches;
next	1.21;

1.21
date	2007.12.20.18.34.50;	author leith;	state Exp;
branches;
next	1.20;

1.20
date	2005.10.18.18.54.57;	author leith;	state Exp;
branches;
next	1.19;

1.19
date	2005.10.18.14.38.10;	author leith;	state Exp;
branches;
next	1.18;

1.18
date	2004.02.13.17.31.34;	author leith;	state Exp;
branches;
next	1.17;

1.17
date	2004.02.10.19.19.19;	author leith;	state Exp;
branches;
next	1.16;

1.16
date	2004.01.23.19.06.39;	author leith;	state Exp;
branches;
next	1.15;

1.15
date	2003.12.10.20.04.22;	author leith;	state Exp;
branches;
next	1.14;

1.14
date	2003.10.16.18.15.40;	author leith;	state Exp;
branches;
next	1.13;

1.13
date	2002.03.27.16.38.08;	author leith;	state Exp;
branches;
next	1.12;

1.12
date	2002.03.11.14.29.09;	author leith;	state Exp;
branches;
next	1.11;

1.11
date	2002.03.11.14.08.40;	author leith;	state Exp;
branches;
next	1.10;

1.10
date	2001.01.10.14.39.10;	author leith;	state Exp;
branches;
next	1.9;

1.9
date	2001.01.09.21.02.03;	author leith;	state Exp;
branches;
next	1.8;

1.8
date	99.08.09.20.44.22;	author pawel;	state Exp;
branches;
next	1.7;

1.7
date	99.03.12.14.05.26;	author leith;	state Exp;
branches;
next	1.6;

1.6
date	99.02.04.17.24.49;	author leith;	state Exp;
branches;
next	1.5;

1.5
date	97.10.10.17.49.05;	author pawel;	state Exp;
branches;
next	1.4;

1.4
date	96.06.14.14.57.20;	author liy;	state Exp;
branches;
next	1.3;

1.3
date	95.09.11.20.57.16;	author mladjadj;	state Exp;
branches;
next	1.2;

1.2
date	95.09.07.17.47.36;	author mladjadj;	state Exp;
branches;
next	1.1;

1.1
date	94.05.13.12.50.47;	author leith;	state Exp;
branches;
next	;


desc
@copied from USER2:[PSIDER.CMSREF] on 11 May 1994
@


1.27
log
@email_health_dept
@
text
@
C **********************************************************************
C                                                                      *
C NOYAU.F        ORIGINAL                                    31-JAN-86 *
C                DENDRO CALL ADDED TO PLOT DENDROGRAM        NOV 86 al *
C                DENDROGRAM DOC FILE BUGGY REMOVED           DEC 03 al *
C                CUTOFF CHANGED                              FEB 04 al *
C                FORMATTING CHANGED                          DEC 07 al *
C                COSMETIC OUTPUT CHANGES                     DEC 08 al * 
C                DOC FILE *                                  MAY 09 al *
C                DENDRO REWRITE                              MAY 09 al *
C                KV ADDED                                    NOV 11 al *
C
C **********************************************************************
C=*                                                                    *
C=* This file is part of:   SPIDER - Modular Image Processing System.  *
C=* SPIDER System Authors:  Joachim Frank & ArDean Leith               *
C=* Copyright 1985-2013  Health Research Inc.,                         *
C=* Riverview Center, 150 Broadway, Suite 560, Menands, NY 12204.      *
C=* Email: spider@@health.ny.gov                                        *
C=*                                                                    *
C=* SPIDER is free software; you can redistribute it and/or            *
C=* modify it under the terms of the GNU General Public License as     *
C=* published by the Free Software Foundation; either version 2 of the *
C=* License, or (at your option) any later version.                    *
C=*                                                                    *
C=* SPIDER is distributed in the hope that it will be useful,          *
C=* but WITHOUT ANY WARRANTY; without even the implied warranty of     *
C=* merchantability or fitness for a particular purpose.  See the GNU  *
C=* General Public License for more details.                           *
C=* You should have received a copy of the GNU General Public License  *
C=* along with this program. If not, see <http://www.gnu.org/licenses> *
C=*                                                                    *
C*---------------------------------------------------------------------*         
C                                                                      *         
C PURPOSE:  CLASSIFICATION ACCORDING TO FACTORIAL COORDINATES          *
C                                                                      *
C INPUT  ...  DATA AND WEIGHTS IN IMC FILE ON: LUNI (FORMATTED)        *         
C      N2DIM     = SUP (NKLA, 2*NCLAS)                                 *         
C      KDIM      = SUP (NUMIM, NCLAS**NBASE, 2*NKLA - 1)               *         
C      MDIM_8    = SUP (NKLA*(NKLA-1)/2)                               *         
C      LDIM      = SUP (NKLA)                                          *         
C      L2DIM     = SUP (2*NKLA - 1)                                    *         
C      NFAC      = NUMBER OF COORDINATES IN RECORD FOLLOWED BY WEIGHT  *         
C      KFAC      = NUMBER OF COORDINATES USED FOR CALCULATION          *         
C      NUMIM     = NUMBER OF OBJECTS TO BE CLASSIFIED                  *         
C      NBASE NITER ... PARAMETERS DEFINED IN SUBROUTINE PARST          * 
C      NCLAS NKLA  ... PARAMETERS DEFINED IN SUBROUTINE PARST          *
C                                                                      *
C WORKING ARRAYS:  GT(*,*) D(*) KLAS(*) CI(*) U(*) JV(*) JW(*)         * 
C                  U(), JV(), JW() EQUIVALENCED TO D()                 *         
C                                                                      *         
C  CALL TREE:   SCLASSI - NOYAU - PARST  - RETIR                       *
C                  |        |            - CLAST                       *
C                  |        |            - STABK - SHELK               *
C                  |        |                                          *
C                  |      NOYAU - DEUCL                                * 
C                  |      NOYAU - CHAVA                                *
C                  |      NOYAU - DENDRO - DENLST                      * 
C                  |      NOYAU - COUPE                                *
C                  |                                                   *
C               SCLASSI - RGRI                                         *    
C                                                                      *         
C*---------------------------------------------------------------------*         

      SUBROUTINE NOYAU(N2DIM,KDIM,MDIM,LDIM,L2DIM,NFAC,KFAC,NUMIM,          
     &                 KV,NBASE, NITER, NCLAS, NKLA, IDI,                
     &                 KLAS, D, U, JV, JW, IDK, CI, GT,               
     &                 NUM,LA,LB,IV,IW,V,W,NT,VAL,PK,NO,LUNI,LUNK,
     &                 LUNDOC)

         
        INCLUDE 'CMBLOCK.INC' 
        INCLUDE 'CMLIMIT.INC' 
        !COMMON /UNITS/LUN,NIN,NOUT,NECHO,IFOUND,NPROC,NDAT

        INTEGER *8 :: MCARD_8
        INTEGER    :: N2DIM,KDIM,LDIM,L2DIM,NFAC,KFAC,NUMIM
        INTEGER    :: KV(KFAC)
        INTEGER    :: NBASE,NITER,NCLAS,NKLA
        INTEGER    :: IDI(NUMIM),KLAS(NUMIM)
        REAL       :: GT(N2DIM,KFAC),D(MDIM),CI(NFAC),U(KDIM)
        INTEGER    :: JV(KDIM), JW(KDIM), IDK(NKLA)
        INTEGER    :: NUM(LDIM),LA(LDIM),LB(LDIM),NT(L2DIM),               
     &                NO(L2DIM),IV(LDIM),IW(LDIM)                    
        REAL       :: VAL(L2DIM),PK(L2DIM),W(LDIM),V(LDIM)                    
        INTEGER    :: LUNI,LUNK, LUNDOC

        IRTFLG = 0

C       AGGREGATION AROUND MOBILE CENTERS AND STABLE CLUSTERING             
        CALL PARST(N2DIM,KDIM,NFAC,NUMIM,KFAC,NBASE,NITER,NCLAS,NKLA,            
     &                       KLAS,JW,U,CI,JV,GT, KFIN,LUNI,LUNK,IDI,KV)              
                                                                               
C       HIERARCHICAL CLASSIFICATION OF THE CLUSTER GRAVITY                  
C       CENTERS ACCORDING TO THE WARD'S VARIANCE CRITERION                  

C       IMPORTANT CHANGE: LIMIT NUMBER OF CLUSTERS USED IN HAC. 8/25/86

        WRITE(NDAT,*)' CLASS ASSIGNMENT FOR EACH IMAGE:'
        WRITE(NDAT,'(10I5)') (KLAS(K),K=1,NUMIM)

        IRANGE1 = MINVAL(JV(1:NKLA))  ! JV IS OCCUPANCY LEVEL
        IRANGE2 = MAXVAL(JV(1:NKLA))

        IF (NDAT .NE. NOUT) WRITE(NOUT,91)IRANGE1,IRANGE2,NKLA
        WRITE(NDAT,91) IRANGE1,IRANGE2, NKLA
91      FORMAT(/'  CLASS OCCUPANCY: ',I7,'....',I7,'   CLASSES: ',I6,/)

        ILEVL = IRANGE1
        CALL RDPRI1S(ILEVL,NOT_USED,
     &      'OCCUPANCY LEVEL FOR CLASS CUTOFF (<CR> = NO CUTOFF)',
     &      IRTFLG)
        IF (IRTFLG .NE. 0) RETURN

        IF (ILEVL .NE. IRANGE1) THEN
           DO I=1,NKLA
              IF (JV(I) < ILEVL) THEN
                 NKLA = I - 1
                 EXIT
              ENDIF
            ENDDO
         ENDIF

        IF (NDAT .NE. NOUT) WRITE(NOUT,92)NKLA
        WRITE(NDAT,92) NKLA
92      FORMAT(/,'  USING: ',I6,' CLASSES.')

C       READS FROM _IMC TO CONSTRUCT MONO-INDEXED TABLE OF DISTANCES 
C       BETWEEN NKLA CLASSES IN THE EUCLIDEAN SPACE CHARACTERIZED 
C       BY THE KFAC FIRST FACTORIAL COORDINATES. READS FROM: LUNI                             *         
C       OUTPUTS: D, GT & PK

        IF (NKLA > KFIN) NKLA = KFIN                              
        MCARD = NKLA * (NKLA-1) / 2 
                             
        CALL DEUCL(N2DIM,NKLA,MCARD,NUMIM,KFAC,NFAC,KLAS,
     &             D,GT,PK,CI,LUNI)

C       CHAVA OVERWRITES AND THEN READS FROM: LUNK
        JFIN    = 2 * NKLA - 1                                
        MCARD_8 = MCARD
        CALL CHAVA(NKLA,MCARD_8,JFIN,D,PK,VAL,LA,LB,NT,NO,LUNK,5)                  
                                          
C       SAVES CLASSIFICATION TO FILE BY OVERWRITING: LUNK                                                                                                                     
        CALL REW(LUNK,0)                                                         
        WRITE(LUNK) NUMIM, NFAC, NKLA, KFAC                 
        WRITE(LUNK) (KLAS(I), I=1,NUMIM), 
     &              (IDI(I), I=1,NUMIM),                   
     &              (PK(L),L=1,NKLA), 
     &              ((GT(L,J),L=1,NKLA),J=1,KFAC)              
                                                                               
C     GENERATION OF IDENTIFIERS, ADDED 1/2001 al SEEMS TO BE
C     NEEDED IN DENDRO BUT REMOVED BY pp SOMETIME ??
      DO I = 1,NKLA
         IDK(I) = I
      ENDDO
       
#ifdef NEVER   
      write(0,*) ' l2dim,nkla,jfin: ',l2dim,nkla,jfin
#endif
          
C     DRAW CLASSIFICATION TREE OF THE NKLA CENTERS                             
      CALL DENDRO(NKLA, JFIN, VAL, LA, LB, PK, IDK, KLAS,NUMIM,IDI,
     &              .TRUE., NO,NUM,NT,IV,IW,V,W)             

C     SUCCESSIVE TRUNCATIONS OF THE CLASS. 
      DO KPRO =2,NKLA-1                                                   
         CALL COUPE(NUMIM,NKLA,KPRO, PK,LA,LB,IV,KLAS,NT, IW)                     

C        TRUNCATED TREE OUTPUT APPENDED TO LUNK 
         WRITE(LUNK) (IV(J), J=1,NKLA)                                           
      ENDDO

      END






@


1.26
log
@cosmetic, tabs, MCARD_8 on chava call,
@
text
@d20 1
a20 1
C=* Email: spider@@wadsworth.org                                        *
@


1.25
log
@factor list (KV) added
@
text
@d13 1
d18 1
a18 1
C=* Copyright 1985-2011  Health Research Inc.,                         *
d41 1
a41 1
C      MDIM      = SUP (NKLA*(NKLA-1)/2)                               *         
d73 1
d75 1
a75 1
        COMMON /UNITS/LUN,NIN,NOUT,NECHO,IFOUND,NPROC,NDAT
d77 11
a87 14
        INTEGER   :: N2DIM,KDIM,MDIM,LDIM,L2DIM,NFAC,KFAC,NUMIM
        INTEGER   :: KV(KFAC)
        INTEGER   :: NBASE,NITER,NCLAS,NKLA
        INTEGER   :: IDI(NUMIM),KLAS(NUMIM)
        REAL      :: GT(N2DIM,KFAC),D(MDIM),CI(NFAC),U(KDIM)
        INTEGER   :: JV(KDIM), JW(KDIM), IDK(NKLA)
        INTEGER   :: NUM(LDIM),LA(LDIM),LB(LDIM),NT(L2DIM),               
     &               NO(L2DIM),IV(LDIM),IW(LDIM)                    
        REAL      :: VAL(L2DIM),PK(L2DIM),W(LDIM),V(LDIM)                    
        INTEGER   :: LUNI,LUNK, LUNDOC

        CHARACTER(LEN=MAXNAM) :: DOCNAM
        CHARACTER(LEN=1)      :: ANS
        CHARACTER(LEN=1)      :: NULL  = CHAR(0)
d101 1
a101 1
	WRITE(NDAT,'(10I5)') (KLAS(K),K=1,NUMIM)
d106 1
a106 1
        IF (NDAT.NE.NOUT) WRITE(NOUT,91)IRANGE1,IRANGE2,NKLA
d111 1
a111 1
 	CALL RDPRI1S(ILEVL,NOT_USED,
d116 1
a116 1
 	IF (ILEVL .NE. IRANGE1) THEN
d122 1
a122 1
	    ENDDO
d125 1
a125 1
        IF (NDAT.NE.NOUT) WRITE(NOUT,92)NKLA
d134 1
a134 1
        IF (NKLA .GT. KFIN) NKLA = KFIN                              
d141 3
a143 2
        JFIN  = 2 * NKLA - 1                                
        CALL CHAVA(NKLA,MCARD,JFIN,D,PK,VAL,LA,LB,NT,NO,LUNK,5)                  
a176 26
C ---------------- CLULST ------------------- UNUSED 2011?? -----------

       SUBROUTINE CLULST(LUNDOC,NUMIM,KLAS,IDI,IRTFLG)

       INCLUDE 'CMLIMIT.INC' 

       INTEGER                :: KLAS(NUMIM),IDI(NUMIM)
       CHARACTER (LEN=MAXNAM) :: DOCNAM
       LOGICAL                :: NEWFILE
       REAL, DIMENSION(2)     :: DLIST
 
       CALL OPENDOC(DOCNAM,.TRUE.,NLET,LUNDOC,LUNDOCT,.TRUE.,
     &               'IMAGE CLASS ASSIGNMENT OUTPUT DOC',
     &               .FALSE.,.FALSE.,.TRUE.,NEWFILE,IRTFLG)
       IF (IRTFLG .NE. 0)RETURN

       CALL LUNDOCPUTCOM(LUNDOCT,'KEY: IMAGE NUMBER,   CLASS',IRTFLG)

       DO  I =1,NUMIM
           IM       = IDI(I)
           DLIST(2) = KLAS(I)
           CALL LUNDOCWRTDAT(LUNDOCT,IM,DLIST(2),1,IRTFLG)
       ENDDO

       CLOSE(LUNDOCT)
       END
@


1.24
log
@GPL_2010
@
text
@d3 10
a12 9
C
C NOYAU.F                                                     31-JAN-86                         
C                DENDRO CALL ADDED TO PLOT DENDROGRAM         NOV 86 al 
C                DENDROGRAM DOC FILE BUGGY REMOVED            DEC 03 al
C                CUTOFF CHANGED                               FEB 04 al
C                FORMATTING CHANGED                           DEC 07 al
C                COSMETIC OUTPUT CHANGES                      DEC 08 al                                                *
C                DOC FILE *                                   MAY 09 al                                                *
C                DENDRO REWRITE                               MAY 09 al                                                *
d17 1
a17 1
C=* Copyright 1985-2010  Health Research Inc.,                         *
d38 8
a45 8
C      N2DIM     = SUP (NKLA, 2*NCLAS)                                      *         
C      KDIM      = SUP (NUMIM, NCLAS**NBASE, 2*NKLA - 1)                    *         
C      MDIM      = SUP (NKLA*(NKLA-1)/2)                                    *         
C      LDIM      = SUP (NKLA)                                               *         
C      L2DIM     = SUP (2*NKLA - 1)                                         *         
C      NFAC      = NUMBER OF COORDINATES IN RECORD FOLLOWED BY WEIGHT       *         
C      KFAC      = NUMBER OF COORDINATES USED FOR CALCULATION               *         
C      NUMIM     = NUMBER OF OBJECTS TO BE CLASSIFIED                       *         
d52 11
d66 1
a66 1
     &                 NBASE, NITER, NCLAS, NKLA, IDI,                
d75 15
a89 9
        DIMENSION GT(N2DIM,KFAC),D(MDIM),KLAS(NUMIM),CI(NFAC),
     &            IDI(NUMIM), U(KDIM), JV(KDIM), JW(KDIM), IDK(NKLA)                         
        DIMENSION NUM(LDIM),LA(LDIM),LB(LDIM),NT(L2DIM),VAL(L2DIM),               
     &            PK(L2DIM),NO(L2DIM),IV(LDIM),W(LDIM),IW(LDIM),V(LDIM)                    

        CHARACTER(LEN=MAXNAM)             :: DOCNAM
        CHARACTER(LEN=1)                  ::  NULL,ANS
        
        NULL   = CHAR(0)
d94 1
a94 1
     &                        KLAS,JW,U,CI,JV,GT, KFIN,LUNI,LUNK,IDI)              
d102 1
a102 2
	WRITE(NDAT,90) (KLAS(K),K=1,NUMIM)
90      FORMAT(10I5)
d119 1
a119 1
              IF (JV(I) .LT. ILEVL) THEN
d160 1
a160 1
        write(0,*) ' l2dim,nkla,jfin: ',l2dim,nkla,jfin
d163 2
a164 2
C       DRAW CLASSIFICATION TREE OF THE NKLA CENTERS                             
        CALL DENDRO(NKLA, JFIN, VAL, LA, LB, PK, IDK, KLAS,NUMIM,IDI,
d167 3
a169 3
C       SUCCESSIVE TRUNCATIONS OF THE CLASS. 
        DO KPRO =2,NKLA-1                                                   
           CALL COUPE(NUMIM,NKLA,KPRO, PK,LA,LB,IV,KLAS,NT, IW)                     
d171 3
a173 3
C          TRUNCATED TREE OUTPUT APPENDED TO LUNK 
           WRITE(LUNK) (IV(J), J=1,NKLA)                                           
        ENDDO
d175 1
a175 1
        END
d177 1
a177 1
C ---------------- CLULST --------------------------------------------
@


1.23
log
@rewrite of dendrogram
@
text
@a12 2
C=* FROM: SPIDER - MODULAR IMAGE PROCESSING SYSTEM.   AUTHOR: J.FRANK  *
C=* Copyright (C) 1985-2009  Health Research Inc.                      *
d14 5
a18 2
C=* HEALTH RESEARCH INCORPORATED (HRI),                                *   
C=* ONE UNIVERSITY PLACE, RENSSELAER, NY 12144-3455.                   *
d20 1
a20 3
C=* Email:  spider@@wadsworth.org                                       *
C=*                                                                    *
C=* This program is free software; you can redistribute it and/or      *
d25 1
a25 1
C=* This program is distributed in the hope that it will be useful,    *
d27 1
a27 1
C=* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  *
a28 1
C=*                                                                    *
d30 1
a30 3
C=* along with this program; if not, write to the                      *
C=* Free Software Foundation, Inc.,                                    *
C=* 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.      *
@


1.22
log
@refactor
@
text
@d9 3
a11 1
C                COSMETIC OUTPUT CHANGES                      DEC  08 al                                                *
d14 1
a14 1
C=* Copyright (C) 1985-2008  Health Research Inc.                      *
a54 1
C                                                                      *
d63 2
d72 3
a74 2
        CHARACTER * 1  NULL,ANS

d83 1
a83 1
C       CENTERS ACCORDING TO THE VARIANCE CRITERION (WARD)                  
d85 1
a85 2
C       IMPORTANT CHANGE: LIMIT THE NUMBER OF CLUSTERS TO BE USED
C       IN THE HAC. 8/25/86
d91 1
a91 1
        IRANGE1 = MINVAL(JV(1:NKLA))
d100 2
a101 1
     &      'LEVEL FOR CLASS CUTOFF (<CR> = NO CUTOFF)',IRTFLG)
a121 1

d140 5
a144 5
C       GENERATION OF IDENTIFIERS, ADDED 1/2001 al SEEMS TO BE
C       NEEDED IN DENDRO BUT REMOVED BY pp SOMETIME ??
        DO I = 1,NKLA                   
           IDK(I) = I
        ENDDO
a145 5
C       WRITE IMAGE CLASS DOC FILE
        CALL CLULST(LUNDOC,NUMIM,KLAS,IDI,IRTFLG)

C       CLASSIFICATION TREE OF THE NKLA CENTERS                             
 
a146 2
c---------------
        write(0,*) ' --------------------'
a147 4
999     format(10f8.2)
        write(0,*) '  '
        write(0,*) '  '
c------------------------  
d150 3
a152 28
        IRT = 0                                                              
        CALL RDPRMC(ANS,NA,.TRUE.,
     &   'DO YOU WANT A DENDROGRAM POSTSCRIPT PLOT? (Y/T/N)',NULL,IRT)

        IF (ANS .EQ. 'T') THEN
C          PLOT TRUNCATED DENDROGRAM USING POSTSCRIPT
           CALL DENDRO2(NKLA, JFIN, VAL, LA, LB, PK, IDK,
     &                 NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)             

        ELSEIF (ANS .NE. 'N') THEN
C          PLOT UN-TRUNCATED DENDROGRAM USING POSTSCRIPT
           CALL DENDRO(NKLA, JFIN, VAL, LA, LB, PK, IDK,
     &                 NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)             

        ELSE
C          NO DENDROGRAM USING POSTSCRIPT
           CALL ARBRE(NKLA, JFIN, VAL, LA, LB, PK, IDK,   
     &                NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)
        ENDIF

C       CAN LIST THE DENDROGRAM IN DOCUMENT FILE IF DESIRED
        CALL RDPRMC(ANS,NA,.TRUE.,
     &    'DO YOU WANT A DENDROGRAM DOC. FILE? (Y/N)',NULL,IRT)

        IF (ANS .NE. 'N') THEN
C          MAKE A DENDROGRAM DOC. FILE
           CALL DENLST(LUNDOC,VMIN,VMAX,NKLA,V,NUM,IRTFLG)
        ENDIF
a190 73
#ifdef NEVER_DEAD_END_IDEA
C ---------------- DENLST_PLUS --------------------------------------------

C **********************************************************************
C
C    DENLST_PLUS(LUNDOC,VMIN,VMAX,NKLA,V,NUM,NUMIM,KLAS,IDI,IRTFLG)
C
C--*********************************************************************

       SUBROUTINE DENLST_PLUS(LUNDOC,VMIN,VMAX,NKLA,V,NUM,
     &                        NUMIM,KLAS,IDI,IRTFLG)

       INCLUDE 'CMLIMIT.INC' 
       COMMON /UNITS/ LUNC,NIN,NOUT

       REAL                   :: V(NKLA),DLIST(2)
       INTEGER                :: KLAS(NUMIM),IDI(NUMIM)
       INTEGER                :: NUM(NKLA)
       CHARACTER (LEN=MAXNAM) :: DOCNAM
       LOGICAL                :: NEWFILE

       IF (VMAX .EQ. VMIN) THEN
C          PREVENT DIVISION BY ZERO
           CALL ERRT(101,'DENLST ABORTED TO AVOID DIVISION BY 0',NE)
           IRTFLG = 1
           RETURN
       ENDIF

       CALL OPENDOC(DOCNAM,.TRUE.,NLET,LUNDOC,LUNDOCT,.TRUE.,
     &               'DENDROGRAM OUTPUT DOC',
     &               .FALSE.,.FALSE.,.TRUE.,NEWFILE,IRTFLG)
       IF (IRTFLG .NE. 0) RETURN

C      PUT HEADER COMMENT IN DOC FILE
       CALL LUNDOCPUTCOM(LUNDOCT,'KEY, CLASS NUMBER,   HEIGHT',IRTFLG)

C      NORMALIZATION FACTOR
       FACT = 1.0 / (VMAX - VMIN)

       DO  I = 1,NKLA
C         FIND CURRENT CLASS NUMBER
          ICLASS = NUM(I)

          DO N = 1,NUMIM      ! LOOP OVER ALL IMAGES
              IF (KLAS(N) .EQ. ICLASS) THEN
C                THIS IMAGE IS WITHIN CURRENT CLASS

                 DLIST(1) = IDI(N)

C                SET HEIGHT TO ZERO
                 DLIST(2) = 0.0

C                STORE THIS LINE IN DOC FILE
                 CALL LUNDOCWRTDAT(LUNDOCT,I,DLIST,2,IRTFLG)
              ENDIF
          ENDDO

          DLIST(1) = ICLASS

C         NORMALIZE THE V VALUES FROM 0...1.0
          DLIST(2) = (V(I) - VMIN) * FACT
C         CONVERT V TO ZERO IF ALMOST ZERO
          IF (DLIST(2) .LT. 0.04) DLIST(2) = 0.0
 
C         STORE THIS LINE IN DOC FILE
          CALL LUNDOCWRTDAT(LUNDOCT,I,DLIST,2,IRTFLG)
       ENDDO

       CLOSE(LUNDOCT)
       IRTFLG = 0

       END
#endif
@


1.21
log
@NFAC,KFAC,READ BUG & REFORMATTING
@
text
@d9 1
d12 1
a12 1
C=* Copyright (C) 1985-2005  Health Research Inc.                      *
d39 10
a48 9
C N2DIM     = SUP (NKLA, 2*NCLAS)                                      *         
C KDIM      = SUP (NUMIM, NCLAS**NBASE, 2*NKLA - 1)                    *         
C MDIM      = SUP (NKLA*(NKLA-1)/2)                                    *         
C LDIM      = SUP (NKLA)                                               *         
C L2DIM     = SUP (2*NKLA - 1)                                         *         
C NFAC      = NUMBER OF COORDINATES IN RECORD FOLLOWED BY WEIGHT       *         
C KFAC      = NUMBER OF COORDINATES USED FOR CALCULATION               *         
C NUMIM     = NUMBER OF OBJECTS TO BE CLASSIFIED                       *         
C NBASE NITER NCLAS NKLA ... PARAMETERS DEFINED IN SUBROUTINE PARST    *
a70 2
        DATA NDOC/10/

d92 1
a92 1
        WRITE(NDAT,91)IRANGE1,IRANGE2, NKLA
d111 1
a111 1
92      FORMAT(/,2X,'USING: ',I6,' CLASSES.')
d116 2
d120 2
a121 1
        MCARD = NKLA * (NKLA-1) / 2                              
d147 11
a157 1
                 
d163 1
d168 1
d173 1
d184 1
a184 1
           CALL DENLST(NDOC,VMIN,VMAX,NKLA,V,NUM,IRTFLG)
d224 76
@


1.20
log
@GPL
@
text
@d3 7
d33 20
a52 26
C **********************************************************************
C----------------------------------------------------------------------        
C NOYAU.F                                                     31-JAN-86                         
C                DENDRO CALL ADDED TO PLOT DENDROGRAM         NOV 86 al 
C                DENDROGRAM DOC FILE BUGGY REMOVED            DEC 03 al
C                CUTOFF CHANGED                               FEB 04 al
C*--------------------------------------------------------------------*         
C                                                                     *         
C PURPOSE:  CLASSIFICATION ACCORDING TO FACTORIAL COORDINATES         *
C                                                                     *
C INPUT  ...  DATA AND WEIGHTS IN /LUNI/ UNFORMATTED                  *         
C N2DIM     = SUP (NKLA, 2*NCLAS)                                     *         
C KDIM      = SUP (NUMIM, NCLAS**NBASE, 2*NKLA - 1)                   *         
C MDIM      = SUP (NKLA*(NKLA-1)/2)                                   *         
C LDIM      = SUP (NKLA)                                              *         
C L2DIM     = SUP (2*NKLA - 1)                                        *         
C NFAC      = NUMBER OF COORDINATES IN RECORD FOLLOWED BY WEIGHT      *         
C KFAC      = NUMBER OF COORDINATES USED FOR CALCULATION              *         
C NUMIM     = NUMBER OF OBJECTS TO BE CLASSIFIED                      *         
C NBASE NITER NCLAS NKLA ... PARAMETERS DEFINED IN SUBROUTINE PARST   *
C                                                                     *
C WORKING ARRAYS:  GT(*,*) D(*) KLAS(*) CI(*) U(*) JV(*) JW(*)        * 
C                  U(), JV(), JW() EQUIVALENCED TO D()                *         
C                                                                     *         
C
C*--------------------------------------------------------------------*         
d54 1
a54 1
      SUBROUTINE NOYAU(N2DIM,KDIM,MDIM,LDIM,L2DIM,NFAC,KFAC,NUMIM,KV,          
d57 2
a58 1
     &                 NUM,LA,LB,IV,IW,V,W,NT,VAL,PK,NO,LUNI,LUNK)
a66 2
        PARAMETER      (LFA=16)
        DIMENSION      KV(LFA)   
d84 1
a84 1
        WRITE(NOUT,*)'  CLASS ASSIGNMENT FOR EACH IMAGE:'
d86 1
a86 1
90      FORMAT(20I5)
a89 2
        WRITE(NOUT,91)IRANGE1,IRANGE2,NKLA
91      FORMAT('  CLASS RANGE: ',I7,'....',I7,'   CLASSES: ',I6)
d91 3
a93 15
#ifdef NEVER
        CALL RDPRM(PERC,NOT_USED,
     &      'PERCENT FOR CLASS CUTOFF (0=NO CUTOFF)')

c        IF (PERC .NE. 0.0) THEN
          NTH = 0.01 * PERC * FLOAT(NUMIM) + 0.5
          DO I=1,NKLA
            WRITE(NOUT,*) '(JV(',i,'):',JV(I),NTH
            IF (JV(I) .LT. NTH) THEN
               NKLA = I-1
               EXIT
            ENDIF
          ENDDO
c        ENDIF
        WRITE(NOUT,92)NKLA
a94 1
#endif
a101 2
CC              WRITE(NOUT,*) '(JV(',i,'):',JV(I)

d103 1
a103 1
                 NKLA = I-1
d109 7
a115 2
        WRITE(NOUT,92)NKLA
92      FORMAT('  USING: ',I6,' CLASSES.')
d122 1
d126 1
a126 1
C       SAVE CLASSIFICATION ON LUNK                                                                                                                      
d128 5
a132 3
        WRITE(LUNK) NUMIM, NFAC, NKLA, KFAC, (KV(K), K=1, KFAC)                 
        WRITE(LUNK) (KLAS(I), I=1,NUMIM), (IDI(I), I=1,NUMIM),                   
     &              (PK(L),L=1,NKLA), ((GT(L,J),L=1,NKLA),J=1,KFAC)              
d139 3
d171 1
a171 1
C       SUCCESSIVE TRUNCATIONS OF THE CLASS. TREE OUTPUT RESULTS TO LUNK 
d174 2
d180 29
@


1.19
log
@GPL License added
@
text
@d1 183
@


1.18
log
@removed  WRITE(NOUT,*) '(JV(',i,'):',JV(I)
@
text
@a0 157
C----------------------------------------------------------------------        
C NOYAU.F                                                     31-JAN-86                         
C                DENDRO CALL ADDED TO PLOT DENDROGRAM         NOV 86 al 
C                DENDROGRAM DOC FILE BUGGY REMOVED            DEC 03 al
C                CUTOFF CHANGED                               FEB 04 al
C*--------------------------------------------------------------------*         
C                                                                     *         
C PURPOSE:  CLASSIFICATION ACCORDING TO FACTORIAL COORDINATES         *
C                                                                     *
C INPUT  ...  DATA AND WEIGHTS IN /LUNI/ UNFORMATTED                  *         
C N2DIM     = SUP (NKLA, 2*NCLAS)                                     *         
C KDIM      = SUP (NUMIM, NCLAS**NBASE, 2*NKLA - 1)                   *         
C MDIM      = SUP (NKLA*(NKLA-1)/2)                                   *         
C LDIM      = SUP (NKLA)                                              *         
C L2DIM     = SUP (2*NKLA - 1)                                        *         
C NFAC      = NUMBER OF COORDINATES IN RECORD FOLLOWED BY WEIGHT      *         
C KFAC      = NUMBER OF COORDINATES USED FOR CALCULATION              *         
C NUMIM     = NUMBER OF OBJECTS TO BE CLASSIFIED                      *         
C NBASE NITER NCLAS NKLA ... PARAMETERS DEFINED IN SUBROUTINE PARST   *
C                                                                     *
C WORKING ARRAYS:  GT(*,*) D(*) KLAS(*) CI(*) U(*) JV(*) JW(*)        * 
C                  U(), JV(), JW() EQUIVALENCED TO D()                *         
C                                                                     *         
C
C*--------------------------------------------------------------------*         

      SUBROUTINE NOYAU(N2DIM,KDIM,MDIM,LDIM,L2DIM,NFAC,KFAC,NUMIM,KV,          
     &                 NBASE, NITER, NCLAS, NKLA, IDI,                
     &                 KLAS, D, U, JV, JW, IDK, CI, GT,               
     &                 NUM,LA,LB,IV,IW,V,W,NT,VAL,PK,NO,LUNI,LUNK)

        COMMON /UNITS/LUN,NIN,NOUT,NECHO,IFOUND,NPROC,NDAT

        DIMENSION GT(N2DIM,KFAC),D(MDIM),KLAS(NUMIM),CI(NFAC),
     &            IDI(NUMIM), U(KDIM), JV(KDIM), JW(KDIM), IDK(NKLA)                         
        DIMENSION NUM(LDIM),LA(LDIM),LB(LDIM),NT(L2DIM),VAL(L2DIM),               
     &            PK(L2DIM),NO(L2DIM),IV(LDIM),W(LDIM),IW(LDIM),V(LDIM)                    

        PARAMETER      (LFA=16)
        DIMENSION      KV(LFA)   
        CHARACTER * 1  NULL,ANS

        DATA NDOC/10/

        NULL   = CHAR(0)
        IRTFLG = 0

C       AGGREGATION AROUND MOBILE CENTERS AND STABLE CLUSTERING             
        CALL PARST(N2DIM,KDIM,NFAC,NUMIM,KFAC,NBASE,NITER,NCLAS,NKLA,            
     &                        KLAS,JW,U,CI,JV,GT, KFIN,LUNI,LUNK,IDI)              
                                                                               
C       HIERARCHICAL CLASSIFICATION OF THE CLUSTER GRAVITY                  
C       CENTERS ACCORDING TO THE VARIANCE CRITERION (WARD)                  

C       IMPORTANT CHANGE: LIMIT THE NUMBER OF CLUSTERS TO BE USED
C       IN THE HAC. 8/25/86

        WRITE(NOUT,*)'  CLASS ASSIGNMENT FOR EACH IMAGE:'
	WRITE(NDAT,90) (KLAS(K),K=1,NUMIM)
90      FORMAT(20I5)

        IRANGE1 = MINVAL(JV(1:NKLA))
        IRANGE2 = MAXVAL(JV(1:NKLA))
        WRITE(NOUT,91)IRANGE1,IRANGE2,NKLA
91      FORMAT('  CLASS RANGE: ',I7,'....',I7,'   CLASSES: ',I6)

#ifdef NEVER
        CALL RDPRM(PERC,NOT_USED,
     &      'PERCENT FOR CLASS CUTOFF (0=NO CUTOFF)')

c        IF (PERC .NE. 0.0) THEN
          NTH = 0.01 * PERC * FLOAT(NUMIM) + 0.5
          DO I=1,NKLA
            WRITE(NOUT,*) '(JV(',i,'):',JV(I),NTH
            IF (JV(I) .LT. NTH) THEN
               NKLA = I-1
               EXIT
            ENDIF
          ENDDO
c        ENDIF
        WRITE(NOUT,92)NKLA

#endif
        ILEVL = IRANGE1
 	CALL RDPRI1S(ILEVL,NOT_USED,
     &      'LEVEL FOR CLASS CUTOFF (<CR> = NO CUTOFF)',IRTFLG)
        IF (IRTFLG .NE. 0) RETURN

 	IF (ILEVL .NE. IRANGE1) THEN
           DO I=1,NKLA
CC              WRITE(NOUT,*) '(JV(',i,'):',JV(I)

              IF (JV(I) .LT. ILEVL) THEN
                 NKLA = I-1
                 EXIT
              ENDIF
	    ENDDO
         ENDIF

        WRITE(NOUT,92)NKLA
92      FORMAT('  USING: ',I6,' CLASSES.')

        IF (NKLA .GT. KFIN) NKLA = KFIN                              
        MCARD = NKLA * (NKLA-1) / 2                              
        CALL DEUCL(N2DIM,NKLA,MCARD,NUMIM,KFAC,NFAC,KLAS,
     &             D,GT,PK,CI,LUNI)

        JFIN  = 2 * NKLA - 1                                
        CALL CHAVA(NKLA,MCARD,JFIN,D,PK,VAL,LA,LB,NT,NO,LUNK,5)                  
                                          
C       SAVE CLASSIFICATION ON LUNK                                                                                                                      
        CALL REW(LUNK,0)                                                         
        WRITE(LUNK) NUMIM, NFAC, NKLA, KFAC, (KV(K), K=1, KFAC)                 
        WRITE(LUNK) (KLAS(I), I=1,NUMIM), (IDI(I), I=1,NUMIM),                   
     &              (PK(L),L=1,NKLA), ((GT(L,J),L=1,NKLA),J=1,KFAC)              
                                                                               
C       GENERATION OF IDENTIFIERS, ADDED 1/2001 al SEEMS TO BE
C       NEEDED IN DENDRO BUT REMOVED BY pp SOMETIME ??
        DO I = 1,NKLA                   
           IDK(I) = I
        ENDDO

C       CLASSIFICATION TREE OF THE NKLA CENTERS                             
                 
        IRT = 0                                                              
        CALL RDPRMC(ANS,NA,.TRUE.,
     &   'DO YOU WANT A DENDROGRAM POSTSCRIPT PLOT? (Y/T/N)',NULL,IRT)

        IF (ANS .EQ. 'T') THEN
           CALL DENDRO2(NKLA, JFIN, VAL, LA, LB, PK, IDK,
     &                 NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)             

        ELSEIF (ANS .NE. 'N') THEN
           CALL DENDRO(NKLA, JFIN, VAL, LA, LB, PK, IDK,
     &                 NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)             

        ELSE
           CALL ARBRE(NKLA, JFIN, VAL, LA, LB, PK, IDK,   
     &                NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)
        ENDIF

C       CAN LIST THE DENDROGRAM IN DOCUMENT FILE IF DESIRED
        CALL RDPRMC(ANS,NA,.TRUE.,
     &    'DO YOU WANT A DENDROGRAM DOC. FILE? (Y/N)',NULL,IRT)

        IF (ANS .NE. 'N') THEN
C          MAKE A DENDROGRAM DOC. FILE
           CALL DENLST(NDOC,VMIN,VMAX,NKLA,V,NUM,IRTFLG)
        ENDIF

C       SUCCESSIVE TRUNCATIONS OF THE CLASS. TREE OUTPUT RESULTS TO LUNK 
        DO KPRO =2,NKLA-1                                                   
           CALL COUPE(NUMIM,NKLA,KPRO, PK,LA,LB,IV,KLAS,NT, IW)                     
           WRITE(LUNK) (IV(J), J=1,NKLA)                                           
        ENDDO

        END
@


1.17
log
@1+80 bug, cosmetic
@
text
@d91 1
a91 1
              WRITE(NOUT,*) '(JV(',i,'):',JV(I)
@


1.16
log
@dendrogram doc file bug
@
text
@d5 1
d22 1
a22 1
C                  U(), JV(), JW() EQUIVALENCED TO D()                       *         
a23 2
C   DENDRO CALL ADDED TO PLOT DENDROGRAM         NOV 86 al 
C   DENDROGRAM DOC FILE BUGGY REMOVED            DEC 03 al
d58 1
d62 7
a68 1
	CALL RDPRM(PERC,NOT_USED,
d71 1
a71 1
	IF (PERC .NE. 0.0) THEN
d74 1
d79 23
a101 2
	  ENDDO
        ENDIF
d105 2
a106 2
        CALL DEUCL(N2DIM,NKLA,MCARD,NUMIM,KFAC,NFAC,            
     &            KLAS, D, GT, PK, CI, LUNI)
d109 1
a109 2
        CALL CHAVA(NKLA,MCARD,JFIN,
     &             D,PK,VAL,LA,LB,NT,NO,LUNK,5)                  
d119 3
a121 2
                            
        IDK(1:NKLA) = K
@


1.15
log
@DENDROGRAM IN DOCUMENT FILE removed
@
text
@d114 1
a114 1
C       CAN LIST THE DENDROGRAM IN DOC. FILE FOR WEB IF DESIRED - liy
d116 1
a116 1
     &      'DO YOU WANT A CLUSTER DOC FILE? (Y/N)',NULL,IRT)
d119 2
a120 2
           CALL CLUSTERLST(NDOC,VMIN,VMAX,NKLA,V,NUM,
     &         NUMIM,KLAS,IDI,IRTFLG)
@


1.14
log
@CA rewrite
@
text
@d1 4
a4 2
C----------------------------------=*=----------------------------------        
C *NAME* = NOYAU.FOR                   31-JAN-86      13:23:08                  
d6 3
a8 2
C*                                                                    *         
C PURPOSE:  CLASSIFICATION ACCORDING TO FACTORIAL COORDINATES         *         
d18 4
a21 3
C NBASE NITER NCLAS NKLA ... PARAMETERS DEFINED IN SUBROUTINE PARST   *         
C          WORKING ARRAYS  GT(*,*) D(*) KLAS(*) CI(*) U(*) JV(*) JW(*)*         
C           U(), JV(), JW() EQUIVALENCED TO D()                       *         
d23 2
a24 1
C   DENDRO CALL ADDED NOV 86 al TO PLOT DENDROGRAM 
d35 2
a36 2
      DIMENSION GT(N2DIM,KFAC),D(MDIM),KLAS(NUMIM),CI(NFAC),IDI(NUMIM),         
     &          U(KDIM), JV(KDIM), JW(KDIM), IDK(NKLA)                         
d38 1
a38 1
     &       PK(L2DIM),NO(L2DIM),IV(LDIM),W(LDIM),IW(LDIM),V(LDIM)                    
d46 2
a47 1
        NULL = CHAR(0)
d59 2
a60 2
	WRITE(NDAT,1111) (KLAS(K),K=1,NUMIM)
1111	FORMAT(20I5)
d93 1
a93 3
        DO  K=1,NKLA
           IDK(K) = K
        ENDDO
d96 2
a97 1
                                                                               
d102 2
a103 2
         CALL DENDRO2(NKLA, JFIN, VAL, LA, LB, PK, IDK,
     &               NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)             
d105 3
a107 3
        ELSEIF (ANS .NE. 'N' .AND. ANS .NE. 'n') THEN
         CALL DENDRO(NKLA, JFIN, VAL, LA, LB, PK, IDK,
     &               NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)             
d110 2
a111 10
         CALL ARBRE(NKLA, JFIN, VAL, LA, LB, PK, IDK,   
     &               NO,NUM,NT,IV,IW,V,W,VMIN,VMAX)
        ENDIF

C       CAN LIST THE DENDROGRAM IN DOCUMENT FILE IF DESIRED
        CALL RDPRMC(ANS,NA,.TRUE.,
     &     'DO YOU WANT A DENDROGRAM DOC. FILE? (Y/N)',NULL,IRT)

        IF (ANS .NE. 'N') THEN
           CALL DENLST(NDOC,VMIN,VMAX,NKLA,V,NUM,IRTFLG)
d118 1
a118 1
        IF (ANS .NE. 'N' .AND. ANS .NE. 'n') THEN
@


1.13
log
@improved
@
text
@a0 1
C
a2 12
C           COPYRIGHT 1986 - JEAN-PIERRE BRETAUDIERE                            
C THE UNIVERSITY OF TEXAS HEALTH SCIENCE CENTER AT HOUSTON                      
C MEDICAL SCHOOL - DEPARTMENT OF PATHOLOGY AND LABORATORY MEDICINE              
C P.O. BOX 20708, HOUSTON, TX 77225.                                            
C DISCLAIMER: NO GUARANTEES OF PERFORMANCE ACCOMPANY THIS SOFTWARE,             
C NOR IS ANY RESPONSIBILITY ASSUMED ON THE PART OF THE AUTHOR                   
C OR THE INSTITUTION.  ALL THE SOFTWARE HAS BEEN TESTED EXTENSIVELY             
C AND EVERY EFFORT HAS BEEN MADE TO INSURE ITS RELIABILITY.                     
C THE FOLLOWING SOFTWARE MAY NOT BE COMMUNICATED TO A THIRD PARTY               
C UNDER ANY FORM WITHOUT WRITTEN PERMISSION OF THE AUTHOR.                      
C PLEASE REPORT ANY BUG(S) TO JPB AT (713) 792 52 00.                           
C OR THRU ARPANET AT  ......!rice!ots!ut-path!suprim                            
d6 1
a6 1
C INPUT  ...  DATA AND WEIGHTS IN /NGUS/ UNFORMATTED                  *         
d8 1
a8 1
C KDIM      = SUP (ICARD, NCLAS**NBASE, 2*NKLA - 1)                   *         
d14 1
a14 1
C ICARD     = NUMBER OF OBJECTS TO BE CLASSIFIED                      *         
d23 4
a26 4
      SUBROUTINE NOYAU (N2DIM,KDIM,MDIM,LDIM,L2DIM,NFAC,KFAC,ICARD,KV,          
     &                           NBASE, NITER, NCLAS, NKLA, IDI,                
     &                           KLAS, D, U, JV, JW, IDK, CI, GT,               
     &     NUM,LA,LB,IV,IW,V,W,NT,VAL,PK,NO,NGUS,NGRI, MODE)
d28 1
a28 1
      COMMON /UNITS/LUN,NIN,NOUT,NECHO,IFOUND,NPROC,NDAT
d30 1
a30 1
      DIMENSION GT(N2DIM,KFAC),D(MDIM),KLAS(ICARD),CI(NFAC),IDI(ICARD),         
d32 1
a32 1
      DIMENSION NUM(LDIM),LA(LDIM),LB(LDIM),NT(L2DIM),VAL(L2DIM),               
d35 3
a37 3
      PARAMETER      (LFA=16)
      DIMENSION      KV(LFA)   
      CHARACTER * 1  NULL,ANS
d39 1
a39 1
      DATA NDOC/10/
d41 1
a41 1
      NULL = CHAR(0)
d43 3
a45 4
C     AGGREGATION AROUND MOBILE CENTERS AND STABLE CLUSTERING             
                                                                               
      CALL PARST(N2DIM,KDIM,NFAC,ICARD,KFAC,NBASE,NITER,NCLAS,NKLA,            
     &                        KLAS,JW,U,CI,JV,GT, KFIN,NGUS,NGRI )              
d47 2
a48 2
C     HIERARCHICAL CLASSIFICATION OF THE CLUSTER GRAVITY                  
C     CENTERS ACCORDING TO THE VARIANCE CRITERION (WARD)                  
d50 1
a50 2
C     ---------------------------------------------------------------
C      IMPORTANT CHANGE: LIMIT HERE THE NUMBER OF CLUSTERS TO BE USED
d53 1
a53 1
	WRITE(NDAT,1111) (KLAS(K),K=1,ICARD)
d60 1
a60 1
          NTH = 0.01*PERC*FLOAT(ICARD)+0.5
d64 1
a64 1
               GOTO 1100
a68 2
1100	CONTINUE

d71 2
a72 2
        CALL DEUCL(N2DIM,NKLA,MCARD,ICARD,KFAC,NFAC,            
     &            KLAS, D, GT, PK, CI, NGUS)
d74 10
d85 1
a85 1
C       NEEDED IN CHAVA BUT REMOVED BY pp SOMETIME ??
d91 1
a91 11
        JFIN  = 2 * NKLA - 1                                
        CALL CHAVA(NKLA, MCARD, JFIN,                       
     &            D, IDK, PK, VAL, LA, LB, NT, NO, NGRI, MODE)                  
                                          
C     SAVE CLASSIFICATION ON NGRI                                                                                                                      
      CALL REW(NGRI,0)                                                         
      WRITE (NGRI) ICARD, NFAC, NKLA, KFAC, (KV(K), K=1, KFAC)                 
      WRITE (NGRI) (KLAS(I), I=1,ICARD), (IDI(I), I=1,ICARD),                   
     &             (PK(L),L=1,NKLA), ((GT(L,J),L=1,NKLA),J=1,KFAC)              
                                                                               
C     CLASSIFICATION TREE OF THE NKLA CENTERS                             
d93 2
a94 2
      CALL RDPRMC(ANS,NA,.TRUE.,
     &  'DO YOU WANT A DENDROGRAM PLOT FILE? (Y/T/N)',NULL,IRT)
d96 1
a96 1
      IF (ANS .EQ. 'T' .OR. ANS .EQ. 't') THEN
d100 1
a100 1
      ELSEIF (ANS .NE. 'N' .AND. ANS .NE. 'n') THEN
d104 1
a104 1
      ELSE
d107 5
a111 1
      ENDIF
d113 3
a115 7
C     CAN LIST THE DENDROGRAM IN DOCUMENT FILE IF DESIRED
      CALL RDPRMC(ANS,NA,.TRUE.,
     &  'DO YOU WANT A DENDROGRAM DOC. FILE? (Y/N)',NULL,IRT)

      IF (ANS .NE. 'N' .AND. ANS .NE. 'n') THEN
         CALL DENLST(NDOC,VMIN,VMAX,NKLA,V,NUM,IRTFLG)
      ENDIF
d117 2
a118 2
C     CAN LIST THE DENDROGRAM IN DOC. FILE FOR WEB IF DESIRED - liy
      CALL RDPRMC(ANS,NA,.TRUE.,
d121 4
a124 10
      IF (ANS .NE. 'N' .AND. ANS .NE. 'n') THEN
         CALL CLUSTERLST(NDOC,VMIN,VMAX,NKLA,V,NUM,
     &         ICARD,KLAS,IDI,IRTFLG)
      ENDIF

C     SUCCESSIVE TRUNCATIONS OF THE CLASS. TREE OUTPUT RESULTS TO NGRI 
      DO KPRO = 2,NKLA - 1                                                   
         CALL COUPE(ICARD,NKLA,KPRO, PK,LA,LB,IV,KLAS,NT, IW)                     
         WRITE(NGRI) (IV(J), J=1,NKLA)                                           
      ENDDO
d126 5
a130 1
      END
d132 1
@


1.12
log
@removed nloop
@
text
@d18 2
a19 2
C          CLASSIFICATION ACCORDING TO FACTORIAL COORDINATES          *         
C......... INPUT  ...  DATA AND WEIGHTS IN /NGUS/ UNFORMATTED         *         
d29 1
a29 1
C......... WORKING ARRAYS  GT(*,*) D(*) KLAS(*) CI(*) U(*) JV(*) JW(*)*         
d31 1
a31 2
C   ROUTINES CALLED ... PARST, DEUCL, CHAVA, ARBRE, COUPE               *         
C                                                                    *         
d41 1
a42 1
      COMMON / ENSOR / LEC,IMP                                                  
d47 3
a49 1
      DIMENSION KV(16)   
d56 1
a56 1
C      AGGREGATION AROUND MOBILE CENTERS AND STABLE CLUSTERING             
d58 1
a58 1
       CALL PARST(N2DIM,KDIM,NFAC,ICARD,KFAC,NBASE,NITER,NCLAS,NKLA,            
d61 2
a62 2
C      HIERARCHICAL CLASSIFICATION OF THE CLUSTER GRAVITY                  
C      CENTERS ACCORDING TO THE VARIANCE CRITERION (WARD)                  
d68 1
a68 1
	WRITE(IMP,1111)(KLAS(K),K=1,ICARD)
d75 2
a76 2
          NTH=0.01*PERC*FLOAT(ICARD)+0.5
          DO  I=1,NKLA
d78 2
a79 2
              NKLA = I-1
              GOTO 1100
d88 1
a88 1
        CALL DEUCL (N2DIM,NKLA,MCARD,ICARD,KFAC,NFAC,            
d101 2
a102 3
                                                                               
C     SAVE CLASSIFICATION ON NGRI                                         
                                                                               
d104 1
a104 1
      WRITE (NGRI)  ICARD, NFAC, NKLA, KFAC, (KV(K), K=1, KFAC)                 
a125 1

a130 1
         JDEB = NKLA + 1
d134 1
a134 1
C     CAN LIST THE DENDROGRAM IN DOC. FILE FOR WEB TO PLOT IF DESIRED---liy
a138 1
         JDEB = NKLA + 1
d144 1
a144 2
      KPART = NKLA - 1                                                          
      DO   KPRO = 2,KPART                                                   
d146 1
a146 1
         WRITE (NGRI)  (IV(J), J=1,NKLA)                                           
@


1.11
log
@nloop,iloop_removed
@
text
@a42 3
      INTEGER          IBCNT,NLOOP,IABSLP,ILOOP
      COMMON    /BATCH/IBCNT,NLOOP,IABSLP,ILOOP

d57 1
a57 1
       CALL PARST (N2DIM,KDIM,NFAC,ICARD,KFAC,NBASE,NITER,NCLAS,NKLA,            
@


1.10
log
@comment changed
@
text
@d73 1
a73 1
	CALL RDPRM(PERC,NLOOP,ILOOP,
@


1.9
log
@added IDK setting (just removed from chava) to fix old bug??
@
text
@d94 1
a94 1
C       NEEDED IN CHAVA ??
@


1.8
log
@*** empty log message ***
@
text
@d50 1
a50 1
     & PK(L2DIM),NO(L2DIM),IV(LDIM),W(LDIM),IW(LDIM),V(LDIM)                    
d54 1
a54 1
       DATA NDOC/10/
d56 1
a56 1
       NULL=CHAR(0)
d93 7
d101 1
a101 1
        CALL CHAVA (NKLA, MCARD, JFIN,                       
a149 1
                                                                               
d152 1
a152 1
         CALL COUPE (ICARD,NKLA,KPRO, PK,LA,LB,IV,KLAS,NT, IW)                     
@


1.7
log
@dendro uses postscript
@
text
@d95 1
a95 1
     &            D, IDK, PK, VAL, LA, LB, NT, NO, NGRI, MODE, 0)                  
a149 1
      RETURN                                                                 
@


1.6
log
@CNO_SAVE
@
text
@d38 3
a40 6
     #                           NBASE, NITER, NCLAS, NKLA, IDI,                
     #                           KLAS, D, U, JV, JW, IDK, CI, GT,               
     #     NUM,LA,LB,IV,IW,V,W,NT,VAL,PK,NO,NGUS,NGRI, MODE)
C 
                                                                              
CNO_SAVE 
a41 2
C     I DO NOT KNOW IF SAVE IS NEEDED FEB 99 al
      SAVE
d43 2
a44 2
        COMMON    /BATCH/IBCNT,NLOOP,IABSLP,ILOOP
        INTEGER          IBCNT,NLOOP,IABSLP,ILOOP
d48 1
a48 1
     #          U(KDIM), JV(KDIM), JW(KDIM), IDK(NKLA)                         
d50 1
a50 1
     # PK(L2DIM),NO(L2DIM),IV(LDIM),W(LDIM),IW(LDIM),V(LDIM)                    
d54 1
a54 2
      DATA NDOC/10/
      NULL=CHAR(0)
d56 3
a58 2
 
C.......... AGGREGATION AROUND MOBILE CENTERS AND STABLE CLUSTERING             
d60 2
a61 2
      CALL PARST (N2DIM,KDIM,NFAC,ICARD,KFAC,NBASE,NITER,NCLAS,NKLA,            
     #                        KLAS,JW,U,CI,JV,GT, KFIN,NGUS,NGRI )              
d63 2
a64 3
C.......... HIERARCHICAL CLASSIFICATION OF THE CLUSTER GRAVITY                  
C           CENTERS ACCORDING TO THE VARIANCE CRITERION (WARD)                  

d66 3
a68 3
C------------------------------------------------------------------
C IMPORTANT CHANGE: LIMIT HERE THE NUMBER OF CLUSTERS TO BE USED
C IN THE HAC. 8/25/86
d74 1
a74 1
     $      'PERC. FOR CLASS CUTOFF(0=NO CUTOFF)')
d76 1
a76 1
	IF (PERC.NE.0.0) THEN
a87 1
C---------------------------------------------------------------
d91 2
a92 2
     #            KLAS, D, GT, PK, CI, NGUS)
C
d95 1
a95 1
     #            D, IDK, PK, VAL, LA, LB, NT, NO, NGRI, MODE, 0)                  
d97 1
a97 1
C.......... SAVE CLASSIFICATION ON NGRI                                         
d102 1
a102 1
     #             (PK(L),L=1,NKLA), ((GT(L,J),L=1,NKLA),J=1,KFAC)              
d104 1
a104 1
C.......... CLASSIFICATION TREE OF THE NKLA CENTERS                             
d107 1
a107 1
     &  'DO YOU WANT DENDROGRAM PLOT FILE? (Y/T/N)',NULL,IRT)
d122 2
a123 1
C     CAN LIST THE DENDORGRAM IN DOCUMENT FILE IF DESIRED
d125 1
a125 1
     &  'DO YOU WANT DENDROGRAM DOC FILE? (Y/N)',NULL,IRT)
d132 1
a132 1
C     CAN LIST THE DENDORGRAM IN DOCUMENT FILE FOR WEB TO PLOT IF DESIRED---liy
d134 1
a134 1
     &  'DO YOU WANT THE CLUSTER DOC FILE? (Y/N)',NULL,IRT)
d142 1
a142 1
C.... SUCCESSIVE TRUNCATIONS OF THE CLASS. TREE OUTPUT RESULTS TO NGRI 
@


1.5
log
@*** empty log message ***
@
text
@d41 6
a46 1
C                                                                               
@


1.4
log
@Generate a cluster doc file for <cl cla>
@
text
@d79 1
a79 1
          DO 1000 I=1,NKLA
d84 1
a84 1
1000      CONTINUE
d146 1
a146 1
      DO 30  KPRO = 2,KPART                                                   
d149 1
a149 1
30    CONTINUE                                                             
@


1.3
log
@add ILOOP common block
@
text
@d48 1
a48 1
     #          U(KDIM), JV(KDIM), JW(KDIM), IDK(NKLA)                          
d133 9
@


1.2
log
@change 1,1 to nloop,iloop in dpr* calls
@
text
@d42 4
@


1.1
log
@Initial revision
@
text
@d70 2
a71 1
	CALL RDPRM(PERC,1,1,'PERC. FOR CLASS CUTOFF(0=NO CUTOFF)$')
d105 1
a105 1
     &  'DO YOU WANT DENDROGRAM PLOT FILE? (Y/T/N)$',NULL,IRT)
d122 1
a122 1
     &  'DO YOU WANT DENDROGRAM DOC FILE? (Y/N)$',NULL,IRT)
@
