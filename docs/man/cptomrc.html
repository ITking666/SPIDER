<head>
<title>SPIDER: CP TO MRC (Copy SPIDER file To MRC (CCP4) format file)</title>
   <link rel='stylesheet' href='niceman.css' type='text/css' />
   <link rel='stylesheet' type='text/css' href='../buttons.css' />

</head>

<body>
<!-- Begin Buttons -->
<table>
<tr>
  <td><a href="../spider.html"                 id="spider">    </a></td>
  <td><a href="../user_doc.html"               id="work">      </a></td>
  <td><a href="../operations_doc.html"         id="index">     </a></td>
  <td><a href="../documents.html"              id="help">      </a></td>
  <td><a href="../faq.html"                    id="faq">       </a></td>
  <td><a href="../documents.html#2D"           id="techs">     </a></td>
  <td><a href="../techs/recon1a/Docs/mr1.html" id="recon">     </a></td>
  <td><a href="../formats.html"                id="menu">      </a></td>
  <td><a href="../installation.html"           id="install">   </a></td>
  <td><a href="../release.html"                id="new">       </a></td>
  <td><a href="../tips/index.html"             id="tips">      </a></td>
  <td><a href="../../web/docs/web.html"               id="web">       </a></td>
</tr>
</table>
<br><hr>
<!-- End Buttons -->

<h2>CP TO MRC - Copy SPIDER file To MRC (CCP4) format file</h2>
<em>(1/23/18)</em><br />
<p>
<dl><dt><strong>PURPOSE</strong>
<p>
<dd>Copies a SPIDER-format image/volume file into a MRC-format file.
As of 2015 this operation converts to the new MRC 2014 format.
Note; MRC format is sometimes referred to as CCP4.
<b>Starting with SPIDER version: 22.11 this operation creates
little-endian (native Intel) byte order output files.</b>
&nbsp; <a href="../exa/cptomrc.html">Example</a>.
</dl>
<p>
<dl><dt><strong>SEE ALSO</strong>
<p>
<dd><table><tr><td><a href="cpfromascii.html"><strong>CP FROM ASCII</strong></a></td><td> [Copy ASCII text file to SPIDER file]</td></tr>
<tr><td><a href="cpfromemi.html"><strong>CP FROM EMI</strong></a></td><td> [Copy EMISPEC format file to SPIDER file]</td></tr>
<tr><td><a href="cpfrommrc.html"><strong>CP FROM MRC</strong></a></td><td> [Copy MRC file to SPIDER file]</td></tr>
<tr><td><a href="cpfromnik.html"><strong>CP FROM NIK</strong></a></td><td> [Copy Nikon Coolscan format file to SPIDER file]</td></tr>
<tr><td><a href="cpfrompdb.html"><strong>CP FROM PDB</strong></a></td><td> [Copy PDB file to SPIDER format]</td></tr>
<tr><td><a href="cpfromraw.html"><strong>CP FROM RAW</strong></a></td><td> [Copy Raw Image to SPIDER file]</td></tr>
<tr><td><a href="cpfromterm.html"><strong>CP FROM TERM</strong></a></td><td> [Copy Terminal input to SPIDER image/volume]</td></tr>
<tr><td><a href="cpfromtiff.html"><strong>CP FROM TIFF</strong></a></td><td> [Copy TIFF format file to SPIDER file]</td></tr>
<tr><td><a href="cpfromvax.html"><strong>CP FROM VAX</strong></a></td><td> [Copy VAX SPIDER file to a Unix SPIDER file]</td></tr>
<tr><td><a href="cptoascii.html"><strong>CP TO ASCII</strong></a></td><td> [Copy SPIDER file to ASCII text format]</td></tr>
<tr><td><a href="cptobrix.html"><strong>CP TO BRIX</strong></a></td><td> [Copy SPIDER volume to BRIX file for "O" input]</td></tr>
<tr><td><a href="cptomrc.html"><strong>CP TO MRC</strong></a></td><td> [Copy SPIDER file To MRC (CCP4) format file]</td></tr>
<tr><td><a href="cptoopend.html"><strong>CP TO OPEND</strong></a></td><td> [Copy SPIDER file To Opposite Byte Endian]</td></tr>
<tr><td><a href="cptopost.html"><strong>CP TO POST</strong></a></td><td> [Copy SPIDER image to a POSTscript image]</td></tr>
<tr><td><a href="cptoraw.html"><strong>CP TO RAW</strong></a></td><td> [Copy SPIDER file to a 8-bit raw image]</td></tr>
<tr><td><a href="cptotiff.html"><strong>CP TO TIFF</strong></a></td><td> [Copy SPIDER file to a TIFF format]</td></tr>
</table></dl>
<p>
<dl><dt><strong>USAGE</strong></dt>
<p>
<dd>.OPERATION: CP TO MRC<br />
<p>
<dd>.SPIDER INPUT FILE: SPI000<br />
[Enter the SPIDER file you want to copy. It can be an image, image stack,
volume, or volume stack.]
<p>
.MRC OUTPUT FILE: MRC000<br />
[Enter name for MRC format output file.]
<p>
</dd> <dt>If input contains a whole bare stack (e.g. images@) then
output is always MRC MODE: 2 floating point data and SPIDER asks:
</dd> <dd><div class="opt_inp">
<p>
.'MRC VERSION (0 or 20140), ORIGIN AT BOTTOM LEFT (YES==1): 0 , 0<br />
[Can create MRC 2014+ format output or a file which has
a different set of values for undetermined minimum, maximum, and
mean density which is not compliant with 2014 format but can be
used with Relion.
Some softwares expect MRC files with image origin at upper left, some
with origin at lower left. Use 0 for use with Relion.]
<p>
.PIXEL SIZE (A) FOR X, Y, &amp; Z AXIS: 1.4, 1.4, 1.4<br />
[Pixel size value will be be multiplied by the
number of pixels in each axis to get the MRC cell dimensions.]
</div>
<p>
</dd> <dt>If input contains an image or volume (not a stack) SPIDER asks:
</dd> <dd><div class="opt_inp">
<p>
.MRC DATA LENGTH (8/32 BITS), ORIGIN AT BOTTOM LEFT (YES==1): 32 , 0<br />
[Can create either a MRC MODE=0 file containing 8 bit
integer values or a MRC MODE=2 file containing 32 bit
floating point values with little-endian byte-ordering.
Some softwares expect MRC files with image origin a upper left, some
with origin a lower left.]
<p>
.STARTING X, Y, &amp; Z OF MRC IMAGE: &lt;CR><br />
[Default value for start: (NX/2)+ 1, (NY/2)+1, (NZ/2)+1
where (+1 added only if axis length is odd) <br />
Enter &lt;CR&gt; or '*' if you want to use the default values.]
<p>
.ANGSTROMS/PIXEL FOR X, Y, &amp; Z AXIS: 12.0, 12.0, 5.0<br />
[Angstroms/pixel value will be be multiplied by the
number of pixels in each axis to get the cell dimensions.]
<p>
.X, Y, &amp; Z ORIGIN OF MRC IMAGE: &lt;CR><br />
[Default value for origin: (NX/2)+ 1, (NY/2)+1, (NZ/2)+1
where (+1 added only if axis length is odd) <br />
Enter &lt;CR&gt; or '*' if you want to use the default values.]
</div>
<p>
<p>
</dl>
<p>
<strong>NOTES</strong>
<ol>
<p>
<li>Can not copy SPIDER Fourier format files.
<p>
<li>Procedure "fit_ccp4_to_pdb.spi" below
creates a CCP4 file aligned for use in 'O'.
<p>
<li>As of SPIDER release 22.12 the first line of the MRC image file
always contains the bottem left corner of the image which
is consistent with MRC files made since 1999.
</ol>
<p>
<dl><dt><strong>SUBROUTINES</strong>
<p>
<dd><a href="../../src/copytomrc.f">COPYTOMRC</a>, <a href="../../src/sethedccp4.f">SETHEDCCP4</a>, <a href="../../src/opfiles.f">OPFILES</a></dl>
<p>
<dl><dt><strong>CALLER</strong>
<p>
<dd><a href="../../src/copy1.f">COPY1</a> 
</dl>
<pre><pre>
; fit_ccp4_to_pdb.spi
;
; THIS PROCEDURE ORIENTS AND SHIFTS A SPIDER VOLUME THAT HAS BEEN CONVERTED TO
; A BRIX VOLUME BY "CP TO BRIX" AND HAS BEEN USED (THE BRIX VOLUME) TO
; FIT A PDB STRUCTURE USING "O" OR REAL SPACE REFINEMENT (RSR). THE OUTPUT 
; OF THIS PROCEDURE IS A CCP4 VOLUME WHICH IS AT THE CORRECT LOCATION AND 
; ORIENTATION AS THAT OF THE FITTED PDB STRUCTURE. THIS CAN BE VISUALIZED 
; USING "O", "CHIMERA" OR "PYMOL".

; ALTERNATIVELY, 

; (1) ONE CAN ALSO ORIENT AND SHIFT THE FITTED PDB FILE TO FIT THE CCP4 
; VOLUME WHICH IS GENERATED FROM THE UNROTATED AND UNSHIFTED SPIDER VOLUME,
; WHICH CAN BE VISUALIZED BY USING "O", "CHIMERA" OR "PYMOL". USE PROCEDURE 
; "fit_pdb_to_ccp4.spi" IN THE SPIDER PROCEDURE DIRECTORY"spider/proc/".

; (2) ONE CAN USE "CP TO BRIX" TO CONVERT THE UNROTATED AND UNSHIFTED 
; SPIDER VOLUME TO A BRIX VOLUME WHICH CAN BE USED TO VISUALIZE THE
; FITTED PDB STRUCTURE IN "O", "CHIMERA" OR "PYMOL".

;;;;;;;;;;;;;;;;;;;;;; BEGINING OF INPUT PARAMETERS ;;;;;;;;;;;;;;;;;;

 [input]  = 'vol_spi'

 [output] = 'vol_ccp4.ccp4'

 ; PIXEL SIZE 
 [ps] = 2.82    ; PIXEL SIZE

 ; DATA LENGTH FOR CCP4 FILE 
 [len] = 32     ; DATA LENGTH FOR CCP4 FILE  

 ;;;;;;;;;;;;;;;;;;;;;; END OF INPUT PARAMETERS ;;;;;;;;;;;;;;;;;;;;;;;;

 ; ROTATE THE VOLUME SO THAT X = Y, Y = X AND Z = -Z
 RT 3D
   [input]
   _1
   90, 0, 0

 RT 3D
   _1
   _2
   0, 180, 0

 RT 3D
   _2
   _3
   180, 0, 0

 ; FIND NX, NY AND NZ
 FI [NX],[NY],[NZ]
   [input]
   12, 2, 1

 ; FIND THE CENTER IN PIXELS, FOR EVEN DIMENSION, IT IS NX/2 ETC..
 ; FOR ODD DIMENSION, IT IS (NX/2 + 1) ETC..

 [xc] = INT([NX]/2)
 [yc] = INT([NY]/2)
 [zc] = INT([NZ]/2)

 [x]  = ([NX] - 2*[xc]) + [xc]
 [y]  = ([NY] - 2*[yc]) + [yc]
 [z]  = ([NZ] - 2*[zc]) + [zc]

 ; CALCULATE THE CENTER IN ANGSTROMS
 [xa] = [x] * [ps]
 [ya] = [y] * [ps]
 [za] = [x] * [ps]

 ; CREATE THE MRC (CCP4) FILE
 ; NOTE: FOR DISPLAY, "CHIMERA" READS THE ORIGIN WHEREAS "O" READS THE STARTING 
 ; POINTS OF XYZ. ORIGIN IS GIVEN IN ANGSTROMS, STARTING POINTS ARE GIVEN IN PIXELS.

 CP TO MRC
   _3
   [output] 
   [len]
   -[x], -[y], -[z]
   [ps], [ps], [ps]    
   -[xa], -[ya], -[za]
 
 EN
 </pre>

</pre>
<!-- Begin Trailer -->
<hr> <small>&copy; <a href="../copyright.html"> 
   Copyright Notice</a> /           &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
   Enquiries: <a href="mailto:spider@wadsworth.org">spider@wadsworth.org</a> </small></a>
<!-- End Trailer -->
</body>
</html>