<HTML> <HEAD>
<META NAME="Segmentation and modeling"
CONTENT="Sterecon, surface rendering, SPIDER, Iris Explorer">
<TITLE>Segmentation and Modeling</TITLE> 
</HEAD>
 
<BODY BACKGROUND="bkgd.gif"
TEXT="#000000" LINK="#0000ff" VLINK="#ff0000" ALINK="#ff0000"
BGCOLOR="#ffffff">

<P ALIGN="CENTER"><FONT SIZE="+2">
<STRONG>SEGMENTATION AND MODELING OF TOMOGRAPHIC VOLUMES</STRONG>
</FONT></P>

<P><HR>

<BR WP="BR1"><BR WP="BR2">
<P><STRONG>Introduction</STRONG></P>

<P>These are the methods currently used at Albany for visualization of
tomographic volumes.</P>

<P>First, the individual objects of interest in the volume are
segmented using <A
HREF="http://www.wadsworth.org/spider_doc/sterecon/sterecon.html">Sterecon</A>,
which results in a stack of contours for each object or class of
objects.</P>

<P>Next, the contour stacks are processed by any of three methods,
which make Inventor-format "geometry" files. The methods are: (<A
HREF="#Method 1">1</A>) converting the contours directly to Inventor
format using "<A
HREF="../../../tips/misc.html#ssrtoiv">ssrtoiv</A>",
(<A HREF="#Method 2">2</A>) tiling of objects using <A
HREF="../../../../../../tips/explorer.html">Iris
Explorer's</A> "<A
HREF="../../../tips/explorer.html">IsosurfaceLat</A>"
after creation of <A
HREF="../../../index.html">SPIDER</A> volumes
from the contour stacks, and (<A HREF="#Method 3">3</A>) direct tiling
of objects based on contour stacks, using MOVIE.BYU's "<A
HREF="../../../tips/misc.html">tiling</A>"
or "<A
HREF="../../../tips/misc.html">sheet</A>",
followed by "<A
HREF="../../../tips/misc.html">byutoexp</A>".
The choice of method depends on the nature of the object, as described
below. </P>

<P>Then, a model or scene is made, which can contain objects created
using any combination of the three methods. The final 3-D model is
surface-rendered and displayed using Iris Explorer's "Render" or SGI's
"SceneViewer".</P>

<P>Finally, the 3-D model can be converted to VRML format for web-based
interactive display using 
"<A HREF="http://www.sgi.com/software/cosmo/">Cosmoplayer</A>", or
animation frames from a rotation or translation series can be made into
a movie or video.</P>

<P>Currently only the SGI workstations have all the software used here.</P>

<P><EM>Updated 03/04/00, M. Marko</EM></P>

<P><STRONG>Preliminary steps</STRONG></P>

<P><A HREF="#1.">Step 1.</A> Prepare the tomographic volume for
slice tracing.</P>

<P><A HREF="#2.">Step 2.</A> Trace contours on slices using Sterecon.</P>

<P><STRONG><A HREF="#Method 1">Method 1</A></STRONG></P>

<P><A HREF="#3.">Step 3.</A> Convert Sterecon contours directly to
Inventor format.</P>

<P><STRONG><A HREF="#Method 2">Method 2</A></STRONG></P>

<P><A HREF="#4.">Step 4.</A> Transfer contours of individual objects or
classes to SPIDER.</P>

<P><A HREF="#5.">Step 5.</A> Create SPIDER volumes of individual
objects or classes.</P>

<P><A HREF="#6.">Step 6.</A> Smooth and cap SPIDER volumes.</P>

<P><A HREF="#7.">Step 7.</A> Tile SPIDER volumes using Explorer's
"IsosurfaceLat".</P>

<P><A HREF="#8.">Step 8.</A> Adjust the translation and scale of
Inventor geometry files.</P>

<P><STRONG><A HREF="#Method 3">Method 3</A></STRONG></P>

<P><A HREF="#9.">Step 9.</A> Transfer Sterecon contour stacks to
MOVIE.BYU format.</P>

<P><A HREF="#10.">Step 10.</A> Tile objects using "tiling" or
"sheet"</P>

<P><A HREF="#11.">Step 11.</A> Smooth MOVIE.BYU-format objects.</P>

<P><A HREF="#12.">Step 12.</A> Convert MOVIE.BYU-format objects to
Inventor geometry files</P>

<P><STRONG><A HREF="#Final steps">Final steps</A></STRONG></P>

<P><A HREF="#13.">Step 13.</A> Reduce the number of tiles in Inventor
geometry files.</P>

<P><A HREF="#14.">Step 14.</A> Smooth Inventor geometry files.</P>

<P><A HREF="#15.">Step 15.</A> Combine objects and make the final
surface-rendered model.</P>

<P><A HREF="#16.">Step 16.</A> Determine surface area from models.</P>

<P><A HREF="#17.">Step 17.</A> Make presentations from models.</P>

<P><A HREF="#18.">Step 18.</A> Miscellaneous tips</P>



<P><HR> 

<BR WP="BR1"><BR WP="BR2">

<STRONG><A NAME="1."> 
1.          </A>Prepare the tomographic volume for slice
tracing. (<A HREF="b80.dat">b80.dat</A>)</STRONG>

<TABLE BORDER="1" WIDTH="716">
<TR VALIGN="TOP"><TD WIDTH="161">input file</TD>
<TD WIDTH="555">the tomographic SPIDER volume</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="716" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="161">output files</TD>
<TD WIDTH="555">sli***.dat [2X enlarged SPIDER images for Sterecon tracing]</P>
<P>mov***.rgb [unenlarged SGI images for making movie]</TD></TR></TABLE>

<P>Before doing this first step, the volume should be windowed on all
sides to just the area to be traced. Be careful, however, not to cut
off too many top and bottom z-slices for spherical objects, since the
tomographic "missing wedge/pyramid" effect makes the top and bottom of
spheres difficult to recognize. The contrast should be adjusted for
optimum viewing, using the <A
HREF="../../../operations_doc.html">SPIDER</A>
operation <A HREF="../../../man/th.html">TH</A>,
for example. </P>

<P>In <A HREF="b80.dat">b80.dat</A>, the number of z-slices in the
reconstruction is reduced by half by adding together adjacent slices.
This reduces the number of slices to be traced, and is justified since
the z-resolution of a typical tomographic reconstruction is less than
the x-y resolution by about a factor of about three. The slices are
made into individual images, with double the pixel size, to make it
easier to trace fine details. A series of slice images, in SGI (-.rgb)
format are also made, which are to be made into a "movie" by using the
program movieplayer_old. This movie is essential as an aid to assigning
correct connectivity when tracing with <A
HREF="http://www.wadsworth.org/spider_doc/sterecon/sterecon.html">Sterecon</A>.
Alternatively, the tracing can be done in stereo, which also helps with
connectivity questions. In that case, the stand-alone routine <A
HREF="../../../tips/stereo.html">tostereo</A> is
used instead of <A HREF="b80.dat">b80.dat</A> to prepare the volume
for tracing. See M.  Marko or A. Leith for advice on using <A
HREF="../../../tips/stereo.html">tostereo</A>.
</P>

<P>You will need to edit <A HREF="b80.dat">b80.dat</A> according to the
comments written on the appropriate lines. Only the name of the input
volume needs to be edited.</P>

<BR WP="BR1"><BR WP="BR2">

<P><A HREF="b80.dat"></A><STRONG><A NAME="2.">
2.         </A> Trace contours on slices using Sterecon.</STRONG>

<TABLE BORDER="1" WIDTH="596" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">input files</TD>
<TD WIDTH="473">sli***.dat [slice images]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="596" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">output file</TD>
<TD WIDTH="473">(e.g.) recon1.ssr [Sterecon reconstruction file,
-.ssr]</TD></TR></TABLE>

<P>An appropriate tracing strategy is essential for a good final model,
so you will benefit from the advice of an experienced staff member who
is familiar with your specimen. Care must be taken when assigning class
names and contour numbers so that individual objects can be handled
conveniently during the visualization process. </P>

<P>It is very important to be sure of the pixel size and slice
thickness, taking into account <A HREF="#1.">step 1</A>, in which the
images were enlarged and the slices made thicker. This is essential if
measurements are to be made, and also to allow combining the different
methods of contour-processing to be used in the same final display. The
questions asked by Sterecon are as follows:</P>

<P><FONT FACE="Courier New" SIZE="4">Enter section or view thickness
(in microns): </FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter pixels/micron: </FONT></P>

<P>For tomography, it is convenient to work in units of nm, so just
assume the word "micron" has been replaced with "nm". For <FONT
FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>section
thickness</STRONG></FONT>, use twice the pixel size of the tomographic
volume used as input for <A HREF="#1.">step 1</A>, since every two slices 
were added together.
For <FONT FACE="Courier New" SIZE="4"
COLOR="#ff0000"><STRONG>pixels/micron</STRONG></FONT>, use one-half the 
pixel size, since the traced image was enlarged two
times. Then take the reciprocal, since you are asked for pixels/nm, not
nm/pixel.</P>

<BR WP="BR1"><BR WP="BR2">
<BR WP="BR1"><BR WP="BR2">

<P><A NAME="Method 1"></A><FONT SIZE="+2"><STRONG>
Method 1                 </STRONG></FONT></P>

<P>This method is suitable as the final display method for objects
which are very small within the whole model, such as particles or
filaments. Since surface-rendering is not practical for these objects,
the contours themselves are used in the final display. However, note
that circles entered in Sterecon using the "cir*" class can be
surface-rendered as spheres after using this method.</P>

<P>This method is also useful for having a quick look at the contours
you traced, before making a more sophisticated model. The stand-alone
program "ssrtoiv" is used to directly convert Sterecon contours to
Inventor format. This allows the data to be displayed using SceneViewer
or Render (see <A HREF="#15.">step 15</A>), providing convenient 3-D
manipulation of the contour-stack model. The colors you assign in
Sterecon's display function (DIS: COD) and any filling of contours
(DIS: POL, FIL), will be retained in the Inventor file.</P>

<BR WP="BR1"><BR WP="BR2"> 

<P><STRONG><A NAME="3.">
3.       Convert Sterecon contours directly to Inventor format.</STRONG> 

<TABLE BORDER="1" WIDTH="528" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">input file</TD>
<TD WIDTH="405">(e.g.) recon1.ssr [Sterecon file, -.ssr]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="528" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">output file</TD>
<TD WIDTH="405">(e.g.) recon1.iv [Inventor file, -.iv]</TD></TR></TABLE>

<P>First use the Sterecon display function (DIS: DIS) to check the
selection of contours you want included in the model. The selection is
done using the contour name specification. Also check that the color
and filling options are correct. These options cannot be changed when
making the final 3-D display. Use "ssrtoiv" as follows:</P>

<P><FONT FACE="Courier New" SIZE="4">ssrtoiv recon1.ssr recon1.iv</FONT></P>

<P>Where <FONT FACE="Courier New" SIZE="4"
COLOR="#ff0000"><STRONG>recon1.ssr</STRONG></FONT> is an example of a
Sterecon file and <FONT FACE="Courier New" SIZE="4"
COLOR="#ff0000"><STRONG>recon1.iv</STRONG></FONT> is the corresponding
Inventor geometry file. To distinguish geometry files made by this
method, we use the extension -.iv.</P>

<P>The screen will read as follows (sample responses shown in <FONT COLOR="#ff0000">red</FONT>):</P>

<P><FONT FACE="Courier New" SIZE="4">Opened SSR file: recon1.ssr</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">sterecon ---&gt; iv conversion started.</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter contour name (or q to stop entering names):</FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>*aaaa*</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter contour name (or q to stop entering names):</FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>*bbbb*</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter contour name (or q to stop entering names):</FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>q</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">--- 2D Contour: 1 / 1 aaaa 1 with 23 points transferred. </FONT></P>

<P><FONT FACE="Courier New" SIZE="4">--- 2D Contour: 2 / 1 aaaa 1 with 27 points transferred. </FONT></P>

<P><FONT FACE="Courier New" SIZE="4"> |</FONT></P>

<P>(Middle of list omitted here.)</P>

<P><FONT FACE="Courier New" SIZE="4"> |</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">--- 2D Contour: 29 / 1 aaaa 1 with 23 points transferred. </FONT></P>

<P><FONT FACE="Courier New" SIZE="4">--- 2D Contour: 30 / 1 aaaa 1 with 27 points transferred. </FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Inventor output file: recon1.iv</FONT></P>

<P>Note that the Sterecon contour-name specification method is used to
select which contour stacks are to be included in the inventor file. If
all the contours are selected at once using <FONT FACE="Courier New"
SIZE="4" COLOR="#ff0000"><STRONG>****</STRONG></FONT> as a contour
name, all the objects traced will be put into the inventor file.</P>

<BR WP="BR1"><BR WP="BR2">

<P><FONT SIZE="+2"><STRONG><A NAME="Method 2">
Method 2           </A></STRONG></FONT></P>

<P>This method is best used when the object to be modeled is
complicated, branched, and/or highly-detailed. A good example is
mitochondrial cristae. All five steps are usually carried out
separately for each individual object. However, a class of objects can
be handled at once if all the objects in the class will always be
displayed at once in the final model, with the same color and
transparency designation for all the objects. </P>

<P>This method only works with closed contours. For objects drawn with
contours which do not form a continuous loop, use method 3.</P>

<BR WP="BR1"><BR WP="BR2">

<P><A NAME="4."><STRONG>
4.     </A> Transfer contours of individual objects or classes to SPIDER.</STRONG> 

<TABLE BORDER="1" WIDTH="491" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">input file</TD>
<TD WIDTH="368">(e.g.) recon1.ssr [Sterecon file, -.ssr]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="491" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">output files</TD>
<TD WIDTH="368">DOC***.dat [SPIDER coordinates files]</TD></TR></TABLE>

<P>The first step is to make a SPIDER document file for each slice
containing a contour of the object to be modeled. These document files
are simply a list, in ASCII form, of the x and y coordinates of all the
points you entered when tracing the contours.</P>

<P>Use Sterecon, INTerface menu (sample responses shown in <FONT COLOR="#ff0000">red</FONT>):</P>

<P><FONT FACE="Courier New" SIZE="4">INTerface menu (enter MEN to see choices).</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter choice: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>doc</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter series name: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>recon1</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">FILE OPENED: recon1.ssr</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter doc file name template (eg. DOC***):</FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG> DOC***</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter first doc file number: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>1</STRONG></FONT></P>

<P>(Always use </FONT><FONT FACE="Courier New" SIZE="4"
COLOR="#ff0000"><STRONG>1</STRONG></FONT>
for this application.)</P>

<P><FONT FACE="Courier New" SIZE="4">Do you want to OK each contour transfer? (Y/N/MIR/CIR): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>n</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">FOR SPIDER &lt;PP LL&gt; USE SCALED OUTPUT</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Output pixel, metric, unscaled, or scaled data? (P/M/U/S): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>s</STRONG></FONT></P>

<P>(It is important to choose "</FONT><FONT FACE="Courier New" SIZE="4"
COLOR="#ff0000"><STRONG>s</STRONG></FONT>" here so all the objects will
match in the final display.)</P>

<P><FONT FACE="Courier New" SIZE="4">X &amp; Y dimensions used in -PP LL- (Default: 280): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>507 507</STRONG></FONT></P>

<P>(The x-y dimensions you use here should be the original x-y
dimensions of the tomographic volume you used as input for <A
HREF="#1.">step 1</A>.)</P>

<P><FONT FACE="Courier New" SIZE="4">DEFAULT OFFSET WILL SET MINIMA TO 1.0</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">USE 0,0 FOR SPIDER -PP LL- INPUT</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter X and Y offset (OR &lt;CR&gt; for -XMIN +1,-YMIN +1): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>0 0</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter contour name: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>*ommm*</STRONG></FONT></P>

<P>(Note that the desired object is selected using the Sterecon 
contour name.)</P>

<P>(The following lines will be shown on the screen. It is <STRONG>very 
important</STRONG> to save the first two lines for later use by pasting 
them into a text file. In <A HREF="#8.">step 8</A>,
these lines will be pasted into the geometry file for the
surface-rendered model.)</P>

<P><FONT FACE="Courier New" SIZE="4">Transform { translation -247.0 -240.6 40.28 </FONT></P>

<P><FONT FACE="Courier New" SIZE="4">; scaleFactor 0.8633 0.8633 2.120 }</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Transfer more contours? (Y/N): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>n</STRONG></FONT><FONT FACE="Courier New" SIZE="4"> </FONT></P>

<P>(Then you will see a list of all the contours transferred.)</P>

<P>NOTE: This step will fail if there are any pre-existing files with
the form DOC***.dat. Therefore, it is best to go through the whole
procedure, steps 4-8, for one object or class at a time, deleting the
intermediate files when the final Inventor file is satisfactory.</P>

<BR WP="BR1"><BR WP="BR2">

<P><STRONG><A NAME="5.">
5.      </A> Create SPIDER volumes of individual objects or 
classes. (<A HREF="b81.dat">b81.dat</A>)</STRONG>

<TABLE BORDER="1" WIDTH="491" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="131">input files</TD>
<TD WIDTH="360">DOC***.dat [SPIDER coordinates files]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="491" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="131">output file</TD>
<TD WIDTH="360">(e.g.) ommmvol.dat [SPIDER volume]</TD></TR></TABLE>

<P>The document (DOC***.dat) files are now converted into SPIDER
volumes. The procedure file does this by creating an image for each slice.
The image contains the contour lines you drew.  The contours are then
filled in with a pixel value of 10, and the background pixel value is
set to zero. All the slices are then stacked into a SPIDER volume. The
filling step requires closed contours, which restricts the use of this
method.</P>

<P>You will need to edit <A HREF="b81.dat">b81.dat</A><A
HREF="b80.dat"></A> according to the comments written on the
appropriate lines. The size of the image, number of DOC files, and name
of the output volume will have to be edited. It is very important that
you use the same image size as was used in <A HREF="#4.">step 4</A>,
which would normally be the original x-y dimensions of the tomographic
volume you used as input for <A HREF="#1.">step 1</A>.</P>

<P>The procedure file will delete all intermediate files after the output
volume is made. However, if the procedure file fails, and these files are not
deleted, the (corrected) procedure file will not run again. If this happens, you must
do the following:</P>

<P>
<FONT FACE="Courier new" SIZE="4">/rm *.tmp *.tem *.stk</FONT></P>

<BR WP="BR1"><BR WP="BR2"> <P>


<P><STRONG><A NAME="6."> 
6.       </A> Smooth and cap individual SPIDER volumes. 
(<A HREF="b82.dat">b82.dat</A>, <A HREF="b83.dat">b83.dat</A>)</STRONG></P>

<P>(Smoothing only)

<TABLE BORDER="1" WIDTH="573" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="146">input file</TD>
<TD WIDTH="427">(e.g.) ommmvol.dat [original SPIDER volume]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="573" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="146">output file</TD>
<TD WIDTH="427">(e.g.) ommmvol_s.dat [smoothed SPIDER volume]</TD></TR></TABLE>

<P>Surface-rendered models made from stacks of images will sometimes be
rough-looking, with striations parallel to the slices. Low-pass
filtering of the SPIDER volumes prior to tiling can improve the
appearance of the model, but one should be careful that desired details
are not obscured. The SPIDER <A
HREF="../../../man/bc.html">BC</A> command is
used for smoothing. A filter box size of 5x5x5 gives about the maximum
smoothing that should be used; sometimes 3x3x3 is more appropriate. Use
<A HREF="b82.dat">b82.dat</A> for smoothing. In the procedure file, you
will need to edit the input and output file names and the filter box
size.</P>

<P>(Smoothing and capping) 

<TABLE BORDER="1" WIDTH="558" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="146">input file</TD>
<TD WIDTH="412">(e.g.) ommmvol.dat [original SPIDER volume]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="558" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="146">output file</TD>
<TD WIDTH="412">(e.g.) ommmvol_c.dat [smoothed SPIDER volume]</TD></TR></TABLE>

<P> The surface of any contour which exists in the top or bottom slice
of the SPIDER volume will not be tiled in the model of the object
unless the volume is padded with an extra pixel above and below.
Without the padding, the top and bottom of the object will be open. In
fact, this is often desired. If you want the model to be both smooth
and capped, use </A><A HREF="b83.dat">b83.dat</A>. In the procedure
file, you will need to edit the input and output file names and the
filter box size.</P>

<BR WP="BR1"><BR WP="BR2"> <P>


<P><STRONG><A NAME="7.">
7.      Tile SPIDER volumes using Explorer's "IsosurfaceLat". </STRONG>

<TABLE BORDER="1" WIDTH="559" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="138">input file</TD> <TD WIDTH="420">(e.g.)
ommmvol_c.dat [smoothed SPIDER volume]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="559" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="138">output file</TD> <TD WIDTH="420">(e.g.)
ommm.geo [Inventor geometry file, -.geo]</TD></TR></TABLE>

<P>This step is computationally-intensive, so it should be run on
computer where the data is kept. "IsosurfaceLat" creates a tiled
surface which follows outer pixels which have values at or above a set
threshold. It uses an algorithm similar to "marching cubes" to do
this.  The number of tiles created this way is very large, and the
Inventor files are large and hard to display quickly. Thus, it is
advisable to reduce the number of tiles in <A HREF="#13.">step 13</A>
before making the final display.</P>

<P>Use Iris Explorer (type 
"<FONT COLOR="#ff0000" ><STRONG>explorer</STRONG></FONT>") and open 
the map file "create.map", which you can download from <A HREF="">
here</A>.</P>

<P>Maximize all three modules by clicking on the square in the upper
right of each small box.</P>

<P>Set the min and max in "IsosurfaceLat" to 0 and 10. You might have
to close and re-maximize "IsosurfaceLat" to get the min and max boxes to
appear.Then set the threshold dial to about 9 o'clock.  Increasing the
threshold makes objects thinner. You can experiment with turning smooth
on.</P>

<P>Make the Render window about 1/4 the size of the computer screen and
click on the small box icon, the bottom one in the row along the right
side. This selects for an orthographic view.

<P>Delete the existing filename on the bottom line of "Trans3Dimage"
and type in the desired SPIDER volume.  "Trans3Dimage" is an Explorer
module written at Albany to allow input of SPIDER volumes. The whole
process will start as soon as you press return.  The top of each box
will turn yellow when that process is running.</P>

<P>When the display of the object in the Render window is finished,
save the tiled Inventor file using "<FONT COLOR="#ff0000"
><STRONG>file&gt;save as</STRONG></FONT>".  Our convention is to use
the extention ".geo" for these files.  The Render window shows a
surface-rendered version of the object as default. If you want to see
the actual tiles, right-click on the black background and select "wire
frame".</P>

<BR WP="BR1"><BR WP="BR2">
 
<P><STRONG><A NAME="8.">
8.     </A> Adjust the translation and scale of tiled objects.
</STRONG></P>

<P>To make all the tiled objects fit together correctly in the final
display, the two lines of text you saved in <A HREF="#4.">step 4</A>
have to be pasted into the "-.geo" Inventor files. Since the Inventor
format is ASCII text, the files can be opened using an editor such as
"jot". You will have saved the corresponding set of lines for each
Inventor file.</P>

<P>The beginning of a typical "-.geo" file looks like this:</P>

<P><FONT FACE="Courier New" SIZE="4">#Inventor V2.1 ascii</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Info {</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">string "Explorer Render"</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">}</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">ShapeHints {</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">vertexOrdering COUNTERCLOCKWISE</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">creaseAngle 0</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">}</FONT></P>

<P>Here are the lines you need to paste into the file:</P>

<P><FONT FACE="Courier New" SIZE="4">Transform { translation -247.0 -240.6 40.28 </FONT></P>

<P><FONT FACE="Courier New" SIZE="4">; scaleFactor 0.8633 0.8633 2.120 }</FONT></P>

<P>Here is what the beginning of the file looks like after the paste.
Note that you have to remove the ";" and move the new lines over
one space. The presence and position of the "{" and "}" characters
isvery important.</P>

<P><FONT FACE="Courier New" SIZE="4">#Inventor V2.1 ascii</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Info {</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">string "Explorer Render"</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">}</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Transform { translation -247.0 -240.6 40.28 </FONT></P>

<P><FONT FACE="Courier New" SIZE="4">scaleFactor 0.8633 0.8633 2.120 }</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">ShapeHints {</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">vertexOrdering COUNTERCLOCKWISE</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">creaseAngle 0</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">}</FONT></P>

<P>Be sure to save the file when you exit the editor.</P>

<P>Steps <A HREF="#4.">4</A>-<A HREF="#8.">8</A> are best done one
class at a time. This way, disk space can be saved by deleting
intermediate files (DOC***.dat and the SPIDER volumes) once the tiling
is satisfactory.</P>

<BR WP="BR1"><BR WP="BR2">

<P><STRONG><FONT SIZE="+2"><A NAME="Method 3"></A>
Method 3        </STRONG></FONT></P>

<P>This method is suitable for large, simple objects such as the
bounding membrane of a cell or an organelle. A model made by this
method is usually smoother than one made by <A HREF="#Method 2">method
2.</A> In addition, the model uses a much smaller Inventor file, so the
display is faster. This method can be used for complicated structures,
but in that case it usually must be used interactively, which can be
difficult.  Special attention may also be required if the topmost or
bottommost contours are highly convex.</P>

<P>This is the only one of the three methods which can make a model of
an unclosed surface, such as a patch of membrane. This is
because it can tile stacks of contours which are not closed loops. </P>

<P>As with <A HREF="#Method 2">method 2</A>, the procedure should be
carried out for one object at a time. If a whole class is selected, the
individual objects in the class will not be able to be displayed
separately, but only as a group.</P>


<BR WP="BR1"><BR WP="BR2">

<P><A NAME="9."><STRONG>
9.       Transfer Sterecon contour stacks to MOVIE.BYU format.</STRONG>

<TABLE BORDER="1" WIDTH="596" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="131">input file</TD> <TD WIDTH="465">(e.g.)
recon1.ssr [Sterecon file, -.ssr]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="596" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="131">output file</TD> <TD WIDTH="465">(e.g.)
ommm.mov [MOVIE.BYU input file, -.mov]</TD></TR></TABLE>

<P>Use Sterecon, INTerface menu (responses in <FONT
COLOR="#ff0000">red</FONT>):</P>

<P><FONT FACE="Courier New" SIZE="4">INTerface menu (enter MEN to see choices).</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter choice: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>mos</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter series name: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>recon1</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">FILE OPENED: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>recon1.ssr</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter name for movie file:</FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG> ommm.mov</STRONG></FONT></P>

<P>(As a convention, we use the extension -.mov for these files.)</P>

<P><FONT FACE="Courier New" SIZE="4">Do you want to OK each contour transfer? (N/Y/MIR) : </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>n</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Do you want to view each contour? (N/Y/CWISE): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>n</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Invert the z levels? (N/Y): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>n</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Close open contours? (N/Y): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>y</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">FOR STERECON INPUT SHOULD USE PIXEL OUTPUT</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">FOR .BYU INPUT SHOULD USE METRIC OUTPUT</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Output pixel or metric data? (P/M): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>m</STRONG></FONT></P>

<P>(Be sure to use metric so that the object will be placed correctly
in the final display.)</P>

<P><FONT FACE="Courier New" SIZE="4">Enter contour name: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>*ommm*</STRONG></FONT></P>

<P>(Note that the desired contours are selected by the contour name.)</P>

<P><FONT FACE="Courier New" SIZE="4">2D Contour has: 18 points at: 0.00000E+00um. for file: ommm</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">2D Contour has: 24 points at: 0.00000E+00um. for file: ommm</FONT></P>

<P><FONT FACE="Courier New" SIZE="4"> |</FONT></P>

<P>(Middle of list omitted here.)</P>

<P><FONT FACE="Courier New" SIZE="4"> |</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">2D Contour has: 19 points at: 165.36 um. for file: ommm</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">2D Contour has: 20 points at: 165.36 um. for file: ommm</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Transfer more contours into this file? (N/Y): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>n</STRONG></FONT></P>

<BR WP="BR1"><BR WP="BR2">

<P><A NAME="10."><STRONG>
10.     Tile objects using "tiling" or "sheet"</STRONG>.

<TABLE BORDER="1" WIDTH="588" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">input file</TD>
<TD WIDTH="465">(e.g.) ommm.mov [MOVIE.BYU input file, -.mov]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="588" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="123">output file</TD>
<TD WIDTH="465">(e.g.) ommm.dat [MOVIE.BYU tiled output file, -.dat]</TD></TR></TABLE>

<P>MOVIE.BYU includes software which directly tiles stacks of contours.
The applications "tiling" and "sheet" are used to connect the points on
adjacent contours in depth, forming a network of triangles. The data
points used are the same as those you entered when tracing contours in
Sterecon. Use "tiling" for objects made from closed-loop contours and
"sheet" for objects made from open contours. Both applications look and
work the same. To start the application, type "<FONT
COLOR="#ff0000"><STRONG>tiling</STRONG></FONT>" or 
"<FONT COLOR="#ff0000"><STRONG>sheet</STRONG></FONT>".
The following dialog takes place in the small box at the lower left of
the application (responses in<FONT COLOR="#ff0000"> red</FONT>).
Information about your data, as well as additional prompts, appears in
the window from which you started the application.  Sample text from
that window is shown in <FONT COLOR="#0000ff">blue</FONT> in the
example.</P>

<P><FONT FACE="Courier New" SIZE="4">&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>read</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&lt;READ MOSAIC CONTOUR FILE&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm.mov</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#0000ff">&lt;NUMBER OF WORKING LEVELS IS    30 &gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">READ&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>auto</STRONG></FONT></P>

<P>(This will automatically tile all the contours.)</P>

<P><FONT FACE="Courier New" SIZE="4">READ&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>write</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&lt;WRITE MOSAIC CONTOUR FILE&gt;</FONT></P>

<P>(This file type is not used. Press </FONT><FONT FACE="Courier New" SIZE="4" 
COLOR="#ff0000"><STRONG>&lt;CR&gt;</STRONG></FONT>
to skip.)</P>

<P><FONT FACE="Courier New" SIZE="4">&lt;WRITE DISPLAY PANEL FILE&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm.dat</STRONG></FONT></P>

<P>(As a convention, we use the extension -.dat for this type of file)</P>

<P><FONT FACE="Courier New" SIZE="4">&lt;WRITE DISPLAY CONTOUR FILE&gt;</FONT></P>

<P>(This file type is not used. Press <FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>&lt;CR&gt;</STRONG></FONT> to skip.)</P>

<P><FONT FACE="Courier New" SIZE="4">READ&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>exit</STRONG></FONT></P>

<P>The above procedure leaves the top and bottom of every object in the
model open. This is usually desired for such structures as the bounding
membrane of a cell or organelle. </P>

<P>If you want to cap an object, the loop numbers of the top and bottom
contours of that object have to be noted, then the desired loops must
be capped after the object has been tiled using <FONT FACE="Courier
New" SIZE="4" COLOR="#ff0000"><STRONG>auto</STRONG></FONT>.  The
following example shows how to do this.  The <FONT
COLOR="#0000ff">blue</FONT> text appears in the window where you
started the application.</P>

<P><FONT FACE="Courier New" SIZE="4">&gt;</FONT><FONT FACE="Courier New"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>read</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&lt;READ MOSAIC CONTOUR FILE&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm.mov</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#0000ff">&lt;NUMBER OF WORKING LEVELS IS    30 &gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">READ&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>insp</STRONG></FONT><FONT FACE="Courier New" SIZE="4"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&gt;&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#0000ff">&lt;LEVEL LIMITS I1,I2,I3&gt;</FONT><FONT FACE="Courier New" SIZE="4"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>1,5</STRONG></FONT><FONT FACE="Courier New" SIZE="4"></FONT></P>

<P>(This displays all the loops from levels 1 to 5. The loops are
labeled. Repeat this as many times as needed to record all the loop
numbers which need caps.)</P>

<P><FONT FACE="Courier New" SIZE="4">&gt;&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>5,10</STRONG></FONT><FONT FACE="Courier New" SIZE="4"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&gt;&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>&lt;CR&gt;</STRONG></FONT><FONT FACE="Courier New" SIZE="4"></FONT></P>

<P>(Press</FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000">
<STRONG> &lt;CR&gt;</STRONG></FONT> when done inspecting levels.)</P>

<P><FONT FACE="Courier New" SIZE="4">READ&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>auto</STRONG></FONT><FONT FACE="Courier New"></FONT></P>

<P>(This will automatically tile all the contours.)</P>

<P><FONT FACE="Courier New" SIZE="4">READ&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>caps</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#0000ff">&lt;LOOP NUMBER AND DELTA Z FOR VERTEX&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&gt;&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>1,1</STRONG></FONT></P>

<P>(For a flat cap, use a vertex height of 0. For caps which come to a
point, use a small number like 1 or 2 for the vertex height. A positive
number makes the cap point upwards, and a negative number makes it
point downwards.)<FONT SIZE="4"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&gt;&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>2,1</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&gt;&gt;&gt;</FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>30,-1</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>&lt;CR&gt;</STRONG></FONT></P>

<P>(When finished capping, press &lt;CR&gt;.)</P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>write</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&lt;WRITE MOSAIC CONTOUR FILE&gt;</FONT></P>

<P>(This file type is not used. 
Press </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000">
<STRONG>&lt;CR&gt;</STRONG></FONT> to skip.)</P>

<P><FONT FACE="Courier New" SIZE="4">&lt;WRITE DISPLAY PANEL FILE&gt;</FONT><FONT FACE="Courier New"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm.dat</STRONG></FONT><FONT FACE="Courier New"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">&lt;WRITE DISPLAY CONTOUR FILE&gt;</FONT></P>

<P>(This file type is not used. Press <FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>&lt;CR&gt;</STRONG></FONT> to skip.)</P>

<P><FONT FACE="Courier New" SIZE="4">READ&gt;&gt;</FONT><FONT FACE="Courier New"></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>exit</STRONG></FONT><FONT FACE="Courier New"></FONT></P>

<P>If the above procedure did not tile the object properly, the
interactive method will have to be used. It is advisable to get help
from an experienced staff member for this, but the method is
summarized  here (user responses only) for reference.  Generally, 
<A HREF="#Method 2">method 2</A> should be used for objects which are
difficult to tile.</P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>read</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm.mov</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>manual</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>auto</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">OK? </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>y</STRONG></FONT></P>

<P>(An attempt will be made to tile the
first two levels. If the results look correct, type <FONT
FACE="Courier New" SIZE="4"
COLOR="#ff0000"><STRONG>yes</STRONG></FONT>.)</P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>next</STRONG></FONT></P>

<P>(The next two levels will be displayed.)</P>

<P><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>auto</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">OK? </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>n</STRONG></FONT></P>

<P>If the results are not correct, type
<FONT FACE="Courier New" SIZE="4"COLOR="#ff0000"><STRONG>n</STRONG></FONT>.
You now have several options to force a correct tiling. The
following commands are usually tried, in this order: 
<FONT FACE="Courier New" SIZE="4"COLOR="#ff0000"><STRONG>include</STRONG></FONT>, 
<FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>renumber</STRONG></FONT>, 
<FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>guide</STRONG></FONT>, and 
<FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>triangulate</STRONG></FONT>.</P>

<P>Before writing the output file, don't forget to add any necessary
caps, as described above.</P>

<BR WP="BR1"><BR WP="BR2">

<P><A NAME="11."></A><STRONG>
11.      Smooth MOVIE.BYU-format objects.</STRONG> 

<TABLE BORDER="1" WIDTH="603" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="138">input file</TD>
<TD WIDTH="465">(e.g.) ommm.dat [MOVIE.BYU output tile file, -.dat]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="603" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="138">output file</TD>
<TD WIDTH="465">(e.g.) ommm_s.dat [MOVIE.BYU smoothed tile file]</TD></TR></TABLE>

<P>Objects tiled with MOVIE-BYU sometimes have ridges parallel to the
slices due to small errors in tracing contours on adjacent slices.
These ridges can be smoothed somewhat using a routine provided in
Sterecon's interface menu. Because the slices of tomographic volumes
are close-spaced, the smoothing is not likely to obscure any "real"
details, so it should normally be used. </P>

<P>Use Sterecon, INTerface menu (responses in <FONT COLOR="#ff0000">red</FONT>):</P>

<P><FONT FACE="Courier New" SIZE="4">INTerface menu (enter MEN to see choices). </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>smo</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Inventor or MOVIE.BYU geometry input files? (I/M): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>m</STRONG></FONT></P>

<P>(Be sure to use </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000">
<STRONG>m</STRONG></FONT> for MOVIE.BYU format.)</P>

<P><FONT FACE="Courier New" SIZE="4">Enter source geometry filename: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm.dat</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter smoothed geometry filename:<STRONG> </STRONG></FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm_s.dat</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Smooth end contours? (N/Y): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>y</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">READ: 4367 NODES AND 8661 POLYGONS.</FONT></P>

<P>The routine tells you how many points and triangles there were.</P>

<BR WP="BR1"><BR WP="BR2"> <P><STRONG><A NAME="12.">12.</A> Convert
MOVIE.BYU-format objects to Inventor geometry files</STRONG> <TABLE
BORDER="1" WIDTH="603" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="116">input file</TD> <TD WIDTH="487">(e.g.)
ommm_s.dat [MOVIE.BYU output tile file, -.dat]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="603" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="116">output file</TD>
<TD WIDTH="487">(e.g.) ommm.inv [Inventor geometry file, -.inv]</TD></TR></TABLE>

<P><FONT FACE="Courier New" SIZE="4">byutoexp ommm_s.dat ommm.inv</FONT></P>

<P>Where ommm_s.dat is an example of a smoothed, MOVIE.BYU tiled output
file and ommm.inv is the corresponding Inventor geometry file. To
distinguish geometry files made by this method, we use the extension
-.inv.</P>

<BR WP="BR1"><BR WP="BR2">
<BR WP="BR1"><BR WP="BR2">

<P><STRONG><A NAME="Final steps"><FONT SIZE="+2"></A>
Final steps                 </STRONG></FONT><FONT SIZE="+2"></FONT></P>


<BR WP="BR1"><BR WP="BR2">

<P><STRONG><A NAME="13."></A>
13.    Reduce the number of tiles in Inventor geometry files.</STRONG>

<TABLE
BORDER="1" WIDTH="746" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="206">input file</TD> <TD WIDTH="540">(e.g.)
ommm.geo [Inventor geometry file, -.geo]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="746" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="206">intermediate input file</TD>
<TD WIDTH="540">(e.g.) ommm.wrl [VRML file, -.wrl]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="746" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="206">intermediate output file</TD> <TD WIDTH="540">(e.g.)
ommm_d.inv [decimated Inventor geometry file, -.geo]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="746" CELLPADDING="1" CELLSPACING="1"> <TR
VALIGN="TOP"><TD WIDTH="206">output file</TD> <TD WIDTH="540">(e.g.)
ommm_d.geo [scaled, decimated Inventor geometry file, -.geo]</TD></TR></TABLE>

<P>Inventor geometry files made by <A HREF="#Method 2">method 2</A>
have many more tiles than necessary. The final display can be
manipulated much faster if the number of tiles is reduced. A
stand-alone application called "decimate" (decimate literally means to
reduce by 10 times) can be used to reduce the number of tiles.  The
application provides control of the amount of tile reduction and
displays the resulting model after each trial.  "Decimate" does not
take Inventor files as input, so the -.geo files must be converted to
VRML format first, and the output from "decimate" must be rescaled so
that all objects will be placed properly in a scene. Decimate only
works on individual objects, not on groups of objects.</P>

<P><STRONG>a.</STRONG> Convert to VRML:</P>

<FONT FACE="Courier New" SIZE="4"COLOR="#ff0000"><STRONG>
ivdowntovrml ommm.geo ommm.wrl</STRONG></FONT>

<P>Where ommm.geo is the orginal geometry file and ommm.wrl is the VRML
version.</P>

<P><STRONG>b.</STRONG> Decimate

<FONT FACE="Courier New" SIZE="4"COLOR="#ff0000"><STRONG>
decimate ommm.wrl</STRONG></FONT>

<P>It may take quite a long time for the application to start and load
the file. When the object appears, click on the "Decimate Surface"
button.  When the box appears, click on the "Fix Boundry" option.  Type
in the amount of decimation desired, then click on "Apply" (DO NOT
CLICK ON "OK" NOW). If the model is large, this could take some time.
For surfaces made using Method 2, 1-5% is usually appropriate, with the
smaller value better for larger objects.  After some time, the
decimated surface will be shown, and the total number of triangles in
the decimated surface will be indicated.  Ideally, it should be not
more than 2000. You can go back to the original number of triangles by
typing 100%, or try any other value.  When you are satisfied with the
decimation, click on "OK" (if you fail to type OK, the model will not
be saved in decimated form).</P>

<P>If desired, you can smooth the object after decimation, but before
saving the decimated version. This is not suitable for all objects,
since it can change the shape.  Click on "Relax Surface".  When the
box appears, click on "Fix Boundry".  Type in the number of iterations
desired. Start with 5. Higher numbers make the model smoother, but
can change the shape.  As with "Decimate Surface", the "Apply" button
is for viewing the results, and the "OK" button is for accepting the new
surface.</P>

<P>To save the new surface, click on the "Save As" button.  When the
box appears, select file type "Inventor ASCII".  Then type in the 
desired file name in the lower box, and click on "OK"</P>

<P><STRONG>c.</STRONG>  Scale the decimated file</P>

<FONT FACE="Courier New" SIZE="4"COLOR="#ff0000"><STRONG>
fixdeci.perl ommm.geo ommm_d.inv ommm_d.geo</STRONG></FONT>

<P>You must copy the file "fixdeci.perl" to your directory from 
<A HREF="">here</A>.  This step reads the scaling from your original
Inventor geometry file ("ommm.geo" in the example) and applies it to
the decimated file ("ommm_d.inv" in the example), creating the new
file, both decimated and scaled ("ommm_d.geo" in the example).

<BR WP="BR1"><BR WP="BR2">

<P><STRONG><A NAME="14.">
14.        </A> Smooth Inventor geometry files</STRONG>

<TABLE BORDER="1" WIDTH="551" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="108">input file</TD>
<TD WIDTH="443">Inventor geometry file [-.inv or -.geo]</TD></TR></TABLE>

<TABLE BORDER="1" WIDTH="551" CELLPADDING="1" CELLSPACING="1">
<TR VALIGN="TOP"><TD WIDTH="108">output file</TD>
<TD WIDTH="443">Smoothed Inventor geometry file [-.inv or -.geo]</TD></TR></TABLE>

<P>This is primarily useful for smoothing Inventor geometry files that
were made using <A HREF="#Method 2">method 2</A> and then decimated using <A
HREF="#13.">step 13.</A> However, at present it only works if there is
only one object represented in the file.  It can also be used for
inventor files made with <A HREF="#Method 3">method 3</A> (extention
-.inv). However, it uses the same method as <A HREF="#11.">step 11</A>,
so it is not effective if the *.inv file has already been smoothed in
<A HREF="#11.">step 11.</A> It has little effect on -.geo files made by
<A HREF="#Method 2">method 2</A><A HREF="#7."></A><A HREF="#8."></A>
without first applying <A HREF="#13.">step 13.</A></P>

<P>The routine is part of Sterecon. From the Sterecon INTerface menu,
use the following example (responses in <FONT
COLOR="#ff0000">red</FONT>):</P>

<P><FONT FACE="Courier New" SIZE="4">Enter choice: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>smo</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Inventor or MOVIE.BYU geometry 
input files? (I/M): </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000">
<STRONG>i</STRONG></FONT></P>

<P>(Be sure to use<FONT FACE="Courier New" SIZE="4"
COLOR="#ff0000"><STRONG> i</STRONG></FONT> for Inventor format.)</P>

<P><FONT FACE="Courier New" SIZE="4">Enter source geometry filename: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm.geo</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Enter smoothed geometry filename: </FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG>ommm_s.geo</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">Smooth end contours? (N/Y):</FONT><FONT FACE="Courier New" SIZE="4" COLOR="#ff0000"><STRONG> y</STRONG></FONT></P>

<P><FONT FACE="Courier New" SIZE="4">READ: 4369 COORDINATES</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">READ: 8661 TRIANGLES</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">----------- CONNECTIVITY TABLE--------</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">0 : 2</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">4 : 4</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">6 : 58</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">8 : 86</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">10 : 645</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">12 : 2867</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">14 : 628</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">16 : 77</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">18 : 2</FONT></P>

<P><FONT FACE="Courier New" SIZE="4">--------------------------------------</FONT></P>

<P>Some statistics on the data is shown on the screen.</P>

<BR WP="BR1"><BR WP="BR2"> 

<P><STRONG><A NAME="15.">
15.      </A> Combine objects and make the final surface-rendered
model.</STRONG></P>

<P>All the Inventor files made above can be displayed using SceneViewer
or Iris Explorer. </P>

<P>The objects can be manipulated and rendered in many ways. The
following just describes the basics.</P>

<P>SceneViewer is simpler to use. Start by typing <FONT
COLOR="#ff0000"><STRONG>SceneViewer</STRONG></FONT> and use <FONT
COLOR="#ff0000"><STRONG>file&gt;open</STRONG></FONT> for the first
geometry file.  Change to orthogonal view by clicking on the bottom
box on the icon bar on the right. To add more geometry files, use <FONT
COLOR="#ff0000"><STRONG>file&gt;import</STRONG></FONT>. To change the
color or transparency of an object, use <FONT
COLOR="#ff0000"><STRONG>edit&gt;pick edit</STRONG></FONT> or click on
the arrow on the right-hand icon bar. Then click on the object you want
to edit. Wait for a red box to appear around the object selected. Then
use <FONT COLOR="#ff0000"><STRONG>editors&gt;material
editor</STRONG></FONT> and/or <FONT
COLOR="#ff0000"><STRONG>editors&gt;color</STRONG></FONT>, which will
open boxes allowing you to select the rendering you like. You can
rotate, translate, and zoom the model using the thumbwheels. If you
want to rotate or translate the model by typing in numbers, use <FONT
COLOR="#ff0000"><STRONG>edit&gt;pick all</STRONG></FONT> and open the
transform box using <FONT
COLOR="#ff0000"><STRONG>editors&gt;transform</STRONG></FONT>. You can
save a final model, including the selected objects and
color/transparency choices under <FONT
COLOR="#ff0000"><STRONG>file&gt;save as.</STRONG></FONT> </P>

<P>To use Iris Explorer, type <FONT
COLOR="#ff0000"><STRONG>explorer</STRONG></FONT>, and pick and drag the
modules "ReadGeom" and "Render" from the list to the map area. A
ReadGeom module must be used for each geometry file.  They can all be
connected to Render. The map you make can be saved using <FONT
COLOR="#ff0000"><STRONG>file&gt;save as</STRONG></FONT> with the extention
".map". Then use Render the same as SceneViewer, above.</P>

<P>NOTES:</P>

<P>Do not move the model while only one object is picked (with a red
box). If you do this, only the picked object will move. Since all the
objects are made to be in register with each other, it is not necessary
to move them separately.</P>

<P>Objects made using <A HREF="#Method 1">method 1</A> cannot be picked
properly, so the color cannot be changed. Since they can't be picked
properly, they can't be deleted properly. Therefore, such objects
should only be added after the rest of the display is satifactory. </P>

<BR WP="BR1"><BR WP="BR2"> 
<P><STRONG><A NAME="16.">
16.     </A> Determine surface area from models.</STRONG></P>

<P><STRONG>Method A:</STRONG> Use the MOVIE.BYU display panel file, (extention -.dat,
made in <A HREF="#10.">step 10</A>), then use Sterecon, INTerface menu:
ARE.  This gives result in square micrometers or square nm, depending
on the units you used when setting up the Sterecon file.</P>

<P><STRONG>Method B:</STRONG> Use an Inventor geometry file and the stand-alone utility
"surface".  This gives a result in square pixels. When converting to
actual area, be sure to use the square of the number of pixels/nm.
Also, don't forget to include any size reduction or expansion relative
to the original data. More information on this utility will be added 
later. </P>

<P><STRONG>Method C:</STRONG> Use the SPIDER command 
<A HREF="../../../man/ia.html">IA</A>.
This is performed on a SPIDER volume, so it only applies to 
objects created using <A HREF="#Method 2">method 2</A>. The file
made in <A HREF="#5.">step 5</A> is needed for this operation.
 </P>

<BR WP="BR1"><BR WP="BR2"> 

<P><STRONG><A NAME="17.">
17.       </A> Make presentations from models.</STRONG></P>

Coming attractions:
<P>
<LI>Use of VRML models for interactive volume manipulation on webpages.</LI>
<P>
<LI>Use of Explorer to automate creation of animations.</LI>
<P>
<LI>Use of movies in websites and in PowerPoint presentations.</LI>
</P>


<BR WP="BR1"><BR WP="BR2"> 

<P><STRONG><A NAME="18.">
18.     </A> Miscellaneous tips</STRONG></P>


<P>(Under construction)</P>

<BR WP="BR1">

<P><STRONG>A.</STRONG> Creation of "artificial" Inventor-format objects which can be added
to a model.</P>

<P>1. Use SGI Showcase to make a simple 3-D volume, and save it as an Inventor
file. </P>

<P>2. Use "ivquicken -a" to make the file editable.</P>

<P>3. Edit the "transform" parameters to get the proportions desired.</P>

<P>4. Add to the SceneViewer or Render model and manipulate as desired.></P>

</BODY>
</HTML>
