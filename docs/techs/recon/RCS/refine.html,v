head	1.29;
access;
symbols;
locks; strict;
comment	@# @;


1.29
date	2013.01.30.13.24.22;	author leith;	state Exp;
branches;
next	1.28;

1.28
date	2010.09.16.14.23.46;	author leith;	state Exp;
branches;
next	1.27;

1.27
date	2007.01.17.16.46.55;	author leith;	state Exp;
branches;
next	1.26;

1.26
date	2006.05.12.16.19.33;	author bbaxter;	state Exp;
branches;
next	1.25;

1.25
date	2006.05.12.16.15.23;	author bbaxter;	state Exp;
branches;
next	1.24;

1.24
date	2006.05.08.18.16.39;	author bbaxter;	state Exp;
branches;
next	1.23;

1.23
date	2006.04.06.18.50.13;	author leith;	state Exp;
branches;
next	1.22;

1.22
date	2005.01.18.17.37.39;	author leith;	state Exp;
branches;
next	1.21;

1.21
date	2004.12.01.18.03.41;	author bbaxter;	state Exp;
branches;
next	1.20;

1.20
date	2004.11.16.15.49.36;	author leith;	state Exp;
branches;
next	1.19;

1.19
date	2004.11.16.15.05.37;	author leith;	state Exp;
branches;
next	1.18;

1.18
date	2004.08.12.15.13.26;	author bbaxter;	state Exp;
branches;
next	1.17;

1.17
date	2004.08.03.15.32.04;	author bbaxter;	state Exp;
branches;
next	1.16;

1.16
date	2004.07.29.14.18.53;	author leith;	state Exp;
branches;
next	1.15;

1.15
date	2004.07.01.17.30.14;	author leith;	state Exp;
branches;
next	1.14;

1.14
date	2004.06.01.19.34.44;	author leith;	state Exp;
branches;
next	1.13;

1.13
date	2004.03.29.18.55.43;	author leith;	state Exp;
branches;
next	1.12;

1.12
date	2004.03.29.15.53.23;	author leith;	state Exp;
branches;
next	1.11;

1.11
date	2004.03.25.19.36.23;	author leith;	state Exp;
branches;
next	1.10;

1.10
date	2003.08.13.15.34.18;	author leith;	state Exp;
branches;
next	1.9;

1.9
date	2003.08.04.17.00.59;	author leith;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.16.15.54.07;	author leith;	state Exp;
branches;
next	1.7;

1.7
date	2003.04.02.17.36.12;	author leith;	state Exp;
branches;
next	1.6;

1.6
date	2003.03.31.16.36.23;	author leith;	state Exp;
branches;
next	1.5;

1.5
date	2003.03.31.16.28.25;	author leith;	state Exp;
branches;
next	1.4;

1.4
date	2003.03.27.14.27.16;	author leith;	state Exp;
branches;
next	1.3;

1.3
date	2003.03.26.21.34.27;	author leith;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.10.15.37.40;	author leith;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.07.17.08.46;	author leith;	state Exp;
branches;
next	;


desc
@@


1.29
log
@removed saveresp.  no longer a used proc.
@
text
@<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
  <title>Refinement</title>
</head>

<body>

<h1 align="center">Refinement</h1>

<a href="#Serial">    Running Serial Refinement</a></br>
<a href="#Cluster">   Running Refinement on Cluster using Pubsub</a></br>
<a href="#Output">    SPIDER Refinement Output</a></br>
<a href="#Procedures">SPIDER Refinement Procedures</a></br>
<a href="#Flowchart"> Refinement Flowchart</a></br>
<a href="#Tree">      Tree of Procedure Calls</a></br>
<ul>

<li><a name="Serial"></a>
<h2>Running Serial Refinement</h2>

<ol>

<li>Access your refinement_dir, e.g.:<br />
  <i>cd &nbsp;&nbsp;/mydir/project/Refinement</i>
</li>
<p />

<li>If you are using <b>OPTIONAL</b>
    "<a href="../xray/xray.html">amplitude enhancement</a>" you will have to add the following
    initial files to input
   <table class="outs">
   <tr valign="top"><td>&curren;</td>
          <td><code class="output"> input/<a href="../xray/scattering8.tst">scattering</a></td> 
          <td>X-ray scattering power spectrum</td> </tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/mask</td></td> 
          <td>Mask created from ribosome-translocon</td> </tr>
   </table>
</li>
<p />

<li>Edit <a href="./newprogs/refine_settings.pam">refine_settings.pam</a> to set
   necessary values for refinement parameters and and any abnormal input file names,
   e.g.<br />
   <i>nedit refine_settings.pam</i>
</li>
<p />

<li>Start refinement using 
   <a href= "./newprogs/refine.pam">refine.pam</a>, e.g.<br />
   <i>spider pam/ftf @@refine 0 &amp;</i>
</li>
</ol>
</li>
<p />


<li><a name="Cluster">
<h2>Running Refinement on Cluster using Pubsub</h2>

<ol>
<p />

<li>Login to master node of cluster, where PubSub has been 
  <a href="../../../pubsub/pubsub_inst.html">installed and is running</a>,
  e.g.:<br />
  <i>ssh &nbsp;&nbsp;radha</i>
</li>
<p />

<li>Access your refinement_dir, e.g.:<br />
  <i>cd &nbsp;&nbsp;/mydir/project/Refinement</i>
</li>
<p />

<li>If you are using <b>OPTIONAL</b>
    "<a href="../xray/xray.html">amplitude enhancement</a>" you will have to add the following
    initial files to input
   <table class="outs">
   <tr valign="top">
          <td><code class="input"> input/<a href="../xray/scattering8.tst">scattering</a></td> 
          <td>X-ray scattering power spectrum</td> </tr>
   <tr valign="top">
          <td><code class="input">input/mask</td></td> 
          <td>Mask created from ribosome-translocon</td> </tr>
   </table>
</li>
<p />

<li>Remove any existing output files currently in the refinement
   directory, e.g.:<br />
   <i>\rm f &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.*
   &nbsp;&nbsp; LOG.* &nbsp;&nbsp; fort.* &nbsp;&nbsp; work/*
   &nbsp;&nbsp; local/* &nbsp;&nbsp; final/* &nbsp;&nbsp; core*
   &nbsp;&nbsp; </i>                        
</li>
<p />

<li>Copy latest SPIDER executable into the current directory and rename it: <i>spider</i> 
    (ensures that same SPIDER executable is used throughout whole refinement), e.g.:<br />
   <i>cp /usr/local/spider/bin/spider_linux_mp_opt64.18.06 &nbsp;&nbsp; spider</i>
</li>
<p />

<li>Edit <a href="./newprogs/refine_settings.pam">refine_settings.pam</a> to set
   necessary values for refinement parameters and input file names,
   e.g.<br />
   <i>xedit  &nbsp;&nbsp; refine_settings.pam</i>
</li>
<p />

<li>Start Master SPIDER refinement process 
    <a href= "./newprogs/pub_refine.pam">pub_refine.pam</a>, e.g.<br />
    <i>spider pam/ftf &nbsp;&nbsp; @@pub_refine 0 &amp;</i>
</li>
<p />

<li>Master SPIDER refinement process will create and 
   <a href= "../../../pubsub/publish.perl">publish</a> 
   new SPIDER jobs as necessary.
</li>
<p />

<li>If the refinement fails.<br />
 <ol>
 <li>Use <i>'killspi'</i> to stop any remaining parallel jobs that
     belong to you.</li>
 <li>Use <i>'wherespi'</i> to find any remaining parallel jobs. If any
   remain, use <i>'killspi'</i> again until they are all gone.</li>
 <li>Clean any un-needed output files (you may want to save
    <i>final/*</i> and <i>results.*</i> if you are restarting at a
    later iteration): e.g..<br />
    <i>\rm -rf &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.*
     &nbsp;&nbsp; LOG.* &nbsp;&nbsp; work/ &nbsp;&nbsp;
     local/&nbsp;&nbsp; final/ &nbsp;&nbsp; core* &nbsp;&nbsp;
     fort.*</i></li>
 <li>To restart while saving some defocus group results for this
     iteration, alter your: 
     <i>input/order_select,*</i> and <i>input/order_select_sort.*</i>
     files to contain only the desired defocus groups and edit:
     <i>pub_refine.pam</i> to stop at end of iteration.  Restart, then
     commence again at next iteration with step: 7.

 <li>Restart at step: 8.</li>
 </ol>
</li>


</ol>
</li>
<p />

<li><a name="Output">
<h2>SPIDER Refinement Output</h2>

<p>All refined alignment parameters are placed in a single output
document file typically: <i>final/align_{iteration}_{group}</i></p>

<table border="5" cellpadding="10">
<caption><b>Document file columns</b></caption>

<tr>
<td>Proj. angle - PHI</td>
<td>Proj. angle - THETA</td>
<td>Proj. angle - PSI</td>
<td>Ref. #I</td>
<td>Image #</td>
<td>Inplane angle</td>
<td>X Shift</td>
<td>Y Shift</td>
<td>Number of projs.</td>
<td>Angular diff.</td>
<td>CC Rotation</td>
<td>Current Inplane angle</td>
<td>Current X Shift</td>
<td>Current Y Shift</td>
</tr>
</table>

<br />
<br />
 <i></i></li>

<li><a name="Procedures">
<h2><i>SPIDER Refinement Procedures</i></h2>

<!-- SPIRE directory=Refinement -->
<p />

<table border="5" cellpadding="10">
<tr>
   <th>Serial</th>
   <th>Parallel<br />
   (For Pubsub)</th>
</tr>

<tr>
   <td><b>Master procedure</b><br />
   <a class="project" href="./newprogs/refine.pam">refine.pam</a></td>
   <td><b>Master procedure</b><br />
   <a class="project" href="./newprogs/pub_refine.pam">pub_refine.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a></td>
   <td><a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/prepare.pam">prepare.pam</a></td>
   <td><a class="project" href="./newprogs/prepare.pam">prepare.pam</a></td>
</tr>

<tr>
   <td>-</td>
   <td><a href="../../../pubsub/publish.perl">publish.perl</a></td>
</tr>

<tr>
   <td>-</td>
   <td><a class="project" href= "./newprogs/pub_refine_start.pam">pub_refine_start.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/grploop.pam">grploop.pam</a></td>
   <td><a class="project" href="./newprogs/grploop.pam">grploop.pam</a></td>
</tr>

<tr>
   <td>-</td>
   <td><a class="project" href="./newprogs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a></td>
</tr>

<tr>
   <td>-</td>
   <td><a class="project" href="./newprogs/pub_refine_wait.pam">pub_refine_wait.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
   <td><a class="project" href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/enhance.pam">enhance.pam</a></td>
   <td><a class="project" href="./newprogs/enhance.pam">enhance.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/endmerge.pam">endmerge.pam</a></td>
   <td><a class="project" href="./newprogs/endmerge.pam">endmerge.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/smangloop.pam">smangloop.pam</a></td>
   <td><a class="project" href="./newprogs/smangloop.pam">smangloop.pam</a></td>
</tr>

<tr>
   <td><a class="project" href="./newprogs/endrefine.pam">endrefine.pam</a></td>
   <td><a class="project" href="./newprogs/endrefine.pam">endrefine.pam</a></td>
</tr>

</table>
</li>

<!-- SPIRE end -->

<p />
<li><a name="Flowchart">
<h2>Refinement Flowchart</h2>

Steps indicated in <i><font color="#ff0000">red</font></i> italics
can be conducted in parallel on different processors. 

<p />

<ol>
<li><a href="./newprogs/refine_settings.pam">Set</a> initial
    parameters &amp; file names</li>
<p />

<li><a href="./newprogs/prepare.pam">Prepare</a> input files.</li>
<p />

<li><i><font color="#ff0000">Loop over all defocus
       groups</font></i></li>

   <ul>
   <li>Create group CTF's weighted by number of particles. 

   <table border="1">
      <tr>
      <td>TF C3</td>
      <td>Compute phase contrast transfer function</td>
      </tr>

      <tr>
      <td>AR</td>
      <td>Weight current CTF by number of particles</td>
      </tr>
   </table>
   </li>
   </ul>
</li>
<p />

<li>Loop over all iterations creating iteration volumes<br />
<p />

   <ul>
   <li><a href="./newprogs/refine_settings.pam">Set parameters</a> 
       for this iteration</li>
   <p />

   <li>Create Fourier and document files used for this iteration<br />
   <table border="1">
      <tr>
      <td>FT</td>
      <td>Fourier on current volume produced by previous iter.</td>
      </tr>

      <tr>
      <td>VO EA</td>
      <td>Create reference angles for this iteration</td>
      </tr>

      <tr>
      <td>DOC CREATE</td>
      <td>Create selection file for reference angles</td>
      </tr>
   </table>
   </li>
   <p />
   </li>

   <li><i><font color="#ff0000"><a href= "./newprogs/grploop.pam">Loop</a> 
       over all defocus groups creating group volumes<br />
       </font></i> 
   <p />

   <ul>
   <li>Create CTF corrected volumes 

   <table border="1">
      <tr>
      <td>MU</td>
      <td>Multiply Fourier of current volume by CTF file for this group</td>
      </tr>

      <tr>
      <td>FT</td>
      <td>Fourier back transform the CTF corrected volume</td>
      </tr>

      <tr>
      <td>PJ 3Q</td>
      <td>Create stack holding reference angular projections from CTF
          corrected volume (reference projections)</td>
      </tr>

      <tr>
      <td>CP</td>
      <td>Copy current aligned images to inline stack for speed</td>
      </tr>

      <tr>
      <td>AP REF or AP SH</td>
      <td>Find reference projections matching each current aligned image.
         Find alignment parameters to match selected ref. projection.</td>
      </tr>
   </table>
   </li>
   <p />

   <li>Loop over all images in current group</li>
   <ul>
      <li>Align original images for back-projection 

      <table border="1">
         <tr>
         <td>RT SQ</td>
         <td>Rotate, mirror, and shift unaligned original image to create
             current aligned image</td>
         </tr>
         </table>
      </li>
   </ul>
   <p />
   </li>

   <li>Back-project original images into new group volume 

   <table border="1">
      <tr>
      <td>BP 32F</td>
      <td>Calculate refined group volume from new aligned images and
          angle data</td>
      </tr>

      <tr>
      <td>CG PH</td>
      <td>Calculate center of gravity of refined group volume</td>
      </tr>

      <tr>
      <td>SH F</td>
      <td>Shift refined group volume to center</td>
      </tr>

      <tr>
      <td>RF 3</td>
      <td>Calculate phase residual for refined group volume</td>
      </tr>
   </table>
   </li>
   </ul>
</li>
<p/>

<li><a href="./newprogs/mergegroups.pam">Merge group volumes into
      iteration volume</a>

   <table border="1">
      <tr>
      <td>TF CTS</td>
      <td>Create CTF corrected volume from refined group volumes</td>
      </tr>

      <tr>
      <td>TF CTS</td>
      <td>Create 1/2 CTF corrected volume from refined group volumes</td>
      </tr>

      <tr>
      <td>TF CTS</td>
      <td>Create 1/2 CTF corrected volume from refined group volumes</td>
      </tr>

      <tr>
      <td>RF 3</td>
      <td>Calculate resolution for group volume</td>
      </tr>

     <tr>
      <td><a href="./newprogs/enhance.pam">@@enhance</a> </td>
      <td>Optional amplitude enhancement</td>
      </tr>

      <tr>
      <td>FQ</td>
      <td>Filter final corrected volume to resolution</td>
      </tr>
   </table>
   </li>
</ul>
</li>
<p />

<li>End iterations when angular displacements are small in all groups.</li>
<p />

<li><i><font color="#ff0000"><a href= "./newprogs/endmerge.pam">Loop</a> over all defocus
     groups</font></i></li>

   <ul>
   <li>Create final group volumes using BP CG 

   <table border="1">
      <tr>
      <td>BP CG</td>
      <td>Create final group volume from aligned images and angle
          data</td>
      </tr>

      <tr>
      <td>BP CG</td>
      <td>Create final 1/2 group volume from aligned images and angle
          data</td>
      </tr>

      <tr>
      <td>BP CG</td>
      <td>Create final 1/2 group volume from aligned images and angle
          data</td>
      </tr>

      <tr>
      <td>RF 3</td>
      <td>Calculate resolution for final group volume</td>
      </tr>
   </table>
</li>
</ul>
</li>
<p />

<li>Continue with small-angle refinement or 
   <a href= "#final_merge">GO TO FINAL VOLUME MERGE</a>.
<p />

   <ul>
   <li><a href="./newprogs/refine_settings.pam">Set parameters</a> for
        small-angle refinement</li>
   <p />

   <li>Loop over all small-angle iterations creating iteration volumes<br />
   <p />

   <ul>
   <li><a href="./newprogs/refine_settings.pam">Set parameters</a> 
           for this iteration</li>
   <p />
   </li>

   <li>Create Fourier and document files used for this iteration<br />
 
   <table border="1">
      <tr>
      <td>FT</td>
      <td>Fourier on current volume produced by previous iter.</td>
      </tr>

      <tr>
      <td>VO EA</td>
      <td>Create relative offset for reference angles for this
          iteration</td>
      </tr>

      <tr>
      <td>DOC CREATE</td>
      <td>Create selection file for reference angles</td>
      </tr>
   </table>
   </li>
   <p />

   <li><i><font color="#ff0000"><a href= "./newprogs/smangloop.pam">Loop</a> 
           over all defocus groups creating group volumes<br /> </font></i> 

   <p />

   <ul>
   <li>Create CTF corrected volumes 

   <table border="1">
      <tr>
      <td>MU</td>
      <td>Multiply Fourier of current volume by CTF file for this
         group</td>
      </tr>

      <tr>
      <td>FT</td>
      <td>Fourier back transform the CTF corrected volume</td>
      </tr>
   </table>
   </li>
   <p />

   <li>Loop over all images in current group 
   <ul>
   <li>Align original images for back-projection 

   <table border="1">
      <tr>
      <td>UD IC</td>
      <td>Get current angle for this image</td>
      </tr>

      <tr>
      <td>VO RAS</td>
      <td>Get angular range around current angle</td>
      </tr>

      <tr>
      <td>PJ 3Q</td>
      <td>Project thru volume at these angles to create set of angular
          reference projections</td>
      </tr>

      <tr>
      <td>AP REF</td>
      <td>Find nearest reference projection matching each current
          image.</td>
      </tr>

      <tr>
      <td>RT SQ</td>
      <td>Rotate, and shift unaligned original image to create aligned
          image</td>
      </tr>
   </table>
   </li>
   </ul>
</li>
<p />

<li>Back-project original images into new group volume 

   <table border="1">
      <tr>
      <td>BP 32F</td>
      <td>Calculate refined group volume from new aligned images and
          angle data</td>
      </tr>

      <tr>
      <td>RF 3</td>
      <td>Calculate phase residual for refined group volume</td>
      </tr>
   </table>
   </li>
</ul>
</li>

<p />

<li><a href="./newprogs/mergegroups.pam">Merge group volumes into
      iteration volume</a>

   <table border="1">
      <tr>
      <td>TF CTS</td>
      <td>Create CTF corrected iteration volume from refined group
          volumes</td>
      </tr>

      <tr>
      <td>TF CTS</td>
      <td>Create 1/2 CTF corrected iteration volume from refined group
          volumes</td>
      </tr>

      <tr>
      <td>TF CTS</td>
      <td>Create 1/2 CTF corrected iteration volume from refined group
          volumes</td>
      </tr>

      <tr>
      <td>RF 3</td>
      <td>Calculate resolution for iteration volume</td>
      </tr>

      <tr>
      <td>FQ</td>
      <td>Filter final corrected volume to resolution</td>
      </tr>

      <tr>
      <td>CG PH</td>
      <td>Calculate center of gravity of refined volume</td>
      </tr>

      <tr>
      <td>SH F</td>
      <td>Shift refined volume to center</td>
      </tr>

   </table>
   </li>
   </ul>
</li>
<p />

<li>End iterations when angular displacements are small in all
    groups.</li>
</ul>
<p />

<li><i><font color="#ff0000"><a href= "./newprogs/endmerge.pam">Loop</a> 
   over all defocus groups</font></i> 
   <ul>
   <li>Create final group volumes using BP CG 

   <table border="1">
      <tr>
      <td>BP CG</td>
      <td>Create final group volume from aligned images and angle
      data</td>
      </tr>

      <tr>
      <td>BP CG</td>
      <td>Create final 1/2 group volume from aligned images and angle
            data</td>
      </tr>

      <tr>
      <td>BP CG</td>
      <td>Create final 1/2 group volume from aligned images and angle
            data</td>
      </tr>

      <tr>
      <td>RF 3</td>
      <td>Calculate resolution for final group volume</td>
      </tr>
   </table>
   </li>
   </ul>
</li>
<p />

<li><a name="final_merge" href="./newprogs/endrefine.pam">Merge
    group volumes into final iteration volume and determine final
    resolution</a>

   <table border="1">
      <tr>
      <td>TF CTS</td>
      <td>Create final CTF corrected iteration volume from final group
            volumes</td>
      </tr>

      <tr>
      <td>TF CTS</td>
      <td>Create final 1/2 CTF corrected iteration volume from final
            group volumes</td>
      </tr>

      <tr>
      <td>TF CTS</td>
      <td>Create final 1/2 CTF corrected iteration volume from final
            group volumes</td>
      </tr>

      <tr>
      <td>RF 3</td>
      <td>Calculate resolution for final iteration volume</td>
      </tr>
   </table>
</li>
<p />

<li>Refinement finished.</li>
</ol>
<p />

<li><a name="Tree"></a>
<h2>Tree of Procedure calls</h2>
(not all procedures are called)
<p />
<table width="100%">
<tr><td valign="top">
<pre>
refine
    refine_settings
    prepare
    grploop
    smangloop
    mergegroups
        enhance
    endmerge
    endrefine
</pre></td>

<td><pre>
pub_refine
    refine_settings
    prepare
    pub_refine_start
        refine_settings
        pub_ref_loop_clone 
        grploop
        smangloop
        endmerge
        pub_refine_doc_sync
        pub_ref_loop_declone 
    pub_refine_wait
    pub_refine_start
        pub_ref_merge_clone
        mergegroups
        enhance
        pub_ref_merge_declone
    pub_refine_wait
    endrefine
</pre></td>
</tr></table>


<hr>
<small>Source file: refine.html &nbsp;&nbsp;&nbsp; 
       Updated: 9/14/10 &nbsp;&nbsp;&nbsp; 
       ArDean Leith</small>
</body>
</html>

@


1.28
log
@update
@
text
@d11 3
a13 3
<a href="#Serial">Running Serial Refinement</a></br>
<a href="#Cluster">Running Refinement on Cluster using Pubsub</a></br>
<a href="#Output">SPIDER Refinement Output</a></br>
d15 2
a16 2
<a href="#Flowchart">Refinement Flowchart</a></br>
<a href="#Tree">Tree of Procedure Calls</a></br>
a250 5
   <td><a class="project" href="./newprogs/saveresp.pam">saveresp.pam</a></td>
   <td><a class="project" href="./newprogs/saveresp.pam">saveresp.pam</a></td>
</tr>

<tr>
d446 1
a446 6
      <tr>
      <td><a href="./newprogs/saveresp.pam">@@saveresp</a> </td>
      <td>Record resolution</td>
      </tr>

      <tr>
a647 5
      <td><a href="./newprogs/saveresp.pam">@@saveresp</a> </td>
      <td>Record resolution</td>
      </tr>

      <tr>
a752 1
        saveresp
a754 1
        saveresp
a757 1
        saveresp
a767 1
            saveresp
a775 1
        saveresp
a779 1
        saveresp
@


1.27
log
@\increased stack usage
@
text
@d27 1
a27 39
<p></p>

<li>Copy all the necessary refinement procedure files to the
    refinement directory, e.g.:<br />
    <i>scp -v '/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam' .</i>
</li>

<li><p class="action">Collect necessary files in <i>input</i> directory</p>

   <a class="project" href="./newprogs/copyin.pam">copyin.pam</a>
   assembles the necessary input files from the other project directories: 
   <table class="outs">
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input</code>: </td> 
          <td>Directory
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/order_select</code>: </td> 
          <td>Group selection file</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/order_select_sort</code>: </td> 
          <td>Sorted group selection file</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/vol01</code>: </td> 
          <td>Initial starting volume</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/select_{***[grp]}</code>: </td> 
          <td>Particle selection files</td></tr> 
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/align_01_{***[grp]}</code>: </td> 
          <td>Initial alignment parameter files</td></tr> 
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/data{***[grp]}</code>: </td> 
          <td>Unaligned stacked image files</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/dala01_{***[grp]}</code>: </td> 
          <td>Initial aligned stacked image files</td></tr>
   </table>
   <p></p>
</li>
d41 1
a41 1
<p></p>
d48 1
a48 1
<p></p>
d56 1
a56 1
<p></p>
d63 1
a63 1
<p></p>
d68 1
a68 1
  <i>ssh &nbsp;&nbsp;patroon3</i>
d70 1
a70 1
<p></p>
d75 1
a75 22
<p></p>

<li>Copy all the necessary refinement procedure files to your 
   refinement directory, e.g.:<br />
   <i>scp -v
   &nbsp;&nbsp;'/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam' &nbsp;&nbsp; .</i><br />
  (Note:  <i>/net/bali/usr1 </i> is mounted on patroon)
</li>
<p></p>

<li>Create an input sub-directory, e.g.:<br />
 <i>mkdir &nbsp; input</i>
</li>
<p></p>

<li>If the input files created by <a class="project" href="./newprogs/copyin.pam">copyin.pam</a>
    are not already in the <i>Refinement/input</i> directory then
    you will copy all the needed data files to the input directory, e.g.:<br />
    <i>scp &nbsp;&nbsp; 'user@@sylt.wadsworth.org:/usr21/Refinement/input/*' &nbsp;&nbsp; input</i><br />
   <p></p>

   Initial input files needed: 
d77 3
d81 6
a86 24
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input</code>: </td> 
          <td>Directory
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/order_select</code>: </td> 
          <td>Group selection file</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/order_select_sort</code>: </td> 
          <td>Sorted group selection file</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/vol01</code>: </td> 
          <td>Initial starting volume</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/select_{***[grp]}</code>: </td> 
          <td>Particle selection files</td></tr> 
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/align_01_{***[grp]}</code>: </td> 
          <td>Initial alignment parameter files</td></tr> 
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/data{***[grp]}</code>: </td> 
          <td>Unaligned stacked image files</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td><code class="output">input/dala01_{***[grp]}</code>: </td> 
          <td>Initial aligned stacked image files</td></tr>
d89 1
a89 1
<p></p>
d93 4
a96 4
   <i>\rm -rf &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.*
   &nbsp;&nbsp; LOG.* &nbsp;&nbsp; fort.* &nbsp;&nbsp; work/
   &nbsp;&nbsp; local/&nbsp;&nbsp; final/ &nbsp;&nbsp; core*
   &nbsp;&nbsp; </i><br />
d98 1
a98 1
<p></p>
d100 1
a100 1
<li>Copy a latest SPIDER executable into the current directory and rename it: <i>spider</i> 
d102 1
a102 1
   <i>cp /usr/local/spider/bin/spider_linux_mpfftw.14.16 &nbsp;&nbsp; spider</i>
d104 1
a104 1
<p></p>
d111 1
a111 1
<p></p>
d117 1
a117 1
<p></p>
d123 1
a123 1
<p></p>
d143 1
a143 1
     commence again at next iteration with step: 8.
d152 1
a152 1
<p></p>
d189 1
a189 1
<p></p>
d275 1
a275 1
<p></p>
d282 1
a282 1
<p></p>
d287 1
a287 1
<p></p>
d290 1
a290 1
<p></p>
d312 1
a312 1
<p></p>
d315 1
a315 1
<p></p>
d320 1
a320 1
   <p></p>
d340 1
a340 1
   <p></p>
d346 1
a346 1
   <p></p>
d374 1
a374 1
      <td>AP REF</td>
d376 1
a376 1
         Find alignment parameters to match selected ref. progjection.</td>
d380 1
a380 1
   <p></p>
d395 1
a395 1
   <p></p>
d469 1
a469 1
<p></p>
d472 1
a472 1
<p></p>
d507 1
a507 1
<p></p>
d511 1
a511 1
<p></p>
d516 1
a516 1
   <p></p>
d519 1
a519 1
   <p></p>
d524 1
a524 1
   <p></p>
d547 1
a547 1
   <p></p>
d552 1
a552 1
   <p></p>
d570 1
a570 1
   <p></p>
d608 1
a608 1
<p></p>
a619 10
      <td>CG PH</td>
      <td>Calculate center of gravity of refined group volume</td>
      </tr>

      <tr>
      <td>SH F</td>
      <td>Shift refined group volume to center</td>
      </tr>

      <tr>
d628 1
a628 1
<p></p>
d666 11
d681 1
a681 1
<p></p>
d686 1
a686 1
<p></p>
d720 1
a720 1
<p></p>
d751 1
a751 1
<p></p>
d755 1
a755 1
<p></p>
d760 1
a760 1
<p></p>
d784 1
d790 1
d792 3
a794 1
    mergegroups
d797 2
d807 1
a807 1
       Updated: 12/12/06 &nbsp;&nbsp;&nbsp; 
@


1.26
log
@added section 'Tree of Procedure calls'
@
text
@d24 2
a25 2
<li>Access your refinement_dir, e.g.:<br>
  <i>cd /usr1/user/Refinement</i>
d29 3
a31 2
<li>Create an input sub-directory, e.g.:<br>
 <i>mkdir input</i>
a32 1
<p></p>
d34 1
a34 5
<li>Copy all the necessary data files to the input directory,
   e.g.:<br>
   <i>cp '/net/sylt/usr/Refinement/input/*' input</i><br>
   <br>
   Initial input files needed: 
d36 29
a64 42
   <table border="0">
   <tr>
   <td>input/order_select</td>
   <td>Group selection doc. file</td>
   </tr>

   <tr>
   <td>input/data{***group}</td>
   <td>Unaligned stacked image files</td>
   </tr>

   <tr>
   <td>input/dala{**iter}_{***group}</td>
   <td>Aligned stacked image files</td>
   </tr>

   <tr>
   <td>input/align_{**iter}_{***group}</td>
   <td>Alignment parameter doc. files (from <a href=
   "../../man/apsh.html">'AP SH'</a>)</td>
   </tr>

   <tr>
   <td>input/vol{**iter}</td>
   <td>Initial starting volume</td>
   </tr>

   <tr>
   <td colspan="2">Optional files for <a href="../xray/xray.html">amplitude enhancement</a>:</td>
   <td> </td>
   </tr>

   <tr>
   <td>input/<a href="../xray/scattering8.tst">scattering</a></td>
   <td>X-ray scattering power spectrum</td>
   </tr>

   <tr>
   <td>input/mask</td>
   <td>Mask created from ribosome-translocon</td>
   </tr>
</table>
a65 1
<p></p>
d67 11
a77 4
<li>Copy all the necessary refinement procedure files to the
   refinement directory, e.g.:<br>
   <i>scp -v '/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam'
   /usr1/user/refine</i>
d81 3
a83 3
<li>Edit <a href= "./newprogs/refine_settings.pam">refine_settings.pam</a> to set
   necessary values for refinement parameters and input file names,
   e.g.<br>
d89 1
a89 1
   <a href= "./newprogs/refine.pam">refine.pam</a>, e.g.<br>
d96 1
d103 4
a106 4
<li>Login to master node of cluster, where PubSub has been <a href=
"../../../pubsub/pubsub_inst.html">installed and is running</a>,
e.g.:<br>
 <i>rlogin &nbsp;&nbsp;patroon</i>
d110 2
a111 2
<li>Access your refinement_dir, e.g.:<br>
 <i>cd &nbsp;&nbsp;/usr1/user/Refinement</i>
d115 7
d123 1
a123 1
<li>Create an input sub-directory, e.g.:<br>
d128 6
a133 4
<li>Copy all the needed data files to the input directory, e.g.:<br>
    <i>scp &nbsp;&nbsp;
   'user@@sylt.wadsworth.org:/usr21/Refinement/input/*'
   &nbsp;&nbsp;input</i><br>
d136 25
a160 41
   <table border="0">
   <tr>
   <td>input/order_select</td>
   <td>Group selection doc. file</td>
   </tr>

   <tr>
   <td>input/data{***group}</td>
   <td>Unaligned stacked image files</td>
   </tr>

   <tr>
   <td>input/dala{**iter}_{***group}</td>
   <td>Aligned stacked image files</td>
   </tr>

   <tr>
   <td>input/align_{**iter}_{***group}</td>
   <td>Alignment parameter doc. files (from 
    <a href= "../../man/apsh.html">'AP SH'</a>)</td>
   </tr>

   <tr>
   <td>input/vol{**iter}</td>
   <td>Initial starting volume</td>
   </tr>

   <tr>
   <td colspan="2">Optional files for <a href="../xray/xray.html">amplitude enhancement</a>:</td>
   <td> </td>
   </tr>

   <tr>
   <td>input/<a href="../xray/scattering8.tst">scattering</a></td>
   <td>X-ray scattering power spectrum</td>
   </tr>

   <tr>
   <td>input/mask</td>
   <td>Mask created from ribosome-translocon</td>
   </tr>
a164 9
<li>Copy all the needed refinement procedure files to the
   refinement directory, e.g.:<br>
   <i>scp -v
   &nbsp;&nbsp;'/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam'
   &nbsp;&nbsp; /usr1/user/Refinement</i><br>
  (Note: /net/bali/usr1 is mounted on patroon)
</li>
<p></p>

d166 1
a166 1
   directory, e.g.:<br>
d170 1
a170 1
  &nbsp;&nbsp; fort.*</i><br>
d174 2
a175 2
<li>Copy a latest SPIDER executable into the current directory and rename it: spider 
    (ensures that same SPIDER executable is used throughout whole refinement), e.g.:<br>
d182 1
a182 1
   e.g.<br>
d188 1
a188 1
    <a href= "./newprogs/pub_refine.pam">pub_refine.pam</a>, e.g.<br>
d199 1
a199 1
<li>If the refinement fails.<br>
d207 1
a207 1
    later iteration): e.g..<br>
d255 2
a256 2
<br>
<br>
a261 3
<i>The following SPIDER procedures should be run in the Refinement
directory.</i>

d268 1
a268 1
   <th>Parallel<br>
d273 1
a273 1
   <td><b>Master procedure</b><br>
d275 1
a275 1
   <td><b>Master procedure</b><br>
d281 1
a281 1
   <td><a class="project" href= "./newprogs/refine_settings.pam">refine_settings.pam</a></td>
a284 5
   <td><a class="project" href="./newprogs/sort.pam">sort.pam</a></td>
   <td><a class="project" href="./newprogs/sort.pam">sort.pam</a></td>
</tr>

<tr>
a289 5
   <td><a class="project" href="./newprogs/newdala.pam">newdala.pam</a></td>
   <td><a class="project" href="./newprogs/newdala.pam">newdala.pam</a></td>
</tr>

<tr>
a299 5
   <td>-</td>
   <td><a class="project" href= "./newprogs/cpang.pam">cpang.pam</a></td>
</tr>

<tr>
a362 4
<li><a href="./newprogs/sort.pam">Sort</a> defocus groups by number
    of particles </li>
<p></p>

d388 1
a388 1
<li>Loop over all iterations creating iteration volumes<br>
d396 1
a396 1
   <li>Create Fourier and document files used for this iteration<br>
d418 1
a418 1
       over all defocus groups creating group volumes<br>
d592 1
a592 1
   <li>Loop over all small-angle iterations creating iteration volumes<br>
d601 1
a601 1
   <li>Create Fourier and document files used for this iteration<br>
d624 1
a624 1
           over all defocus groups creating group volumes<br> </font></i> 
a838 2
    sort
    newdala
d850 1
a853 1
    sort
a856 1
        cpang
d874 1
a874 1
       Updated: 05/12/06 &nbsp;&nbsp;&nbsp; 
@


1.25
log
@added enhancement files to 'Initial input files needed'
@
text
@d16 1
d878 45
d925 1
a925 1
       Updated: 05/08/06 &nbsp;&nbsp;&nbsp; 
@


1.24
log
@added cpang to table of procedures; added 'table of contents' links at the top
@
text
@d65 15
d160 16
a175 1
   td>Initial starting volume</td>
@


1.23
log
@spider executable cp not ln
@
text
@d11 5
d18 1
a18 1
<li>
d89 1
d91 1
a91 1
<li>
d221 1
d223 1
a223 1
<li>
d254 1
a254 1
<li>
d308 5
d362 2
a363 1
<li>
d849 1
a849 1
       Updated: 04/06/06 &nbsp;&nbsp;&nbsp; 
@


1.22
log
@enhance , saveresp, formatting
@
text
@d4 1
a4 1
<title>Refinement</title>
d8 1
d163 3
a165 4
<li>Create link for a specific SPIDER (ensures that same SPIDER
   executable is used throughout whole refinement), e.g.:<br>
   <i>ln -s /usr/local/spider/bin/spider_linux_mpfftw.101 &nbsp;&nbsp;
  spider</i>
d172 1
a172 1
   <i>xedit&nbsp;&nbsp; refine_settings.pam</i>
d836 1
a836 1
       Updated: 01/18/05 &nbsp;&nbsp;&nbsp; 
@


1.21
log
@added class="project" to <a> tags for newprogs/batchfiles
@
text
@a3 1
<meta name="generator" content="HTML Tidy, see www.w3.org">
d6 1
d321 7
a327 2
   <td><a class="project" href="./newprogs/saveres.pam">saveres.pam</a></td>
   <td><a class="project" href="./newprogs/saveres.pam">saveres.pam</a></td>
d360 2
a361 1
parameters &amp; file names</li>
d364 2
a365 5
of particles<br>
<br>
</li>

<li><a href="./newprogs/prepare.pam">Prepare</a> input files.
d367 1
a368 1
</li>
d371 1
a371 1
groups</font></i></li>
d373 2
a374 3
<li style="list-style: none">
<ul>
<li>Create group CTF's weighted by number of particles. 
d376 13
a388 11
<table border="1">
<tr>
<td>TF C3</td>
<td>Compute phase contrast transfer function</td>
</tr>

<tr>
<td>AR</td>
<td>Weight current CTF by number of particles</td>
</tr>
</table>
d390 1
a390 5
</ul>

<br>
<br>
</li>
a392 2
 

d395 64
a458 3
<ul>
<li><a href="./newprogs/refine_settings.pam">Set
parameters</a></li>
d460 42
a501 4
<li style="list-style: none">for this iteration</li>

<li style="list-style: none">
<p></p>
d503 1
d505 2
a506 2
<li>Create Fourier and document files used for this iteration<br>
 
d508 38
a545 16
<table border="1">
<tr>
<td>FT</td>
<td>Fourier on current volume produced by previous iter.</td>
</tr>

<tr>
<td>VO EA</td>
<td>Create reference angles for this iteration</td>
</tr>

<tr>
<td>DOC CREATE</td>
<td>Create selection file for reference angles</td>
</tr>
</table>
a546 2

<li style="list-style: none">
a547 6
</li>

<li><i><font color="#ff0000"><a href=
"./newprogs/grploop.pam">Loop</a> over all defocus groups creating
group volumes<br>
</font></i> 
d549 1
d552 2
a553 25
<ul>
<li>Create CTF corrected volumes 

<table border="1">
<tr>
<td>MU</td>
<td>Multiply Fourier of current volume by CTF file for this
group</td>
</tr>

<tr>
<td>FT</td>
<td>Fourier back transform the CTF corrected volume</td>
</tr>

<tr>
<td>PJ 3Q</td>
<td>Create stack holding reference angular projections from CTF
corrected volume (reference projections)</td>
</tr>

<tr>
<td>CP</td>
<td>Copy current aligned images to inline stack for speed</td>
</tr>
d555 2
a556 7
<tr>
<td>AP REF</td>
<td>Find reference projections matching each current aligned image.
Find alignment parameters to match selected ref. progjection.</td>
</tr>
</table>
</li>
d558 6
a563 1
<li>Loop over all images in current group</li>
d565 5
a569 3
<li style="list-style: none">
<ul>
<li>Align original images for back-projection 
d571 5
a575 9
<table border="1">
<tr>
<td>RT SQ</td>
<td>Rotate, mirror, and shift unaligned original image to create
current aligned image</td>
</tr>
</table>
</li>
</ul>
d577 5
a581 115
<br>
<br>
</li>

<li>Back-project original images into new group volume 

<table border="1">
<tr>
<td>BP 32F</td>
<td>Calculate refined group volume from new aligned images and
angle data</td>
</tr>

<tr>
<td>CG PH</td>
<td>Calculate center of gravity of refined group volume</td>
</tr>

<tr>
<td>SH F</td>
<td>Shift refined group volume to center</td>
</tr>

<tr>
<td>RF 3</td>
<td>Calculate phase residual for refined group volume</td>
</tr>
</table>
</li>
</ul>

<br>
<br>
</li>

<li><a href="./newprogs/mergegroups.pam">Merge group volumes into
iteration volume</a></li>

<li style="list-style: none">
<table border="1">
<tr>
<td>TF CTS</td>
<td>Create CTF corrected volume from refined group volumes</td>
</tr>

<tr>
<td>TF CTS</td>
<td>Create 1/2 CTF corrected volume from refined group volumes</td>
</tr>

<tr>
<td>TF CTS</td>
<td>Create 1/2 CTF corrected volume from refined group volumes</td>
</tr>

<tr>
<td>RF 3</td>
<td>Calculate resolution for group volume</td>
</tr>

<tr>
<td><a href="./newprogs/saveres.pam">@@saveres</a> </td>
<td>Save resolution</td>
</tr>

<tr>
<td>FQ</td>
<td>Filter final corrected volume to resolution</td>
</tr>
</table>
</li>
</ul>

<br>
<br>
</li>

<li>End iterations when angular displacements are small in all
groups.</li>

<li style="list-style: none"><i><font color=
"#ff0000"></font></i></li>

<li><i><font color="#ff0000"><a href=
"./newprogs/endmerge.pam">Loop</a> over all defocus
groups</font></i></li>

<li style="list-style: none">
<ul>
<li>Create final group volumes using BP CG 

<table border="1">
<tr>
<td>BP CG</td>
<td>Create final group volume from aligned images and angle
data</td>
</tr>

<tr>
<td>BP CG</td>
<td>Create final 1/2 group volume from aligned images and angle
data</td>
</tr>

<tr>
<td>BP CG</td>
<td>Create final 1/2 group volume from aligned images and angle
data</td>
</tr>

<tr>
<td>RF 3</td>
<td>Calculate resolution for final group volume</td>
</tr>
</table>
a584 5

<li>Continue with small-angle refinement or <a href=
"#final_merge">GO TO FINAL VOLUME MERGE</a>.</li>

<li style="list-style: none">
d587 2
a588 10
<ul>
<li><a href="./newprogs/refine_settings.pam">Set
parameters</a></li>

<li style="list-style: none">for this small-angle iteration</li>

<li>Loop over all small-angle iterations creating iteration
volumes<br>
 

d591 4
a594 3
<ul>
<li><a href="./newprogs/refine_settings.pam">Set
parameters</a></li>
d596 2
a597 1
<li style="list-style: none">for this iteration</li>
d599 5
a603 3
<li style="list-style: none">
<p></p>
</li>
d605 1
a605 1
<li>Create Fourier and document files used for this iteration<br>
d607 22
d630 1
a630 5
<table border="1">
<tr>
<td>FT</td>
<td>Fourier on current volume produced by previous iter.</td>
</tr>
d632 17
a648 5
<tr>
<td>VO EA</td>
<td>Create relative offset for reference angles for this
iteration</td>
</tr>
d650 35
a684 5
<tr>
<td>DOC CREATE</td>
<td>Create selection file for reference angles</td>
</tr>
</table>
a685 6

<li><i><font color="#ff0000"><a href=
"./newprogs/smangloop.pam">Loop</a> over all defocus groups
creating group volumes<br>
</font></i> 

d688 1
a688 2
<ul>
<li>Create CTF corrected volumes 
d690 23
a712 50
<table border="1">
<tr>
<td>MU</td>
<td>Multiply Fourier of current volume by CTF file for this
group</td>
</tr>

<tr>
<td>FT</td>
<td>Fourier back transform the CTF corrected volume</td>
</tr>
</table>
</li>

<li>Loop over all images in current group</li>

<li style="list-style: none">
<ul>
<li>Align original images for back-projection 

<table border="1">
<tr>
<td>UD IC</td>
<td>Get current angle for this image</td>
</tr>

<tr>
<td>VO RAS</td>
<td>Get angular range around current angle</td>
</tr>

<tr>
<td>PJ 3Q</td>
<td>Project thru volume at these angles to create set of angular
reference projections</td>
</tr>

<tr>
<td>AP REF</td>
<td>Find nearest reference projection matching each current
image.</td>
</tr>

<tr>
<td>RT SQ</td>
<td>Rotate, and shift unaligned original image to create aligned
image</td>
</tr>
</table>
</li>
a713 3

<br>
<br>
d716 1
a716 26
<li>Back-project original images into new group volume 

<table border="1">
<tr>
<td>BP 32F</td>
<td>Calculate refined group volume from new aligned images and
angle data</td>
</tr>

<tr>
<td>CG PH</td>
<td>Calculate center of gravity of refined group volume</td>
</tr>

<tr>
<td>SH F</td>
<td>Shift refined group volume to center</td>
</tr>

<tr>
<td>RF 3</td>
<td>Calculate phase residual for refined group volume</td>
</tr>
</table>
</li>
</ul>
a717 4
<br>
<br>
</li>

d719 1
a719 1
iteration volume</a></li>
d721 36
a756 35
<li style="list-style: none">
<table border="1">
<tr>
<td>TF CTS</td>
<td>Create CTF corrected iteration volume from refined group
volumes</td>
</tr>

<tr>
<td>TF CTS</td>
<td>Create 1/2 CTF corrected iteration volume from refined group
volumes</td>
</tr>

<tr>
<td>TF CTS</td>
<td>Create 1/2 CTF corrected iteration volume from refined group
volumes</td>
</tr>

<tr>
<td>RF 3</td>
<td>Calculate resolution for iteration volume</td>
</tr>

<tr>
<td><a href="./newprogs/saveres.pam">@@saveres</a> </td>
<td>Save resolution</td>
</tr>

<tr>
<td>FQ</td>
<td>Filter final corrected volume to resolution</td>
</tr>
</table>
d758 1
a758 5
</ul>

<br>
<br>
</li>
d761 3
a763 1
groups.</li>
d765 31
a795 37
<li style="list-style: none"><i><font color=
"#ff0000"></font></i></li>

<li><i><font color="#ff0000"><a href=
"./newprogs/endmerge.pam">Loop</a> over all defocus
groups</font></i></li>

<li style="list-style: none">
<ul>
<li>Create final group volumes using BP CG 

<table border="1">
<tr>
<td>BP CG</td>
<td>Create final group volume from aligned images and angle
data</td>
</tr>

<tr>
<td>BP CG</td>
<td>Create final 1/2 group volume from aligned images and angle
data</td>
</tr>

<tr>
<td>BP CG</td>
<td>Create final 1/2 group volume from aligned images and angle
data</td>
</tr>

<tr>
<td>RF 3</td>
<td>Calculate resolution for final group volume</td>
</tr>
</table>
</li>
</ul>
a796 2

<li style="list-style: none">
a797 1
</li>
d800 2
a801 2
group volumes into final iteration volume and determine final
resolution</a></li>
d803 24
a826 25
<li style="list-style: none">
<table border="1">
<tr>
<td>TF CTS</td>
<td>Create final CTF corrected iteration volume from final group
volumes</td>
</tr>

<tr>
<td>TF CTS</td>
<td>Create final 1/2 CTF corrected iteration volume from final
group volumes</td>
</tr>

<tr>
<td>TF CTS</td>
<td>Create final 1/2 CTF corrected iteration volume from final
group volumes</td>
</tr>

<tr>
<td>RF 3</td>
<td>Calculate resolution for final iteration volume</td>
</tr>
</table>
d828 1
a830 2
</ul>
</li>
d832 1
a832 2
</li>
</ul>
d836 1
a836 1
       Updated: 11/18/04 &nbsp;&nbsp;&nbsp; 
@


1.20
log
@nedala duplicatd bug
@
text
@d265 1
a265 1
   <a href="./newprogs/refine.pam">refine.pam</a></td>
d267 1
a267 1
   <a href="./newprogs/pub_refine.pam">pub_refine.pam</a></td>
d271 2
a272 2
   <td><a href="./newprogs/refine_settings.pam">refine_settings.pam</a></td>
   <td><a href= "./newprogs/refine_settings.pam">refine_settings.pam</a></td>
d276 2
a277 2
   <td><a href="./newprogs/sort.pam">sort.pam</a></td>
   <td><a href="./newprogs/sort.pam">sort.pam</a></td>
d281 2
a282 2
   <td><a href="./newprogs/prepare.pam">prepare.pam</a></td>
   <td><a href="./newprogs/prepare.pam">prepare.pam</a></td>
d286 2
a287 2
   <td><a href="./newprogs/newdala.pam">newdala.pam</a></td>
   <td><a href="./newprogs/newdala.pam">newdala.pam</a></td>
d297 1
a297 1
   <td><a href= "./newprogs/pub_refine_start.pam">pub_refine_start.pam</a></td>
d301 2
a302 2
   <td><a href="./newprogs/grploop.pam">grploop.pam</a></td>
   <td><a href="./newprogs/grploop.pam">grploop.pam</a></td>
d307 1
a307 1
   <td><a href="./newprogs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a></td>
d312 1
a312 1
   <td><a href="./newprogs/pub_refine_wait.pam">pub_refine_wait.pam</a></td>
d316 2
a317 2
   <td><a href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
   <td><a href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
d321 2
a322 2
   <td><a href="./newprogs/saveres.pam">saveres.pam</a></td>
   <td><a href="./newprogs/saveres.pam">saveres.pam</a></td>
d326 2
a327 2
   <td><a href="./newprogs/endmerge.pam">endmerge.pam</a></td>
   <td><a href="./newprogs/endmerge.pam">endmerge.pam</a></td>
d331 2
a332 2
   <td><a href="./newprogs/smangloop.pam">smangloop.pam</a></td>
   <td><a href="./newprogs/smangloop.pam">smangloop.pam</a></td>
d336 2
a337 2
   <td><a href="./newprogs/endrefine.pam">endrefine.pam</a></td>
   <td><a href="./newprogs/endrefine.pam">endrefine.pam</a></td>
@


1.19
log
@newdala, xhtml format fixed
@
text
@d281 2
a282 2
   <td><a href="./newprogs/newdala.pam">newdala.pam</a></td>
   <td><a href="./newprogs/newdala.pam">newdala.pam</a></td>
@


1.18
log
@changed refine_settings_sm.pam to refine_settings.pam (the former doesn't exist), added <!-- end SPIRE comment
@
text
@d11 1
a15 3
<li style="list-style: none">
<p></p>
</li>
d18 2
a19 3
 <i>cd /usr1/user/Refinement</i></li>

<li style="list-style: none">
a20 1
</li>
d23 2
a24 3
 <i>mkdir input</i></li>

<li style="list-style: none">
a25 1
</li>
d28 31
a58 31
e.g.:<br>
 <i>cp '/net/sylt/usr/Refinement/input/*' input</i><br>
<br>
 Initial input files needed: 

<table border="0">
<tr>
<td>input/order_select</td>
<td>Group selection doc. file</td>
</tr>

<tr>
<td>input/data{***group}</td>
<td>Unaligned stacked image files</td>
</tr>

<tr>
<td>input/dala{**iter}_{***group}</td>
<td>Aligned stacked image files</td>
</tr>

<tr>
<td>input/align_{**iter}_{***group}</td>
<td>Alignment parameter doc. files (from <a href=
"../../man/apsh.html">'AP SH'</a>)</td>
</tr>

<tr>
<td>input/vol{**iter}</td>
<td>Initial starting volume</td>
</tr>
a60 2

<li style="list-style: none">
a61 1
</li>
d64 5
a68 3
refinement directory, e.g.:<br>
 <i>scp -v '/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam'
/usr1/user/refine</i></li>
d70 5
a74 1
<li style="list-style: none">
a75 7
</li>

<li>Edit <a href=
"./newprogs/refine_settings.pam">refine_settings.pam</a> to set
necessary values for refinement parameters and input file names,
e.g.<br>
 <i>nedit refine_settings.pam</i></li>
d77 3
a79 2
<li style="list-style: none">
<p></p>
a80 4

<li>Start refinement using <a href=
"./newprogs/refine.pam">refine.pam</a>, e.g.<br>
 <i>spider pam/ftf @@refine 0 &amp;</i></li>
a87 1
<li style="list-style: none">
a88 1
</li>
d93 2
a94 3
 <i>rlogin &nbsp;&nbsp;patroon</i></li>

<li style="list-style: none">
a95 1
</li>
d98 3
a100 1
 <i>cd &nbsp;&nbsp;/usr1/user/Refinement</i></li>
a101 3
<li style="list-style: none">
<p></p>
</li>
d104 2
a105 3
 <i>mkdir &nbsp; input</i></li>

<li style="list-style: none">
a106 19
</li>

<li>Copy all the needed data files to the input directory,
e.g.:<br>
 <i>scp &nbsp;&nbsp;
'user@@sylt.wadsworth.org:/usr21/Refinement/input/*'
&nbsp;&nbsp;input</i><br>
 Initial input files needed: 

<table border="0">
<tr>
<td>input/order_select</td>
<td>Group selection doc. file</td>
</tr>

<tr>
<td>input/data{***group}</td>
<td>Unaligned stacked image files</td>
</tr>
d108 33
a140 19
<tr>
<td>input/dala{**iter}_{***group}</td>
<td>Aligned stacked image files</td>
</tr>

<tr>
<td>input/align_{**iter}_{***group}</td>
<td>Alignment parameter doc. files (from <a href=
"../../man/apsh.html">'AP SH'</a>)</td>
</tr>

<tr>
<td>input/vol{**iter}</td>
<td>Initial starting volume</td>
</tr>
</table>

<br>
<br>
a141 2

<li style="list-style: none">
a142 1
</li>
d145 6
a150 7
refinement directory, e.g.:<br>
 <i>scp -v
&nbsp;&nbsp;'/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam'
&nbsp;&nbsp; /usr1/user/Refinement</i><br>
 (Note: /net/bali/usr1 is mounted on patroon)</li>

<li style="list-style: none">
a151 1
</li>
d153 6
a158 6
<li>Remove any existing output files curreently in the refinement
directory, e.g.:<br>
 <i>\rm -rf &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.*
&nbsp;&nbsp; LOG.* &nbsp;&nbsp; fort.* &nbsp;&nbsp; work/
&nbsp;&nbsp; local/&nbsp;&nbsp; final/ &nbsp;&nbsp; core*
&nbsp;&nbsp; fort.*</i><br>
a159 2

<li style="list-style: none">
a160 1
</li>
d163 5
a167 3
executable is used throughout whole refinement), e.g.:<br>
 <i>ln -s /usr/local/spider/bin/spider_linux_mpfftw.90 &nbsp;&nbsp;
spider</i></li>
d169 5
a173 1
<li style="list-style: none">
d176 4
d181 4
d186 1
d188 19
a206 9
<li>Edit <a href=
"./newprogs/refine_settings.pam">refine_settings.pam</a> to set
necessary values for refinement parameters and input file names,
e.g.<br>
 <i>xedit&nbsp;&nbsp; refine_settings.pam</i></li>

<li>Start Master SPIDER refinement process <a href=
"./newprogs/pub_refine.pam">pub_refine.pam</a>, e.g.<br>
 <i>spider pam/ftf &nbsp;&nbsp; @@pub_refine 0 &amp;</i></li>
d208 2
a209 2
<li style="list-style: none">
<p></p>
a211 3
<li>Master SPIDER refinement process will create and <a href=
"../../../pubsub/publish.perl">publish</a> new SPIDER jobs as
necessary.</li>
a212 13
<li>If the refinement fails.<br>
 Use <i>'killspi'</i> to stop any remaining parallel jobs that
belong to you.<br>
 Use <i>'wherespi'</i> to find any remaining parallel jobs. If any
remain, use <i>'killspi'</i> again until they are all gone.<br>
 Clean any un-needed output files (you may want to save
<i>final/*</i> and <i>results.*</i> if you are restarting at a
later iteration: e.g..<br>
 <i>\rm -rf &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.*
&nbsp;&nbsp; LOG.* &nbsp;&nbsp; work/ &nbsp;&nbsp;
local/&nbsp;&nbsp; final/ &nbsp;&nbsp; core* &nbsp;&nbsp;
fort.*</i><br>
 Restart at step: 8.</li>
d258 10
a267 3
<th>Serial</th>
<th>Parallel<br>
(For Pubsub)</th>
d271 2
a272 4
<td><b>Master procedure</b><br>
<a href="./newprogs/refine.pam">refine.pam</a></td>
<td><b>Master procedure</b><br>
<a href="./newprogs/pub_refine.pam">pub_refine.pam</a></td>
d276 2
a277 4
<td><a href=
"./newprogs/refine_settings.pam">refine_settings.pam</a></td>
<td><a href=
"./newprogs/refine_settings.pam">refine_settings.pam</a></td>
d281 2
a282 2
<td><a href="./newprogs/sort.pam">sort.pam</a></td>
<td><a href="./newprogs/sort.pam">sort.pam</a></td>
d286 2
a287 2
<td><a href="./newprogs/prepare.pam">prepare.pam</a></td>
<td><a href="./newprogs/prepare.pam">prepare.pam</a></td>
d291 2
a292 2
<td>-</td>
<td><a href="../../../pubsub/publish.perl">publish.perl</a></td>
d296 2
a297 3
<td>-</td>
<td><a href=
"./newprogs/pub_refine_start.pam">pub_refine_start.pam</a></td>
d301 2
a302 2
<td><a href="./newprogs/grploop.pam">grploop.pam</a></td>
<td><a href="./newprogs/grploop.pam">grploop.pam</a></td>
d306 2
a307 3
<td>-</td>
<td><a href=
"./newprogs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a></td>
d311 2
a312 3
<td>-</td>
<td><a href=
"./newprogs/pub_refine_wait.pam">pub_refine_wait.pam</a></td>
d316 2
a317 2
<td><a href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
<td><a href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
d321 2
a322 2
<td><a href="./newprogs/saveres.pam">saveres.pam</a></td>
<td><a href="./newprogs/saveres.pam">saveres.pam</a></td>
d326 2
a327 2
<td><a href="./newprogs/endmerge.pam">endmerge.pam</a></td>
<td><a href="./newprogs/endmerge.pam">endmerge.pam</a></td>
d331 2
a332 2
<td><a href="./newprogs/smangloop.pam">smangloop.pam</a></td>
<td><a href="./newprogs/smangloop.pam">smangloop.pam</a></td>
d336 2
a337 2
<td><a href="./newprogs/endrefine.pam">endrefine.pam</a></td>
<td><a href="./newprogs/endrefine.pam">endrefine.pam</a></td>
d339 1
d885 3
a887 2
<small>Source file: refine.html &nbsp;&nbsp;&nbsp; Updated: 7/01/04
&nbsp;&nbsp;&nbsp; ArDean Leith</small>
@


1.17
log
@added SPIRE comment line
@
text
@d365 2
d637 1
a637 1
<li><a href="./newprogs/refine_settings_sm.pam">Set
@


1.16
log
@xhtml
@
text
@d275 2
@


1.15
log
@*** empty log message ***
@
text
@d1 1
a2 1

d4 1
a7 1

d11 166
d178 69
a246 2
<p>
<li> <h2>Running Serial Refinement</h2>
d248 17
a264 1
       <ol>
d266 96
a361 214
       <p> 
       <li>Access your refinement_dir, e.g.: <br>
       <i> cd /usr1/user/Refinement </i> 
       </li>
       </p>

       <p> 
       <li>Create an input sub-directory, e.g.:<br>
       <i> mkdir input</i>
       </li>
       </p>

       <p> 
       <li>Copy all the necessary data files to the input directory, e.g.:<br>
       <i> cp '/net/sylt/usr/Refinement/input/*' input</i></p>

       Initial input files needed:
       <table border="0">
       <tr><td>input/order_select</td>               <td>Group selection doc. file</td></tr>
       <tr><td>input/data{***group} </td>            <td>Unaligned stacked image files</td></tr>  
       <tr><td>input/dala{**iter}_{***group} </td>   <td>Aligned stacked image files</td></tr>
       <tr><td>input/align_{**iter}_{***group}</td>  <td>Alignment parameter doc. files 
                                                         (from <a href="../../man/apsh.html">'AP SH'</a>)</td></tr>
       <tr><td>input/vol{**iter}</td>                <td>Initial starting volume </td></tr>
       </table>
       </li>
       </p>

       <p> 
       <li>Copy all the necessary refinement procedure files to the refinement directory, e.g.:<br>
       <i> scp -v '/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam'   /usr1/user/refine</i>
       </li>
       </p>

       <p> 
       <li>Edit <a href="./newprogs/refine_settings.pam">refine_settings.pam</a> to set 
           necessary values for refinement parameters and input file names, e.g.<br>
       <i> nedit refine_settings.pam</i>
       </li>
       </p>

       <p> 
       <li>Start refinement using <a href="./newprogs/refine.pam">refine.pam</a>, e.g.<br>
       <i> spider pam/ftf @@refine 0 & </i>
       </li>
       </p>
    </ol>
</li>
</p>

<p>
<li> <h2>Running Refinement on Cluster using Pubsub</h2>

       <ol>

       <p> 
       <li> Login to master node of cluster, where PubSub has been
            <a href="../../../pubsub/pubsub_inst.html">installed and is running</a>, e.g.:<br>
          <i>  rlogin &nbsp;&nbsp;patroon</i>
       </li>
       </p>

       <p> 
       <li>Access your refinement_dir, e.g.: <br>
          <i> cd &nbsp;&nbsp;/usr1/user/Refinement </i> 
       </li>
       </p>

       <p> 
       <li>Create an input sub-directory, e.g.:<br>
          <i> mkdir &nbsp; input</i>
       </li>
       </p>

       <p> 
       <li>Copy all the needed data files to the input directory, e.g.:<br>
         <i> scp &nbsp;&nbsp; 'user@@sylt.wadsworth.org:/usr21/Refinement/input/*' &nbsp;&nbsp;input</i><br>
         Initial input files needed:
         <table border="0">
         <tr><td>input/order_select</td>               <td>Group selection doc. file</td></tr>
         <tr><td>input/data{***group} </td>            <td>Unaligned stacked image files</td></tr>  
         <tr><td>input/dala{**iter}_{***group} </td>   <td>Aligned stacked image files</td></tr>
         <tr><td>input/align_{**iter}_{***group}</td>  <td>Alignment parameter doc. files 
                                                         (from <a href="../../man/apsh.html">'AP SH'</a>)</td></tr>
         <tr><td>input/vol{**iter}</td>                <td>Initial starting volume </td></tr>
         </table>
         </p>
       </li>
       </p>

       <p> 
       <li>Copy all the needed refinement procedure files to the refinement directory, e.g.:<br>
       <i> scp -v &nbsp;&nbsp;'/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam'  &nbsp;&nbsp; /usr1/user/Refinement</i><br>
        (Note: /net/bali/usr1 is mounted on patroon) 
       </li>
       </p>

       <p> 
       <li>Remove any existing output files curreently in the refinement directory, e.g.: <br>
          <i> \rm -rf &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.* &nbsp;&nbsp; LOG.* &nbsp;&nbsp; fort.* &nbsp;&nbsp;  work/ &nbsp;&nbsp; local/&nbsp;&nbsp;  final/ &nbsp;&nbsp; core* &nbsp;&nbsp; fort.* </i><br>
       </li>
       </p>

       <p> 
       <li>Create link for a specific SPIDER (ensures that same SPIDER 
          executable is used throughout whole refinement), e.g.: <br>
       <i> ln -s /usr/local/spider/bin/spider_linux_mpfftw.90 &nbsp;&nbsp; spider</i>
       </li>
       </p>

       <p> 

       <p> 
       <li>Edit <a href="./newprogs/refine_settings.pam">refine_settings.pam</a> to set 
           necessary values for refinement parameters and input file names, e.g.<br>
       <i> xedit&nbsp;&nbsp; refine_settings.pam</i>
       </li>
       </p>

       <li>Start Master SPIDER refinement process <a href="./newprogs/pub_refine.pam">pub_refine.pam</a>, e.g.<br>
       <i> spider pam/ftf &nbsp;&nbsp;  @@pub_refine 0 & </i>
       </li>
       </p>

       <p> 

       <li> Master SPIDER refinement process will create and <a href="../../../pubsub/publish.perl">publish</a> 
       new SPIDER jobs as necessary. 
       </li>
       </p>

       <li> If the refinement fails.<br>
            Use <i>'killspi'</i> to stop any remaining parallel jobs that belong to you. <br>
            Use <i>'wherespi'</i> to find any remaining parallel jobs. If any
            remain, use  <i>'killspi'</i> again until they are all gone. <br>
            Clean any un-needed output files (you may want to save 
                 <i>final/*</i> and <i>results.*</i> if you are restarting at a later iteration: e.g..<br>
            <i> \rm -rf &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.* &nbsp;&nbsp; LOG.* &nbsp;&nbsp; work/ &nbsp;&nbsp; local/&nbsp;&nbsp;  final/ &nbsp;&nbsp; core* &nbsp;&nbsp; fort.* </i><br>
            Restart at step: 8.                    
       </li>
       </p>

       </ol>
</li>
</p>

<li><h2>SPIDER Refinement Output</h2>
<p>
All refined alignment parameters are placed in a single output document 
file typically: <i>final/align_{iteration}_{group}

<table  border="5" cellpadding="10">
   <caption><b>Document file columns</b></caption>

   <tr><td>Proj. angle - PHI</td> <td>Proj. angle - THETA</td> <td>Proj. angle - PSI</td>
       <td>Ref. #I</td> <td>Image #</td> <td>Inplane angle</td> <td>X Shift</td> <td>Y Shift</td>
       <td>Number of projs.</td> <td>Angular diff.</td> <td>CC Rotation</td>
        <td>Current Inplane angle</td> <td>Current X Shift</td> <td>Current Y Shift</td></tr>
</table>
</p>
</li>

<li><h2>SPIDER Refinement Procedures</h2>

The following SPIDER procedures should be run in the <i>Refinement</i> directory. 
<p>

<table  border="5" cellpadding="10">
   <tr><th>Serial</th> <th>Parallel<br>(For Pubsub)</th>   </tr>

   <tr><td><b>Master procedure</b><br><a href="./newprogs/refine.pam">refine.pam</a></td>
       <td><b>Master procedure</b><br><a href="./newprogs/pub_refine.pam">pub_refine.pam</a></td> </tr>

   <tr><td><a href="./newprogs/refine_settings.pam">refine_settings.pam</a></td>
       <td><a href="./newprogs/refine_settings.pam">refine_settings.pam</a></a></td> </tr>

   <tr><td><a href="./newprogs/sort.pam">sort.pam</a></td>
       <td><a href="./newprogs/sort.pam">sort.pam</a></td> </tr>

   <tr><td><a href="./newprogs/prepare.pam">prepare.pam</a></td>
       <td><a href="./newprogs/prepare.pam">prepare.pam</a></td> </tr>

   <tr><td>-</td>
       <td><a href="../../../pubsub/publish.perl">publish.perl</a></td> </tr>

   <tr><td>-</td>
       <td><a href="./newprogs/pub_refine_start.pam">pub_refine_start.pam</a></td> </tr>

   <tr><td><a href="./newprogs/grploop.pam">grploop.pam</a></td> 
       <td><a href="./newprogs/grploop.pam">grploop.pam</a></td> </tr>

   <tr><td>-</td>
       <td><a href="./newprogs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a></td> </tr>

   <tr><td>-</td>
       <td><a href="./newprogs/pub_refine_wait.pam">pub_refine_wait.pam</a></td> </tr>

   <tr><td><a href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
       <td><a href="./newprogs/mergegroups.pam">mergegroups.pam</a></td> </tr>

   <tr><td><a href="./newprogs/saveres.pam">saveres.pam</a></td> 
       <td><a href="./newprogs/saveres.pam">saveres.pam</a></td> </tr>

   <tr><td><a href="./newprogs/endmerge.pam">endmerge.pam</a></td>
       <td><a href="./newprogs/endmerge.pam">endmerge.pam</a></td> </tr>

   <tr><td><a href="./newprogs/smangloop.pam">smangloop.pam</a></td>
       <td><a href="./newprogs/smangloop.pam">smangloop.pam</a></td> </tr>

   <tr><td><a href="./newprogs/endrefine.pam">endrefine.pam</a></td>
       <td><a href="./newprogs/endrefine.pam">endrefine.pam</a></td> </tr>
</table>
</li>
</p>
d363 2
a364 2
<p>
<li><h2>Refinement Flowchart</h2>
d366 2
a367 2
Steps indicated in <i><font COLOR="#ff0000">red</font></i> italics can be conducted in
parallel on different processors.
d369 1
a369 1
<p>
d372 120
d493 17
a509 2
<p><li> <a href="./newprogs/refine_settings.pam">Set</a> initial parameters & file names</li>
</p>
d511 1
a511 2
<p>
<li> <a href="./newprogs/sort.pam">Sort</a> defocus groups by number of particles</p></li>
d513 24
a536 2
<p>
<li> <a href="./newprogs/prepare.pam">Prepare</a> input files.<p>   
d538 2
a539 212
<i><font COLOR="#ff0000">
<li>Loop over all defocus groups</li>
</font></i>
   </p>
   <ul>

   <li>Create group CTF's weighted by number of particles.
   <table border="1">
   <tr><td>TF C3</td> <td>Compute phase contrast transfer function </td></tr>
   <tr> <td>AR</td> <td>Weight current CTF by number of particles</td></tr>
   </table>
   </li>
   </ul>

</p>

<p>
<li> Loop over all iterations creating iteration volumes<br>
   <p>
   <ul>
   <li><a href="./newprogs/refine_settings.pam">Set parameters </a></li> for this iteration</li>
   </p>

   <p>
   <li>Create Fourier and document files used for this iteration<br>
   <table border="1">
   <tr><td>FT</td> <td>Fourier on current volume produced by previous iter.</td></tr>
   <tr><td>VO EA</td> <td>Create reference angles for this iteration</td></tr> 
   <tr><td> DOC CREATE</td> <td>Create selection file for reference angles</td></tr>
   </table>
   </li>
   </p>

   <p>
   <li>
   <i><font COLOR="#ff0000">
   <a href="./newprogs/grploop.pam">Loop</a> over all defocus groups creating group volumes<br>
   </font></i>
   <p>
         <ul>
         <li>
         Create CTF corrected volumes
         <table border="1">
         <tr><td>MU</td> <td>Multiply Fourier of current volume by CTF file for this group</td></tr>
         <tr><td>FT</td> <td>Fourier back transform the CTF corrected volume</td></tr>
         <tr><td>PJ 3Q</td> <td>Create stack holding reference angular projections from CTF corrected volume (reference projections)</td></tr>
         <tr><td>CP</td> <td>Copy current aligned images to inline stack for speed</td></tr>
         <tr><td>AP REF </td><td>Find reference projections matching each current aligned image.    
                                         Find alignment parameters to match selected ref. progjection.</td></tr>    
        </table> 
         </li> 
         </p>

         <li>Loop over all images in current group</li>
            <ul>
            <li>Align original images for back-projection
            <table border="1">
           <tr><td>RT SQ</td> <td>Rotate, mirror, and shift unaligned original image to create current aligned image</td></tr>
            </table>
            </li>
            </p> 
            </ul>

            </p>
         <li>Back-project original images into new group volume
         <table border="1">
         <tr><td>BP 32F</td> <td>Calculate refined group volume from new aligned images and angle data</td></tr>
         <tr><td>CG PH</td>  <td>Calculate center of gravity of refined group volume</td></tr>
         <tr><td>SH F</td>   <td>Shift refined group volume to center</td></tr>
         <tr><td>RF 3</td>   <td>Calculate phase residual for refined group volume</td></tr>
         </table>
         </li>
         </ul>
      </p>

      <li> <a href="./newprogs/mergegroups.pam">Merge group volumes into iteration volume</a></li>
      <table border="1">
      <tr><td>TF CTS</td> <td>Create     CTF corrected volume from refined group volumes</td></tr>
      <tr><td>TF CTS</td> <td>Create 1/2 CTF corrected volume from refined group volumes</td></tr>
      <tr><td>TF CTS</td> <td>Create 1/2 CTF corrected volume from refined group volumes</td></tr>
      <tr><td>RF 3</td>   <td>Calculate resolution for group volume</td></tr>
      <tr><td><a href="./newprogs/saveres.pam">@@saveres</a> </td> <td>Save resolution</td></tr>
      <tr><td>FQ</td>     <td>Filter final corrected volume to resolution</td></tr>
      </table>
      </li>
      </ul>

   </p>
   <li> End iterations when angular displacements are small in all groups.</li>
   </p>

   <i><font COLOR="#ff0000">
   <li><a href="./newprogs/endmerge.pam">Loop</a> over all defocus groups</li>
       </font></i>
       <ul>  
       <li>Create final group volumes using BP CG
       <table border="1">
       <tr><td>BP CG</td> <td>Create final     group volume from  aligned images and angle data</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angle data</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angle data</td></tr>
       <tr><td>RF 3</td>  <td>Calculate resolution for final group volume</td></tr>
       </table>
       </li>
       </ul>
  </li>
 </dd>
<p>
<li> Continue with small-angle refinement or <a href="#final_merge">GO TO FINAL VOLUME MERGE</a>.</li>
<p>

<ul>
<li><a href="./newprogs/refine_settings_sm.pam">Set parameters </a></li> for this small-angle iteration</li>
</p>

<p>
<li> Loop over all small-angle iterations creating iteration volumes<br>
   <p>
   <ul>
   <li><a href="./newprogs/refine_settings.pam">Set parameters </a></li> for this iteration</li>
   </p>

   <p>
   <li>Create Fourier and document files used for this iteration<br>
   <table border="1">
   <tr><td>FT</td> <td>Fourier on current volume produced by previous iter.</td></tr>
   <tr><td>VO EA</td> <td>Create relative offset for reference angles for this iteration</td></tr> 
   <tr><td> DOC CREATE</td> <td>Create selection file for reference angles</td></tr>
   </table>
   </li>
   </p>
   <li>
   <i><font COLOR="#ff0000">
   <a href="./newprogs/smangloop.pam">Loop</a> over all defocus groups creating group volumes<br>
   </font></i>
   <p>
         <ul>
         <li>
         Create CTF corrected volumes
         <table border="1">
         <tr><td>MU</td> <td>Multiply Fourier of current volume by CTF file for this group</td></tr>
         <tr><td>FT</td> <td>Fourier back transform the CTF corrected volume</td></tr>
         </table> 
         </li> 
         </p>

         <li>Loop over all images in current group </li>
            <ul>
            <li>Align original images for back-projection
            <table border="1">
            <tr><td>UD IC</td> <td>Get current angle for this image</td></tr>
            <tr><td>VO RAS</td><td>Get angular range around current angle</td></tr>
            <tr><td>PJ 3Q</td> <td>Project thru volume at these angles to create set of angular reference projections </td></tr>
            <tr><td>AP REF</td> <td>Find nearest reference projection matching each current image.</td></tr>    
            <tr><td>RT SQ</td> <td>Rotate, and shift unaligned original image to create aligned image</td></tr>
            </table>
            </li>
            </p> 
            </ul>

            </p>
         <li>Back-project original images into new group volume
         <table border="1">
         <tr><td>BP 32F</td> <td>Calculate refined group volume from new aligned images and angle data</td></tr>
         <tr><td>CG PH</td>  <td>Calculate center of gravity of refined group volume</td></tr>
         <tr><td>SH F</td>   <td>Shift refined group volume to center</td></tr>
         <tr><td>RF 3</td>   <td>Calculate phase residual for refined group volume</td></tr>
         </table>
         </li>
         </ul>
      </p>

      <li> <a href="./newprogs/mergegroups.pam">Merge group volumes into iteration volume</a></li>
      <table border="1">
      <tr><td>TF CTS</td> <td>Create     CTF corrected iteration volume from refined group volumes</td></tr>
      <tr><td>TF CTS</td> <td>Create 1/2 CTF corrected iteration volume from refined group volumes</td></tr>
      <tr><td>TF CTS</td> <td>Create 1/2 CTF corrected iteration volume from refined group volumes</td></tr>
      <tr><td>RF 3</td>   <td>Calculate resolution for iteration  volume</td></tr>
      <tr><td><a href="./newprogs/saveres.pam">@@saveres</a> </td> <td>Save resolution</td></tr>
      <tr><td>FQ</td>     <td>Filter final corrected volume to resolution</td></tr>
      </table>
      </li>
      </ul>

   </p>
   <li> End iterations when angular displacements are small in all groups.</li>
   </p>
   </p>

   <i><font COLOR="#ff0000">
   <li><a href="./newprogs/endmerge.pam">Loop</a> over all defocus groups</li>
   </font></i>
       <ul>
       <li>Create final group volumes using BP CG
       <table border="1" > 
       <tr><td>BP CG</td> <td>Create final     group volume from  aligned images and angle data</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angle data</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angle data</td></tr>
       <tr><td>RF 3</td>  <td>Calculate resolution for final group volume</td></tr>
       </table>
       </li>
       </ul>
  </li>
 </dd>
<p>

<li> <a name="final_merge" href="./newprogs/endrefine.pam">Merge group volumes into final iteration volume and determine final resolution</a></li>
       <table border="1">
       <tr><td>TF CTS</td>  <td>Create final     CTF corrected iteration volume from final group volumes</td></tr>
       <tr><td>TF CTS</td>  <td>Create final 1/2 CTF corrected iteration volume from final group volumes</td></tr>
       <tr><td>TF CTS</td>  <td>Create final 1/2 CTF corrected iteration volume from final group volumes</td></tr>
       <tr><td>RF 3</td>    <td>Calculate resolution for final iteration volume</td></tr>
       </table>
d542 2
a543 2
<p>
<li> Refinement finished.</li>
d545 33
d579 14
a592 1
</b>
d594 28
d624 29
d654 51
a704 6
<hr>
<small>
Source file: refine.html &nbsp;&nbsp;&nbsp;  
Updated:  7/01/04  &nbsp;&nbsp;&nbsp; 
ArDean Leith
</small>
d706 31
a736 2
</body>
</html>
d738 3
d742 1
d744 24
d769 3
d773 2
d776 37
d814 3
d818 2
d821 2
d824 3
d828 3
d832 27
d860 3
d864 30
d895 6
d902 5
@


1.14
log
@updateed
@
text
@d116 1
a116 1
          <i> \rm -rf &nbsp;&nbsp; pubsub.log &nbsp;&nbsp; results.* &nbsp;&nbsp; LOG.* &nbsp;&nbsp;  work/ &nbsp;&nbsp; local/&nbsp;&nbsp;  final/ &nbsp;&nbsp; core* &nbsp;&nbsp; fort.* </i><br>
d477 1
a477 1
Updated:  6/01/04  &nbsp;&nbsp;&nbsp; 
@


1.13
log
@*** empty log message ***
@
text
@d2 1
d19 1
a19 1
       <i> cd /usr1/user/refine </i> 
d38 3
a40 5
       <tr><td>input/align_{**iter}_{***group}</td>  <td>Original alignment parameters doc. files(from <a href="../../man/apsh.html">'AP SH'</a>)<br>
                                                       (Modify: <a href="./newprogs/firstalign.pam">firstalign.pam</a> to
                                                        create these from old 'AP MQ' <I>trans</i> files</td></tr>
       <tr><td>input/vol{**iter}</td>                <td>Initial volume (from <a href="../../man/apsh.html">'AP SH'</a></td></tr>
       <tr><td>input/ctfs</td>                       <td>Group defocus doc. file</td></tr>  
d75 1
a75 1
       <i>  rlogin &nbsp;&nbsp;patroon</i>
d81 1
a81 1
       <i> cd &nbsp;&nbsp;/usr1/user/refine </i> 
d87 1
a87 1
       <i> mkdir &nbsp; input</i>
d93 11
a103 12
       <i> scp &nbsp;&nbsp; 'user@@sylt.wadsworth.org:/usr21/Refinement2/input/*' &nbsp;&nbsp;input</i>
       Initial input files needed:
       <table border="0">
       <tr><td>input/order_select</td>               <td>Group selection doc. file</td></tr>
       <tr><td>input/data{***group} </td>            <td>Unaligned stacked image files</td></tr>  
       <tr><td>input/dala{**iter}_{***group} </td>   <td>Aligned stacked image files</td></tr>

       <tr><td>input/align_{**iter}_{***group}</td>  <td>Original alignment parameters doc. files (from <a href="../../man/apsh.html">'AP SH'</a>)<br>                                                       (Modify: <a href="./newprogs/firstalign.pam">firstalign.pam</a> to
                                                        create these from old 'AP MQ' <I>trans</i> files</td></tr>
       <tr><td>input/vol{**iter}</td>                <td>Initial volume (from <a href="../../man/apsh.html">'AP SH'</a>)</td></tr>
       <tr><td>input/ctfs</td>                       <td>Group defocus doc. file</td></tr>  
       </table>
a105 2
       </li>
       </p>
d109 1
a109 1
       <i> scp -v &nbsp;&nbsp;'/net/bali/usr1/spider/docs/techs/recon/newprogs/*pam'  &nbsp;&nbsp; /usr1/user/refine</i><br>
d115 2
a116 2
       <li>Remove any existing <i>pubsub.log</i> file in the refinement directory, e.g.:<br>
       <i> rm &nbsp;&nbsp; ./pubsub.log  </i><br>
d121 3
a123 3
       <li>Edit <a href="./newprogs/refine_settings.pam">refine_settings.pam</a> to set 
           necessary values for refinement parameters and input file names, e.g.<br>
       <i> xedit&nbsp;&nbsp; refine_settings.pam</i>
d127 1
d130 3
a132 3
       <li>Create link for a specific SPIDER (ensures that same SPIDER 
          executable is used throughout whole refinement), e.g.: <br>
       <i> ln -s /usr/local/spider/bin/spider_linux_mpfftw.48 &nbsp;&nbsp; spider</i>
a135 2
       <p> 

d151 5
a155 3
            remain use  <i>'killspi'</i> again until they are all gone. <br>
            Clean the following files: <i>results.ext, pubsub.log, LOG.ext, work/* & local/*</i>.<br>
            Restart at step: 7.                    
a198 3
   <tr><td><a href="./newprogs/makeselect.pam">makeselect.pam</a></td>
       <td><a href="./newprogs/makeselect.pam">makeselect.pam</a></td> </tr>
      
d477 1
a477 1
Updated:  3/29/04  &nbsp;&nbsp;&nbsp; 
@


1.12
log
@*** empty log message ***
@
text
@d37 4
a40 2
       <tr><td>input/align_{**iter}_{***group}</td>  <td>Original alignment parameters doc. files</td></tr>
       <tr><td>input/vol{**iter}</td>                <td>Initial volume (from <a href="../../man/apsh.html">'AP SH'</a>  alignment</td></tr>
d100 4
a103 2
       <tr><td>input/align_{**iter}_{***group}</td>  <td>Original alignment parameters doc. files</td></tr>
       <tr><td>input/vol{**iter}</td>                <td>Initial volume (from <a href="../../man/apsh.html">'AP SH'</a>  alignment</td></tr>
d188 1
a188 1
   <tr><th>Serial</th> <th>parallel<br>(For Pubsub)</th>   <th>old procedures<br> (Not recommended)</th></tr>
d191 1
a191 2
       <td><b>Master procedure</b><br><a href="./newprogs/pub_refine.pam">pub_refine.pam</a></td>
       <td><b>Master procedure</b><br><a href="./old/programs/b96.pam">b96.pam</a></td></tr>
d194 1
a194 2
       <td><a href="./newprogs/refine_settings.pam">refine_settings.pam</a></a></td>
       <td>-</td></tr>
d197 1
a197 2
       <td><a href="./newprogs/sort.pam">sort.pam</a></td>
       <td>-</td></tr>
d200 1
a200 2
       <td><a href="./newprogs/prepare.pam">prepare.pam</a></td>
       <td>-</td></tr>
d203 1
a203 2
       <td><a href="./newprogs/makeselect.pam">makeselect.pam</a></td>
       <td><a href="./old/programs/Makeselect.prj">Makeselect.prj</a></td></tr>
d206 1
a206 2
       <td><a href="../../../pubsub/publish.perl">publish.perl</a></td>
       <td><a href="./old/programs/ali3dapmd.pam">ali3dapmd.pam</a></td></tr>
d209 1
a209 2
       <td><a href="./newprogs/pub_refine_start.pam">pub_refine_start.pam</a></td>
       <td><a href="./old/programs/aln3dapmd.pam">aln3dapmd.pam</a></td></tr>
d212 1
a212 2
       <td><a href="./newprogs/grploop.pam">grploop.pam</a></td> 
       <td><a href="./old/programs/alr3dapmd.pam">alr3dapmd.pam</a></td></tr>
d215 1
a215 2
       <td><a href="./newprogs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a></td>
       <td><a href="./old/programs/lang.pam">lang.pam</a></td>           </tr>
d218 1
a218 2
       <td><a href="./newprogs/pub_refine_wait.pam">pub_refine_wait.pam</a></td>
       <td><a href="./old/programs/combat.pam">combat.pam</a></td> </tr>
d221 1
a221 2
       <td><a href="./newprogs/mergegroups.pam">mergegroups.pam</a></td>
       <td>-</td></tr>
d224 1
a224 6
       <td><a href="./newprogs/saveres.pam">saveres.pam</a></td> 
       <td>-</td></tr>

   <tr><td><a href="./newprogs/makealigndoc.pam">makealigndoc.pam</a></td> 
       <td><a href="./newprogs/makealigndoc.pam">makealigndoc.pam</a></td> 
       <td>-</td></tr>
d227 1
a227 2
       <td><a href="./newprogs/endmerge.pam">endmerge.pam</a></td>
       <td>-</td></tr>
d230 1
a230 2
       <td><a href="./newprogs/smangloop.pam">smangloop.pam</a></td>
       <td>-</td></tr>
d233 1
a233 2
       <td><a href="./newprogs/endrefine.pam">endrefine.pam</a></td>
       <td>-</td></tr>
@


1.11
log
@update for ap ref
@
text
@d162 16
d184 1
a184 1
   <tr><th>Serial</th> <th>parallel<br>(For Pubsub)</th>   <th>old procedures<br> (Not recommended)</th></tr></tr>
d498 1
a498 1
Updated:  3/26/04  &nbsp;&nbsp;&nbsp; 
@


1.10
log
@makealigndoc missing
@
text
@d29 12
a40 2
       <li>Copy all the needed data files to the input directory, e.g.:<br>
       <i> cp '/net/sylt/usr21/Refinement2/input/*' input</i>
d45 1
a45 1
       <li>Copy all the needed refinement procedure files to the refinement directory, e.g.:<br>
d93 11
d149 9
a245 11
<li> Initial input files needed:
   <table border="0">
   <tr><td>input/dala{**iter}_{***group} </td>   <td>Aligned stacked image files</td></tr>
   <tr><td>input/data{***grp} </td>              <td>Unaligned stacked image files</td></tr>  
   <tr><td>input/trans{**iter}_{***group}</td>   <td>Original alignment shift doc. files</td></tr>
   <tr><td>input/order_select</td>               <td>Image selection doc. file</td></tr>
   <tr><td>input/vol{**iter}</td>                <td>Initial volume (from 'AP MQ' alignment</td></tr>
   <tr><td>input/ctfs</td>                       <td>Group defocus doc. file</td></tr>  
   </table>
   </li>
</p>
d303 3
a305 4
         <tr><td>AP MD  Iter.: 1</td><td>Find reference projection matching each current aligned image.</td></tr>    
         <tr><td>AP RD  Iter.:2  </td></tr>    
         <tr><td>AP RN  Iter.: 3...</td></tr>  
         </table> 
d313 1
a313 12
            <tr><td>RT SQ</td> <td>Rotate current image to angle of matching reference found by 'AP'</td></tr>
            <tr><td>MR</td>    <td>Mirror rotated image (if necessary)</td></tr>
            <tr><td>PD</td>    <td>Pad rotated image to 2X size</td></tr>
            <tr><td>SD</td>    <td>Save angles found by 'AP'</td></tr>
            <tr><td>PD</td>    <td>Pad reference projection to 2X size</td></tr>
            <tr><td>CC N</td>  <td>Cross-correlate rotated image with reference projection</td></tr>
            <tr><td>WI</td>    <td>Window from padded image</td></tr>
            <tr><td>PK</td>    <td>Find shift from peak location</td></tr>
            <tr><td>SA P</td>  <td>Combine rotation, mirror, and shift values</td></tr>
            <tr><td>SD</td>    <td>Create doc file with new translations</td></tr>
            <tr><td>RT SQ</td> <td>Rotate, mirror, and shift unaligned original image to create current aligned image</td></tr>
            <tr><td><a href="./newprogs/lang.pam">@@lang</a> </td> <td>Find angular displacement</td></tr>
d408 1
a408 11
            <tr><td>AP RN</td> <td>Find nearest reference projection matching each current image.</td></tr>    
            <tr><td>SD</td>    <td>Save angles found by 'AP RN'</td></tr>
            <tr><td>RT SQ</td> <td>Rotate current image to angle of matching reference</td></tr>

            <tr><td>PD</td>    <td>Pad rotated image to 2X size</td></tr>
            <tr><td>PD</td>    <td>Pad reference projection to 2X size</td></tr>
            <tr><td>CC N</td>  <td>Cross-correlate rotated image with reference projection</td></tr>
            <tr><td>WI</td>    <td>Window from padded image</td></tr>
            <tr><td>PK</td>    <td>Find shift from peak location</td></tr>
            <tr><td>SA P</td>  <td>Combine rotation, mirror, and shift values</td></tr>
            <tr><td>SD</td>    <td>Create doc file with new translations</td></tr>
a409 2


d482 1
a482 1
Updated:  8/13/03  &nbsp;&nbsp;&nbsp; 
@


1.9
log
@newprogs dir.
@
text
@d188 4
d487 1
a487 1
Updated:  8/04/03  &nbsp;&nbsp;&nbsp; 
@


1.8
log
@*** empty log message ***
@
text
@d36 1
a36 1
       <i> scp -v '/net/bali/usr1/spider/docs/techs/recon/programs/*pam'   /usr1/user/refine</i>
d41 1
a41 1
       <li>Edit <a href="./programs/refine_settings.pam">refine_settings.pam</a> to set 
d48 1
a48 1
       <li>Start refinement using <a href="./programs/refine.pam">refine.pam</a>, e.g.<br>
d88 1
a88 1
       <i> scp -v &nbsp;&nbsp;'/net/bali/usr1/spider/docs/techs/recon/programs/*pam'  &nbsp;&nbsp; /usr1/user/refine</i><br>
d94 7
a100 1
       <li>Edit <a href="./programs/refine_settings.pam">refine_settings.pam</a> to set 
d110 1
a110 1
       <i> ln -s /usr/local/spider/bin/spider_linux_mpfftw.35 &nbsp;&nbsp; spider</i>
d116 1
a116 1
       <li>Start Master SPIDER refinement process <a href="./programs/pub_refine.pam">pub_refine.pam</a>, e.g.<br>
d140 2
a141 2
   <tr><td><b>Master procedure</b><br><a href="./programs/refine.pam">refine.pam</a></td>
       <td><b>Master procedure</b><br><a href="./programs/pub_refine.pam">pub_refine.pam</a></td>
d144 2
a145 2
   <tr><td><a href="./programs/refine_settings.pam">refine_settings.pam</a></td>
       <td><a href="./programs/refine_settings.pam">refine_settings.pam</a></a></td>
d148 2
a149 2
   <tr><td><a href="./programs/sort.pam">sort.pam</a></td>
       <td><a href="./programs/sort.pam">sort.pam</a></td>
d152 2
a153 2
   <tr><td><a href="./programs/prepare.pam">prepare.pam</a></td>
       <td><a href="./programs/prepare.pam">prepare.pam</a></td>
d156 2
a157 2
   <tr><td><a href="./programs/makeselect.pam">makeselect.pam</a></td>
       <td><a href="./programs/makeselect.pam">makeselect.pam</a></td>
d165 1
a165 1
       <td><a href="./programs/pub_refine_start.pam">pub_refine_start.pam</a></td>
d168 2
a169 2
   <tr><td><a href="./programs/grploop.pam">grploop.pam</a></td> 
       <td><a href="./programs/grploop.pam">grploop.pam</a></td> 
d173 1
a173 1
       <td><a href="./programs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a></td>
d177 1
a177 1
       <td><a href="./programs/pub_refine_wait.pam">pub_refine_wait.pam</a></td>
d180 2
a181 2
   <tr><td><a href="./programs/mergegroups.pam">mergegroups.pam</a></td>
       <td><a href="./programs/mergegroups.pam">mergegroups.pam</a></td>
d184 2
a185 2
   <tr><td><a href="./programs/saveres.pam">saveres.pam</a></td> 
       <td><a href="./programs/saveres.pam">saveres.pam</a></td> 
d188 2
a189 2
   <tr><td><a href="./programs/endmerge.pam">endmerge.pam</a></td>
       <td><a href="./programs/endmerge.pam">endmerge.pam</a></td>
d192 2
a193 2
   <tr><td><a href="./programs/smangloop.pam">smangloop.pam</a></td>
       <td><a href="./programs/smangloop.pam">smangloop.pam</a></td>
d196 2
a197 2
   <tr><td><a href="./programs/endrefine.pam">endrefine.pam</a></td>
       <td><a href="./programs/endrefine.pam">endrefine.pam</a></td>
d224 1
a224 1
<p><li> <a href="./programs/refine_settings.pam">Set</a> initial parameters & file names</li>
d228 1
a228 1
<li> <a href="./programs/sort.pam">Sort</a> defocus groups by number of particles</p></li>
d231 1
a231 1
<li> <a href="./programs/prepare.pam">Prepare</a> input files.<p>   
d253 1
a253 1
   <li><a href="./programs/refine_settings.pam">Set parameters </a></li> for this iteration</li>
d269 1
a269 1
   <a href="./programs/grploop.pam">Loop</a> over all defocus groups creating group volumes<br>
d302 1
a302 1
            <tr><td><a href="./programs/lang.pam">@@lang</a> </td> <td>Find angular displacement</td></tr>
d320 1
a320 1
      <li> <a href="./programs/mergegroups.pam">Merge group volumes into iteration volume</a></li>
d326 1
a326 1
      <tr><td><a href="./programs/saveres.pam">@@saveres</a> </td> <td>Save resolution</td></tr>
d337 1
a337 1
   <li><a href="./programs/endmerge.pam">Loop</a> over all defocus groups</li>
d356 1
a356 1
<li><a href="./programs/refine_settings_sm.pam">Set parameters </a></li> for this small-angle iteration</li>
d363 1
a363 1
   <li><a href="./programs/refine_settings.pam">Set parameters </a></li> for this iteration</li>
d377 1
a377 1
   <a href="./programs/smangloop.pam">Loop</a> over all defocus groups creating group volumes<br>
d428 1
a428 1
      <li> <a href="./programs/mergegroups.pam">Merge group volumes into iteration volume</a></li>
d434 1
a434 1
      <tr><td><a href="./programs/saveres.pam">@@saveres</a> </td> <td>Save resolution</td></tr>
d446 1
a446 1
   <li><a href="./programs/endmerge.pam">Loop</a> over all defocus groups</li>
d462 1
a462 1
<li> <a name="final_merge" href="./programs/endrefine.pam">Merge group volumes into final iteration volume and determine final resolution</a></li>
d483 1
a483 1
Updated:  6/16/03  &nbsp;&nbsp;&nbsp; 
@


1.7
log
@pubsub stuff
@
text
@d30 1
a30 1
       <i> cp '/net/sylt/usr21/hxgao/newftf/Refinement2/input/*' input</i>
d82 1
a82 1
       <i> scp &nbsp;&nbsp; 'user@@sylt.wadsworth.org:/usr21/hxgao/newftf/Refinement2/input/*' &nbsp;&nbsp;input</i>
a101 8
       <li>Create links for <a href="../../../pubsub/publish.perl">PubSub</a>, e.g.:<br>
       <i> ln -s /usr/local/spider/pubsub/publish.perl &nbsp;&nbsp; publish</i><br>
       <i> ln -s /usr/local/spider/pubsub/delete.perl  &nbsp;&nbsp;&nbsp;delt</i><br>
       </li>
       </p>


       <p> 
d104 1
a104 1
       <i> ln -s /usr/local/spider/bin/spider_linux_mpfftw.19 &nbsp;&nbsp; spider</i>
d167 1
a167 1
       <td><a href="./programs/pub_doc_sync.pam">pub_doc_sync.pam</a></td>
d171 1
a171 1
       <td><a href="./programs/pub_wait.pam">pub_wait.pam</a></td>
d477 1
a477 1
Updated:  3/31/03  &nbsp;&nbsp;&nbsp; 
@


1.6
log
@*** empty log message ***
@
text
@d64 1
a64 1
       <i>  rlogin patroon</i>
d70 1
a70 1
       <i> cd /usr1/user/refine </i> 
d76 1
a76 1
       <i> mkdir input</i>
d82 1
a82 1
       <i> scp 'user@@sylt.wadsworth.org:/usr21/hxgao/newftf/Refinement2/input/*' input</i>
d88 1
a88 1
       <i> scp -v '/net/bali/usr1/spider/docs/techs/recon/programs/*pam'   /usr1/user/refine</i><br>
d96 1
a96 1
       <i> xedit refine_settings.pam</i>
d103 2
a104 2
       <i> ln -s /usr/local/spider/pubsub/publish.perl* publish</i><br>
       <i> ln -s /usr/local/spider/pubsub/delete.perl  delt</i><br>
d112 1
a112 1
       <i> ln -s /usr/local/spider/bin/spider_linux_mpfftw.19 spider</i>
d119 1
a119 1
       <i> spider pam/ftf @@pub_refine 0 & </i>
d179 2
a180 3
       <td><a href="./programs/pub_wait.pam">pub_wait.pam</a></td
       <td><a href="./old/programs/combat.pam">combat.pam</a></td>
       <td>-</td></tr>
@


1.5
log
@*** empty log message ***
@
text
@d148 1
a148 1
       <td> </td></tr>
d152 1
a152 1
       <td> </td></tr>
d156 1
a156 1
       <td> </td></tr>
d162 1
a162 1
   <tr><td> </td>
d166 1
a166 1
   <tr><td> </td>
d174 1
a174 5
   <tr><td>-</td> 
       <td>-</td> 
       <td><a href="./old/programs/lang.pam">lang.pam</a></td></tr>

   <tr><td> </td>
d176 1
a176 1
       <td><a href="./old/programs/combat.pam">combat.pam</a></td></tr>
d178 4
a181 2
   <tr><td> </td>
       <td><a href="./programs/pub_wait.pam">pub_wait.pam</a></td></tr>
d185 1
a185 1
       <td> </td></tr>
d189 1
a189 1
       <td> </td></tr>
d193 1
a193 1
       <td> </td></tr>
d197 1
a197 1
       <td> </td></tr>
d201 1
a201 1
       <td> </td></tr>
@


1.4
log
@*** empty log message ***
@
text
@d174 2
a175 2
   <tr><td><a href="./programs/lang.pam">lang.pam</a></td> 
       <td><a href="./programs/lang.pam">lang.pam</a></td> 
d488 1
a488 1
Updated:  3/26/03  &nbsp;&nbsp;&nbsp; 
@


1.3
log
@*** empty log message ***
@
text
@d57 1
a57 1
<li> <h2>Running Refinement on Cluster in Parallel using Pubsub</h2>
d63 1
a63 2
            <a href="../../../pubsub/pubsub_inst.html">installed and the subscriber daemon is
            running</a>, e.g.:<br>
d88 2
a89 1
       <i> scp -v '/net/bali/usr1/spider/docs/techs/recon/programs/*pam'   /usr1/user/refine</i>
@


1.2
log
@*** empty log message ***
@
text
@d3 1
a3 1
   <title>Refinement</title>
d7 1
a7 1
<h2 align="center">Refinement</h2>
d9 127
a135 1
<b>
d140 1
a140 1
   <tr><th>Serial</th> <th>parallel<br>(For Pubsub)</th>   <th>old proceedures<br> (Not recommended)</th></tr></tr>
d174 4
d183 1
a183 2
       <td><a href="./programs/pub_wait.pam">pub_wait.pam</a></td>
       <td><a href="./old/programs/lang.pam">lang.pam</a></td></tr>
d205 3
d209 1
a209 2

<hr>
d482 3
d488 1
a488 1
Updated:  3/3/3  &nbsp;&nbsp;&nbsp; 
@


1.1
log
@Initial revision
@
text
@d3 1
a3 2
<title>Refinement overview</title>
<title>Controls and synchronizes alignment</title>
d7 1
d9 73
a81 1
<h2 align="center">Refinement overview</h2>
a82 1
Refinement as controlled by <a href="./refine.pam">refine.pam</a> 
d87 7
a93 7
   <table border=0>
   <tr><td>input/dala{**iter}_{***group}@@</td>   <td>Aligned stacked image files</td></tr>
   <tr><td>input/data{***grp}@@</td>              <td>Unaligned stacked image file</td></tr>  
   <tr><td>input/trans{**iter}_{***group}</td>   <td>Original alignment offsets </td></tr>
   <tr><td>input/order_select</td>               <td>Image ID doc. fil</td></tr>
   <tr><td>input/vol{**iter}</td>                <td>Initial volume</td></tr>
   <tr><td>input/ctfs</td>                       <td>CTF Starting file </td></tr>  
d98 1
a98 1
<p><li> <a href="./refine_settings.pam">Input</a> initial parameters & file names</li>
d102 1
a102 1
<li> <a href="./sort.pam">Sort</a> defocus groups by number of particles</p></li>
d105 1
a105 1
<li> <a href="./prepare.pam">Prepare</a> input files.<p>   
d107 1
d109 1
d114 1
a114 1
   <table border=1>
d127 1
a127 1
   <li><a href="./refine_settings.pam">Set parameters </a></li> for this iteration</li>
d132 1
a132 1
   <table border=1>
d142 3
a144 1
   <a href="./grploop.pam">Loop</a> over all defocus groups creating group volumes<br>
d148 2
a149 2
         Reference projection mapping
         <table border=1>
d163 2
a164 2
            <li>Align original images for back projection
            <table border=1>
d176 1
a176 1
            <tr><td><a href="./lang.pam">@@lang</a> </td> <td>Find angular displacement</td></tr>
d183 3
a185 3
         <li>Back project original images into new group volume
         <table border=1>
         <tr><td>BP 32F</td> <td>Calculate refined group volume from new aligned images and angles</td></tr>
d194 2
a195 2
      <li> <a href="mergegroups.pam">Merge group volumes into iteration volume</a></li>
      <table border=1>
d200 1
a200 1
      <tr><td><a href="./saveres.pam">@@saveres</a> </td> <td>Save resolution</td></tr>
d210 4
a213 2
   <li><a href="endmerge.pam">Loop</a> over all defocus groups</li>
       <ul>
d215 4
a218 4
       <table border=1>
       <tr><td>BP CG</td> <td>Create final     group volume from  aligned images and angles</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angles</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angles</td></tr>
d226 1
a226 1
<li> Continue with small-angle refinement or GO TO STEP 12.</li>
d229 4
d237 1
a237 1
   <li><a href="./refine_settings.pam">Set parameters </a></li> for this iteration</li>
d242 1
a242 1
   <table border=1>
d244 1
a244 1
   <tr><td>VO EA</td> <td>Create reference angles for this iteration</td></tr> 
d250 3
a252 1
   <a href="./smangloop.pam">Loop</a> over all defocus groups creating group volumes<br>
d256 2
a257 2
         Reference projection mapping
         <table border=1>
d266 2
a267 2
            <li>Align original images for back projection
            <table border=1>
d272 1
a272 1
            <tr><td>SD</td>    <td>Save angles found by 'AP'</td></tr>
d291 3
a293 3
         <li>Back project original images into new group volume
         <table border=1>
         <tr><td>BP 32F</td> <td>Calculate refined group volume from new aligned images and angles</td></tr>
d302 7
a308 7
      <li> <a href="mergegroups.pam">Merge group volumes into iteration volume</a></li>
      <table border=1>
      <tr><td>TF CTS</td> <td>Create     CTF corrected volume from refined group volumes</td></tr>
      <tr><td>TF CTS</td> <td>Create 1/2 CTF corrected volume from refined group volumes</td></tr>
      <tr><td>TF CTS</td> <td>Create 1/2 CTF corrected volume from refined group volumes</td></tr>
      <tr><td>RF 3</td>   <td>Calculate resolution for group volume</td></tr>
      <tr><td><a href="./saveres.pam">@@saveres</a> </td> <td>Save resolution</td></tr>
d319 3
a321 1
   <li><a href="endmerge.pam">Loop</a> over all defocus groups</li>
d324 4
a327 4
       <table border=1>
       <tr><td>BP CG</td> <td>Create final     group volume from  aligned images and angles</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angles</td></tr>
       <tr><td>BP CG</td> <td>Create final 1/2 group volume from  aligned images and angles</td></tr>
d335 7
a341 6
<li> <a href="endrefine.pam">Merge group volumes into final iteration volume and determine final resolution</a></li>
       <table border=1>
       <tr><td>TF CTS</td>  <td>Create final     CTF corrected volume from group volumes</td></tr>
       <tr><td>TF CTS</td>  <td>Create final 1/2 CTF corrected volume from group volumes</td></tr>
       <tr><td>TF CTS</td>  <td>Create final 1/2 CTF corrected volume from group volumes</td></tr>
       <tr><td>RF 3</td>    <td>Calculate resolution for final volume</td></tr>
d343 2
d346 2
a347 2
<li> Finished.</li>
<p>
d349 1
a349 2


d351 6
d358 2
a359 1
; </body></pre></html>
@
