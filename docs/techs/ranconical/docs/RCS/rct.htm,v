head	1.9;
access;
symbols;
locks;
comment	@# @;


1.9
date	2015.08.31.15.00.04;	author leith;	state Exp;
branches;
next	1.8;

1.8
date	2014.06.06.09.35.32;	author tapu;	state Exp;
branches;
next	1.7;

1.7
date	2014.02.04.12.13.30;	author tapu;	state Exp;
branches;
next	1.6;

1.6
date	2013.12.12.17.05.51;	author leith;	state Exp;
branches;
next	1.5;

1.5
date	2013.12.12.15.58.33;	author leith;	state Exp;
branches;
next	1.4;

1.4
date	2013.07.31.13.17.36;	author tapu;	state Exp;
branches;
next	1.3;

1.3
date	2012.12.27.02.06.49;	author tapu;	state Exp;
branches;
next	1.2;

1.2
date	2012.12.22.02.06.51;	author tapu;	state Exp;
branches;
next	1.1;

1.1
date	2012.12.21.14.40.58;	author leith;	state Exp;
branches;
next	;


desc
@@


1.9
log
@updated
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
    <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
    <TITLE>Random-conical tilt reconstruction</TITLE>
    <link rel='stylesheet' href='tapu.css' type='text/css' />
</head>

<body lang="en-us" dir="ltr">
<body link="#0000ee" vlink="#0000ee" alink="#ff0000" bgcolor="#cccccc">

<hr />


<table class="heading" width="100%" >
    <tr> <td>    <br />
    <h3 class="heading">Random conical tilt reconstruction</h3>
    <p><center>As described in <I>Nucleic Acids Res.</I> (2011) <b>39</b>: 2845-54.</center></p>
    <p />
    </td> </tr>
</table>

<hr />


<b><p>Outline</p></b>
<ul>
    <li><a href="#links">Links to further information</a> </li>
    <li><a href="#notes">General notes</a>                </li>
    <li><a href="#quick">Quick-start guide</a>            </li>
    <li><a href="#start">Getting started</a>              </li>
    <li><a href="#proc">Procedure</a>                     </li>
    <li><a href="#misc">Miscellaneous procedure files</a>     </li>
    <li><a href="#mods">Modifications log</a>             </li>
    <li><a href="#refs">References</a>                    </li>
</ul>

<hr />

<a name="links">
<table class="heading" width="100%" >
   <tr> <td>    <br />  
   <h3 class="heading">Links to further information</h3>
   <p class="explain"></p>
   <p />
   </td> </tr>
</table>
</a>

<ul>
    <li><a href="#mr1987">Radermacher et al. (1987)</a>  -- description of the technique 
	of random conical tilt.</li>

    <li><a href="../../../euler.html">
        General information about Euler angles</a>, and 
        <a href="eulers.htm">a note about Euler angles in RCT</a>,
	</li>

    <li><a href="../tar_archive/archive.html">Tarball archive</a>. </li>

    <li>Information about 
	<a href="../../../../spire/doc/index.html">SPIRE</a>,
	the SPIDER Reconstruction Engine, including
	<a href="../../../../spire/doc/download.html">
	installation</a>. </li>

    <li>Download link for the 
	<a href="../../..//protocol_download.html">
	Nature Protocols (2008) data set</a>.</li>

    <li>A description of the
	<a href="params.html"> reconstruction parameters</a>.</li>

    <li>Information about images from the 
	<a href="../../recon/zi/zidoc.html">ZI scanner</a> </li>

    <li>Convert ZI scanner TIF files to SPIDER format: 
	<a href="../../recon/zi/zi2spi.c">
	zi2spi.c</a></li>

    <li><a href="../../..//techs/MSA/index.html">
	Multivariate data analaysis</a>, 
	including reference-free alignment, correspondence analysis, and classification.</li>

    <li><a href="../../../techs/classification/tutorial.html">
	Classification and clustering tutorial</a>.</li> 

    <li><a href="../../../techs/verify/batch/VerifyDocs/interface.htm">
	Documentation for <font class="guitool">verifybyview.py</font></a>.</li> 
    
    <li><a href="flipflop.htm">A note about use of mirrored reference images in multireference alignment</a>.</li>
    
    <li><a href="misc.htm#pocs">Projection onto convex sets</a>.</li> 
    
<!--     <li><a href="URL">LINK</a>.</li> -->
    
    <li> <a href="http://www.amazon.com/gp/product/0195182189/">
	Three-Dimensional Electron Microscopy of Macromolecular Assemblies</a>,
	Oxford University Press,  (February 2006)</li>
</ul>

<hr />

<a name="notes">
<table class="heading" width="100%" >
   <tr> <td>    <br />  
   <h3 class="heading">General notes</h3>
   
   <p class="explain"></p>
   
   <p />
   
   </td> </tr>
</table>
</a>

<!--TEMPLATES-->
<ul>
    <li> <b>Each step in the process is bold and marked  by a bullet.</b></li>
    <li> <a href="#notes">Procedure files</a> are links to the procedure script.</li>
    <li> <font class="input">Inputs</font> are marked in pink italics.</li>
    <li> <font class="output">Outputs</font> created by that procedure are marked in green.</li>
    <li> <font class="guitool"> Graphical tools</font> are marked in red. </li>
    <li> Command-line instructions are written in <code class="snippet">Courier</code>.</li>
    <li> <b><I>Parameters</I></b> will be in bold italic.</li>
    <li> Sequential operations are numbered. Options are lettered.</li>
    <li> Data extension assumed to be <b>.spi</b>. Adjust accordingly.</li>
    <li> List of inputs and outputs in description is not exhaustive.</li>
</ul>

	<!--<table class="outs">
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">OUTPUT</font>:</td>
	    <td>DESCRIPTION.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">OUTPUT</font>:</td>
	    <td>DESCRIPTION.</td></tr>
	</table>-->
    
	<!--<table class="outs">
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>PARAMETER</I></b>:                      </td>
		<td>DESCRIPTION.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>PARAMETER</I></b>:                      </td>
		<td>DESCRIPTION.</td></tr>
	</table>-->

<hr />


<a name="quick">
<table class="heading" width="100%" >
   <tr> <td>    <br />  
   <h3 class="heading">Quick-start guide</h3>
   
   <p class="explain">This is a brief list of the steps comprised in this protocol. 
   For simplicity, options have been limited. 
   For more detailed information, see the <a href="#proc">full procedure</a> below.</p>
   
   <p>Data extension is assumed to be <code class="snippet">spi</code></p>
   
   </td> </tr>
</table>
</a>

<code class="snippet"><ol>
    <li>tar -xvf procedures.tar</li>
    <li>spider rct/spi @@makeparams (or copy <b>params.spi</b>)</li>
    <li>(optional) tar -xvf data20060817.tar</li>
    <li>mkfilenums filenums.spi $MICROGRAPHS*</li>
    <li>(for non-SPIDER format micrographs) spider rct/spi @@convertmics</li>
    <li>spider rct/spi @@shrinkmics</li>
    <li>cd Micrographs/ ; montagefromdoc ../filenums.spi sm-mic*</li>
    <li>spider rct/spi @@micpair</li>
    <li>(required for JWEB) spider rct/spi @@padmics</li>
    <li>pick tilt pairs in JWEB or WEB</li>
    <li>spider rct/spi @@makesomenoise (or copy <b>noise.spi</b>) </li>
    <li>spider rct/spi @@windowparticles</li>
    <li>(for negative stain) Do both of:</li>
	<OL type="I">
	    <li>spider rct/spi @@highpass-untilted</li>
	    <li>spider rct/spi @@highpass-tilted</li>
	</ol>
    <li>montagefromdoc listparticles.spi Zerodegr/stk2-winrot.spi</li>
    <li>(if necessary) spider rct/spi @@removebad</li>
    <li>montagefromdoc listparticles.spi Tilted/stk2-winrot.spi</li>
    <li>(if necessary) spider rct/spi @@removebad</li>
    <li>(slow) spider rct/spi @@pairwise</li>
    <li>(optional) To reorient average, do both of:</li>
	<OL type="I">
	    <li>spider rct/spi @@reorientavg</li>
	    <li>spider rct/spi @@sumalign</li>
	</ol>
    <li>spider rct/spi @@filtershrink</li>
    <li>spider rct/spi @@ca-pca</li>
    <li>Classify.  (Ward's method shown here.  For other options, see below.)</li>
	<OL type="I">
	    <li>spider rct/spi @@hierarchical</li>
	    <li>spider rct/spi @@binarytree</li>
	    <li>cd Zerodegr/Tree ; binarytree labeled001.spi 4 goodclasses.spi</li>
	</ol>
    <li>Iterate:</li> 
	<OL type="I">
	    <li>spider rct/spi @@multirefalign after the first iteration)</li> 
	    <li>spider rct/spi @@filtershrink</li> 
	    <li>spider rct/spi @@classifybyview</li>
	    <li>verifybyview</li> 
	</ol>
    <li>spider rct/spi @@combinegoodclasses</li> 
    <li>spider rct/spi @@viewaverages</li> 
    <li>spider rct/spi @@centertilt</li>
    <li>spider rct/spi @@storeangles</li>
    <li>(optional) spider rct/spi @@d6symmetry</li>
    <li>spider rct/spi @@bpclass</li>
    <li>spider rct/spi @@volfilt</li>
    <li>(if multiple orientations) Do both of: </li>
	<OL type="I">
	    <li>spider rct/spi @@volalignprj</li>
	    <li>spider rct/spi @@mergevols</li>
	</ol>
    <li>spider rct/spi @@prepare-prjmatch</li>
</ol></code>


<a name="start"><hr /></a>

<table class="heading" width="100%" >
   <tr> <td>    <br />
   <h3 class="heading">Getting started</h3>

   <p class="explain"></p>

   <p />
   </td> </tr>
</table>

<ul>
    <li>Before unpackaging the procedure-file <a href="../procedures.tar">tarball</a> 
	(as described below), create a new directory, and change to that directory .</li>

    <li>Micrographs should be placed in the <b>Micrographs/</b> directory.  
	They needn't be in SPIDER format, but you'll then need to run
	<a href="../convertmics.rct">convertmics.rct</a> for the conversion. </li>
</ul>

<p>
  There are two different choices for running SPIDER procedures: Using 
  <a href="../../../..//spire/doc/index.html">
  <font class="guitool">SPIRE</font></a> or using SPIDER procedures directly.
</p>

<ol class="choice">
    <li> If you are using 
    <font class="guitool">SPIRE</font>, 
    then read <a href="../../../..//spire/doc/index.html">
    its documentation</a>, starting with 
    <a href="../../../../spire/doc/project.html">
    Starting a new project</a>.
    In this case, the configuration file is called <b>rct.xml</b>, 
    and is located in the directory in which you unpackaged the tarball. 
    
    <p> Even if you are <U>not</U> using <font class="guitool">SPIRE</font>, 
    its libraries are required for various Python scripts, such as
    <a href="../mkfilenums.py">mkfilenums.py</a> and <a href="../binarytree.py">binarytree.py</a>. 
    These steps can be substituted with SPIRE-independent analogs. 
    </p>
    
    <p> Installation instructions for <font class="guitool">SPIRE</font> can be found 
    <a href="../../../../spire/doc/download.html#FullInstall">here</a>.
    </p>
   </li>

   <li> If you are running SPIDER at the command-line prompt, 
   the processing steps are carried out by procedure files,
   which run many SPIDER operations automatically. 
   To use a procedure in this document, 
   if you have not unpackaged the complete tarball, 
   then right-click the procedure filename and 
   save the procedure to your current working directory. 
   At the beginning of each procedure, 
   there is a list of parameters that can be adjusted according to the particular project. 
   Some of the procedures will call additional procedure(s).
   You do not need to change anything in the procedures. 
   Use the following format to run a SPIDER procedure: <br />
   
   <code class="snippet">spider rct/spi @@proc</code> <br />
   
   where <code class="snippet">rct</code> is the procedure file extension, 
   <code class="snippet">spi</code> is the project data file extension, and 
   <code class="snippet">proc.rct</code> is the procedure file.
   </li>
</ol>


<a name="proc"><hr /></a>

<table class="heading" width="100%" >
   <tr> <td>    <br />
   <h3 class="heading">Procedure</h3>

   <p class="explain">This procedure comprises a complete series of steps required to 
	compute a three-dimensional reconstrction using random conical tilt.</p>

   <p />
   </td> </tr>
</table>

<ul>

<li><p class="action">Prepare project directory</p> </li> 
    
    <p>Access the latest <a href="../tar_archive/procedures.tar">procedures archive</a> 
    and unpackage it by typing:</p>
    
    <p><code class="snippet">tar -xvf procedures.tar</code></p>
    
    This command will unpackage the files in the currect directory, 
    so create a new directory if so desired.</li>

<p />


<li><p class="action">Prepare parameter doc file</p> </li> 

    <P>Many parameters are used repeatedly throughout this protocol. 
    There are two ways to prepare the doc file: 
    <a class="project" href="../makeparams.rct">makeparams.rct</a> or 
    <A HREF="../../../../spire/doc/packages.html"><font class="guitool">SPIRE</font></A>.</P>
    
    <OL type='A'>
        <LI>The procedure file <a class="project" href="../makeparams.rct">makeparams.rct</a> stores these parameters.
            Run it interactively, and answer the questions.  </LI>
        
        <LI>When you start a new project in <font class="guitool">SPIRE</font>, 
            it will spawn a pop-up window with entries for you to fill. 
            Some of the values will be inter-dependent, such as 
            pixel size and maximum spatial frequency.</LI>
    </OL>

	<BR>Either of these steps will create the document file:
	
	<table class="outs">
	    <tr valign="top">  <td>&curren;</td>
		<td><font class="output">params</font>:</td>
		<td>A doc file containing the 
		    <a href="params.html">
		    reconstruction parameters</a></td> 
	    </tr>
	</table>
    
    <br>Not all 20 parameters are used, so here is a summary of the key values:
    
    <table class="outs">
	<tr valign="top"><td>&curren;                                   </td>
	    <td><b><I>1</I></b>:                      </td>
	    <td>zip flag -- if set to 1, micrographs will be uncompressed using gunzip.</td></tr>
	<tr valign="top"><td>&curren;                                   </td>
	    <td><b><I>2</I></b>:                      </td>
	    <td>format flag -- 0 corresponds to SPIDER, 3 to Z/I TIFF, etc.
		<BR>See <a href="params.html">
		complete description</a> for additional formats</td></tr>
	<tr valign="top"><td>&curren;                                   </td>
	    <td><b><I>5</I></b>:                      </td>
	    <td>pixel size, in Angstroms.</td></tr>
	<tr valign="top"><td>&curren;                                   </td>
	    <td><b><I>17</I></b>:                      </td>
	    <td>window size, in pixels.</td></tr>
	<tr valign="top"><td>&curren;                                   </td>
	    <td><b><I>18</I></b>:                      </td>
	    <td>particle diameter, in pixels.</td></tr>
    </table>
    
    <p>Alternatively, you can copy and modify this file from elsewhere. 
       An example file called <font class="input">bak-params</font> is present in the tarball.</p>
    

<li><p><b>[Optional] Copy sample data</b></p></li>
    
    <p> The sample data set, from Nicolas Boisset, 
	consists of a phantom tilt pair containing worm hemoglobin.  
	Access the <a href="../tar_archive/data20060817.tar">data archive</a>
	and unpackage it by typing:</p>
	
	<p><code class="snippet">tar -xvf data20060817.tar</code></p>
	
	This command will create a directory called 
	<font class="output">Micrographs/</font>, containing phantom micrographs, and 
	also a directory called <font class="output">TP1/</font>, 
	containing the files used to generate the micrographs.
    </p>
	

<li><p><b>Generate a list of micrographs</b></p></li>

    <p> The Python script <a href="../mkfilenums.py">mkfilenums.py</a> 
        generates a SPIDER doc file with a list of filenumbers. 
        The syntax to make a file list of TIFF-format micrographs would be
        (after substituting the file pattern of your micrographs): </p>
        
        <p><code class="snippet">mkfilenums -f filenums.spi Micrographs/zeiss*.tif</code></p>
        
        <p> This Python script requires the Spiderutils library from 
            <a href="../../../../spire/doc/index.html"><font class="guitool">SPIRE</font></a>. 
	    If SPIRE is not installed, you can generate <font class="output">filenums</font> using other means, 
	    such as by manually entering the filenumbers using 
	    <a href="../../../man/doccreate.html">
	    'DOC CREATE'</a> in SPIDER.
        </p>

        <P> If the micrographs are stacked -- such as in the MRCS example described below --
            the run this step after unstacking them.</P>

<li><p><b>If the micrographs are not already in SPIDER format, then convert them</b></p></li>

    <P>There are two general ways to convert micrographs: 
        in SPIDER using <a href="../convertmics.rct">convertmics.rct</a>, or 
        other software, such as <a href="http://xmipp.cnb.csic.es/twiki/bin/view/Xmipp/WebHome">XMIPP</a>.</P>
    
    <OL type='A'>
        <li><P> The procedure file <a href="../convertmics.rct">convertmics.rct</a>, 
            which calls subroutine <a href="../convert_p.rct">convert_p.rct</a>, 
            will convert, in the default example, <font class="input">zeiss****.tif</font> 
            to SPIDER format.  
            Change the format for the input filename as necessary. 
            Acceptable formats are specified by parameters 1 and 2 in 
            <a href="params.html">
            <font class="input">params</font> (described here)</a>. 
            </P>
            
            <p> If the micrographs are in Z/I TIFF format, 
                <a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">zi2spi</a> 
                will be needed. If it is not installed on your system, the compilation instructions 
                are described at the top of the source code.
            </p>
        </li>

        <LI><P>XMIPP is also convenient for converting MRC stacks, which 
            is written by some camera software.  
            (Note however that <a href="../../../random.html">
            MRC stacks present their own problems</a>.) 
            The syntax (XMIPP version 3.1) to convert an MRC stack to SPIDER would be:</P>
            
            <p><code class="snippet">xmipp_image_convert -i mrc-stack.mrcs --swap --oroot mic:spi</code></P>
            
            <P>The SPIDER-format micrographs will have too many digits though 
                (the procedures below expect four). 
                You can either remove the extra digits, or 
                change all of the downstream procedures to accommodate the extra digits.  
                To perform the former, many graphical file managers allow mass-renaming.  
                Alternatively, you can do a FOR-loop from the command line in the BASH shell. 
                (If you're using CSH or TCSH, 
                you can temporarily switch to bash simply by typing <code class="snippet">bash</code>, 
                and return to your old shell with <I>CTRL-d</I> or by <code class="snippet">exit</code>).</P>
                
            <p>The syntax for removing two leading zeroes from, say, 28 files would be:<BR>
                <code class="snippet">for i in {01..28}; do mv mic0000$i.spi mic00$i.spi; done</code></P>
            
            <P> Now that the micrographs are unstacked, 
            run <a href="../mkfilenums.py">mkfilenums.py</a> as described above.</P>
        </LI>
    </OL>
       
    <b>Outputs:</b><br>

    <table class="outs">
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">Micrographs/mic****</font>:</td>
	<td>SPIDER-format micrographs.</td></tr>
    </table>
    
    </p>


<li><p><b>Shrink the micrographs</b></p></li>

    <p> Here, we will choose a reduction factor such that the micrograph fits on the screen
	(or better yet, an even number of micrographs), and/or where the particles are visible.  
	The procedure file <a href="../shrinkmics.rct">shrinkmics.rct</a> will 
        shrink the micrographs <font class="input">Micrographs/mic****</font>.  
        Output:
    </p>

    <table class="outs">
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">Micrographs/sm-mic****</font>:</td>
	<td>Downsampled micrographs.</td></tr>
    </table>
    
    <p> <I>HINT:</I> The high-pass filtration step can be slow, so 
        by setting <b><I>[filter-radius]=0</I></b>, you can skip this step. 
        For micrographs, I subjectively like a high-pass filter radius of 1500 Agnstroms.
    </p>

    <p> <I>HINT:</I> If you're too well oversampled 
        (i.e., if your pixel size is too fine), 
        you can save two copies of shrunken micrographs, for example,
        one that convieniently fits on the screen (say, a 4k image reduced by a factor of 5), and 
        another to be used for particle-windowing (perhaps, reduced by a factor of 2). 
        If you do the latter, remember to update your <a href="params.html">params</a> file. 
        The value there (in line 16) is used here only during conversion of the micrographs.
    </p>


<li><p><b>Screen micrographs</b></p></li>

    <p> Not all of the tilt pairs will necessarily be usable, so we will screen them. 
	Micrographs can be screened using various display programs. 
	To use, <font class="guitool">montagefromdoc.py</font>, for example, 
	<code class="snippet">cd Micrographs/</code> and type:</p>
	
    <p> <code class="snippet">montagefromdoc ../filenums.spi sm-mic* </code></p>
    
    <p> The tarball should have left a (hidden) file called
	<font class="input">Micrographs/.montagefromdoc</font> with reasonable settings. 
	The output selection docfile should be the same as the input: 
	<font class="input">../filenums</font>.
	By default, two micrographs will be displayed at a time.  
	Select them with <I>CTRL-a</I> or by clicking on each one.</p>
	
    <p> <U>NOTE:</U> If the micrographs do not have the same dimensions, 
        <font class="guitool">montagefromdoc.py</font> 
        will stretch them to be the same size (for display purposes only). 
        A later step, <a href="../padmics.rct">padmics.rct</a>, 
        will pad micrographs as necessary.
    </p>
	
    <p> If instead of with <font class="guitool">montagefromdoc.py</font>),
	you wish to remove micrographs by editing <b>filenums</b>
	it isn't necessary to renumber the keys. 
	The next procedure, <a href="../micpair.rct">micpair.rct</a>, 
	will renumber the keys internally.</p> 


<li><p><b>Establish pairings between micrographs</p></b></li>

    <p> The procedure file <a href="../micpair.rct">micpair.rct</a> reads 
	<font class="input">filenums</font> and 
	establishes pairs of micrographs.  Output:
    </p>

    <table class="outs">
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">docmicpairs</font>:</td>
	<td>Doc file listing untilted and tilted micrographs.</td></tr>
    </table>
    
    <p> This procedure file presumes that the tilted-specimen micrograph 
	precedes the untilted-specimen micrograph.
	Check the output to confirm that the pairings make sense.
    </p>
    

<li><p><b>Resize micrographs 
    [Required for <font class="guitool">JWEB</font>, 
    not required for <font class="guitool">WEB</font>]</b></p></li>

    <p> JWEB has a "feature" that requires the tilt pair to have the same dimensions. 
	The procedure file <a href="../padmics.rct">padmics.rct</a> reads pairs 
	as judged by <font class="input">docmicpairs</font>, 
	of micrographs <font class="input">Micrographs/sm-mic****</font> and
	sets them to have the same dimensions.  
    </p>

    <b>Outputs:</b><BR>
    <table class="outs">
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">Micrographs/jweb-mic{***[untilted]}
	    <BR>Micrographs/jweb-mic{***[untilted]}_tilted:</font></td>
	<td>Padded untilted-specimen and tilted-specimen micrographs, respectively.</td></tr>
    </table>
    
    <p> Another "feature" of JWEB is 
	that it expects the tilted micrograph to be second in the file list, 
	even though it is typically collected first at the microscope.
	So, the tilted micrograph is named such that it appears second in the <I>Open</I> dialog. 
	For bookkeeping purposes, from this point on, 
	"micrograph number" will correspond to the number of the untilted micrograph.
    </p>
    
   
<li><p><b>Pick tilt pairs</b></p></li>

    <p> In this step, we need to pick the same particle in the untilted- and tilted-specimen images. 
	There are two options for picking tilt pairs: 
	<font class="guitool">JWEB</font> or <font class="guitool">WEB</font>:</p>

	<OL type='A'>
	    <li>If using <font class="guitool">JWEB</font>: </li>
	      <ol>
		<li>From the <b>Micrographs/</b> directory, open JWEB. </li>
		<li>Go to <I>File -> Open -> Image Series</I> and select a pair of micrographs: 
		    <font class="input">Micrographs/jweb-mic{***[untilted]}</font> and 
		    <font class="input">Micrographs/jweb-mic{***[untilted]}_tilted</font>. 
		    Adjust the contrast as convenient. 
                </li>
		<li>Click on the <I>Markers/Tilt Pair</I> tab.</li>
		<li>In the <I>Marker File Number</I> field, enter the number of the <U>UN</U>tilted micrograph.
                    This number will be appended to the various file outputs.
		</li>
		<li>Click on the <I>Show/Edit Marker</I> button, which will display the images.</li>
		<li>Select a particle from the untilted micrograph, and 
		    the corresponding particle from the tilted micrograph.
		    Repeat this for at least four particles, 
		    separated as far as possible in the micrograph, the farther apart the better. 
		    <BR><I>HINT:</I> The middle mouse button will erase a pair of points 
		    if you make a mistake, or if JWEB becomes confused..
		    <BR><I>HINT:</I> Since the numbering is to the right of the marker, 
		    it may be easier to proceed from right to left.</li>
		<li>Click on buttons <I>Save Marker Files</I> and <I>Determine Theta</I>, 
		    which will determine the magnitude of the tilt angle between the micrographs.</li>
		<li>Click on the <I>Fit Angles</I> button.
		    This will determine the direction of the tilt axis.</li>
		<li>Click on the <I>Draw Fitted Locations</I> button.
		    This will slightly adjust the locations of the fitted coordinates according to the fitting above, 
		    but does not affect the coordinates selected with the mouse.</li>
		<li>Click on the <I>Save Angles</I> button.</li>
		<li>Now, when you select a particle in the untilted image, 
		    JWEB will send the cursor to the corresponding location in the tilted image.</li>
		<li>Select more particles from the tilt pair. 
		    (For the <a href="../data20060817.tar">sample micrograph</a>, 
		    there are 76 pairs.  Select all of them.)</li>
		<li>To save the new values, re-click the five buttons: <I>Save Marker Files</I>, <I>Determine Theta</I>, 
		    <I>Fit Angles</I>, <I>Draw Fitted Locations</I>, and <I>Save Angles</I>.</li>
	      </ol>
	    <li>If using <font class="guitool">WEB</font>: </li>
	      <ol>
		<li>From the menu, select <I>COMMANDS</I> &gt; <I>Tilted Particles</I>, 
		    and select first the untilted-specimen image 
		    <font class="input">Micrographs/sm-mic{****[tilted]}</font> 
		    and then the tilted-specimen image
		    <font class="input">Micrographs/sm-mic{****[tilted]}</font>.
		    <BR>If in WEB you entered a number under <I>Image reduction factor</I>
		    (after setting the reduction factor in <I>OPTIONS</I> &gt; <I>Image</I>)
		    when you run <a href="../windowparticles.rct">windowparticles.rct</a> below, 
		    continue to use the parameter <I><b>[shrinkFactor]</b></I> that you used in 
		    <a href="../shrinkmics.rct">shrinkmics.rct</a>.  
		    Do <U>NOT</U> multiply the additional reduction factor used; 
		    using both reduction factors would be redundant.
		    </li>
		<li>In the <I>Particle doc</I> popup window, under <I>Doc file number</I>, 
		    enter the number of the <U>UN</U>tilted micrograph and click <I>ACCEPT</I>.
		    This number will be appended to the various file outputs.
                </li>
		<li>Select a particle from the untilted micrograph, and 
		    the corresponding particle from the tilted micrograph.
		    Repeat this for at least four particles, 
		    separated as far as possible in the micrograph, 
		    the farther apart the better.</li>
		<li>Click the middle button to open the <I>Particle picking menu_popup</I>.</li>
		<li>Click on <I>Determine tilt axis angles</I>, <I>Draw fitted locations</I>, 
		    and <I>Save angles in doc file</I>.</li>
		<li>Now, when you select a particle in the untilted image, 
		    WEB will send the cursor to the corresponding location in the tilted image.</li>
		<li>Select more particles from the tilt pair. 
		    (For the sample micrograph, there are 76 pairs.  Select all of them.)</li>
		<li>To save the new values, re-click the three buttons: <I>Determine tilt axis angles</I>, 
		    <I>Draw fitted locations</I>, and <I>Save angles in doc file</I>.</li>
	      </ol>
	</ol>
	
	<br>Differences between <font class="guitool">JWEB</font> and <font class="guitool">WEB</font>:
	    <ul>
		<li>WEB does not require the pair of micrographs to be the same size, 
		    so the step <a href="../padmics.rct">padmics.rct</a> is unnecessary. </li>
		<li>There is no <I>Save Marker Files</I> button in <font class="guitool">WEB</font>.
		    Coordinates are saved continuously.</li>
		<li><I>Determine Theta</I> and <I>Fit Angles</I> in <font class="guitool">JWEB</font> 
			are now merged into one button in <font class="guitool">WEB</font>, <I>Determine tilt axis angles</I>.</li>
	    </ul>
	
	<BR><I>HINTS:</I>
	  <ul>
	    <li>Save the coordinates frequently. 
		JWEB gets confused from time to time, 
		and the main console window will state which particles have it confused. 
		Delete those particles (using the middle mouse button), and re-pick them, as necessary.</li>
		<li>The particles will be numbered to the right of and slightly above the point where you clicked. 
			So, it may be useful to start from the top right and work your way toward the bottom left. </li>
		<li>Your initial fit of the angles will probably be clustered in a small area 
			(it isn't easy to find common constellations of particles in the tilted and untilted micrographs), 
			so your clicked coordinates may deviate from the fitted coordinates as you stray from that cluster. 
			If, while picking pairs, the fitted locations stray from the correct location, 
			it may help to re-do the fitting.</li>
                <li>If you close a pair or micrographs and re-open them
                    (with the appropriate <I>Marker File Number</I>), 
                    you can resume from where you left off.</li>
	  </ul>
	<p />


<li><p><b>Obtain a noise image for normalization</b></p></li>

    <p> We will be normalizing the images using the SPIDER command 
	 <a href="../../..//man/cefit.html">
	'CE FIT'</a>, which fits the histogram of the background to that of a "noise" image. 
	The procedure file <a href="../makesomenoise.rct">makesomenoise.rct</a> will window out 
	a series of candidate images to use as the noise reference 
	from a full-size micrograph <font class="input">Micrographs/mic****</font> 
	(choose any micrograph).
    </p>

    <b>Outputs:</b><br>
    
    <table class="outs">
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">noise</font>:</td>
	<td>An noise reference image at random.</td></tr>
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">tmpnoise/noi</font>:</td>
	<td>A series of candidate noise references.</td></tr>
    </table>
    
    <p> You can look at the noise images <font class="output">tmpnoise/noi***</font>
	and copy one that looks "noisiest" to <font class="output">noise.spi</font>
	(in the top-level directory).
	
	A second option is to copy a pre-existing noise reference from another project to 
	<font class="output">noise.spi</font>.
	
	A third option is to open as a montage <font class="output">tmpnoise/noi</font> 
	and note the image number of your preferred noise reference for the next step, 
	<a href="../windowparticles.rct">windowparticles.rct</a>.
    </p>
    

<li><p><b>Window out particles from tilted and untilted micrographs.</b></p></li>

    <p> In this step, the procedure file <a href="../windowparticles.rct">windowparticles.rct</a>
	will window out particles from the untilted and tilted particles from 
	the micrographs <font class="input">Micrographs/mic****</font>, using 
	the coordinates doc files <font class="input">Micrographs/dcu****</font> and
	<font class="input">Micrographs/dct****</font>.  
	Windowed images will be normalized using 
	the <font class="input">noise</font> file from the previous step.
    </p>
    
    <p> For the parameter <b><I>[shrinkFactor]</I></b>, 
	if you picked particles from the micrographs downsampled in 
	<a href="../shrinkmics.rct">shrinkmics.rct</a> 
	enter the reduction factor used in that step. 
	If on the other hand you loaded the full-sized micrographs 
	(not recommended because of slowness), 
	then enter the value used under <I>Edit</I> &gt; <I>Resize</I> 
	(for <font class="guitool">JWEB</font>) or 
	<I>Image reduction factor</I> (for <font class="guitool">WEB</font>). 
	Ultimately, this parameter needs to be the multiplicationg factor between 
	the full-sized micrograph and the version used for particle-selection.
    </p>

    <b>Outputs:</b><br>
    <table class="outs">
        <tr valign="top"><td>&curren;</td>
            <td><font class="output">listparticles</font>:</td>
            <td>A list of windowed particles, along with the corresponding (untilted) micrograph number.</td></tr>
        <tr valign="top"><td>&curren;</td>
            <td><font class="output">Zerodegr/stk2-winrot</font>:</td>
            <td>Windowed-particle stack from the untilted-specimen micrographs.</td></tr>
        <tr valign="top"><td>&curren;</td>
            <td><font class="output">Tilted/stk2-winrot</font>:</td>
            <td>Windowed-particle stack from the tilted-specimen micrographs.</td></tr>
    </table>
    
    <p> There are additional outputs, <font class="output">Zerodegr/stk0-unrot</font> and 
        <font class="output">Tilted/stk0-unrot</font>.  
        See this <a href="eulers.htm">note about Euler angles</a> for information about 
        how the different outputs relate to the 3D reconstruction.
    </p>

    <p> The outputs <font class="output">Zerodegr/stk1-winrot_backup</font> and 
        <font class="output">Tilted/stk1-winrot_backup</font> are 
        generated in case high-pass filtration needs to be repeated.
    </p>

<li><p><b>[Recommended for negatively-stained images] High-pass filter windowed images</b></p>
    
    <p>For negatively-stained images, it is often the case that the puddle of stain surrounding the particles 
    dominates the classification (although maybe not the case for deep-stained specimens).  
    In this case, it may be helpful to high-pass filter the images using a filter radius 
    larger than the size of your particle.  If you cut off <U>too</U> much of the low-frequency information 
    however, the aligning power of the images will be lost.  You may need to tweak the radii.</p> 
    
    <p>If you are unsure whether to do these steps, feel free to skip them, 
    but be sure to look at the reconstituted images when you run <a href="../ca-pca.rct">ca-pca.rct</a> 
    in order to see if the stain is the predominant source of variation. </p> 
    
    <p>The procedure files <a href="../highpass-untilted.rct">highpass-untilted.rct</a> and
	<a href="../highpass-tilted.rct">highpass-tilted.rct</a> read stacks
	<font class="input">Zerodegr/stk1-winrot_backup</font> and <font class="input">Tilted/stk1-winrot_backup</font>, 
	respectively, the input directories are renamed <font class="output">Zerodegr/Unhighpass</font> and 
	<font class="output">Tilted/Unhighpass</font>.</P>
	
    <b>Outputs:</b><br>
    
    <table class="outs">
        <tr valign="top"><td>&curren;</td>
            <td><font class="output">Zerodegr/stk2-winrot</font>:</td>
            <td>High-pass filtered untilted-specimen image stack (overwrites previous version).</td></tr>
        <tr valign="top"><td>&curren;</td>
            <td><font class="output">Tilted/stk2-winrot</font>:</td>
            <td>High-pass filtered tilted-specimen image stack (overwrites previous version).</td></tr>
    </table>


<li><p><b>Screen the windowed images for defects (micrograph edges, dust, etc.).</b></p></li>

    <p> Here, we will screen the images for gross defects, such as micrograph edges, dust, <I>etc.</I>
	using <font class="guitool">montagefromdoc.py</font>. Steps: </p>

	  <ol>
	    <li>Open the untilted-specimen images by typing:
		<BR><code class="snippet">montagefromdoc listparticles.spi Zerodegr/stk2-winrot.spi</code>
		<BR>The (hidden) input <font class="input">.montagefromdoc</font> should have been present in the tarball, 
		but ensure that the output doc file is called <font class="output">notgood</font></li>
	    <li>Select only the bad particles.  
		Hit <I>PageDown</I> and <I>PageUp</I> to navigate though the screenfuls of images. </li>
	    <li>Save the selection file with <I>CTRL-s</I>.  
		A more detailed description of <font class="guitool">montagefromdoc.py</font> can be found 
		<a href="../../..//techs/verify/VerifyDocs/montagefromdoc.htm">
		here</a>.</li>
	    <li>If particles are to be rejected, run: <a href="../removebad.rct">removebad.rct</a>. 
		This procedure file, and its subroutine <a href="../backup.rct">backup.rct</a>,
		backs up and updates <b>listparticles</b>.</li>
	    <li>Screen the tilted-specimen images by typing:
		<BR><code class="snippet">montagefromdoc listparticles.spi Tilted/stk2-winrot.spi</code></li>
	    <li>Select the bad particles. </li>
	    <li>If additional particles are to be rejected, re-run: <a href="../removebad.rct">removebad.rct</a>  
		to update <b>listparticles</b>.</li>
	  </ol>

    <p> The types of particles that should be rejected are those that will interfere with the 2D alignment 
	or 3D reconstruction.  
	Cut-off images, where the particle was too close to the edge of the micrograph, 
	fall in this category. 
	For tilted images, particles with dust should be thrown out 
	if the dust will interfere with the reconstruction. 
	For untilted images, dust is more tolerable; 
	if the dust interferes with the 2D alignment, offending particles can be thrown out later. 
	For the tilted images, this is the last opportunity to exclude them.
    </p>

<li><p><b>Align the untilted-specimen particles using reference-free alignment.</b></p></li>

    <p> In order to run classification, the particle will first be run through reference-free alignment.  
	Even if there are different views of particles (orientation or conformation), 
	the idea is that these different classes of particles will align consistently with 
	the type of particle to which it is aligned.
    </p>
	
    <p> There are a few different implementations of reference-free alignment, such as 
	<a href="../../..//man/apsr.html">'AP SR'</a>. 
	The procedure file used here, <a href="../pairwise.rct">pairwise.rct</a>, uses an algorithm called 
	the "pyramidal system for prealignment construction."  For more information, see the 
	<a href="../../..//techs/MSA/index.html">
	MSA documentation</a>.  
    </p>
	
    <P> Briefly, <a href="../pairwise.rct">pairwise.rct</a> takes the first two images from the stack
	<font class="input">Zerodegr/stk2-winrot</font>, aligns them, and averages them.  
	In the next iteration, it will align pairs of averages, and then average them, 	and so forth.  
	This type of alignment appears to be less random than does 
	<a href="../../..//man/apsr.html">'AP SR'</a>, 
	which chooses seed images as alignment references.</P>

	<b>Outputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Pairwise/stkcentavg</font>:</td>
                <td>Stack of centered intermediate averages, with circles overlain.
                    <BR>See note about centering on the 
                    <a href="align.htm">alignment parameters page</a>.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/stk3-aligned</font>:</td>
                <td>Aligned untilted-specimen image stack.
                    <BR>This stack will be overwritten with subsequent alignments.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Pairwise/stkaligned</font>:</td>
                <td>Copy of aligned untilted-specimen image stack,
                    <BR>retained locally to the <font class="output">Pairwise/</font> directory.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Pairwise/rfreeavg001</font>:</td>
                <td>Final average of all images.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Pairwise/docalign</font>:</td>
                <td>Alignment doc file.</td></tr>
	</table>

    <P>See a description of the key parameters <a href="align.htm">alignment parameters page</a>.</P>
    

<li><p><b>[Optional] Align average along coordinate axes</p></b></li>

    <p> These two steps are for purely aesthetic reasons. 
	Following reference-free alignment, the image average will be in an arbitrary orientation. 
	These two steps attempt to reorient the average to a less arbitrary orientation.</p>
	
      <ol>
	<li><P>The procedure file <a href="../reorientavg.rct">reorientavg.rct</a> 
	    will attempt to find a bilateral symmetry axis in 
	    <font class="input">Zerodegr/Pairwise/rfreeavg001</font>, 
	    and then orient that symmetry axis along the coordinate axes.</P>

	    <b>Outputs:</b><br>
	    
	    <table class="outs">
                <tr valign="top"><td>&curren;</td>
                    <td><font class="output">Zerodegr/Pairwise/malign</font>:</td>
                    <td>Montage of reorientation candidates (see below).</td></tr>
                <tr valign="top"><td>&curren;</td>
                    <td><font class="output">Zerodegr/Pairwise/dsolalign</font>:</td>
                    <td>Alignment doc file for reorientaiton attempts.</td></tr>
	    </table>
	    
	    <p> The output <font class="output">Zerodegr/Pairwise/malign</font> 
		outlines the progress of the procedure file. 
		It takes the average <font class="input">Zerodegr/Pairwise/rfreeavg001</font> 
		and mirrors it. 
		The procedure file then takes the autocorrelation functions (ACF) of both images and 
		aligns the ACFs.  
		The best fit is rotated to vertical (solution 1) and horizontal (solution 2). 
		The procedure file also attempts to align the images in real space (solutions 3 &amp; 4).
	    </p>
	</li>
	    
	<li><P>Choose the preferred solution number from the previous step (if any), and
	    enter it as parameter <I><b>[solutionNum]</b></I> in <a href="../sumalign.rct">sumalign.rct</a>.
	    This procedure file reads the alignment information for the corresponding solution number from 
	    <font class="input">Zerodegr/Pairwise/dsolalign</font>, 
	    combines it with the reference-free alignment parameters in 
	    <font class="input">Zerodegr/Pairwise/docpairalign</font>, and applies them to 
	    the unaligned image stack <font class="input">Zerodegr/stk2-winrot</font>.  </P>

        <b>Outputs:</b><br>
        
        <table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/stk3-aligned</font>:</td>
                <td>Aligned untilted-specimen image stack.
                    <BR>This stack will be overwritten with subsequent alignments.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Pairwise/sumaligned</font>:</td>
                <td>Aligned untilted-specimen image stack.
                    <BR>This copy is retained locally to the <font class="output">Pairwise/</font> directory.</td></tr>
                <tr valign="top"><td>&curren;</td>
                    <td><font class="output">Zerodegr/Pairwise/avgu001</font>:</td>
                    <td>Realigned 2D average.</td></tr>
                <tr valign="top"><td>&curren;</td>
                    <td><font class="output">Zerodegr/Pairwise/docalign</font>:</td>
                    <td>Combined alignment-parameter doc file.</td></tr>
	    </table>

	</li>
      </ol>


<li><p><b>Filter and shrink the aligned, untilted-specimen particles.</b></p></li>

	The procedure file <a href="../filtershrink.rct">filtershrink.rct</a> 
	low-pass filters and optionally shrinks the particle images. 
	The next step, multivariate data analysis, will be faster if 
	the image stack <font class="input">Zerodegr/stk3-aligned</font> are made smaller. 
	Also, the individual images will be examined subsequently and 
	will be easier to recognize if they are low-pass filtered.</p>

	<b>Outputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/stkfiltered</font>:</td>
                <td>Low-pass, shrunken filtered image stack.</td></tr>
	</table>
	
	<p> The default parameters are hopefully reasonable. 
	    To view the output filtered images, type:
	    <BR><code class="snippet">montagefromdoc listparticles.spi Zerodegr/stkfiltered.spi</code></p>
	    
	<p> Adjust the filtration parameters as necessary, and re-run. 
	    Note the reduction factor for subsequent steps.
	</p>


<li><p><b>Run multivariate statistical analysis (MSA) on filtered images.</b></p></li>

    <p> The procedure file <a href="../ca-pca.rct">ca-pca.rct</a> runs 
	correspondence analysis (CA) or principal component analysis (PCA) or iterative PCA (IPCA). 
	In principle, one can classify the image stack <font class="input">Zerodegr/stkfiltered</font> 
	without running MSA, but here we will be using it. </p>
	
    <p> What this means, briefly, is that systematic variations are reduced into 
	an arbitrary number of factors (<I>e.g.,</I> 25 used here); 
	in this case, the factors can be expressed as images, or "eigenimages." 
	Each image can be reconstituted as the sum of these eigenimages, when using the proper weights.  
	How CA and PCA differ is in the way these weights are calculated. 
	The "importance" of each factor is the percent variation that is accounted for. 
	The eigenimages of lower importance typically correspond to noise. 
	Thus, an image reconstituted from the strongest eigenimages can be thought of as 
	a type of filtered image, where some contribution of noise has been excluded.
    </p>
	
    <p> For a more complete description of multivariate statistical analysis 
	(or more accurately, multivariate data analysis), see Chapter 4 in 
	<a href="#jf2006">Frank, 2006</a>.
	For details about the specific SPIDER commands pertaining to MSA, and example outputs, see the
	<a href="../../..//techs/classification/tutorial.html">
	classification and clustering tutorial</a>.</p>
	
       <b>Outputs:</b><br>
       
       <table class="outs">
        <tr valign="top"><td>&curren;</td>
            <td><font class="output">Zerodegr/MSA/eigenimg</font>:</td>
            <td>Stack of eigenimages, i.e., images showing systematic correlated variations between pixels.
                <BR>For more information about eigenimages (and reconstituted images), see the
                <a href="../../..//techs/classification/tutorial.html#virtual">
                classification and clustering tutorial</a>.</td></tr>
        <tr valign="top"><td>&curren;</td>
            <td><font class="output">Zerodegr/MSA/reconst</font>:</td>
            <td>Stack of images reconstituted using a single factor
                <BR>Factors can be positive or negative, hence the two versions for each.
                <BR>For more information about reconstituted images (and eigenimages), see the
                <a href="../../..//techs/classification/tutorial.html#virtual">
                classification and clustering tutorial</a>.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/MSA/ps_eigenvalues.ps</font>:</td>
	    <td>A PostScript file with a histogram of the percent variation for each factor.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/MSA/cas_IMC</font>:</td>
	    <td>A text file containing information about each factor and for each image
		<BR>For more information about the output of
		<a href="../../..//man/cas.html">'CA S'</a>, see the
		<a href="../../..//techs/classification/tutorial.html#CAPCA">
		classification and clustering tutorial</a>.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/MSA/factormapAABB</font>:</td>
	    <td>PostScript format plots for factor #AA <I>vs.</I> factor #BB (where BB = AA+1)
		<BR>Clusters are indicative of distinct classes.</td></tr>
	</table>

	<BR><I>Important parameters:</I>
	
	<table class="outs">
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[cas-option]</I></b>:                      </td>
		<td>Option of CA (option 1), PCA (2), or iterative PCA (3)
		    <BR>One method or another sometimes crashes due to "numerical inaccuracy."
		    I subjectively try CA first, then iterative PCA, then PCA last.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[num-factors]</I></b>:                      </td>
		<td>Number of factors to calculate.
		    <BR>If after you run this procedure file, all of the eigenimages look meaningful,
		    then increase this parameter and re-run.</td></tr>
	</table>
	
	<p> <U>NOTE</U>: For negatively-stained samples, when looking at the reconstituted images, 
	    it may be that the stain distribution is the greatest source of variation. 
	    If this is the case, go back to the high-pass filtration step above.
	</p>

<li><p><b>Classify images.</b></p></li>

    <p> At this step, we willl attempt to separate the images into homogeneous subclasses.  
	There is a tradeoff between homogeneity of the subclasses, and 
	size of the subclasses (which is related to the improvement of signal-to-noise in the class averages). 
	In other words, if too few classes are used, dissimilar classes will be grouped together, and
	if too many classes are used, class averages will be likely redundant and noisy.
	Thus, there is some degree of subjectivity involved in the classification.
    </p>
	
    <p> For any of the classification options presented here, 
	choose the number of factors to use (parameter <I><b>[numFactors]</b></I>) 
	based on the appearance of the eigenimages and the strength of the factors (based on the histogram), 
	including those factors that you believe to represent true structural differences. 
	Use of weaker factors will probably not make a appreciable difference, however.
    </p>
	
    <p> There are three classification options given here. 
	(For hints about the usage of the different methods, see the 
	<a href="../../..//techs/MSA/index.html">
	multivariate data analaysis</a> page.)
    </p>
	
    <p> To view the particles belonging to each class, refer below to the 
	<a href="#vbv">instructions about <font class="guitool">verifybyview</font></a>.</p>
	
	<BR>Choose one of the following 3 classification options:
	  <OL TYPE=A>
	    <li><b>[Recommended] Hierarchical classification, using Ward's method.</b> </li>
	      <ol>
		<li><p><b>Run hierarchical classification.</b></p> </li>
		
		    <p> This classification method uses SPIDER command
			<a href="../../..//man/clhc.html">'CL HC'</a>. 
			For a description of the outputs, see the 
			<a href="../../..//techs/classification/tutorial.html#clhc">
			classification and clustering tutorial</a>.
		    </p>
			
		    <P>The procedure file <a href="../hierarchical.rct">hierarchical.rct</a> 
			reads the MSA factor text file <font class="input">Zerodegr/MSA/cas_IMC</font>.</P>
		
			<b>Output:</b><br>
			
			<table class="outs">
			<tr valign="top"><td>&curren;</td>
			    <td><font class="output">Zerodegr/Hierarchical/docdendro</font>:</td>
			    <td>Dendrogram doc file, showing the relatedness between images.
				<BR>See the <a href="../../..//techs/classification/tutorial.html#clhc">
				classification and clustering tutorial</a> for more details.
				</td></tr>
			</table>
			
		<li><b>Generate class averages.</b></li>
		
		<p> In the previous step, we didn't explicitly assign classes. 
		    We simply made the dendrogram, which describes the relatedness of the images. 
		    In this step, we will explicitly pare down the dendrogram into classes.</p>
		    
		Choose one of:		
		  <OL TYPE=a>
		    <li><b>[Recommended] Generate binary tree</b></li>
		    
			<p> It is somewhat arbitrary where to cut off the dendrogram 
			    <font class="input">Zerodegr/Hierarchical/docdendro</font> generated above. 
			    This procedure file will generate class averages for <U>all</U> depths until a specified cutoff, 
			    averaging the image stack <font class="input">Zerodegr/stkfiltered</font>.
			    The output class averages are arranged into the format of a binary tree, such that 
			    the average is the top-level node, the first two subclasses are at the next depth, 
			    the first two classes of each of those two classes are at the next depth, etc.
			    While it becomes straightforward how to draw the tree, the drawback is that 
			    information is lost about the height of the branches.  
			    That is, the height of the branches in the binary tree does not direct correspond to 
			    the actual height of the branch in the dendrogram.
			</p>
			    
			<p> In the procedure file <a href="../binarytree.rct">binarytree.rct</a> 
			    (which calls <a href="../averagenode.rct">averagenode.rct</a> 
			    and <a href="../update_lut.rct">update_lut.rct</a>), 
			    the parameter <I><b>[end-depth]</b></I> 
			    will call for 2**<I><b>[end-depth]</b></I> class averages. 
			    It is better to err on the side of too high a depth and display fewer in the next step.
			</p>
			    
			    <b>Outputs:</b><br>
			
			    <table class="outs">
                                <tr valign="top"><td>&curren;</td>
                                    <td><font class="output">Zerodegr/Tree/classavg***</font>:</td>
                                    <td>Class average for each node on the binary tree.</td></tr>
                                <tr valign="top"><td>&curren;</td>
                                    <td><font class="output">Zerodegr/Tree/labeled***</font>:</td>
                                    <td>Class average, labeled with the class number and the number of particles.</td></tr>
			    </table>
			    
			<p><U>NOTE</U>: The format of SPIDER's dendrogram doc file changed in version 17.13. 
			    Previously the top two branches had height 1, whereas now, it's 100. 
			    If this procedure file crashes, check the parameter <b><I>[top-branch]</I></b>.
			</p>
			    
			<p> Instructions for viewing the binary tree are given below, 
			    in the section below, on the <a href="#treepy">selection of class averages</a>.
			</p>
			
		    <li><b>Generate a pre-specified number of class averages</b></li>
		    
		    <p> To use this option, run procedure file <a href="../classavg.rct">classavg.rct</a>. 
                        This option cuts off the dendrogram <font class="input">dendrodoc</font> at a specific height.  
			The height determines the number of classes into which the dendrogram is pared. 
			The number of classes desired is specified by the parameter <I><b>[numClasses]</b></I> in 
			<a href="../classavg.rct">classavg.rct</a>. 
			However, because of the imprecision in how the appropriate height in the dendrogram is searched, 
			the actual number of classes found may not exactly match the desired number of classes. 
		    </p>
		    
		    <b>Outputs:</b><br>
			<table class="outs">
                            <tr valign="top"><td>&curren;</td>
                                <td><font class="output">Zerodegr/Hierarchical/classavg***</font>:</td>
                                <td>Class averages.</td></tr>
                            <tr valign="top"><td>&curren;</td>
                                <td><font class="output">Zerodegr/Hierarchical/docclass***</font>:</td>
                                <td>List of particles belonging to each class.</td></tr>
                            <tr valign="top"><td>&curren;</td>
                                <td><font class="output">Zerodegr/Hierarchical/listclasses</font>:</td>
                                <td>Doc file with each information about each class
                                    <BR>Needed as an input for <font class="guitool">verifybyview.py</font> 
                                    (<a href="#vbv">more information below</a>).</td></tr>
                            <tr valign="top"><td>&curren;</td>
                                <td><font class="output">Zerodegr/Hierarchical/classvar***</font>:</td>
                                <td>Class variances.</td></tr>
			</table>
		  </ol>
	      </ol>

	    <li><p><b>Run K-means classification</b></p> </li>
	    
	    <p> K-means classification uses the SPIDER command
		<a href="../../..//man/clkm.html">
		'CL KM'</a>.  In contrast to the other classification options presented here, 
		K-means will generate exactly the number of classes requested.  
		The procedure file <a href="../kmeans.rct">kmeans.rct</a> reads 
		<font class="input">Zerodegr/MSA/cas_IMC</font> and, in a single step, 
		generates <I>K</I> (parameter <I><b>[numClasses]</I></b> in the procedure file) classes 
		from the image stack <font class="input">Zerodegr/stkfiltered</font>.
	    </p>
	    
	    <b>Outputs:</b><br>
		    <table class="outs">
                        <tr valign="top"><td>&curren;</td>
                            <td><font class="output">Zerodegr/Kmeans/docassign</font>:</td>
                            <td>Doc file of analogous format to 
                                dendrograms from the other 2 classification methods.</td></tr>
                        <tr valign="top"><td>&curren;</td>
                            <td><font class="output">Zerodegr/Kmeans/classavg***</font>:</td>
                            <td>Class averages.</td></tr>
                        <tr valign="top"><td>&curren;</td>
                            <td><font class="output">Zerodegr/Kmeans/docclass***</font>:</td>
                            <td>List of particles belonging to each class.</td></tr>
                        <tr valign="top"><td>&curren;</td>
                            <td><font class="output">Zerodegr/Kmeans/listclasses</font>:</td>
                            <td>Doc file with each information about each class
                                <BR>Needed as an input for <font class="guitool">verifybyview.py</font> 
                                (<a href="#vbv">more information below</a>).</td></tr>
                        <tr valign="top"><td>&curren;</td>
                            <td><font class="output">Zerodegr/Kmeans/classvar***</font>:</td>
                            <td>Class variances.</td></tr>
		    </table>
	    
	    <li><p><b>Clustering using Diday's method</b></p> </li>
	      <ol>
		<li><p><b>Run hierarchical classification.</b></p> </li>
		
		    <P> The procedure file <a href="../cluster.rct">cluster.rct</a> uses SPIDER command
			<a href="../../..//man/clcla.html">
			'CL CLA'</a>, which uses Diday's method of moving centers. 
			Like with Ward's method above, this method is hierarchical, 
			reading <font class="input">Zerodegr/MSA/cas_IMC</font>.</P>
		    
			    <b>Outputs:</b><br>
			    
			    <table class="outs">
                                <tr valign="top"><td>&curren;</td>
                                    <td><font class="output">Zerodegr/Cluster/docdendro</font>:</td>
                                    <td>Dendrogram doc file, showing the relatedness between images.
                                        <BR>See the <a href="../../..//techs/classification/tutorial.html#clhc">
                                        classification and clustering tutorial</a> for more details.
                                        </td></tr>
			    </table>
		    
		<li><b>Generate class averages.</b></li>
	    
		    <p> With the previous step, analogously to Ward's method above, 
			we didn't explicitly assign classes. 
			We simply made the dendrogram 
			<font class="input">Zerodegr/Cluster/docdendro</font>, 
			which describes the relatedness of the images. </p>
			
		    <p> In the procedure file <a href="../classavg.rct">classavg.rct</a>, 
			we will explicitly pare down the dendrogram into classes. 
			(I haven't been able to make Diday's method compatible with 
			<a href="../binarytree.rct">binarytree.rct</a>,
			so for now, it's functionally equivalent to K-means.) </p>
			
		    <p> <U>NOTE:</U> The default parameter <I><b>[class-type]</b></I> 
                        in the procedure file is for Ward's hierarchical method, 
			so change that parameter to <I><b>2</b></I>.
		    </p>
			
			<b>Outputs:</b><br>
			    <table class="outs">
                                <tr valign="top"><td>&curren;</td>
                                    <td><font class="output">Zerodegr/Cluster/classavg***</font>:</td>
                                    <td>Class averages.</td></tr>
                                <tr valign="top"><td>&curren;</td>
                                    <td><font class="output">Zerodegr/Cluster/docclass***</font>:</td>
                                    <td>List of particles belonging to each class.</td></tr>
                                <tr valign="top"><td>&curren;</td>
                                    <td><font class="output">Zerodegr/Cluster/listclasses</font>:</td>
                                    <td>Doc file with each information about each class
                                        <BR>Needed as an input for <font class="guitool">verifybyview.py</font> 
                                        (<a href="#vbv">more information below</a>).</td></tr>
                                <tr valign="top"><td>&curren;</td>
                                    <td><font class="output">Zerodegr/Cluster/classvar***</font>:</td>
                                    <td>Class variances.</td></tr>
			    </table>
	      </ol>
	  </ol>
	  
    <p> It may be informative to see the individual particles that belong to each class. 
	This can be accomplished by using 
	<a href="../../..//techs/verify/VerifyDocs/interface.htm">
	<font class="guitool">verifybyview.py</font></a>. 
	There should be a settings file, <a href="../.verifybyview">.verifybyview</a>, 
	present in the tarball. 
	For more details, refer below to the 
	<a href="#vbv">section on viewing the class averages and constituent particles</a>.
    </p>    

<li><p><b>Select unique classes</b></p></li>

    <p> In the next step, we will select class averages to use as references for multireference alignment. 
	The first option applies to the output of <a href="../binarytree.rct">binarytree.rct</a> above. 
	The second option applies to all classification options from above, 
	including the output of <a href="../binarytree.rct">binarytree.rct</a>.
    </p>
    
      <OL TYPE=A>
	<li><a name="treepy"><b>View and select classes from binary tree</b></a></li>
	
	    <p> To view the binary tree, <code class="snippet">cd Zerodegr/Tree</code> and run:
		<BR><code class="snippet">binarytree labeled001.spi 4 goodclasses.spi</code>
	    </p>
	    
	    <p> The parameter <b><I>4</I></b> on the command line above specifies 
		the maximum depth displayed of the tree.  
		A depth of <b><I>2</I></b>, in comparison, 
		would display only the combined average plus 
		the two classes corresponding to the first branch in the dendrogram. 
		Unlike the <I>Dendrogram</I> option in 
		<a href="http://www.wadsworth.org/spider_doc/web/docs/web.html"><font class="guitool">WEB</font></a>, 
		one advantage of <font class="guitool">binarytree.py</font> is that 
		averages are also shown for the non-terminal branches. 
		A disadvantage is that the height of the branches in the tree are purely relative, 
		and have no bearing to the numerical height of the branch point in the dendrogram
		(and thus the relatedness of the classes).
	    </p>

	    <p> As one proceeds down the tree, the number of classes increases, and 
		the number of particles per class decreases. 
		As is the case with classification in general, 
		there is a tradeoff between too big a class, 
		such that dissimilar particles are combined, and 
		too small a class, where the signal-to-noise ratio is low. 
		One strategy for displaying an appropriate depth is 
		the point at which a parent class's subclasses do not look different than the parent class. 
	    </p>

	    <p> Save the selection file with <I>CTRL-s</I>. 
		Further options for the program are described on the 
		<a href="../../..//techs/MSA/index.htm">
		MSA page</a>.
	    </p>
		
	    <p> The script <A HREF="../binarytree.py"><font class="guitool">binarytree.py</font></A> requires the library 
		<A HREF="../../..//python/spipylib/code/Spiderutils.html">
		Spiderutils.py</A> from the 
		<A HREF="../../../../spire/doc/packages.html">
		<font class="guitool">SPIRE</font></A> installation. 
		If you don't have <font class="guitool">SPIRE</font></A> installed, 
		you can alternatively run <a href="../tree.rct">tree.rct</a>, 
		which generates a (large) SPIDER image, <font class="output">Zerodegr/Tree/tree*</font>. 
		To generate a selection file of class averages, <code class="snippet">cd Zerodegr/Tree</code>, 
		and either categorize the montage of class averages in 
		<font class="guitool">WEB</font> or <font class="guitool">JWEB</font>, 
		or manually create the selection file interactively in SPIDER using 
		<a href="../../..//man/doccreate.html">
		'DOC CREATE'</a>.  The selection file should be called 
		<font class="output">Zerodegr/Tree/goodclasses</font>.
	    </p>
	    
	<li><b><a name="vbv">View the class averages and, optionally, the constituent particles using 
	    <font class="guitool">verifybyview.py</font></a></b></li>
	    
	    <p> This option can be used for any of the classification schemes described above. 
		It can also be used in conjuction with <font class="guitool">binarytree.py</font> to 
		view the individual particles that belong to a class.
	    </p>
	    
	    <p> Open <font class="guitool">verifybyview.py</font> by typing: <BR>
		<code class="snippet">verifybyview Zerodegr/Tree</code> &nbsp; if you used the binary-tree option, or <BR>
		<code class="snippet">verifybyview Zerodegr/Kmeans</code> &nbsp; if you ran K-means classification, or <BR>
		<code class="snippet">verifybyview Zerodegr/Cluster</code> &nbsp; if you used Diday's clustering method, <I>etc.</I>
	    </p>

	    <p> The script <A HREF="../verifybyview.py"><font class="guitool">verifybyview.py</font></A> 
		requires libraries belonging to <font class="guitool">SPIRE</font>. 
		See the <A HREF="../../../../spire/doc/packages.html">
		installation instructions here</a>.
	    </p>
	    
	    <br>Included in the tarball is a starting <a href="../.verifybyview">.verifybyview</a> file 
		with mostly reasonable settings. 
		The primary purpose of that <a href="../.verifybyview">.verifybyview</a> file, however, 
		was to view classes for multireference alignment, so 
		you may wish to change the following 2 settings:
		
		<table class="outs">
		    <tr valign="top"><td>&curren;                                   </td>
			<td><i>Display &gt; <b>reverse order</b></i>:                      </td>
			<td>Toggling this option will display the averages starting from #1.</td></tr>
		    <tr valign="top"><td>&curren;                                   </td>
			<td><I><i>Display &gt; labels &gt; <b>text label</b></i></I>:                      </td>
			<td>Change <I><b>CCC</b></I> to <I><b>N</b></I>
			    for the number of particles in a class.</td></tr>
		</table>

<!--    	    <p> The <a href="../.verifybyview">.verifybyview</a> file is updated with each change. 
		If you make a mistake, or wish to revert to the original, 
		there are copies the of the file included in the tarball, called
		<a href="../.verifybyview.tree">.verifybyview.tree</a> and 
		<a href="../.verifybyview.multiref">.verifybyview.multiref</a>.
	    </p>-->
	    
		If <a href="../.verifybyview">.verifybyview</a> is not present 
		(it is a hidden file, starting with a period, so to list it, type 
		<code class="snippet">ls -a</code> in your toplevel directory), 
		you will need to adjust the filenames. 
		In the initial popup window, the values should be:
	    
		<table class="outs">
                    <tr valign="top"><td>&curren;</td>
                        <td><font class="input">.spi</font>:</td>
                        <td>Data extension. Adjust as necessary</td></tr>
                    <tr valign="top"><td>&curren;</td>
                        <td><font class="input">Zerodegr/Tree</font>:</td>
                        <td>Initial directory.</td></tr>
                    <tr valign="top"><td>&curren;</td>
                        <td><font class="input">listclasses</font>:</td>
                        <td>List of classes.</td></tr>
                    <tr valign="top"><td>&curren;</td>
                        <td><font class="input">classavg***</font>:</td>
                        <td>Class-average template.</td></tr>
		</table>

	    <BR>The first time you click on a class average, 
		a popup menu will appear to confirm filenames, 
		some of which are repeated from the initial popup menu. 
		The key filenames are:
	    
		<table class="outs">
                    <tr valign="top"><td>&curren;</td>
                        <td><font class="input">docclass***.spi</font>:</td>
                        <td>List of particles belonging to each class.</td></tr>
                    <tr valign="top"><td>&curren;</td>
                        <td><font class="input">Zerodegr/Filtered/flt*****.spi</font>:</td>
                        <td>Filtered-image template.</td></tr>
                    <tr valign="top"><td>&curren;</td>
                        <td><font class="output">goodclasses.spi</font>:</td>
                        <td>List of selected classes.</td></tr>
		</table>
	    
	    <p> When you click on a class average 
		(except for the first instance, when a popup menu appears), 
		a montage of individual particles will appear. 
	    <br><U>NOTE</U>: There is a limit of how many images that can be displayed in one montage. 
		Clicking on a class with ~1000 particles will show an error message to the console window.
	    </p>

	    <p> It is unnecessary to verify individual particles at this time. 
		Instead, simply select the class averages that you wish to use for multireference alignment. 
		Select the classes averages by right-clicking on them. 
		When you are finished, save the selection by going to the 
		<I>File</I> menu and selecting <I>Save selection</I> (or <I>ALT-s</I>).
	    </p>
      </ol>


<li><p><b>Run multireference alignment</b></p></li>

    <p>The procedure file <a href="../multirefalign.rct">multirefalign.rct</a> 
	takes the class averages <font class="input">classavg***</font> 
	selected in the previous step in <font class="input">goodclasses</font>, 
	re-centers them, and uses them for multireference alignment. 
	The previously aligned image stack <font class="input">Zerodegr/stk3-aligned</font> 
	is used to generate the reference images 
	(the class averages are derived from filtered images which may have been downsampled), 
	and the unaligned image stack <font class="input">Zerodegr/stk2-winrot</font> 
	will be aligned to those references. 
    </p>
    
    <p><U>NOTE</U>: Ensure that the classification method that you used 
	is reflected in the procedure file label <b><I>[old_class_dir]</I></b>. 
	If you used K-means, for example, use the directory <font class="input">Zerodegr/Kmeans</font>.
	The default in the procedure file is <font class="input">Zerodegr/Tree</font>. 
    </p>
    
    <b>Outputs:</b><br>
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/stkref</font>:</td>
                <td>Stack of reference images used for alignment.
                    <BR>They should resemble full-sized, unfiltered versions of the selected class averages</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/docalign</font>:</td>
                <td>Alignment parameters
                    <BR>See the documentation for 
                    <a href="../../..//man/apsh.html">
                    'AP SH'</a> for an explanation of the doc file.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/selview***</font>:</td>
                <td>A list of particles belonging to each class.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/stkcenu</font>:</td>
                <td>Aligned untilted-specimen image stack.
                    <BR>This copy is retained locally to the <font class="output">Pairwise/</font> directory.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/stk3-aligned</font>:</td>
                <td>Aligned untilted-specimen image stack.
                    <BR>This stack will be overwritten with subsequent alignments.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/viewavg***</font>:</td>
                <td>Average of particles belonging to each reference.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/docmultiref</font>:</td>
                <td>Keeps track of successfully executed iterations of multireference alignment.</td></tr>
	</table>

    <P>
    In addition to the same key <a href="align.htm">alignment parameters</a> as above in 
    <a href="../pairwise.rct">pairwise.rct</a>, 
    you may be interested in some of the consequences of <b><I>[mirror-option]</I></b>, 
    described in my <a href="flipflop.htm">note about mirroring references</a>.
    If this parameter is set to 0 (the default), experimental images are NOT compared to mirrored references. 
    This default is the safe choice.
    </P>
    

<li><p><b>Re-filter aligned images</b></p></li>

    <p> With newly aligned images, we will re-filter and optionally shrink the images before re-classifying them. 
	The newly aligned image stack, <font class="input">Zerodegr/stk3-aligned</font>, 
	overwrote the old version, thus the inputs and outputs of <a href="../filtershrink.rct">filtershrink.rct</a> 
	will remain the same.
    </p>

	<b>Outputs:</b><br>
	
	<table class="outs">
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/stkfiltered</font>:</td>
	    <td>Low-pass, shrunken filtered image stack.</td></tr>
	</table>
	
    <p> Adjust the parameters as necessary, 
	although the parameters used previously should be applicable.
    </p>

<li><p><b>Classify the particles assigned to each reference</b></p></li>

    <p> In the next step, we will perform separate classifications for the particles belonging to each reference. 
	In principle, the particles assigned to each reference should be identical. 
	However, if too few references were chosen, there may be homogeneous subsets assigned to a reference. 
	Also, if there are subtle but systematic structural differences, 
	those difference may be noticeable upon MSA and classification. 
	Also, junk particles (damaged particles or contaminants) may not match any references well. 
    </p>
    
    <p> The procedure file <a href="../classifybyview.rct">classifybyview.rct</a> 
	performs separate classifications on the image stack <font class="input">Zerodegr/stkfiltered</font>
	for each of the selection doc files <font class="input">Zerodegr/Multiref1/selview***</font>. 
	As a rough measure of the quality of each particle and each class average, 
	the cross-correlation coefficient (CCC) is computed against the reference 
	<font class="input">Zerodegr/Multiref1/ref***</font>.
    </p>
    
    <b>Outputs</b>:<br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/listclasses</font>:</td>
                <td>List of classes for all references
                    <BR>Also contains various statistics for each class.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/classavg***</font>:</td>
                <td>Class averages.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref1/docclass***</font>:</td>
                <td>List of particles belonging to each class.</td></tr>
	</table>

	<BR><I>Notable parameters include:</I>
	
	<table class="outs">
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[reduce-factor]</I></b>:                      </td>
		<td>Reduction factor applied in <a href="../filtershrink.rct">filtershrink.rct</a>.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[ca-pca]</I></b>:                      </td>
		<td>Option of CA (option 1), PCA (2), or iterative PCA (3)
		    <BR>One method or another sometimes hangs due to "numerical inaccuracy."
		    I subjectively try CA first, then iterative PCA, then PCA last.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[first-view]</I></b>:                      </td>
		<td>If this procedure file hangs or crashes after <I>N</I> reference-views, 
		    <BR>change the <b><I>[ca-pca]</I></b> option and 
		    re-start the procedure file at <I>N+1</I>.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[num-factors]</I></b>:                      </td>
		<td>Number of factors to calculate in MSA and use in classification. 
		    <BR>The classification does not appear to depend greatly on this value, 
		    but you can check the eigenimages to see if variation is not well-represented.</td></tr>
	</table>
	

<li><p><b>Check the classification results using <font class="guitool">verifybyview</font></b></p></li>

    <p> We will check the results of the classifiaction using <font class="guitool">verifybyview</font>, 
	which requires libraries belonging to <font class="guitool">SPIRE</font>. 
	See the <A HREF="../../../../spire/doc/packages.html">
	installation instructions here</a>.
    </p>
	
    <p> Specifically, what we are looking for is that there is no subpopulation within each reference-view 
	that warrants its own class. 
	So for each reference-view, we will select the distinct class averages, and 
	use those for the next round of multi-reference alignment and classification. 
	If there is only one distinct class for each reference-view, you are finished with this step and 
	can proceed to the step of <a href="#verify">verifying individual particle images</a>.
    </p>

    <p> Open <font class="guitool">verifybyview.py</font> by typing: <BR>
		<code class="snippet">verifybyview Zerodegr/Multiref1</code>
    </p>

    <p> Included in the tarball is a starting <a href="../.verifybyview">.verifybyview</a> file 
	with mostly reasonable settings. 
	However, if you viewed the outputs of <a href="../binarytree.rct">binarytree.rct</a>, 
	<a href="../classavg.rct">classavg.rct</a>, or <a href="../kmeans.rct">kmeans.rct</a>, 
	this file will have been modified.  
<!--    	Either edit the settings, or copy the archived version in the tarball, 
	called <a href="../.verifybyview.multiref">.verifybyview.multiref</a>, 
	to <b>.verifybyview</b>-->
    </p>
    
    The file <a href="../.verifybyview">.verifybyview</a> is present in the 
    <a href="../tar_archive/archive.html">tarball archive</a>, 
    but if absent, you will need to adjust the filenames. 
    In the initial popup window, the values should be:

    <table class="outs">
        <tr valign="top"><td>&curren;</td>
            <td><font class="input">.spi</font>:</td>
            <td>Data extension.</td></tr>
        <tr valign="top"><td>&curren;</td>
            <td><font class="input">Zerodegr/Multiref1</font>:</td>
            <td>Initial directory.</td></tr>
        <tr valign="top"><td>&curren;</td>
            <td><font class="input">listclasses</font>:</td>
            <td>List of classes.</td></tr>
        <tr valign="top"><td>&curren;</td>
            <td><font class="input">classavg***</font>:</td>
            <td>Class-average template.</td></tr>
    </table>

    <BR>The first time you click on a class average, 
	a popup menu will appear to confirm filenames, 
	some of which are repeated from the initial popup menu. 
	(For this popup window, the file extensions are required, 
	but will be omitted from the list below.)
	The key files are:

	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">docclass***</font>:</td>
                <td>List of particles belonging to each class.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Zerodegr/stkfiltered</font>:</td>
                <td>Filtered-image stack.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">goodclasses</font>:</td>
                <td>Output list of selected classes.</td></tr>
	</table>

    <p> When you click on a class average 
	(except for the first instance, when a popup menu appears), 
	a montage of individual particles will appear. 
    </p>

    <p> It is unnecessary to verify individual particles at this time. 
	Instead, simply select the class averages that you wish to use for 
	the next round of multireference alignment. 
	Select the unique classes averages by right-clicking on them. 
	Conversely, do not select similar-looking class averages, 
	which would then be used as separate references in the next round.
	When you are finished with a reference-view, save the selection by going to the 
	<I>File</I> menu and selecting <I>Save selection</I>.
	If there is only one distinct class for each reference-view, 
	proceed to the step of <a href="#verify">verifying individual particle images</a>.
    </p>

    <p> If there is an unwieldy number of classes on the main window of 
    <font class="guitool">verifybyview.py</font>, we can break the into subsets.
    Instead of the command above, type: </P>
                <code class="snippet">verifybyview Zerodegr/Multiref1/View001</code>
                
    <P>...which will show only the classes corresponding to reference 1.  
    You can proceed to the next reference by changing the directory number (e.g., <B>View002</B>)
    and pressing <I>Update</I> (after saving the class selection, if necessary).
    </p>

<li><p><b>Iterate multireference alignment and classification</b></p></li>

    <p> We will iterate multireference alignment, filtration, and classification until 
	we obtain stable classes, <I>i.e.,</I> no new classes appear. 
	For a sample that doesn't have many orientations/conformations, 
	only 2 or 3 iterations should be needed.
    </p>
    
    The specifics in the following example are for the second round of multireference alignment. 
    The 3 steps to be iterated are:
    
      <ol>
	<li><b>Run multireference alignment</b> </li>
	
	<p> The classes selected in the previous round of multireference alignment 
	    will be used as references for the next round. 
	    For example, if you selected a 2 class averages from reference-view #1, 
	    and one class average from reference-view #2, then 
	    this next iteration will have 3 references.
	</p>
	
        <p> The input file <font class="input">docmultiref</font> 
            keeps track of successfully executed iterations of multireference alignment, and is updated. 
            The default parameter <b><I>[multirefIterNum]</I></b> of <I>-1</I> will use 
            the most recent multireference alignment as input.  
            If you do not wish to use the last multireference alignment, 
            override this parameter with the iteration number that you wish to use.
            </p>

	<li><b>Filter the aligned particles</b> </li>
	
	    <p>Run <a href="../filtershrink.rct">filtershrink.rct</a> as previously.</p>
	
	<li><b>Classify the particles assigned to each reference</b> </li>
	
	    <p>Run <a href="../classifybyview.rct">classifybyview.rct</a>, 
                set the parameter <b><I>[multirefIterNum]</I></b> if 
                you do not wish to operate on the last iteration of multireference alignment. 
                This parameter will be present in many steps from this point.</p>
                
        <li><p><b>Check the classification results using <font class="guitool">verifybyview</font></b></p></li>

            <p> Select unique classes using <font class="guitool">verifybyview.py</font> 
                To open it, type: <BR>
                        <code class="snippet">verifybyview Zerodegr/Multiref2/View001</code><BR>
            </p>

            Remember to update number of the directory, i.e., 
            which iteration of multireference alignment you ran.

      </ol>
      
<!--        For a possible third iteration, the following changes would be needed:
      <ol>
	<li>In <a href="../multirefalign-descend.rct">multirefalign-descend.rct</a>, 
	    change input file label <b><I>[old_class_dir]</I></b> from 
	    <font class="input">Zerodegr/Multiref</font> to <font class="input">Zerodegr/Multiref2</font>
	    <BR>An example, <a href="../multirefalign3plus.rct">multirefalign3plus.rct</a>, 
	    is present in the tarball.
	</li>
	<li>In <a href="../classifybyview.rct">classifybyview.rct</a>, 
	    change the label <b><I>[class_dir]</I></b> from 
	    <b>Zerodegr/Multiref2</b> to <b>Zerodegr/Multiref3</b>
	</li>
      </ol>-->
    
    <p> Iterate these 4 steps -- 
        <a href="../multirefalign-descend.rct">multirefalign-descend.rct</a>, 
        <a href="../filtershrink.rct">filtershrink.rct</a>,  
        <a href="../classifybyview.rct">classifybyview.rct</a>, and
        <font class="guitool">verifybyview</font> --
        until no new classes appear. </p>
    
<!--        <p> <U>NOTE</U>: In several steps below, I will assume that you run 2 iterations of multireference alignment. 
	If you ran a different number of iterations, pay attention to when this value is required. 
	There should be reminders in the steps below when to change filenames.
	</p>-->


<li><p><a name="verify"><b>Verify individual particles from last iteration of multireference alignment</a></b></p></li>

    <p> When we compute the 3D reconstruction, we will use only the highest-quality particles. 
	To select these particles, we will use <font class="guitool">verifybyview.py</font>. 
	To start it, assuming you performed 2 rounds of multireference alignment, type: <BR>
	<code class="snippet">verifybyview Zerodegr/Multiref2/View001</code> </p>
	
    <p> You should have screened the class averages in the previous step, so 
	the filenames should be appropriate.  
	In fact, if the last directory where you viewed class averages was one of the 
	<font class="input">Zerodegr/Multiref2/View###</font> directories, 
	you do not need to include the directory name on the command line either.
    </p>
    
    <p> Now, when you open a montage of individual particle images, 
	select the images that you want to keep using the left mouse button. 
	Conversely, exclude the particles that don't resemble the reference image. 
	To crudely assist selection of the images, 
	the particles are sorted from highest CCC to worst. 
	A more thorough description of 
	<a href="../../..//techs/verify/VerifyDocs/interface.htm">
	verifybyview.py can be found here</a>. 
    </p>
    
    <b>Outputs:</b><br>
	
	<table class="outs">
	
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref2/View###/goodclasses</font>:</td>
	    <td>List of classes with selected particles for each reference-view.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref2/View###/byhand***</font>:</td>
	    <td>List of selected particles for each class.</td></tr>
	</table>
    
    <p><U>NOTE:</U> When you finish going through the class averages for a particular reference-view, 
	be sure to save the list of good <U>classes</U> in addition to the list of good particles. 
	The good-class list can be saved by going to the <I>File</I> menu and selecting <I>Save selection</I>, 
	or by clicking on the <I>Save+Update</I> button, or with the shortcut <I>Alt-S</I>
    </p>


<li><p><b>Combine selected particles from selected classes</b></p></li>

    <p> Following the previous step, the selected particles are distributed over 
	multiple docfiles <font class="input">byhand***</font>, 
	listed in <font class="input">goodclasses</font>
	from multiple reference-views <font class="input">Zerodegr/Multiref2/View###</font>
	(once again assuming two iterations of multireference alignment + classification). 
	In this procedure file, <a href="../combinegoodclasses.rct">combinegoodclasses.rct</a>, 
	we will combine the <font class="input">byhand***</font> files into 
	one doc file for each reference-view.
    </p>
    
    <b>Output:</b><br>
    
	<table class="outs">
	
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref2/goodsel***</font>:</td>
	    <td>List of selected particles in each reference-view.</td></tr>
	</table>
	
    <p> If in your final iteration of multireference alignment, 
	you set parameter <b><I>[mirror-option]</I></b> is set to <I>1</I>, 
	there will be additional outputs for the lists of flipped and un-flipped particle images, 
	called <font class="output">goodsel***-flip</font> and <font class="output">goodsel***-noflip</font>, 
	respectively, in the <font class="output">Zerodegr/Multiref2</font> directory.
	See the <a href="flipflop.htm">note about mirroring references</a> for more information.
    </p>
    
<!--    <p> <i>HINT</i>: It may be useful to re-classify only the good particles, 
	if, for example, there's an asymmetry present that is washed out by the bad particles.  
	In that case, re-run classifyview, setting <B><I>[verified-yn]</I></B> to 1, 
	which will read <b>goodsel***</b> instead of <b>selview***</b>.
	You will overwrite the previous classes (but not verified particles), 
	so you may want to change the output filenames, 
	<I>e.g.</I>, add <b>good-</b> to the beginning of the filenames. 
	If you find a new class, using the names of the new doc files, re-run
	<a href="../multirefalign.rct">multirefalign.rct</a>. 
	It might be useful to classify the bad particles too.
    </p>-->
    

<li><p><b>Average selected images</b></p></li>

    <p> In this step, we will generate averages of the good particle images. 
	These new averages should look cleaner than those from the multireference alignment, 
	which also included bad particles. 
	(Because of model bias, however, the bad particles may not have degraded the old average too much.)
    </p>
    
    <p> The procedure file <a href="../viewaverages.rct">viewaverages.rct</a> 
	and its subroutine <a href="../viewaverage1.rct">viewaverage1.rct</a> 
	read the aligned-image stack <font class="input">Zerodegr/stk3-aligned</font> 
	and averages the images according to the good-particle selection files
	<font class="input">Zerodegr/Multiref2/goodsel***</font> 
	(assuming again that you performed 2 rounds of multi-reference alignment).
    </p>
    
    <b>Outputs:</b><br>
    
	<table class="outs">
	
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref2/stkgoodavg</font>:</td>
	    <td>Stack of average images for each view.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref2/stkgoodvar</font>:</td>
	    <td>Stack of variance images for each view.</td></tr>
	</table>

    <p> If in your final iteration of multireference alignment, 
	you set parameter <b><I>[mirror-option]</I></b> is set to <I>1</I>, 
	there will be separate outputs for the flipped and un-flipped particle images, 
	ending in <font class="output">-flip</font> and <font class="output">-noflip</font>, 
	respectively, in the <font class="output">Zerodegr/Multiref2</font> directory.
	See the <a href="flipflop.htm">note about mirroring references</a> for more information.
    </p>
    
<li><p><b>Select well-populated classes</b></p></li>
    
    <p> Following particle-verification, 
	not all of the classes will have an adequate number of particles for a 3D reconstruction.  
	(This exact number will depend on the size, symmetry, etc., of the particle, and 
	on the specimen-preparation technique, i.e., negative stain or cryo.) 
	We will select only the classes with enough particles.
	Type:
	<BR><code class="snippet">cd Zerodegr/Multiref2/ ; montagefromdoc sorted-viewaverage.spi stkgoodavg.spi</code>
	<BR>(assuming you performed 2 rounds of multireference alignment)
	</p>
	
    <p> Set the output filename to <font class="output">goodviews</font>.
        To show the number of particles in each average, 
        set <B><I>doc file column for label</I></B> to <I>2</I>.
	Select the classes for which you wish to compute a 3D reconstruction, 
	and save that selection (e.g., using <I>CTRL-s</I>).
	</p>

	
    
<li><p><b>Center tilted-specimen particles</b></p></li>

    <p> The goal of any 3D reconstruction technique is, for each 2D image, 
    to obtain 2 translational parameters, and 3 orientational parameters.  
    By this stage, we have all 3 orientation parameters. 
    (One is the magnitude of the tilt, 
    the second is the direction of the tilt axis with respect to the coordinate axes, and 
    the third is the in-plane rotation angle of the untilted-specimen images.) 
    The 2D alignment of the untilted-specimen images cannot be applied to the tilted-specimen images, 
    so we will need to translationally align the tilted-specimen images separately.
    </p>

    <p> The procedure file <a href="../centertilt.rct">centertilt.rct</a> 
	uses a reference-free alignment to align the images in stack
	<font class="input">Tilted/stk2-winrot</font> translationally but not rotationally. 
	It is adapted from <a href="../pairwise.rct">pairwise.rct</a>, which was used above.
    </p>
    
    <b>Outputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/Pairwise/stkcentavg</font>:</td>
                <td>Stack of centered intermediate averages.
                    <BR>See note about centering below.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/stk3-cent</font>:</td>
                <td>Stack of translationally aligned tilted-specimen images.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/Pairwise/rfreeavg001</font>:</td>
                <td>Final average of all images.
                    <BR>Note that the images are not rotationally aligned.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/docpairalign</font>:</td>
                <td>Alignment doc file.</td></tr>
	</table>

    <P><U>NOTE</U>: The parameter <b><I>[cg-option]</I></b>, 
    specifies how the center of gravity for the intermediate average will be computed, if at all.  
    The options are:</P>
    
    <OL>
      <LI>No centering performed </LI>
      <LI>Centering performed using <a href="../../..//man/cgph.html">'CG PH'</a> </LI>
      <LI>Centering performed by rotating the image 180 degrees and aligning to itself </LI>
    </OL>
    
    <P>All three options are written to <font class="output">Zerodegr/Pairwise/stkcentavg</font>
    If one is significantly better than the one you used, re-run this with the better option.</P>
        
    <p> If this procedure file runs slowly, you can save time by centering only the selected particles.  
	Change the parameter <b><I>[verified-yn]</I></b> to <I>1</I>. 
	This will change the input from <font class="input">listparticles</font> 
	to <font class="input">Zerodegr/Multiref2/combinedgood</font> 
	(assuming once again that you ran 2 iterations of multireference alignment). 
    </p>
    
    <p> To look at the centered tilted particles, type:<BR>
	<code class="snippet">montagefromdoc listparticles.spi Tilted/stk3-cent.spi</code>
    </p>


<li><p><b>Store Euler angles</b></p></li>

    <p> In this step, the procedure file <a href="../storeangles.rct">storeangles.rct</a>
	collects information about the 3 Euler angles from the 
	micrograph-parameter doc files <font class="input">Micrographs/dcb****</font> 
	and the last multireference alignment doc file 
	<font class="input"> Zerodegr/Multiref#/docalign</font> 
	This Euler-angle doc file will be used in the 3D-reconstruction step.
    </p>
    
    <b>Outputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/dangles</font>:</td>
                <td>Euler-angle doc file to be used for the 3D reconstruction.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/dang-unrot</font>:</td>
                <td>More informative Euler-angle doc file for instructional purposes.
                    <BR>See <a href="eulers.htm">note about Euler angles</a>.</td></tr>
	</table>
	
    <p> Changing parameter <b><I>[mirror-yn]</I></b> will reverse the handedness of the structure. 
	Whether this flag should be set to 0 or 1 depends on numerous variables in the data collection and processing, 
	such as the direction in which the goniometer is rotated, how the micrographs are digitized, <I>etc.</I> 
	Unfortunately, it is difficult to determine from first principles whether the handedness needs to be flipped, 
	so the safest way to know how to set this parameter is to generate a RCT reconstruction of a sample with known handedness.  
	Once the data-collection &amp; image-processing conventions are set, change them as seldom as possible, or else 
	you may need to re-test for flips in handedness.
    </p>


<li><p><b>[Optional] Generate symmetry files</b></p></li>

    <p> This step is primarily for the 
        <a href= "../../..//protocol_download.html">
        Nature Protocols RCT data set</a>, but can be tailored for other symmetric samples. 
        The procedure file <a href="../d6symmetry.rct">d6symmetry.rct</a> will generate files that 
        contain the Euler angles for equivalent positions in each asymmetric unit. 
    </p>

    <p> The worm hemoglobin used in the Nature Protocols data set has D6 symmetry, 
        and has two main types of views: top views and side views. 
        There were also 4 particles that were neither top views nor side views, 
        but they will not be used for the reconstruction. 
        Also, there were two types of side views in that data set, but 
        both can use the identical symmetry file since 
        the symmetry axis is in the same direction in both.
    </p>
    
    <b>Outputs:</b><br>

        <table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">d6top</font>:</td>
                <td>Symmetry doc file where the 6-fold axis is along <I>z</I>.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">d6side</font>:</td>
                <td>Symmetry doc file where the 6-fold axis is in the <I>xy</I> plane.</td></tr>
        </table>
        
    <p> To generate a doc file corresponding to a different symmetry, use the command 
        <a href="../../..//man/sy.html">
        'SY DOC'</a>.
    </p>


<li><p><b>Compute 3D reconstructions for each class</b></p></li>
    
    <p> The procedure file <a href="../bpclass.rct">bpclass.rct</a> and 
	its subroutine <a href="../bp3f.rct">bp3f.rct</a> will compute 3D reconstructions for each class, 
	whose particles are listed in each <font class="input">Zerodegr/Multiref#/goodsel***</font>, 
	The aligned tilted-specimen images <font class="input">Tilted/Aligned/cent*****</font> 
	will be reconstructed using the Euler angles found in <font class="input">Tilted/dangles</font>. 
	An optional symmetry file can be given, but 
	in the absence of symmetry the default <font class="input">*</font> is given.
    </p>
    
    <b>Outputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/vcla***</font>:</td>
                <td>Reconstructions for each class.</td></tr>
	</table>
    
    <p> For the <a href= "../../..//protocol_download.html">Nature Protocols RCT data set</a>, 
	instead run <a href="../bpclass.rct">bpclass.rct</a>.
	Make sure that the parameters <B><I>[sideViewClassA]</I></B> and <B><I>[sideViewClassB]</I></B> 
	(by default in the procedure file, classes 1 &amp; 2) correspond to side views, 
	to which the side-view symmetry file <font class="input">Volumes/d6side</font> will be applied.
	Similarly, make sure that the parameter <B><I>[topViewClass]</I></B> corresponds to the top view, 
	(by default, class 4) to which the top-view symmetry file <font class="input">Volumes/d6top</font> 
	will be applied. 
    </p>
	

<li><p><b>Filter 3D reconstructions</b></p></li>

    <p> The procedure file <a href="../volfilt.rct">volfilt.rct</a> Fourier filters one or all reconstructions 
	<font class="input">Volumes/vcla***</font>. 
     </p>
   
   <b>Outputs:</b><br>

	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/vflt***</font>:</td>
                <td>Filtered reconstructions.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/docvolfilt</font>:</td>
                <td>Editable doc file containing filter parameters.
                    <BR>See note below.</td></tr>
	</table>
	
	<BR><I>Parameters:</I>
	
	<table class="outs">
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[single-class]</I></b>:                      </td>
		<td>Class number whose reconstruction will be filtered.
		    <BR>The default value of <b><I>0</I></b> will filter all class volumes.
		    <BR>To filter a single volume, perhaps to fine-tune a specific class, 
		        enter the number of that class</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[header-type]</I></b>
		    <BR><b><I>[header-param1]</I></b>
		    <BR><b><I>[header-param2]</I></b>:                      </td>
		<td>Filter parameters.
		    <BR>The defaults, respectively, are <b><I>7</I></b> (for Butterworth low-pass) 
		    <BR>and <b><I>37.6</I></b> &amp; <b><I>28.2</I></b> f
			or pass-band and stop-band (in Angstroms)</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[override-yn]</I></b>:                      </td>
		<td>If pre-existing doc file <font class="output">Volumes/docvolfilt</font> exists, setting this parameter to <I>1</I>
		    <BR>will override the filter parameters in the batch-file header and will use the values in the docfile instead.
		    <BR>More below.</td></tr>
	</table>
	
    <p> The reason for the usage of the file <font class="output">Volumes/docvolfilt</font> is that 
	you may want to fine-tune the filter parameters for a single class volume 
	without having to filter all of them. 
	Also, it may be the case that different class volumes warrant different filter parameters 
	(if, for example, the number of particles varies). 
	This doc file can serve as a record of what filter parameters were used.
    </p>


<li><p><b>[Optional] Run projection onto convex sets (POCS)</b></p>

    <p> Detailed <a href="misc.htm#pocs">information about POCS can be found here</a>. 
	Briefly, POCS is an iterative way to try to minimize the effects of the missing cone. 
	<BR>The steps involved in POCS are:
    </p>
    
      <ol>
	<li>Generate a binary mask</li>
	<li>[Optional] Choose a projection by which to gauge the progress of POCS</li>
	<li>Run POCS</li>
      </ol>

<li><p><b>[If multiple classes] Align volumes to each other</b></p>
    
    <p> If you have multiple classes, it remains to be seen whether the classes correspond to the same structure. 
	You should have a rough idea after playing with the volumes in Chimera. 
	The procedure file <a href="../volalignprj.rct">volalignprj.rct</a> and 
	its subroutine <a href="../montageprj.rct">montageprj.rct</a> 
	attempt to find a rigorous alignment between two volumes 
	<font class="input">Volumes/vflt***</font> (or <font class="input">Volumes/volpocs***-filt</font>). 
    </p>
    
    <p>Note that this procedure file aligns two volumes to each other.
       Choose one volume as an alignment reference, to which the rest of class volumes will be aligned.  
       After an initial alignment using a coarse search grid using 
       <a href="../../..//man/pj3q.html">'PJ 3Q'</a>,
       a finer search will be performed using
       <a href="../../..//man/or3q.html">'OR 3Q'</a>
       (which needs an initial estimate for optimal function).
    </p>

    <I>Parameters:</I>
	
	<table class="outs">
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[exp-num]</I></b>:                      </td>
		<td>Class number for the volume to be aligned.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[ref-num]</I></b>:                      </td>
		<td>Class number for the reference volume.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[num-solns]</I></b>:                      </td>
		<td>Number of solutions that you wish to compare (as 2D projections)
		    <BR>Note that multiple solutions may converge to the same refined solution.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[dtheta]</I></b>:                      </td>
		<td>Angular increment for coarse search.
		    <BR>A value of 15 degrees corresponds to 83 projection directions.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[shift-range]</I></b>, 
		    <b><I>[shift-step]</I></b>, 
		    <b><I>[first-ring]</I></b>:                      </td>
		<td>2D search parameters as described in 
		    <a href="../../..//man/apsh.html">
		    'AP SH'</a>.</td></tr>
	</table>

    <BR><b>Outputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/Alignment/dalv***</font>:</td>
                <td>Doc file with initial and refined alignment parameters.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/Alignment/vali***</font>:</td>
                <td>Aligned class volume.
                    <BR>Only written for the best match, but see note below.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/Alignment/mproj</font>:</td>
                <td>Stack file of projections for each projection direction, 
                    and for the best <b><I>[num-solns]</I></b> solutions.
                    <BR>More below.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/Alignment/prj_***</font>:</td>
                <td>Reprojections of the reference and experimental volumes.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/Alignment/list2merge</font>:</td>
                <td>Editable list of aligned class volumes with preferred alignment solution.
                    <BR>More below.</td></tr>
	</table>

    <p>The first row of each slice in <b>mproj***</b> shows the reference projection. 
       Each additional row corresponds to one alignment solution, from "best" to "worst." 
       The left-hand image is the re-projection following the initial, coarse alignment, and 
       the right-hand image is the re-projection following the refined alignment using 
       <a href="../../..//man/or3q.html">'OR 3Q'</a>.</p>
    
    <p>If the better alignment solution is not solution #1, then 
       edit in <font class="output">Volumes/Alignment/list2merge</font> column #2, labelled <I>SOLUTIONNUM</I>.  
       If you do wish exclude the aligned class volume in the merging step altogether, 
       set this value to <I>0</I> in <font class="output">Volumes/Alignment/list2merge</font>.</p>
       
    <p> The aligned class volume <font class="output">Volumes/Alignment/vali***</font> 
	is written only for the bit fit as judged by CCC, but 
	the lower-ranked solutions can be used when merging the class volumes as described above 
	by editing the <font class="output">Volumes/Alignment/list2merge</font> file.
	A class volume using your preferred volume-alignment parameters can be optionally written 
	in the next step, <a href="../mergevols.rct">mergevols.rct</a>, 
	by setting the parameter in that procedure file <b><I>[classvols-yn]</I></b> is set to <b><I>1</I></b>. 
    </p>
    
    <p>The re-projections <b>prj_***</b> will illustrate the missing-cone artifact better than 
       isosurface presentations.</p>


<li><p><b>[Optional] Merged particles from aligned class volumes into one reconstruction</b></p></li>

    <p> You will need to decide subjectively whether the aligned class volumes are sufficiently similar to merge. 
	The procedure file <a href="../mergevols.rct">mergevols.rct</a> combines data from many steps.</p>
	
    <b>Inputs:</b><br>
    
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Tilted/stk3-cent</font>:</td>
                <td>Aligned-image stack.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Zerodegr/Multiref#/goodsel***</font>:</td>
                <td>Good-particle selection files.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Tilted/dangles</font>:</td>
                <td>Euler-angle doc file.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Volumes/Alignment/dalv***</font>:</td>
                <td>Volume-alignment doc files.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Volumes/Alignment/list2merge</font>:</td>
                <td>List of classes to merge.</td></tr>
	</table>
	
    <BR><b>Outputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/dang-merged</font>:</td>
                <td>Euler angles taking into account the volume alignment.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Zerodegr/Multiref#/mergedsel</font>:</td>
                <td>Selection file containing particle numbers for merged classes.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/vtot999</font>:</td>
                <td>Merged reconstruction.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Volumes/vtot999-flt</font>:</td>
                <td>Filtered merged reconstruction.</td></tr>
	</table>
	
    <p>If the parameter <b><I>[classvols-yn]</I></b> is set to <b><I>1</I></b>, 
       volumes for each class will be reconstructed of the form <font class="output">Volumes/vtot***</font>,
       using the merged Euler angles. 
       They should look very similar to the <b>vali***</b> reconstructions from the previous step, 
       <a href="../volalignprj.rct">volalignprj.rct</a>, although 
       in this case the volume will have undergone one fewer interpolation. 
       Also, if you did use the best-fit solution in <a href="../volalignprj.rct">volalignprj.rct</a>, 
       then this aligned class volume will be the only version.
    </p>
    
    <p>Filter parameters are used like in <a href="../volfilt.rct">volfilt.rct</a> above.</p>
    

<li><p><b>Prepare files for reference-based alignment</b></p></li>

    <p> Now that you have a low-resolution structure to used a reference, 
	you can use model-based alignment to perform subsequent alignments. 
    </p>
    
    <p> Before running the next procedure file, 
	download the latest reference-based alignment tarball 
	(<a href="../../..//techs/recon/batcharch">from here</a>) 
	and unpackage by typing:
	<BR><code class="snippet">tar -zxvf spiproject.tar.gz</code> &nbsp; (substituting the name of the tarball as needed).
    </p>
    
    <p> The tarball will create a directory called <font class="output">myproject/</font>
	<BR>For the example here, it will be assumed that the tarball was extracted while in the toplevel RCT directory, 
	in which case <font class="output">myproject/</font> is a subdirectory. 
	Feel free to change the name, but remember to change it in the ensuing procedure file.
    </p>
    
    <p> The procedure file <a href="../prepare-prjmatch.rct">prepare-prjmatch.rct</a> 
	converts the files from the RCT protocol into a form that can be used 
	in the reference-based alignment protocol.
    </p>
    
    <b>Inputs:</b><br>
	
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">params</font>:</td>
                <td>Parameter doc file.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Volumes/vtot999-flt</font> :</td>
                <td>Filtered, merged volume
                    <BR>If you didn't merge classes, 
                    use a <font class="input">Volumes/vflt***</font> class volume.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">docmicpairs</font>:</td>
                <td>Micrograph-pairing doc file.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">listparticles</font>:</td>
                <td>List of particles.
                    <BR>See note below.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">order_picked</font>:</td>
                <td>micrograph-to-particle lookup-table.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Micrographs/dct****</font>:</td>
                <td>Tilted-specimen coordinates doc file.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="input">Tilted/stk2-winrot</font>:</td>
                <td>Tilted-specimen particle image stack.
                    <BR>See note below.</td></tr>
	</table>
	
	<p> The total list of particles <font class="input">listparticles</font> will be used 
	    instead of only the particles that were included in the reconstruction 
	    in case the previously-excluded particles can have their orientations determined 
	    now that there is a model.
	</p>

	<p> Only the tilted particles will be used in the projection-matching step. 
	    With the untilted particles, most likely they would be overrepresented, 
	    which would cause problems in the reconstruction. 
	    Also, instead of <font class="input">Tilted/stk2-winrot</font>, 
	    you could opt to use <font class="input">Tilted/stk0-unrot</font>, 
	    which have undergone one fewer interpolation. 
	    However, if you needed to high-pass filter the <b>stk2-winrot</b> images, 
	    you will need to go back and filter the <b>stk0-unrot</b> images similarly.
	</p>
	
	<b>Outputs</b> (assumed to be in <font class="output">myproject/</font>):<br>
	    
	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">params</font>:</td>
                <td>Parameter doc file (identical to input).</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">reference_volume</font>:</td>
                <td>Reference volume.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Power_Spectra/sel_group</font>:</td>
                <td>Dummy list of defocus groups.
                    <BR>See note about CTF-correction below.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">sel_micrograph</font>:</td>
                <td>List of micrographs.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Power_Spectra/def_avg</font>:</td>
                <td>Dummy list of defocus values.
                    <BR>See note about CTF-correction below.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Particles/win/winser_****</font>:</td>
                <td>Particle stacks, for each micrograph.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Particles/good/ngood****</font>:</td>
                <td>Particle selection doc file, for each micrograph.
                    <BR>If you plan to re-verify the particles, 
                    instead call these files <font class="output">Particles/win/sel_particle_****</font>.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Particles/coords/sndc****</font>:</td>
                <td>Coordinate doc files.</td></tr>
	</table>

	<p> As of yet, CTF-correction is not implemented in this RCT implementation. 
	    A few dummy files related to defocus and defocus groups 
	    will be written by <a href="../prepare-prjmatch.rct">prepare-prjmatch.rct</a> anyway. 
	    (Set your expectations for the resulting reconstruction accordingly.) 
	    When you reach a step where there is an option to account for the CTF or not, 
	    be sure to use the option that disregards the CTF, namely 
	    <a href="../../../techs/recon/newprogs/apsh.spi">
	    apsh.spi</a> instead of 
	    <a href="../../../techs/recon/newprogs/apshgrp.spi">
	    apshgrp.spi</a>. 
	</p>
	
	<p> You should now have the files in a form that can be understood by the 
	    <a href="../../../techs/recon/mr.html">
	    reference-based alignment protocol.</a>

	    Begin with the section entitled 
	    <a href="../../../techs/recon/mr.html#SH">
	    "Alignment"</a> with the step 
	    <a href="../../../techs/recon/newprogs/sel_by_group.spi">
	    sel_by_group.spi</a>. 
	    If you are going to re-verify the particles 
	    (in which case you should have named the output particle lists 
	    <font class="output">Particles/win/sel_particle_****</font> 
	    instead of <font class="output">Particles/good/ngood****</font>), 
	    then you should begin in the section entitled 
	    "<a href="../../../techs/recon/mr.html#AUTO">Particle 
	    Picking and Selection</a>" with either the (optional) step 
	    <a href="../../../techs/recon/newprogs/pfilt.spi">
	    pfilt.spi</a> or 
	    the next step, entitled <b>"Verify the automatically selected particles"</b>. 
	    Alternatively, if you are going to use 
	    <a href="../../../techs/verify/batch/instr-apsh.htm">
	    classification-based particle verification</a>, then begin in the section entitled 
	    "<a href="../../../techs/verify/batch/instr-apsh.htm#particles">Particle-picking</a>"
	    with the step 
	    <a href="../../../techs/verify/batch/Particles/numberparticles.spi">
	    numberparticles.spi</a>.
	</p>
	
	<p>Good luck!</p>
</ul>

<hr />

<b><p><a name="misc"><a href="misc.htm">Miscellaneous procedure files</a></a></p></b>

<ul>
    <li><a href="misc.htm#pocs">Projection onto convex sets</a></li>
    <li><a href="misc.htm#other">Other procedure files</a> -- under construction</li>
</ul>

<hr />

<b><p><a name="mods">Modifications log</a></p></b>

<ul>
    <li>2015-08-13 -- refproj.rct shows power spectra of re-projections, to illustrate missing cone</li>
    <li>2015-08-10 -- classes from multirefalign.rct and classifybyview.rct can be viewed (and selected) all at the same time</li>
    <li>2015-08-06 -- centering of tilted images now uses pyramidal scheme</li>
    <li>2015-08-05 -- pairwise.rct and centertilt.rct draw circles on averages corresponding to inner and outer alignment radii</li>
    <li>2015-08-05 -- ca-pca.rct and classifybyview.rct get image dimension automatically
    <li>2015-07-29 -- windowparticles.rct allows choice of selected noise image from makesomenoise.rct
    <li>2015-07-16 -- separated Nature Protocols reconstruction procedure, bpwormhb.rct, from bpclass.rct</li>
    <li>2015-07-16 -- number of CPUs is now user-defined</li>
    <li>2015-07-14 -- added procedure and Python script to covert from EMAN2's e2RCTboxer.py (under construction)</li>
    <li>2015-03-17 -- bug fix in volalignprj/montageprj</li>
    <li>2014-03-06 -- using stacks for the windowed particles</li>
    <li>2014-03-06 -- changed assumed extension to '.spi'. 
                  <BR>(Conversion/display programs sometimes expect this extension for SPIDER files.)</li>
    <li>2014-03-04 -- automatically looks for last iteration of multireference alignment</li>
    <li>2014-02-04 -- pairwise.spi -- using named registers, error-checking for alignment radius</li>
    <li>2013-12-12 -- tar archive, cosmetic changes       </li>
    <li>2012-12-20 -- posted to local Techniques directory</li>
    <li>2012-12-20 -- made SPIRE configuration file       </li>
</ul>

<hr />

<b><p><a name="refs">References</a></p></b>
<ol>
    <a name="jf2006">
    <li>Frank J. (2006) 
        <I>Three-Dimensional Electron Microscopy of Macromolecular Assemblies</I>.
        (Oxford University Press, New York, NY).</li>
    </a>
    <li>Marco S, Chagoyen M, de la Fraga LG, Carazo JM, Carrascosa JL. (1996) 
        A variant to the random approximation of the reference-free algorithm.
        <I>Ultramicroscopy</I> <b>66</b>: 5-10.</li>
    <a name="mr1987">
    <li>Radermacher M, Wagenknecht T, Verschoor A, Frank J. 
        (1987) Three-dimensional reconstruction from a single-exposure, random conical tilt series applied to 
        the 50S ribosomal subunit of <I>Escherichia coli</I>.
        <I>J Microsc.</I>  <b>146</b>:113-36.</li>
    </a>
<!--    <li>AUTHOR 1, AUTHOR 2. (YEAR) 
        TITLE.
        <I>JOURNAL</I> <b>VOLUME</b>: PG0-PG.</li>-->
    <li>Shaikh TR, LeBarron JS, Trujillo R, Baxter WT, and Frank J. (2008a) 
        Particle-verification for single-particle reconstruction using multivariate data analysis and classification.
        <I>J Struct Biol </I> <b>161</b>: 41-48.</li>
    <li>Shaikh TR, Gao H, Baxter WT, Asturias F, Boisset N, Leith A, and Frank J. (2008b) 
        SPIDER image-processing for single-particle reconstruction of biological macromolecules from electron micrographs.
        <I>Nature Protocols</I> <b>3</b>: 1941-74.</li>
    <li>Huang T, Shaikh TR, Gupta K, Contreras-Martin LM, Grassucci RA, Van Duyne GD, Frank J, Belfort M .
        (2011) The group II intron ribonucleoprotein precursor is a large, loosely packed structure. 
        <I>Nucleic Acids Res.</I> <b>39</b>: 2845-54.</li>
</ol>

<hr />

<small>
  <p>
  Source: rct.htm          &nbsp;&nbsp;&nbsp;
  Page updated: 2015/07/29 &nbsp;&nbsp;&nbsp;
  Tapu Shaikh
  </p>

  <p>
  <address>
  Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a>
  </address>
  </p>
</small>

</body>
</html>
@


1.8
log
@Using stacked images for many outputs
@
text
@d55 4
a58 3
    <li><a href="eulers.htm">A note about Euler angles in RCT</a>, and 
	<a href="../../../euler.html">
	general information about Euler angles</a>.</li>
d70 1
a70 1
	Nature Protocols data set</a>.</li>
d73 1
a73 1
	<a href="../../../techs/recon1/Docs/params.html"> reconstruction parameters</a>.</li>
d170 1
a170 1
    <li>spider rct/dat @@makeparams (or copy <b>params.spi</b>)</li>
d173 2
a174 2
    <li>(for non-SPIDER format micrographs) spider rct/dat @@convert</li>
    <li>spider rct/dat @@shrinkmics</li>
d176 2
a177 2
    <li>spider rct/dat @@micpair</li>
    <li>(required for JWEB) spider rct/dat @@padmics</li>
d179 2
a180 2
    <li>spider rct/dat @@makesomenoise (or copy <b>noise.spi</b>) </li>
    <li>spider rct/dat @@windowparticles</li>
d183 2
a184 2
	    <li>spider rct/dat @@highpass-untilted</li>
	    <li>spider rct/dat @@highpass-tilted</li>
d187 1
a187 1
    <li>(if necessary) spider rct/dat @@removebad</li>
d189 2
a190 2
    <li>(if necessary) spider rct/dat @@removebad</li>
    <li>(slow) spider rct/dat @@pairwise</li>
d193 2
a194 2
	    <li>spider rct/dat @@reorientavg</li>
	    <li>spider rct/dat @@sumalign</li>
d196 2
a197 2
    <li>spider rct/dat @@filtershrink</li>
    <li>spider rct/dat @@ca-pca</li>
d200 3
a202 3
	    <li>spider rct/dat @@hierarchical</li>
	    <li>spider rct/dat @@binarytree</li>
	    <li>cd Zerodegr/Tree ; ../../tree labeled001.spi 6 goodclasses.spi</li>
d206 3
a208 3
	    <li>spider rct/dat @@multirefalign (@@multirefalign-descend after the first iteration)</li> 
	    <li>spider rct/dat @@filtershrink</li> 
	    <li>spider rct/dat @@classifybyview</li>
d211 7
a217 7
    <li>spider rct/dat @@combinegoodclasses</li> 
    <li>spider rct/dat @@viewaverages</li> 
    <li>spider rct/dat @@centertilt</li>
    <li>spider rct/dat @@storeangles</li>
    <li>(optional) spider rct/dat @@d6symmetry</li>
    <li>spider rct/dat @@bpclass</li>
    <li>spider rct/dat @@volfilt</li>
d220 2
a221 2
	    <li>spider rct/dat @@volalignprj</li>
	    <li>spider rct/dat @@mergevols</li>
d223 1
a223 1
    <li>spider rct/dat @@prepare-prjmatch</li>
d245 1
a245 1
	<a href="../convert.rct">convert.rct</a> for the conversion. </li>
d288 1
a288 1
   <code class="snippet">spider rct/dat @@proc</code> <br />
d348 1
a348 1
		    <a href="../../../techs/recon1/Docs/params.html">
d362 1
a362 1
		<BR>See <a href="../../../techs/recon1/Docs/params.html">
d399 2
a400 1
        The syntax to make a file list of TIFF-format micrographs would be: </p>
d418 1
a418 1
        in SPIDER using <a href="../convert.rct">convert.rct</a>, or 
d422 1
a422 1
        <li><P> The procedure file <a href="../convert.rct">convert.rct</a>, 
d428 1
a428 1
            <a href="../../..//techs/recon1/Docs/params.html">
d438 3
a440 3
        
        <LI><P>XMIPP is convenient for converting MRC stacks, which 
            is a convenient format written by CCD cameras.  
d501 2
a502 1
        If you do the latter, remember to update your <a href="../../../techs/recon1/Docs/params.html">params</a> file.
d508 1
a508 1
    <p> Not all of the tilt pairs will be usable, so we will screen them. 
d516 2
a517 2
	<font class="input">.montagefromdoc</font> with reasonable settings. 
	The output selection docfile should be the same as the input, 
d522 7
d597 1
a597 5
		    Do <U>NOT</U> resize the micrographs using <I>Edit</I> &gt; <I>Resize</I>, 
		    for ease of use with the procedure files below.  
		    If you want to adjust the size of the micrographs, 
		    instead go back and re-run <a href="../shrinkmics.rct">shrinkmics.rct</a> and 
		    <a href="../padmics.rct">padmics.rct</a>.</li>
d599 3
a601 1
		<li>In the <I>Marker File Number</I> field, enter the number of the <U>UN</U>tilted micrograph.</li>
d606 1
a606 2
		    separated as far as possible in the micrograph, 
		    ideally in the four corners, but the farther apart the better. 
d637 1
a637 1
		    continue to use the parameter <I><b>[decimation-factor]</b></I> that you used in 
d643 3
a645 1
		    enter the number of the <U>UN</U>tilted micrograph and click <I>ACCEPT</I>.</li>
d650 1
a650 1
		    ideally in the four corners, but the farther apart the better.</li>
d667 1
a667 1
		<li>There is no <I>Save Marker Files</I> button in the current verion of WEB.
d686 3
a688 8
		<li>To expand on the previous point, 
			if will help to work perpendicular to the tilt axis after your initial fit of angles. 
			(You should notice the direction of your tilt axis after some experience picking tilt pairs.)
			After re-fitting the angles, the relation between the micrographs will be determined better, and 
			will make picking additional tilt pairs easier.</li>
	    <li>If you close a pair or micrographs and re-open them
		(with the appropriate <I>Marker File Number</I>), 
		you can resume from where you left off.</li>
d709 1
a709 1
	<td>An automatically-selected noise reference image.</td></tr>
d711 1
a711 1
	<td><font class="output">tmpnoise/noi***</font>:</td>
d718 8
a725 2
	Alternatively, you can copy a pre-existing noise reference from another project to 
	<font class="output">noise.spi</font>.</p>
d739 1
a739 1
    <p> For the parameter <b><I>[decimation-factor]</I></b>, 
d742 1
a742 2
	(and padded in <a href="../padmics.rct">padmics.rct</a>), then 
	use the reduction factor used in that step. 
d748 1
a748 1
	Ultimately, this parameter needs to be the factor between 
d870 5
d879 3
a881 3
                <td><font class="output">Zerodegr/Pairwise/cenu</font>:</td>
                <td>Aligned untilted-specimen image stack.
                    <BR>This copy is retained locally to the <font class="output">Pairwise/</font> directory.</td></tr>
d884 1
a884 1
                <td>Average of all images.</td></tr>
d886 1
a886 1
                <td><font class="output">Zerodegr/Pairwise/docpairalign</font>:</td>
d890 2
d928 1
a928 1
	    enter it as parameter <I><b>X10</b></I> in <a href="../sumalign.rct">sumalign.rct</a>.
d950 1
a950 1
                    <td><font class="output">Zerodegr/Pairwise/dalu001</font>:</td>
d971 1
a971 1
                <td><font class="output">Zerodegr/stk4-filtered</font>:</td>
d977 1
a977 1
	    <BR><code class="snippet">montagefromdoc listparticles.spi Zerodegr/stk4-filtered.spi</code></p>
d988 1
a988 1
	In principle, one can classify the image stack <font class="input">Zerodegr/stk4-filtered</font> 
d1072 1
a1072 1
	choose the number of factors to use (parameter <I><b>x27</b></I>) 
d1081 1
a1081 1
	multireference data analaysis</a> page.)
d1127 1
a1127 1
			    averaging the image stack <font class="input">Zerodegr/stk4-filtered</font>.
d1170 1
a1170 1
			The number of classes desired is specified by the parameter <I><b>x20</b></I> in 
d1203 3
a1205 3
		<font class="input">Zerodegr/MSA/cas_IMC</font> and, in one step, 
		generates <I>K</I> (parameter <I><b>x20</I></b> in the procedure file) classes 
		from the image stack <font class="input">Zerodegr/stk4-filtered</font>.
d1312 1
a1312 1
		<BR><code class="snippet">binarytree labeled001.spi 6 goodclasses.spi</code>
d1315 1
a1315 1
	    <p> The parameter <b><I>6</I></b> on the command line above specifies 
d1323 1
a1323 1
		averages are shown for the non-terminal branches. 
d1325 2
a1326 1
		and have no bearing to the numerical height of the branch point in the dendrogram.
d1454 1
a1454 1
		<I>File</I> menu and selecting <I>Save selection</I>.
d1481 2
a1482 2
                <td><font class="output">Zerodegr/Multiref1/ref***</font>:</td>
                <td>Reference images used for alignment.
d1494 4
a1501 4
                <td><font class="output">Zerodegr/Multiref1/cenu</font>:</td>
                <td>Aligned untilted-specimen image stack.
                    <BR>This copy is retained locally to the <font class="output">Pairwise/</font> directory.</td></tr>
            <tr valign="top"><td>&curren;</td>
d1505 2
a1506 2
                <td><font class="output">Zerodegr/docmultiref1</font>:</td>
                <td>Keeps track of executed iterations of multireference alignment.</td></tr>
d1509 8
a1516 1
    <BR><I>Some notable parameters:</I>
a1517 16
	<table class="outs">
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[cg-option]</I></b>:                      </td>
		<td>If set to <I>1</I> (the default), 
		    the center of gravity for each reference is computed using 
		    <a href="../../..//man/cgph.html">'CG PH'</a>. 
		    <BR>Using negative-stain data, this option may not work well.  
		    <BR>You can look at the <b>Zerodegr/Multiref1/ref***</b> files during the 
		    (slow) multi-reference alignment is running to check if they are centered well.</td></tr>
	    <tr valign="top"><td>&curren;                                   </td>
		<td><b><I>[mirror-option]</I></b>:                      </td>
		<td>If this is set to 0 (the default), 
		    experimental images are NOT compared to mirrored references.  
		    <BR>See the <a href="flipflop.htm">note about mirroring references</a>.</td></tr>
	</table>

d1521 1
a1521 1
    <p> With newly aligned images, we will re-filter, and optionally shrink the images before re-classifying them. 
d1531 1
a1531 1
	    <td><font class="output">Zerodegr/stk4-filtered</font>:</td>
d1550 1
a1550 1
	performs separate classifications on the image stack <font class="input">Zerodegr/stk4-filtered</font>
d1553 1
a1553 1
	the cross-correlation coefficient (CCC) is coputed against the reference 
d1557 1
a1557 2
    <b>Outputs</b> 
    (with separate directories <font class="output">Zerodegr/Multiref1/View###</font> for each view):<br>
d1561 3
a1563 3
                <td><font class="output">Zerodegr/Multiref1/View###/listclasses</font>:</td>
                <td>List of classes for each reference-view's classification
                    <BR>Also contains various stats for each class.</td></tr>
d1565 2
a1566 2
                <td><font class="output">Zerodegr/Multiref1/View###/classavg***</font>:</td>
                <td>Class average.</td></tr>
d1568 1
a1568 1
                <td><font class="output">Zerodegr/Multiref1/View###/docclass***</font>:</td>
d1581 1
a1581 1
		    <BR>One method or another sometimes crashes due to "numerical inaccuracy."
d1585 1
a1585 1
		<td>If this procedure file crashes after <I>N</I> reference-views, 
d1613 1
a1613 1
		<code class="snippet">verifybyview Zerodegr/Multiref1/View001</code>
d1626 2
a1627 1
    The file <a href="../.verifybyview">.verifybyview</a> is required, 
d1636 1
a1636 1
            <td><font class="input">Zerodegr/Multiref1/View001</font>:</td>
d1658 2
a1659 2
                <td><font class="input">Zerodegr/Filtered/flt*****</font>:</td>
                <td>Filtered-image template.</td></tr>
d1682 10
a1712 13
	The procedure file <a href="../multirefalign-descend.rct">multirefalign-descend.rct</a> 
	    is a copy of <a href="../multirefalign.rct">multirefalign.rct</a> used previously 
	    except for the following key differences (not an exhaustive list):
	    
	    <ul>
		<li>The input file label <b><I>[old_class_dir]</I></b> 
		    <font class="input">Zerodegr/Tree</font> (in the binary-tree option was used) 
		    is instead <font class="input">Zerodegr/Multiref#</font></li>
                <li>The parameter <b><I>[subdir-flag]</I></b> is set to <I>1</I> 
                    to tell the procedure file to look in the 
                    <font class="input">View###</font> subdirectories</li> 
	    </ul>
	    
d1714 2
a1715 2
            keeps track of executed iterations of multireference alignment, and is updated. 
            The default parameter <b><I>[multiref-iter]</I></b> of <I>-1</I> will use 
d1728 1
a1728 1
                setting the parameter <b><I>[multiref-iter]</I></b> if 
d1843 1
a1843 1
    <p> <i>HINT</i>: It may be useful to re-classify only the good particles, 
d1845 4
a1848 2
	In that case, re-run classifyview using <b>goodsel***</b> instead of <b>selview***</b>.
	Change the output filenames, so that they don't overwrite previous classification output, 
d1851 3
a1853 3
	<a href="../multirefalign-descend.rct">multirefalign-descend.rct</a>. 
	It could be useful to classify the bad particles too.
    </p>
d1904 5
a1908 4
    <p> Set the output filename to <font class="output">listviews</font>, and
	set <B><I>doc file column for label</I></B> to <I>2</I> 
	in order to show the number of particles in each average. 
	Select the classes for which you wish to compute a 3D reconstruction.
d1921 1
a1921 1
    The 2D alignment of the untilted-specimen images cannot be directly applied to the tilted-specimen images, 
d1925 2
a1926 3
    <p> The procedure file <a href="../centertilt.rct">centertilt.rct</a> uses the command
	<a href="../../..//man/apsa.html">'AP SA'</a>, 
	which will use a reference-free alignment to align the images in stack
d1928 1
d1935 4
d1942 2
a1943 2
                <td><font class="output">Tilted/avg1_apsa</font>:</td>
                <td>Intermediate average of translationally aligned, filtered images.
d1946 1
a1946 8
                <td><font class="output">Tilted/avg2_cent</font>:</td>
                <td>Average after centering
                    <BR>See note about centering below.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/avg3_tilt</font>:</td>
                <td>Final average of translationally aligned, unfiltered images.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">Tilted/dalt001</font>:</td>
d1950 13
a1962 21
    <p> Following the reference-free translational alignment, 
	the average may or may not be centered 
	depending on the parameter <b><I>[cg-option]</I></b>. 
	The default, option <b><I>1</I></b>, uses the command 
	<a href="../../..//man/cgph.html">'CG PH'</a>, 
	which as noted in its documentation sometimes fails. 
	As an alternative, option <b><I>2</I></b> for <b><I>[cg-option]</I></b> 
	rotates the average 180 degrees around the origin and aligns to itself. 
	If both of these fail, 
	option <b><I>0</I></b> bypasses the center-of-gravity calculation altogether. 
	Be sure to inspect the averages, 
	especially the final one <font class="output">Tilted/avgt001</font>, 
	to make sure that the centering is adequate.
    </p>

    <p> The parameters regarding filtration are to help the reference-free alignment command, 
	<a href="../../..//man/apsa.html">'AP SA'</a>. 
	The filter is for temporary, intermediate images. 
	The final aligned images will be unfiltered.
    </p>

a1974 35
<li><p><b>[Optional] Generate symmetry files</b></p></li>

    <p> This step is primarily for the 
	<a href= "../../..//protocol_download.html">
	Nature Protocols RCT data set</a>, but can be tailored for other symmetric samples. 
	The procedure file <a href="../d6symmetry.rct">d6symmetry.rct</a> will generate files that 
	contain the Euler angles for equivalent positions in each asymmetric unit. 
    </p>

    <p> The worm hemoglobin used in the Nature Protocols data set has D6 symmetry, 
	and has two main types of views: top views and side views. 
	There were also 4 particles that were neither top views nor side views, 
	but they will not be used for the reconstruction. 
	Also, there were two types of side views in that data set, but 
	both can use the identical symmetry file since 
	the symmetry axis is in the same direction in both.
    </p>
    
    <b>Outputs:</b><br>

	<table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">d6top</font>:</td>
                <td>Symmetry doc file where the 6-fold axis is along <I>z</I>.</td></tr>
            <tr valign="top"><td>&curren;</td>
                <td><font class="output">d6side</font>:</td>
                <td>Symmetry doc file where the 6-fold axis is in the <I>xy</I> plane.</td></tr>
	</table>
	
    <p> To generate a doc file corresponding to a different symmetry, use the command 
	<a href="../../..//man/sy.html">
	'SY DOC'</a>.
    </p>


d1993 1
a1993 1
                <td>Euler-angle doc file for instructional purposes.
d2007 35
d2061 8
a2068 6
    <p> For the <a href= "../../..//protocol_download.html">
	Nature Protocols RCT data set</a>, change the parameter <b><I>[natprot-yn]</I></b> to <b><I>1</I></b>. 
	This will make sure that the side-view symmetry file <font class="input">Volumes/d6side</font> 
	(by default in the procedure file, classes 1 &amp; 3) and 
	the top-view symmetry file <font class="input">Volumes/d6top</font> (by default, class 4) are used. 
	Make sure that they are applied to the correct classes.
d2387 1
a2387 1
	<p> As of yet, CTF-correction is not implemented here. 
d2444 10
d2456 1
a2456 1
    <BR>(Conversion/display programs sometimes expect this extension for SPIDER files.)</li>
d2501 1
a2501 1
  Page updated: 2014/03/28 &nbsp;&nbsp;&nbsp;
@


1.7
log
@updated modification log, link to new tarball
@
text
@d88 1
a88 1
    <li><a href="../../../techs/verify/batch/instr-apsh.htm">
d127 1
a127 1
    <li> Data extension assumed to be <b>.dat</b>. Adjust accordingly.</li>
d161 1
a161 1
   <p>Data extension is assumed to be <code class="snippet">dat</code></p>
d169 1
a169 1
    <li>spider rct/dat @@makeparams (or copy <b>params.dat</b>)</li>
d171 1
a171 1
    <li>mkfilenums.py filenums.dat $MICROGRAPHS*</li>
d174 1
a174 1
    <li>cd Micrographs/ ; montagefromdoc.py ../filenums.dat</li>
d178 1
a178 1
    <li>spider rct/dat @@makesomenoise (or copy <b>noise.dat</b>) </li>
d185 1
a185 1
    <li>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</li>
d187 1
a187 1
    <li>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</li>
d201 1
a201 1
	    <li>cd Zerodegr/Tree ; ../../tree.py labeled001.dat 6 goodclasses.dat</li>
d205 1
a205 1
	    <li>spider rct/dat @@multirefalign (subsequently @@multirefalign-descend)</li> 
d208 1
a208 1
	    <li>verifybyview.py</li> 
d265 1
a265 1
    <a href="../mkfilenums.py">mkfilenums.py</a> and <a href="../tree.py">tree.py</a>. 
d290 1
a290 1
   <code class="snippet">dat</code> is the project data file extension, and 
d326 17
a342 4
    Many parameters are used repeatedly throughout this protocol. 
    The procedure file <a class="project" href="../makeparams.rct">makeparams.rct</a> stores these parameters.
    Run it interactively, and answer the questions.  It creates the document file:
    
d400 1
a400 1
        <p><code class="snippet">mkfilenums.py filenums.dat Micrographs/zeiss*.tif</code></p>
d410 2
d415 49
a463 10
    <p>The procedure file <a href="../convert.rct">convert.rct</a>, 
       which calls subroutine <a href="../convert_p.rct">convert_p.rct</a>, 
       will convert, in the default example, <font class="input">zeiss****.tif</font> 
       to SPIDER format.  
       Change the format for the input filename as necessary. 
       Acceptable formats are specified by parameters 1 and 2 in 
       <a href="../../..//techs/recon1/Docs/params.html">
       <font class="input">params</font> (described here)</a>. 
       Outputs:
    </p>
a470 4
    <p> If the micrographs are in Z/I TIFF format, 
	<a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">zi2spi</a> 
	will be needed. If it is not installed on your system, the compilation instructions 
	are described at the top of the source code.
d489 11
a499 2
    <p> The filtration step is slow, so 
	by setting <b><I>[filter-radius]=0</I></b>, you can skip this step. 
d510 1
a510 1
    <p> <code class="snippet">montagefromdoc.py ../filenums.dat sm-mic* </code></p>
d515 9
a523 7
	<font class="input">../filenums</font>.</p>
	
    <p> If you wish to remove micrographs by editing <b>filenums</b>
	(instead of with <font class="guitool">montagefromdoc.py</font>),
	renumber it to have consecutive keys, using 
	<a href="../../..//man/docren.html">
	'DOC REN'</a>. (The input and output can have the same name.)</p> 
d553 1
a553 1
	sets them to have the same dimensions.  Outputs:
d556 1
d660 2
a661 2
		<li><I>Determine Theta</I> and <I>Fit Angles</I> are now merged into one button, 
		    <I>Determine tilt axis angles</I>.</li>
d664 1
a664 1
	<BR>HINTS:
d670 12
a681 4
	    <li>If, while picking pairs, the fitted locations stray from the correct location 
		(which could be the case if earlier fittings were done using a limited area, or 
		if the support film deviates from flatness), 
		it may help to re-do the fitting (summarized under the previous bullet).</li>
d697 1
a697 1
	(choose any micrograph).  Outputs:
d700 2
d712 1
a712 1
	and copy one that looks "noisiest" to <font class="output">noise.dat</font>
d715 1
a715 1
	<font class="output">noise.dat</font>.</p>
d743 1
a743 1
    Outputs:
d745 9
a753 9
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">listparticles</font>:</td>
	<td>A list of windowed particles, along with the corresponding (untilted) micrograph number.</td></tr>
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">Zerodegr/Winrot/unt*****</font>:</td>
	<td>Windowed particles from the untilted-specimen micrographs.</td></tr>
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">Tilted/Winrot/tilt*****</font>:</td>
	<td>Windowed particles from the tilted-specimen micrographs.</td></tr>
d755 5
d761 4
a764 5
    
    <p> There are additional outputs, <font class="output">Zerodegr/Unrot/unt*****</font> and 
	<font class="output">Tilted/Unrot/tilt*****</font>.  
	See this <a href="eulers.htm">note about Euler angles</a> for information about 
	how the different outputs relate to the 3D reconstruction.
d780 2
a781 2
	<a href="../highpass-tilted.rct">highpass-tilted.rct</a> read 
	<font class="input">Zerodegr/Winrot/unt*****</font> and <font class="input">Tilted/Winrot/tilt*****</font>, 
d783 3
a785 1
	<font class="output">Tilted/Unhighpass</font>, and the following outputs are written:
d788 6
a793 6
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">Zerodegr/Winrot/unt*****</font>:</td>
	<td>High-pass filtered untilted-specimen images.</td></tr>
    <tr valign="top"><td>&curren;</td>
	<td><font class="output">Tilted/Winrot/tilt*****</font>:</td>
	<td>High-pass filtered tilted-specimen images.</td></tr>
a795 4
    <p> If you don't like the appearance of the output images, 
	delete the corresponding <b>Winrot/</b> directory and 
	rename the <b>Unhighpass/</b> directory back to <b>Winrot/</b>. </p>

d804 1
a804 1
		<BR><code class="snippet">montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</code>
d817 1
a817 1
		<BR><code class="snippet">montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</code></li>
d830 2
a831 1
	if the dust interferes with the 2D alignment, it can be thrown out later.
d850 2
a851 2
	Briefly, <a href="../pairwise.rct">pairwise.rct</a> takes the first two images 
	<font class="input">Zerodegr/Winrot/unt*****</font>, aligns them, and averages them.  
d855 1
a855 1
	which chooses seed images as alignment references.  A partial list of outputs:
d857 2
d860 14
a873 9
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Aligned/cenu*****</font>:</td>
	    <td>Aligned untilted-specimen images.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Pairwise/rfreeavg001</font>:</td>
	    <td>Average of all images.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Pairwise/docpairalign</font>:</td>
	    <td>Alignment doc file.</td></tr>
d884 1
a884 1
	<li>The procedure file <a href="../reorientavg.rct">reorientavg.rct</a> 
d887 1
a887 2
	    and then orient that symmetry axis along the coordinate axes.
	    Outputs:
d889 2
d892 6
a897 6
	    <tr valign="top"><td>&curren;</td>
		<td><font class="output">Zerodegr/Pairwise/malign</font>:</td>
		<td>Montage of reorientation candidates (see below).</td></tr>
	    <tr valign="top"><td>&curren;</td>
		<td><font class="output">Zerodegr/Pairwise/dsolalign</font>:</td>
		<td>Alignment doc file for reorientaiton attempts.</td></tr>
d911 1
a911 1
	<li>Choose the preferred solution number from the previous step (if any), and
d917 1
a917 2
	    the unaligned images <font class="input">Zerodegr/Winrot/unt*****</font>.  
	    Outputs:
d919 17
a935 10
	    <table class="outs">
	    <tr valign="top"><td>&curren;</td>
		<td><font class="output">Zerodegr/Aligned/cenu*****</font>:</td>
		<td>Newly-aligned untilted-specimen images.</td></tr>
	    <tr valign="top"><td>&curren;</td>
		<td><font class="output">Zerodegr/Pairwise/avgu001</font>:</td>
		<td>Realigned 2D average.</td></tr>
	    <tr valign="top"><td>&curren;</td>
		<td><font class="output">Zerodegr/Pairwise/dalu001</font>:</td>
		<td>Combined alignment-parameter doc file.</td></tr>
d947 1
a947 1
	the images <font class="input">Zerodegr/Aligned/cenu*****</font> are made smaller. 
d951 2
a952 1
	Outputs: 
d954 3
a956 3
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Filtered/flt*****</font>:</td>
	    <td>Low-pass, shrunken filtered images.</td></tr>
d961 1
a961 1
	    <BR><code class="snippet">montagefromdoc.py listparticles.dat Zerodegr/Filtered/flt*</code></p>
d972 1
a972 1
	In principle, one can classify the images <font class="input">Zerodegr/Filtered/flt*****</font> 
d991 1
a991 1
	classification and clustering tutorial</a></p>
d993 16
a1008 10
	Outputs:
	<table class="outs">
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/MSA/reconstituted***</font>:</td>
	    <td>Images reconstituted using a single factor (eigenimage)
		<BR>Factors can be positive or negative, hence the two versions for each.
		<BR>For more information about reconstituted images and eigenimages, see the
		<a href="../../..//techs/classification/tutorial.html#virtual">
		classification and clustering tutorial</a>.</td></tr>
		.</td></tr>
d1025 2
a1026 1
	Important parameters:
d1072 1
a1072 1
	  <OL TYPE=a>
d1084 2
a1085 3
		    The procedure file <a href="../hierarchical.rct">hierarchical.rct</a> 
			reads the MSA factor text file <font class="input">Zerodegr/MSA/cas_IMC</font> and 
			generates the following output:
d1087 2
d1111 1
a1111 1
			    averaging the images <font class="input">Zerodegr/Filtered/flt*****</font>.
d1129 2
a1130 1
			Outputs:
d1132 6
a1137 6
			    <tr valign="top"><td>&curren;</td>
				<td><font class="output">Zerodegr/Tree/classavg***</font>:</td>
				<td>Class average for each node on the binary tree.</td></tr>
			    <tr valign="top"><td>&curren;</td>
				<td><font class="output">Zerodegr/Tree/labeled***</font>:</td>
				<td>Class average, labeled with the class number and the number of particles.</td></tr>
d1151 2
a1152 1
		    <p> This option cuts off the dendrogram <font class="input">dendrodoc</font> at a specific height.  
d1155 1
a1155 1
			the procedure file <a href="../classavg.rct">classavg.rct</a>. 
d1160 1
a1160 1
		    Outputs:
d1162 14
a1175 14
			<tr valign="top"><td>&curren;</td>
			    <td><font class="output">Zerodegr/Hierarchical/classavg***</font>:</td>
			    <td>Class averages.</td></tr>
			<tr valign="top"><td>&curren;</td>
			    <td><font class="output">Zerodegr/Hierarchical/docclass***</font>:</td>
			    <td>List of particles belonging to each class.</td></tr>
			<tr valign="top"><td>&curren;</td>
			    <td><font class="output">Zerodegr/Hierarchical/listclasses</font>:</td>
			    <td>Doc file with each information about each class
				<BR>Needed as an input for <font class="guitool">verifybyview.py</font> 
				(<a href="#vbv">more information below</a>).</td></tr>
			<tr valign="top"><td>&curren;</td>
			    <td><font class="output">Zerodegr/Hierarchical/classvar***</font>:</td>
			    <td>Class variances.</td></tr>
d1189 1
a1189 1
		from the images <font class="input">Zerodegr/Filtered/flt*****</font>.
d1192 1
a1192 1
	    Outputs:
d1194 18
a1211 18
		    <tr valign="top"><td>&curren;</td>
			<td><font class="output">Zerodegr/Kmeans/docassign</font>:</td>
			<td>Doc file of analogous format to 
			    dendrograms from the other 2 classification methods.</td></tr>
		    <tr valign="top"><td>&curren;</td>
			<td><font class="output">Zerodegr/Kmeans/classavg***</font>:</td>
			<td>Class averages.</td></tr>
		    <tr valign="top"><td>&curren;</td>
			<td><font class="output">Zerodegr/Kmeans/docclass***</font>:</td>
			<td>List of particles belonging to each class.</td></tr>
		    <tr valign="top"><td>&curren;</td>
			<td><font class="output">Zerodegr/Kmeans/listclasses</font>:</td>
			<td>Doc file with each information about each class
			    <BR>Needed as an input for <font class="guitool">verifybyview.py</font> 
			    (<a href="#vbv">more information below</a>).</td></tr>
		    <tr valign="top"><td>&curren;</td>
			<td><font class="output">Zerodegr/Kmeans/classvar***</font>:</td>
			<td>Class variances.</td></tr>
d1218 1
a1218 1
		    The procedure file <a href="../cluster.rct">cluster.rct</a> uses SPIDER command
d1222 1
a1222 2
			reading <font class="input">Zerodegr/MSA/cas_IMC</font> and 
			generating the following output:
d1224 2
d1227 6
a1232 6
			    <tr valign="top"><td>&curren;</td>
				<td><font class="output">Zerodegr/Cluster/docdendro</font>:</td>
				<td>Dendrogram doc file, showing the relatedness between images.
				    <BR>See the <a href="../../..//techs/classification/tutorial.html#clhc">
				    classification and clustering tutorial</a> for more details.
				    </td></tr>
d1249 3
a1251 3
		    <p> <U>NOTE:</U> The default filenames in the procedure file are for Ward's method, 
			so change the file label in the procedure file <I><b>[class_dir]</b></I> from 
			<b>Zerodegr/Hierarchical</b> to <b>Zerodegr/Cluster</b>.
d1254 1
a1254 1
			Outputs:
d1256 14
a1269 14
			    <tr valign="top"><td>&curren;</td>
				<td><font class="output">Zerodegr/Cluster/classavg***</font>:</td>
				<td>Class averages.</td></tr>
			    <tr valign="top"><td>&curren;</td>
				<td><font class="output">Zerodegr/Cluster/docclass***</font>:</td>
				<td>List of particles belonging to each class.</td></tr>
			    <tr valign="top"><td>&curren;</td>
				<td><font class="output">Zerodegr/Cluster/listclasses</font>:</td>
				<td>Doc file with each information about each class
				    <BR>Needed as an input for <font class="guitool">verifybyview.py</font> 
				    (<a href="#vbv">more information below</a>).</td></tr>
			    <tr valign="top"><td>&curren;</td>
				<td><font class="output">Zerodegr/Cluster/classvar***</font>:</td>
				<td>Class variances.</td></tr>
d1292 1
a1292 1
      <OL TYPE=a>
d1296 1
a1296 1
		<BR><code class="snippet">tree.py labeled001.dat 6 goodclasses.dat</code>
d1306 2
a1307 2
		one advantage of <font class="guitool">tree.py</font> is that 
		the displayed classes do not all have to be at the same height. 
d1328 1
a1328 1
	    <p> The script <A HREF="../tree.py"><font class="guitool">tree.py</font></A> requires the library 
d1349 1
a1349 1
		It can also be used in conjuction with <font class="guitool">tree.py</font> to 
d1354 3
a1356 3
		<code class="snippet">verifybyview.py Zerodegr/Tree</code> &nbsp; if you used the binary-tree option, or <BR>
		<code class="snippet">verifybyview.py Zerodegr/Kmeans</code> &nbsp; if you ran K-means classification, or <BR>
		<code class="snippet">verifybyview.py Zerodegr/Cluster</code> &nbsp; if you used Diday's clustering method, <I>etc.</I>
d1359 1
a1359 1
	    <p> The script <A HREF="../tree.py"><font class="guitool">verifybyview.py</font></A> 
d1381 1
a1381 1
	    <p> The <a href="../.verifybyview">.verifybyview</a> file is updated with each change. 
d1386 1
a1386 1
	    </p>
d1395 12
a1406 12
		<tr valign="top"><td>&curren;</td>
		    <td><font class="input">.dat</font>:</td>
		    <td>Data extension. Adjust as necessary</td></tr>
		<tr valign="top"><td>&curren;</td>
		    <td><font class="input">Zerodegr/Tree</font>:</td>
		    <td>Initial directory.</td></tr>
		<tr valign="top"><td>&curren;</td>
		    <td><font class="input">listclasses</font>:</td>
		    <td>List of classes.</td></tr>
		<tr valign="top"><td>&curren;</td>
		    <td><font class="input">classavg***</font>:</td>
		    <td>Class-average template.</td></tr>
d1415 9
a1423 9
		<tr valign="top"><td>&curren;</td>
		    <td><font class="input">docclass***.dat</font>:</td>
		    <td>List of particles belonging to each class.</td></tr>
		<tr valign="top"><td>&curren;</td>
		    <td><font class="input">Zerodegr/Filtered/flt*****.dat</font>:</td>
		    <td>Filtered-image template.</td></tr>
		<tr valign="top"><td>&curren;</td>
		    <td><font class="output">goodclasses.dat</font>:</td>
		    <td>List of selected classes.</td></tr>
d1448 2
a1449 2
	The previously aligned images <font class="input">Zerodegr/Aligned/cenu*****</font> 
	are used to generate the reference images 
d1451 1
a1451 1
	and the unaligned images <font class="input">Zerodegr/Winrot/unt*****</font> 
d1461 1
a1461 1
    Outputs:
d1463 27
a1489 19
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/ref***</font>:</td>
	    <td>Reference images used for alignment.
		<BR>They should resemble full-sized, unfiltered versions of the selected class averages</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/docalign</font>:</td>
	    <td>Alignment parameters
		<BR>See the documentation for 
		<a href="../../..//man/apsh.html">
		'AP SH'</a> for an explanation of the doc file.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/selview***</font>:</td>
	    <td>A list of particles belonging to each class.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Aligned/cenu*****</font>:</td>
	    <td>Newly aligned particle images.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/viewavg***</font>:</td>
	    <td>Average of particles belonging to each reference.</td></tr>
d1492 2
a1493 1
    <BR>Some notable parameters:
d1501 1
a1501 1
		    <BR>You can look at the <b>Zerodegr/Multiref/ref***</b> files during the 
d1514 1
a1514 1
	The newly aligned images, <font class="input">Zerodegr/Aligned/cenu*****</font>, 
d1519 2
a1520 1
	Outputs: 
d1523 2
a1524 2
	    <td><font class="output">Zerodegr/Filtered/flt*****</font>:</td>
	    <td>Low-pass, shrunken filtered images.</td></tr>
d1542 2
a1543 2
	performs separate classifications on the images <font class="input">Zerodegr/Filtered/flt*****</font>
	for each of the selection doc files <font class="input">Zerodegr/Multiref/selview***</font>. 
d1546 1
a1546 1
	<font class="input">Zerodegr/Multiref/ref***</font>.
d1549 2
a1550 2
    The outputs for each classification will have their own subdirectory 
    <font class="output">Zerodegr/Multiref/View###</font>:
d1553 10
a1562 13
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/View###/listclasses</font>:</td>
	    <td>List of classes for each reference-view's classification
		<BR>Also contains various stats for each class.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/View###/classavg***</font>:</td>
	    <td>Class average.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/View###/docclass***</font>:</td>
	    <td>List of particles belonging to each class.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref/View###/eigenimg***</font>:</td>
	    <td>Eigenimages.</td></tr>
d1565 1
a1565 1
	<BR>Notable parameters include:
d1606 1
a1606 1
		<code class="snippet">verifybyview.py Zerodegr/Multiref/View001</code>
d1614 1
a1614 1
	Either edit the settings, or copy the archived version in the tarball, 
d1616 1
a1616 1
	to <b>.verifybyview</b>
d1624 12
a1635 12
    <tr valign="top"><td>&curren;</td>
	<td><font class="input">.dat</font>:</td>
	<td>Data extension.</td></tr>
    <tr valign="top"><td>&curren;</td>
	<td><font class="input">Zerodegr/Multiref001</font>:</td>
	<td>Initial directory.</td></tr>
    <tr valign="top"><td>&curren;</td>
	<td><font class="input">listclasses</font>:</td>
	<td>List of classes.</td></tr>
    <tr valign="top"><td>&curren;</td>
	<td><font class="input">classavg***</font>:</td>
	<td>Class-average template.</td></tr>
d1646 9
a1654 9
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">docclass***</font>:</td>
	    <td>List of particles belonging to each class.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Zerodegr/Filtered/flt*****</font>:</td>
	    <td>Filtered-image template.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">goodclasses</font>:</td>
	    <td>Output list of selected classes.</td></tr>
d1702 4
a1705 6
		    is instead <font class="input">Zerodegr/Multiref</font></li>
		<li>The output file label <b><I>[multiref_dir]</I></b> goes from 
		    <font class="output">Zerodegr/Multiref</font> to <font class="output">Zerodegr/Multiref2</font></li>
		<li>The parameter <b><I>[subdir-flag]</I></b> is set to <I>1</I> 
		    to tell the procedure file to look in the 
		    <font class="input">View###</font> subdirectories</li> 
d1708 7
a1714 3
	<p>For an exhaustive list of differences between the two procedure files, type: <BR>
	<code class="snippet">diff multirefalign.rct multirefalign-descend.rct</code></p>

d1722 15
a1736 3
	    <p>Run <a href="../classifybyview.rct">classifybyview.rct</a> with one difference: <BR>
		The input/output directory <b><I>[class_dir]</I></b> should be changed from 
		<b>Zerodegr/Multiref</b> to <b>Zerodegr/Multiref2</b> </p>
d1739 1
a1739 1
    For a possible third iteration, the following changes would be needed:
d1744 1
a1744 1
	    <BR>An example, <a href="../multirefalign3.rct">multirefalign3.rct</a>, 
d1751 1
a1751 1
      </ol>
d1753 6
a1758 3
    <I>Et cetera...</I>

    <p> Iterate these 3 steps until no new classes appear. </p>
d1760 1
a1760 1
    <p> <U>NOTE</U>: In several steps below, I will assume that you run 2 iterations of multireference alignment. 
d1763 1
a1763 1
	</p>
d1771 1
a1771 1
	<code class="snippet">verifybyview.py Zerodegr/Multiref2/View001</code> </p>
d1790 1
a1790 1
    Briefly, the outputs of this step are:
d1793 1
d1821 2
a1822 1
    Output:
d1824 1
d1830 1
a1830 1
    <p> If in you final iteration of multireference alignment, 
d1838 1
a1838 1
    <p> <U>HINT</U>: It may be useful to re-classify only the good particles, 
d1859 1
a1859 1
	read the aligned images <font class="input">Zerodegr/Aligned/cenu*****</font> 
d1865 1
a1865 1
    Outputs:
d1868 1
d1870 2
a1871 2
	    <td><font class="output">Zerodegr/Multiref2/goodavg***</font>:</td>
	    <td>Averages of the selected particles.</td></tr>
d1873 2
a1874 2
	    <td><font class="output">Zerodegr/Multiref2/goodvar***</font>:</td>
	    <td>Variances of the selected particles.</td></tr>
d1877 1
a1877 1
    <p> If in you final iteration of multireference alignment, 
d1885 17
d1903 2
d1919 2
a1920 2
	which will use a reference-free alignment to align the
	<font class="input">Tilted/Winrot/tilt*****</font> images translationally but not rotationally. 
d1923 1
a1923 1
    Outputs:
d1926 17
a1942 17
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/Aligned/cent*****</font>:</td>
	    <td>Translationally aligned tilted-specimen images.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/avst001</font>:</td>
	    <td>Intermediate average of translationally aligned, filtered images.
		<BR>Note that the images are not rotationally aligned.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/avsc001</font>:</td>
	    <td>Average after center-of-gravity calculation
		<BR>See note about centering below.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/avgt001</font>:</td>
	    <td>Final average of translationally aligned, unfiltered images.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/dalt001</font>:</td>
	    <td>Alignment doc file.</td></tr>
d1967 4
a1970 5
	To do this, change the input <font class="input">listparticles</font> 
	to <font class="input">Zerodegr/Multiref2/combinedgood</font>, 
	assuming once again that you ran 2 iterations of multireference alignment. 
	A commented-out version of this label <b><I>[selection_list]</I></b> 
	is present in the procedure file.
d1974 1
a1974 1
	<code class="snippet">montagefromdoc.py listparticles.dat Tilted/Aligned/cent*</code>
d1996 1
a1996 1
    Outputs:
d1999 6
a2004 6
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">d6top</font>:</td>
	    <td>Symmetry doc file where the 6-fold axis is along <I>z</I>.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">d6side</font>:</td>
	    <td>Symmetry doc file where the 6-fold axis is in the <I>xy</I> plane.</td></tr>
d2019 1
a2019 3
	<font class="input"> Zerodegr/Multiref2/docalign</font> 
	(assuming you ran 2 iterations of mutireference alignment -- 
	adjust the procedure file as necessary). 
d2023 1
a2023 1
    Outputs:
d2026 7
a2032 7
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/dangles</font>:</td>
	    <td>Euler-angle doc file to be used for the 3D reconstruction.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/dang-unrot</font>:</td>
	    <td>Euler-angle doc file for instructional purposes.
		<BR>See <a href="eulers.htm">note about Euler angles</a>.</td></tr>
d2049 1
a2049 2
	whose particles are listed in each <font class="input">Zerodegr/Multiref2/goodsel***</font>, 
	(assuming you ran 2 iterations of multireference alignment).
d2056 1
a2056 1
    Outputs:
d2059 3
a2061 3
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/vcla***</font>:</td>
	    <td>Reconstructions for each class.</td></tr>
d2065 5
a2069 7
	Nature Protocols RCT data set</a>, edit the procedure file <a href="../bpclass.rct">bpclass.rct</a> 
	and remove the semicolon in the line <code class="snippet">;goto lb4</code> to uncomment it.
	Then, go to the end of the procedure file and make sure that 
	the side-view symmetry file <font class="input">Volumes/d6side</font> is used for the correct classes 
	(by default in the procedure file, classes 1 &amp; 3) and that 
	the top-view symmetry file <font class="input">Volumes/d6top</font> is used for the correct class 
	(by default, class 4).
d2077 3
a2079 2
    <BR>Outputs:
    </p>
d2082 7
a2088 7
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/vflt***</font>:</td>
	    <td>Filtered reconstructions.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/docvolfilt</font>:</td>
	    <td>Editable doc file containing filter parameters.
		<BR>See note below.</td></tr>
d2091 1
a2091 1
	Parameters:
d2156 1
a2156 1
    Parameters:
d2182 1
a2182 1
    <BR>Outputs:
d2185 19
a2203 19
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/Alignment/dalv***</font>:</td>
	    <td>Doc file with initial and refined alignment parameters.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/Alignment/vali***</font>:</td>
	    <td>Aligned class volume.
		<BR>Only written for the best match, but see note below.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/Alignment/mproj</font>:</td>
	    <td>Stack file of projections for each projection direction, 
		and for the best <b><I>[num-solns]</I></b> solutions.
		<BR>More below.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/Alignment/prj_***</font>:</td>
	    <td>Reprojections of the reference and experimental volumes.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/Alignment/list2merge</font>:</td>
	    <td>Editable list of aligned class volumes with preferred alignment solution.
		<BR>More below.</td></tr>
d2235 1
a2235 1
    Inputs:
d2238 32
a2269 32
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Tilted/Aligned/cent*****</font>:</td>
	    <td>Aligned images.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Zerodegr/Multiref2/goodsel***</font>:</td>
	    <td>Good-particle selection files (assuming 2 rounds of multireference alignment).</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Tilted/dangles</font>:</td>
	    <td>Euler-angle doc file.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Volumes/Alignment/dalv***</font>:</td>
	    <td>Volume-alignment doc files.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Volumes/Alignment/list2merge</font>:</td>
	    <td>List of classes to merge.</td></tr>
	</table>
	
    <BR>Outputs:
	
	<table class="outs">
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Tilted/dang-merged</font>:</td>
	    <td>Euler angles taking into account the volume alignment.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Zerodegr/Multiref#/mergedsel</font>:</td>
	    <td>Selection file containing particle numbers for merged classes.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/vtot999</font>:</td>
	    <td>Merged reconstruction.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Volumes/vtot999-flt</font>:</td>
	    <td>Filtered merged reconstruction.</td></tr>
d2309 1
a2309 1
    Inputs:
d2312 25
a2336 25
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">params</font>:</td>
	    <td>Parameter doc file.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Volumes/vtot999-flt</font> :</td>
	    <td>Filtered, merged volume
		<BR>If you didn't merge classes, 
		use a <font class="input">Volumes/vflt***</font> class volume.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">docmicpairs</font>:</td>
	    <td>Micrograph-pairing doc file.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">listparticles</font>:</td>
	    <td>List of particles.
		<BR>See note below.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">order_picked</font>:</td>
	    <td>micrograph-to-particle lookup-table.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Micrographs/dct****</font>:</td>
	    <td>Tilted-specimen coordinates doc file.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="input">Tilted/Winrot/tilt*****</font>:</td>
	    <td>Tilted-specimen particle images
		<BR>See note below.</td></tr>
d2348 2
a2349 2
	    Also, instead of <font class="input">Tilted/Winrot/tilt*****</font>, 
	    you could opt to use <font class="input">Tilted/Unrot/tilt*****</font>, 
d2351 2
a2352 2
	    However, if you needed to high-pass filter the <b>Winrot/</b> images, 
	    you will need to go back and filter the <b>Unrot/</b> images similarly.
d2355 1
a2355 1
	Outputs (assumed to be in <font class="output">myproject/</font>):
d2358 28
a2385 28
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">params</font>:</td>
	    <td>Parameter doc file (identical to input).</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">reference_volume</font>:</td>
	    <td>Reference volume.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Power_Spectra/sel_group</font>:</td>
	    <td>Dummy list of defocus groups.
		<BR>See note about CTF-correction below.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">sel_micrograph</font>:</td>
	    <td>List of micrographs.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Power_Spectra/def_avg</font>:</td>
	    <td>Dummy list of defocus values.
		<BR>See note about CTF-correction below.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Particles/win/winser_****</font>:</td>
	    <td>Particle stacks, for each micrograph.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Particles/good/ngood****</font>:</td>
	    <td>Particle selection doc file, for each micrograph.
		<BR>If you plan to re-verify the particles, 
		instead call these files <font class="output">Particles/win/sel_particle_****</font>.</td></tr>
	<tr valign="top"><td>&curren;</td>
	    <td><font class="output">Particles/coords/sndc****</font>:</td>
	    <td>Coordinate doc files.</td></tr>
d2445 4
d2492 1
a2492 1
  Page updated: 2014/02/04 &nbsp;&nbsp;&nbsp;
@


1.6
log
@*** empty log message ***
@
text
@d2302 1
d2345 1
a2345 1
  Page updated: 2013/07/31 &nbsp;&nbsp;&nbsp;
@


1.5
log
@tar archive, html update, cosmetic, links fixed
@
text
@d59 1
a59 1
    <li><a href="../Attic/tar_archive/archive.htm">Tarball archive (Albany only)</a>. </li>
d313 1
a313 1
    <p>Access the latest <a href="../procedures.tar">procedures archive</a> 
d369 1
a369 1
	Access the <a href="../data20060817.tar">data archive</a>
@


1.4
log
@Added link to POCS page
@
text
@d2 3
a4 2
<HTML>
<HEAD>
d8 1
a8 1
</HEAD>
d10 1
a10 1
<BODY LANG="en-US" DIR="LTR">
d13 1
a13 1
<HR>
d19 2
a20 5
   
    <p><center>As described in <I>Nucleic Acids Res.</I> (2011) <B>39</B>: 2845-54.</center></p>
   
    <P></P>

d24 1
a24 1
<HR>
d27 11
a37 11
<B><P>Outline</P></B>
<UL>
    <LI><a href="#links">Links to further information</a> </LI>
    <LI><a href="#notes">General notes</a> </LI>
    <LI><a href="#quick">Quick-start guide</a> </LI>
    <LI><a href="#start">Getting started</a> </LI>
    <LI><a href="#proc">Procedure</a> </LI>
    <LI><a href="#misc">Miscellaneous batch files</a> </LI>
    <LI><a href="#mods">Modifications log</a> </LI>
    <LI><a href="#refs">References</a> </LI>
</UL>
d39 1
a39 1
<HR>
a44 1
   
d46 1
a46 3
   
   <P></P>
   
d56 1
a56 1
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/euler.html">
d59 1
a59 2
    <li><a href="../tar_archive/archive.htm">
	Tarball archive</a>. </li>
d62 1
a62 1
	<a href="http://www.wadsworth.org/spider_doc/spire/doc/index.html">SPIRE</a>,
d64 1
a64 1
	<a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html">
d68 1
a68 1
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
d72 1
a72 2
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon1/myproject/Docs/params.html">
	reconstruction parameters</a>.</li>
d75 1
a75 2
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon1/myproject/Docs/zi/zidoc.html">
	ZI scanner</a> </li>
d78 1
a78 1
	<a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">
d81 1
a81 1
    <li><a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/MSA/index.html">
d85 1
a85 1
    <li><a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/tutorial.html">
d88 1
a88 1
    <li><a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/batch/instr-apsh.htm">
d102 1
a102 1
<HR>
d111 1
a111 1
   <P></P>
d118 12
a129 12
<UL>
    <LI> <b>Each step in the process is bold and marked  by a bullet.</b></LI>
    <LI> <a href="#notes">Procedure files</a> are links to the procedure script.</LI>
    <LI> <font class="input">Inputs</font> are marked in pink italics.</LI>
    <LI> <font class="output">Outputs</font> created by that procedure are marked in green.</LI>
    <LI> <font class="guitool"> Graphical tools</font> are marked in red. </LI>
    <LI> Command-line instructions are written in <code class="snippet">Courier</code>.</LI>
    <LI> <B><I>Parameters</I></B> will be in bold italic.</LI>
    <LI> Sequential operations are numbered. Options are lettered.</LI>
    <LI> Data extension assumed to be <B>.dat</B>. Adjust accordingly.</LI>
    <LI> List of inputs and outputs in description is not exhaustive.</LI>
</UL>
d149 1
a149 1
<HR>
d161 1
a161 1
   <P>Data extension is assumed to be <code class="snippet">dat</code></P>
d167 14
a180 14
<code class="snippet"><OL>
    <LI>tar -xvf $BATCH.tar</LI>
    <LI>spider rct/dat @@makeparams (or copy <B>params.dat</B>)</LI>
    <LI>(optional) tar -xvf $DATA.tar</LI>
    <LI>mkfilenums.py filenums.dat $MICROGRAPHS*</LI>
    <LI>(for non-SPIDER format micrographs) spider rct/dat @@convert</LI>
    <LI>spider rct/dat @@shrinkmics</LI>
    <LI>cd Micrographs/ ; montagefromdoc.py ../filenums.dat</LI>
    <LI>spider rct/dat @@micpair</LI>
    <LI>(required for JWEB) spider rct/dat @@padmics</LI>
    <LI>pick tilt pairs in JWEB or WEB</LI>
    <LI>spider rct/dat @@makesomenoise (or copy <B>noise.dat</B>) </LI>
    <LI>spider rct/dat @@windowparticles</LI>
    <LI>(for negative stain) Do both of:</LI>
d182 9
a190 9
	    <LI>spider rct/dat @@highpass-untilted</LI>
	    <LI>spider rct/dat @@highpass-tilted</LI>
	</OL>
    <LI>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</LI>
    <LI>(if necessary) spider rct/dat @@removebad</LI>
    <LI>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</LI>
    <LI>(if necessary) spider rct/dat @@removebad</LI>
    <LI>(slow) spider rct/dat @@pairwise</LI>
    <LI>(optional) To reorient average, do both of:</LI>
d192 6
a197 6
	    <LI>spider rct/dat @@reorientavg</LI>
	    <LI>spider rct/dat @@sumalign</LI>
	</OL>
    <LI>spider rct/dat @@filtershrink</LI>
    <LI>spider rct/dat @@ca-pca</LI>
    <LI>Classify.  (Ward's method shown here.  For other options, see below.)</LI>
d199 5
a203 5
	    <LI>spider rct/dat @@hierarchical</LI>
	    <LI>spider rct/dat @@binarytree</LI>
	    <LI>cd Zerodegr/Tree ; ../../tree.py labeled001.dat 6 goodclasses.dat</LI>
	</OL>
    <LI>Iterate:</LI> 
d205 13
a217 13
	    <LI>spider rct/dat @@multirefalign (subsequently @@multirefalign-descend)</LI> 
	    <LI>spider rct/dat @@filtershrink</LI> 
	    <LI>spider rct/dat @@classifybyview</LI>
	    <LI>verifybyview.py</LI> 
	</OL>
    <LI>spider rct/dat @@combinegoodclasses</LI> 
    <LI>spider rct/dat @@viewaverages</LI> 
    <LI>spider rct/dat @@centertilt</LI>
    <LI>spider rct/dat @@storeangles</LI>
    <LI>(optional) spider rct/dat @@d6symmetry</LI>
    <LI>spider rct/dat @@bpclass</LI>
    <LI>spider rct/dat @@volfilt</LI>
    <LI>(if multiple orientations) Do both of: </LI>
d219 5
a223 5
	    <LI>spider rct/dat @@volalignprj</LI>
	    <LI>spider rct/dat @@mergevols</LI>
	</OL>
    <LI>spider rct/dat @@prepare-prjmatch</LI>
</OL></code>
d226 1
a226 1
<a name="start"><HR></a>
d234 1
a234 1
   <p></p>
d238 3
a240 3
<UL>
    <LI>Before unpackaging the batch-file <a href="../tar_archive/archive.htm">tarball</a> 
	(as described below), create a new directory, and change to that directory .</LI>
d242 1
a242 1
    <LI>Micrographs should be placed in the <B>Micrographs/</B> directory.  
d244 2
a245 2
	<a href="../convert.rct">convert.rct</a> for the conversion. </LI>
</UL>
d248 3
a250 4
There are two different choices for running SPIDER procedures: Using 
<a href="http://www.wadsworth.org/spider_doc/spire/doc/index.html">
<font class="guitool">SPIRE</font></a> or using SPIDER
procedures directly.
d256 1
a256 1
    then read <a href="http://www.wadsworth.org/spider_doc/spire/doc/index.html">
d258 1
a258 1
    <a href="http://www.wadsworth.org/spider_doc/spire/doc/project.html">
d260 1
a260 1
    In this case, the configuration file is called <B>rct.xml</B>, 
d263 1
a263 1
    <P> Even if you are <U>not</U> using <font class="guitool">SPIRE</font>, 
d267 1
a267 1
    </P>
d269 3
a271 3
    <P> Installation instructions for <font class="guitool">SPIRE</font> can be found 
    <a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html#FullInstall">here</a>.
    </P>
d296 1
a296 1
<a name="proc"><HR></a>
d305 1
a305 1
   <p></p>
d309 1
a309 1
<UL>
d313 1
a313 1
    <p>Download the latest <a href="../tar_archive/archive.htm">batch-file archive</a>, 
d316 1
a316 1
    <P><code class="snippet">tar -xvf $ARCHIVE.tar</code></p>
d319 1
a319 1
    so create a new directory if so desired.</LI>
d321 1
a321 1
<P></P>
d327 1
a327 1
    The batch file <a class="project" href="../makeparams.rct">makeparams.rct</a> stores these parameters.
d334 1
a334 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon1/myproject/Docs/params.html">
d348 1
a348 1
		<BR>See <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon1/myproject/Docs/params.html">
d361 2
a362 2
    <P>Alternatively, you can copy and modify this file from elsewhere. 
       An example file called <font class="input">bak-params</font> is present in the tarball.</P>
d365 1
a365 1
<LI><P><B>[Optional] Copy sample data</B></P></LI>
d367 1
a367 1
    <P> The sample data set, from Nicolas Boisset, 
d369 1
a369 1
	Download the <a href="../tar_archive/data20060817.tar">data archive</a>
d372 1
a372 1
	<P><code class="snippet">tar -xvf data20060817.tar</code></p>
d378 1
a378 1
    </P>
d381 1
a381 1
<LI><P><B>Generate a list of micrographs</B></P></LI>
d383 1
a383 1
    <P> The Python script <a href="../mkfilenums.py">mkfilenums.py</a> 
d387 1
a387 1
        <P><code class="snippet">mkfilenums.py filenums.dat Micrographs/zeiss*.tif</code></P>
d389 2
a390 2
        <P> This Python script requires the Spiderutils library from 
            <a href="http://www.wadsworth.org/spider_doc/spire/doc/index.html"><font class="guitool">SPIRE</font></a>. 
d393 1
a393 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/doccreate.html">
d395 1
a395 1
        </P>
d398 1
a398 1
<LI><P><b>If the micrographs are not already in SPIDER format, then convert them</b></P></LI>
d400 1
a400 1
    <P>The batch file <a href="../convert.rct">convert.rct</a>, 
d406 1
a406 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon1/myproject/Docs/params.html">
d409 1
a409 1
    </P>
d417 1
a417 1
    <P> If the micrographs are in Z/I TIFF format, 
d421 1
a421 1
    </P>
d424 1
a424 1
<LI><P><B>Shrink the micrographs</B></P></LI>
d426 1
a426 1
    <P> Here, we will choose a reduction factor such that the micrograph fits on the screen
d428 1
a428 1
	The batch file <a href="../shrinkmics.rct">shrinkmics.rct</a> will 
d431 1
a431 1
    </P>
d439 3
a441 3
    <P> The filtration step is slow, so 
	by setting <B><I>[filter-radius]=0</I></B>, you can skip this step. 
    </P>
d444 1
a444 1
<LI><P><B>Screen micrographs</B></P></LI>
d446 1
a446 1
    <P> Not all of the tilt pairs will be usable, so we will screen them. 
d449 1
a449 1
	<code class="snippet">cd Micrographs/</code> and type:</P>
d451 1
a451 1
    <P> <code class="snippet">montagefromdoc.py ../filenums.dat sm-mic* </code></p>
d453 1
a453 1
    <P> The tarball should have left a (hidden) file called
d456 1
a456 1
	<font class="input">../filenums</font>.</P>
d458 1
a458 1
    <P> If you wish to remove micrographs by editing <B>filenums</B>
d461 2
a462 2
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/docren.html">
	'DOC REN'</a>. (The input and output can have the same name.)</P> 
d465 1
a465 1
<LI><P><B>Establish pairings between micrographs</P></B></LI>
d467 1
a467 1
    <P> The batch file <a href="../micpair.rct">micpair.rct</a> reads 
d470 1
a470 1
    </P>
d478 1
a478 1
    <P> This batch file presumes that the tilted-specimen micrograph 
d481 1
a481 1
    </P>
d484 1
a484 1
<LI><P><B>Resize micrographs 
d486 1
a486 1
    not required for <font class="guitool">WEB</font>]</B></P></LI>
d488 2
a489 2
    <P> JWEB has a "feature" that requires the tilt pair to have the same dimensions. 
	The batch file <a href="../padmics.rct">padmics.rct</a> reads pairs 
d493 1
a493 1
    </P>
d502 1
a502 1
    <P> Another "feature" of JWEB is 
d508 1
a508 1
    </P>
d511 1
a511 1
<LI><P><B>Pick tilt pairs</B></P></LI>
d513 1
a513 1
    <P> In this step, we need to pick the same particle in the untilted- and tilted-specimen images. 
d515 1
a515 1
	<font class="guitool">JWEB</font> or <font class="guitool">WEB</font>:</P>
d518 4
a521 4
	    <LI>If using <font class="guitool">JWEB</font>: </LI>
	      <OL>
		<LI>From the <B>Micrographs/</B> directory, open JWEB. </LI>
		<LI>Go to <I>File -> Open -> Image Series</I> and select a pair of micrographs: 
d526 1
a526 1
		    for ease of use with the batch files below.  
d529 5
a533 5
		    <a href="../padmics.rct">padmics.rct</a>.</LI>
		<LI>Click on the <I>Markers/Tilt Pair</I> tab.</LI>
		<LI>In the <I>Marker File Number</I> field, enter the number of the <U>UN</U>tilted micrograph.</LI>
		<LI>Click on the <I>Show/Edit Marker</I> button, which will display the images.</LI>
		<LI>Select a particle from the untilted micrograph, and 
d541 6
a546 6
		    it may be easier to proceed from right to left.</LI>
		<LI>Click on buttons <I>Save Marker Files</I> and <I>Determine Theta</I>, 
		    which will determine the magnitude of the tilt angle between the micrographs.</LI>
		<LI>Click on the <I>Fit Angles</I> button.
		    This will determine the direction of the tilt axis.</LI>
		<LI>Click on the <I>Draw Fitted Locations</I> button.
d548 13
a560 13
		    but does not affect the coordinates selected with the mouse.</LI>
		<LI>Click on the <I>Save Angles</I> button.</LI>
		<LI>Now, when you select a particle in the untilted image, 
		    JWEB will send the cursor to the corresponding location in the tilted image.</LI>
		<LI>Select more particles from the tilt pair. 
		    (For the <a href="../tar_archive/data20060817.tar">sample micrograph</a>, 
		    there are 76 pairs.  Select all of them.)</LI>
		<LI>To save the new values, re-click the five buttons: <I>Save Marker Files</I>, <I>Determine Theta</I>, 
		    <I>Fit Angles</I>, <I>Draw Fitted Locations</I>, and <I>Save Angles</I>.</LI>
	      </OL>
	    <LI>If using <font class="guitool">WEB</font>: </LI>
	      <OL>
		<LI>From the menu, select <I>COMMANDS</I> &gt; <I>Tilted Particles</I>, 
d568 1
a568 1
		    continue to use the parameter <I><B>[decimation-factor]</B></I> that you used in 
d572 4
a575 4
		    </LI>
		<LI>In the <I>Particle doc</I> popup window, under <I>Doc file number</I>, 
		    enter the number of the <U>UN</U>tilted micrograph and click <I>ACCEPT</I>.</LI>
		<LI>Select a particle from the untilted micrograph, and 
d579 12
a590 12
		    ideally in the four corners, but the farther apart the better.</LI>
		<LI>Click the middle button to open the <I>Particle picking menu_popup</I>.</LI>
		<LI>Click on <I>Determine tilt axis angles</I>, <I>Draw fitted locations</I>, 
		    and <I>Save angles in doc file</I>.</LI>
		<LI>Now, when you select a particle in the untilted image, 
		    WEB will send the cursor to the corresponding location in the tilted image.</LI>
		<LI>Select more particles from the tilt pair. 
		    (For the sample micrograph, there are 76 pairs.  Select all of them.)</LI>
		<LI>To save the new values, re-click the three buttons: <I>Determine tilt axis angles</I>, 
		    <I>Draw fitted locations</I>, and <I>Save angles in doc file</I>.</LI>
	      </OL>
	</OL>
d593 8
a600 8
	    <UL>
		<LI>WEB does not require the pair of micrographs to be the same size, 
		    so the step <a href="../padmics.rct">padmics.rct</a> is unnecessary. </LI>
		<LI>There is no <I>Save Marker Files</I> button in the current verion of WEB.
		    Coordinates are saved continuously.</LI>
		<LI><I>Determine Theta</I> and <I>Fit Angles</I> are now merged into one button, 
		    <I>Determine tilt axis angles</I>.</LI>
	    </UL>
d603 2
a604 2
	  <UL>
	    <LI>Save the coordinates frequently. 
d607 2
a608 2
		Delete those particles (using the middle mouse button), and re-pick them, as necessary.</LI>
	    <LI>If, while picking pairs, the fitted locations stray from the correct location 
d611 2
a612 2
		it may help to re-do the fitting (summarized under the previous bullet).</LI>
	    <LI>If you close a pair or micrographs and re-open them
d614 3
a616 3
		you can resume from where you left off.</LI>
	  </UL>
	<P></P>
d619 1
a619 1
<LI><P><B>Obtain a noise image for normalization</B></P></LI>
d621 2
a622 2
    <P> We will be normalizing the images using the SPIDER command 
	 <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cefit.html">
d624 1
a624 1
	The batch file <a href="../makesomenoise.rct">makesomenoise.rct</a> will window out 
d628 1
a628 1
    </P>
d639 1
a639 1
    <P> You can look at the noise images <font class="output">tmpnoise/noi***</font>
d643 1
a643 1
	<font class="output">noise.dat</font>.</P>
d646 1
a646 1
<LI><P><B>Window out particles from tilted and untilted micrographs.</B></P></LI>
d648 1
a648 1
    <P> In this step, the batch file <a href="../windowparticles.rct">windowparticles.rct</a>
d655 1
a655 1
    </P>
d657 1
a657 1
    <P> For the parameter <B><I>[decimation-factor]</I></B>, 
d669 1
a669 1
    </P>
d683 1
a683 1
    </P>
d685 1
a685 1
    <P> There are additional outputs, <font class="output">Zerodegr/Unrot/unt*****</font> and 
d689 1
a689 1
    </P>
d691 1
a691 1
<LI><P><B>[Recommended for negatively-stained images] High-pass filter windowed images</B></P>
d693 1
a693 1
    <P>For negatively-stained images, it is often the case that the puddle of stain surrounding the particles 
d697 1
a697 1
    however, the aligning power of the images will be lost.  You may need to tweak the radii.</P> 
d699 1
a699 1
    <P>If you are unsure whether to do these steps, feel free to skip them, 
d701 1
a701 1
    in order to see if the stain is the predominant source of variation. </P> 
d703 1
a703 1
    <P>The batch files <a href="../highpass-untilted.rct">highpass-untilted.rct</a> and
d718 3
a720 3
    <P> If you don't like the appearance of the output images, 
	delete the corresponding <B>Winrot/</B> directory and 
	rename the <B>Unhighpass/</B> directory back to <B>Winrot/</B>. </P>
d723 1
a723 1
<LI><P><B>Screen the windowed images for defects (micrograph edges, dust, etc.).</B></P></LI>
d728 2
a729 2
	  <OL>
	    <LI>Open the untilted-specimen images by typing:
d732 4
a735 4
		but ensure that the output doc file is called <font class="output">notgood</font></LI>
	    <LI>Select only the bad particles.  
		Hit <I>PageDown</I> and <I>PageUp</I> to navigate though the screenfuls of images. </LI>
	    <LI>Save the selection file with <I>CTRL-s</I>.  
d737 11
a747 11
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
		here</a>.</LI>
	    <LI>If particles are to be rejected, run: <a href="../removebad.rct">removebad.rct</a>. 
		This batch file, and its subroutine <a href="../backup.rct">backup.rct</a>,
		backs up and updates <B>listparticles</B>.</LI>
	    <LI>Screen the tilted-specimen images by typing:
		<BR><code class="snippet">montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</code></LI>
	    <LI>Select the bad particles. </LI>
	    <LI>If additional particles are to be rejected, re-run: <a href="../removebad.rct">removebad.rct</a>  
		to update <B>listparticles</B>.</LI>
	  </OL>
d749 1
a749 1
    <P> The types of particles that should be rejected are those that will interfere with the 2D alignment 
d757 1
a757 1
    </P>
d759 1
a759 1
<LI><P><B>Align the untilted-specimen particles using reference-free alignment.</B></P></LI>
d761 1
a761 1
    <P> In order to run classification, the particle will first be run through reference-free alignment.  
d765 1
a765 1
    </P>
d767 3
a769 3
    <P> There are a few different implementations of reference-free alignment, such as 
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsr.html">'AP SR'</a>. 
	The batch file used here, <a href="../pairwise.rct">pairwise.rct</a>, uses an algorithm called 
d771 1
a771 1
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/MSA/index.html">
d773 1
a773 1
    </P>
d779 1
a779 1
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsr.html">'AP SR'</a>, 
d795 1
a795 1
<LI><P><b>[Optional] Align average along coordinate axes</P></b></LI>
d797 1
a797 1
    <P> These two steps are for purely aesthetic reasons. 
d799 1
a799 1
	These two steps attempt to reorient the average to a less arbitrary orientation.</P>
d801 2
a802 2
      <OL>
	<LI>The batch file <a href="../reorientavg.rct">reorientavg.rct</a> 
d817 2
a818 2
	    <P> The output <font class="output">Zerodegr/Pairwise/malign</font> 
		outlines the progress of the batch file. 
d821 1
a821 1
		The batch file then takes the autocorrelation functions (ACF) of both images and 
d824 2
a825 2
		The batch file also attempts to align the images in real space (solutions 3 &amp; 4).
	    </P>
d829 2
a830 2
	    enter it as parameter <I><B>X10</B></I> in <a href="../sumalign.rct">sumalign.rct</a>.
	    This batch file reads the alignment information for the corresponding solution number from 
d850 1
a850 1
      </OL>
d853 1
a853 1
<LI><P><B>Filter and shrink the aligned, untilted-specimen particles.</B></P></LI>
d855 1
a855 1
	The batch file <a href="../filtershrink.rct">filtershrink.rct</a> 
d860 1
a860 1
	will be easier to recognize if they are low-pass filtered.</P>
d869 1
a869 1
	<P> The default parameters are hopefully reasonable. 
d871 1
a871 1
	    <BR><code class="snippet">montagefromdoc.py listparticles.dat Zerodegr/Filtered/flt*</code></P>
d873 1
a873 1
	<P> Adjust the filtration parameters as necessary, and re-run. 
d875 1
a875 1
	</P>
d878 1
a878 1
<LI><P><B>Run multivariate statistical analysis (MSA) on filtered images.</B></P></LI>
d880 1
a880 1
    <P> The batch file <a href="../ca-pca.rct">ca-pca.rct</a> runs 
d883 1
a883 1
	without running MSA, but here we will be using it. </P>
d885 1
a885 1
    <P> What this means, briefly, is that systematic variations are reduced into 
d894 1
a894 1
    </P>
d896 1
a896 1
    <P> For a more complete description of multivariate statistical analysis 
d900 2
a901 2
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/tutorial.html">
	classification and clustering tutorial</a></P>
d910 1
a910 1
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/tutorial.html#virtual">
d920 2
a921 2
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cas.html">'CA S'</a>, see the
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/tutorial.html#CAPCA">
d939 1
a939 1
		    <BR>If after you run this batch file, all of the eigenimages look meaningful,
d948 1
a948 1
<LI><P><B>Classify images.</B></P></LI>
d950 1
a950 1
    <P> At this step, we willl attempt to separate the images into homogeneous subclasses.  
d956 1
a956 1
    </P>
d958 2
a959 2
    <P> For any of the classification options presented here, 
	choose the number of factors to use (parameter <I><B>x27</B></I>) 
d963 1
a963 1
    </P>
d965 1
a965 1
    <P> There are three classification options given here. 
d967 1
a967 1
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/MSA/index.html">
d969 1
a969 1
    </P>
d971 2
a972 2
    <P> To view the particles belonging to each class, refer below to the 
	<a href="#vbv">instructions about <font class="guitool">verifybyview</font></a>.</P>
d976 3
a978 3
	    <LI><B>[Recommended] Hierarchical classification, using Ward's method.</B> </LI>
	      <OL>
		<LI><P><B>Run hierarchical classification.</B></P> </LI>
d980 2
a981 2
		    <P> This classification method uses SPIDER command
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/clhc.html">'CL HC'</a>. 
d983 1
a983 1
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/tutorial.html#clhc">
d985 1
a985 1
		    </P>
d987 1
a987 1
		    The batch file <a href="../hierarchical.rct">hierarchical.rct</a> 
d995 1
a995 1
				<BR>See the <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/tutorial.html#clhc">
d1000 1
a1000 1
		<LI><B>Generate class averages.</B></LI>
d1002 1
a1002 1
		<P> In the previous step, we didn't explicitly assign classes. 
d1004 1
a1004 1
		    In this step, we will explicitly pare down the dendrogram into classes.</P>
d1008 1
a1008 1
		    <LI><B>[Recommended] Generate binary tree</B></LI>
d1010 1
a1010 1
			<P> It is somewhat arbitrary where to cut off the dendrogram 
d1012 1
a1012 1
			    This batch file will generate class averages for <U>all</U> depths until a specified cutoff, 
d1021 1
a1021 1
			</P>
d1023 1
a1023 1
			<P> In the batch file <a href="../binarytree.rct">binarytree.rct</a> 
d1026 2
a1027 2
			    the parameter <I><B>[end-depth]</B></I> 
			    will call for 2**<I><B>[end-depth]</B></I> class averages. 
d1029 1
a1029 1
			</P>
d1041 1
a1041 1
			<P><U>NOTE</U>: The format of SPIDER's dendrogram doc file changed in version 17.13. 
d1043 2
a1044 2
			    If this batch file crashes, check the parameter <B><I>[top-branch]</I></B>.
			</P>
d1046 1
a1046 1
			<P> Instructions for viewing the binary tree are given below, 
d1048 1
a1048 1
			</P>
d1050 1
a1050 1
		    <LI><B>Generate a pre-specified number of class averages</B></LI>
d1052 1
a1052 1
		    <P> This option cuts off the dendrogram <font class="input">dendrodoc</font> at a specific height.  
d1054 2
a1055 2
			The number of classes desired is specified by the parameter <I><B>x20</B></I> in 
			the batch file <a href="../classavg.rct">classavg.rct</a>. 
d1058 1
a1058 1
		    </P>
d1077 2
a1078 2
		  </OL>
	      </OL>
d1080 1
a1080 1
	    <LI><P><B>Run K-means classification</B></P> </LI>
d1082 2
a1083 2
	    <P> K-means classification uses the SPIDER command
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/clkm.html">
d1086 1
a1086 1
		The batch file <a href="../kmeans.rct">kmeans.rct</a> reads 
d1088 1
a1088 1
		generates <I>K</I> (parameter <I><B>x20</I></B> in the batch file) classes 
d1090 1
a1090 1
	    </P>
d1114 3
a1116 3
	    <LI><P><B>Clustering using Diday's method</B></P> </LI>
	      <OL>
		<LI><P><B>Run hierarchical classification.</B></P> </LI>
d1118 2
a1119 2
		    The batch file <a href="../cluster.rct">cluster.rct</a> uses SPIDER command
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/clcla.html">
d1129 1
a1129 1
				    <BR>See the <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/tutorial.html#clhc">
d1134 1
a1134 1
		<LI><B>Generate class averages.</B></LI>
d1136 1
a1136 1
		    <P> With the previous step, analogously to Ward's method above, 
d1140 1
a1140 1
			which describes the relatedness of the images. </P>
d1142 1
a1142 1
		    <P> In the batch file <a href="../classavg.rct">classavg.rct</a>, 
d1146 1
a1146 1
			so for now, it's functionally equivalent to K-means.) </P>
d1148 4
a1151 4
		    <P> <U>NOTE:</U> The default filenames in the batch file are for Ward's method, 
			so change the file label in the batch file <I><B>[class_dir]</B></I> from 
			<B>Zerodegr/Hierarchical</B> to <B>Zerodegr/Cluster</B>.
		    </P>
d1170 2
a1171 2
	      </OL>
	  </OL>
d1173 1
a1173 1
    <P> It may be informative to see the individual particles that belong to each class. 
d1175 1
a1175 1
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/interface.htm">
d1181 1
a1181 1
    </P>    
d1183 1
a1183 1
<LI><P><B>Select unique classes</B></P></LI>
d1185 1
a1185 1
    <P> In the next step, we will select class averages to use as references for multireference alignment. 
d1189 1
a1189 1
    </P>
d1192 1
a1192 1
	<LI><a name="treepy"><B>View and select classes from binary tree</B></a></LI>
d1194 1
a1194 1
	    <P> To view the binary tree, <code class="snippet">cd Zerodegr/Tree</code> and run:
d1196 1
a1196 1
	    </P>
d1198 1
a1198 1
	    <P> The parameter <B><I>6</I></B> on the command line above specifies 
d1200 1
a1200 1
		A depth of <B><I>2</I></B>, in comparison, 
d1209 1
a1209 1
	    </P>
d1211 1
a1211 1
	    <P> As one proceeds down the tree, the number of classes increases, and 
d1219 1
a1219 1
	    </P>
d1221 1
a1221 1
	    <P> Save the selection file with <I>CTRL-s</I>. 
d1223 1
a1223 1
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/MSA/index.htm">
d1225 1
a1225 1
	    </P>
d1227 2
a1228 2
	    <P> The script <A HREF="../tree.py"><font class="guitool">tree.py</font></A> requires the library 
		<A HREF="http://www.wadsworth.org/spider_doc/spider/docs/python/spipylib/code/Spiderutils.html">
d1230 1
a1230 1
		<A HREF="http://www.wadsworth.org/spider_doc/spire/doc/packages.html">
d1239 1
a1239 1
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/doccreate.html">
d1242 1
a1242 1
	    </P>
d1244 2
a1245 2
	<LI><B><a name="vbv">View the class averages and, optionally, the constituent particles using 
	    <font class="guitool">verifybyview.py</font></a></B></LI>
d1247 1
a1247 1
	    <P> This option can be used for any of the classification schemes described above. 
d1250 1
a1250 1
	    </P>
d1252 1
a1252 1
	    <P> Open <font class="guitool">verifybyview.py</font> by typing: <BR>
d1256 1
a1256 1
	    </P>
d1258 1
a1258 1
	    <P> The script <A HREF="../tree.py"><font class="guitool">verifybyview.py</font></A> 
d1260 1
a1260 1
		See the <A HREF="http://www.wadsworth.org/spider_doc/spire/doc/packages.html">
d1262 1
a1262 1
	    </P>
d1276 1
a1276 1
			<td>Change <I><B>CCC</B></I> to <I><B>N</B></I>
d1285 1
a1285 1
	    </P>
d1325 1
a1325 1
	    <P> When you click on a class average 
d1330 1
a1330 1
	    </P>
d1332 1
a1332 1
	    <P> It is unnecessary to verify individual particles at this time. 
d1337 2
a1338 2
	    </P>
      </OL>
d1341 1
a1341 1
<LI><P><B>Run multireference alignment</B></P></LI>
d1343 1
a1343 1
    <P>The batch file <a href="../multirefalign.rct">multirefalign.rct</a> 
d1352 1
a1352 1
    </P>
d1354 2
a1355 2
    <P><U>NOTE</U>: Ensure that the classification method that you used 
	is reflected in the batch file label <B><I>[old_class_dir]</I></B>. 
d1357 2
a1358 2
	The default in the batch file is <font class="input">Zerodegr/Tree</font>. 
    </P>
d1370 1
a1370 1
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsh.html">
d1389 1
a1389 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html">'CG PH'</a>. 
d1391 1
a1391 1
		    <BR>You can look at the <B>Zerodegr/Multiref/ref***</B> files during the 
d1401 1
a1401 1
<LI><P><B>Re-filter aligned images</B></P></LI>
d1403 1
a1403 1
    <P> With newly aligned images, we will re-filter, and optionally shrink the images before re-classifying them. 
d1407 1
a1407 1
    </P>
d1416 1
a1416 1
    <P> Adjust the parameters as necessary, 
d1418 1
a1418 1
    </P>
d1420 1
a1420 1
<LI><P><B>Classify the particles assigned to each reference</B></P></LI>
d1422 1
a1422 1
    <P> In the next step, we will perform separate classifications for the particles belonging to each reference. 
d1428 1
a1428 1
    </P>
d1430 1
a1430 1
    <P> The batch file <a href="../classifybyview.rct">classifybyview.rct</a> 
d1436 1
a1436 1
    </P>
d1470 1
a1470 1
		<td>If this batch file crashes after <I>N</I> reference-views, 
d1472 1
a1472 1
		    re-start the batch file at <I>N+1</I>.</td></tr>
d1481 1
a1481 1
<LI><P><B>Check the classification results using <font class="guitool">verifybyview</font></B></P></LI>
d1483 1
a1483 1
    <P> We will check the results of the classifiaction using <font class="guitool">verifybyview</font>, 
d1485 1
a1485 1
	See the <A HREF="http://www.wadsworth.org/spider_doc/spire/doc/packages.html">
d1487 1
a1487 1
    </P>
d1489 1
a1489 1
    <P> Specifically, what we are looking for is that there is no subpopulation within each reference-view 
d1495 1
a1495 1
    </P>
d1497 1
a1497 1
    <P> Open <font class="guitool">verifybyview.py</font> by typing: <BR>
d1499 1
a1499 1
    </P>
d1501 1
a1501 1
    <P> Included in the tarball is a starting <a href="../.verifybyview">.verifybyview</a> file 
d1508 2
a1509 2
	to <B>.verifybyview</B>
    </P>
d1549 1
a1549 1
    <P> When you click on a class average 
d1552 1
a1552 1
    </P>
d1554 1
a1554 1
    <P> It is unnecessary to verify individual particles at this time. 
d1564 1
a1564 1
    </P>
d1566 1
a1566 1
<LI><P><B>Iterate multireference alignment and classification</B></P></LI>
d1568 1
a1568 1
    <P> We will iterate multireference alignment, filtration, and classification until 
d1572 1
a1572 1
    </P>
d1577 2
a1578 2
      <OL>
	<LI><B>Run multireference alignment</B> </LI>
d1580 1
a1580 1
	<P> The classes selected in the previous round of multireference alignment 
d1585 1
a1585 1
	</P>
d1587 1
a1587 1
	The batch file <a href="../multirefalign-descend.rct">multirefalign-descend.rct</a> 
d1591 2
a1592 2
	    <UL>
		<LI>The input file label <B><I>[old_class_dir]</I></B> 
d1594 7
a1600 7
		    is instead <font class="input">Zerodegr/Multiref</font></LI>
		<LI>The output file label <B><I>[multiref_dir]</I></B> goes from 
		    <font class="output">Zerodegr/Multiref</font> to <font class="output">Zerodegr/Multiref2</font></LI>
		<LI>The parameter <B><I>[subdir-flag]</I></B> is set to <I>1</I> 
		    to tell the batch file to look in the 
		    <font class="input">View###</font> subdirectories</LI> 
	    </UL>
d1602 1
a1602 1
	<P>For an exhaustive list of differences between the two batch files, type: <BR>
d1606 1
a1606 1
	<LI><B>Filter the aligned particles</B> </LI>
d1608 1
a1608 1
	    <P>Run <a href="../filtershrink.rct">filtershrink.rct</a> as previously.</P>
d1610 1
a1610 1
	<LI><B>Classify the particles assigned to each reference</B> </LI>
d1612 4
a1615 4
	    <P>Run <a href="../classifybyview.rct">classifybyview.rct</a> with one difference: <BR>
		The input/output directory <B><I>[class_dir]</I></B> should be changed from 
		<B>Zerodegr/Multiref</B> to <B>Zerodegr/Multiref2</B> </P>
      </OL>
d1618 3
a1620 3
      <OL>
	<LI>In <a href="../multirefalign-descend.rct">multirefalign-descend.rct</a>, 
	    change input file label <B><I>[old_class_dir]</I></B> from 
d1624 6
a1629 6
	</LI>
	<LI>In <a href="../classifybyview.rct">classifybyview.rct</a>, 
	    change the label <B><I>[class_dir]</I></B> from 
	    <B>Zerodegr/Multiref2</B> to <B>Zerodegr/Multiref3</B>
	</LI>
      </OL>
d1633 1
a1633 1
    <P> Iterate these 3 steps until no new classes appear. </P>
d1635 1
a1635 1
    <P> <U>NOTE</U>: In several steps below, I will assume that you run 2 iterations of multireference alignment. 
d1638 1
a1638 1
	</P>
d1641 1
a1641 1
<LI><P><a name="verify"><B>Verify individual particles from last iteration of multireference alignment</a></B></P></LI>
d1643 1
a1643 1
    <P> When we compute the 3D reconstruction, we will use only the highest-quality particles. 
d1648 1
a1648 1
    <P> You should have screened the class averages in the previous step, so 
d1653 1
a1653 1
    </P>
d1655 1
a1655 1
    <P> Now, when you open a montage of individual particle images, 
d1661 1
a1661 1
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/interface.htm">
d1663 1
a1663 1
    </P>
d1676 1
a1676 1
    <P><U>NOTE:</U> When you finish going through the class averages for a particular reference-view, 
d1680 1
a1680 1
    </P>
d1683 1
a1683 1
<LI><P><B>Combine selected particles from selected classes</B></P></LI>
d1685 1
a1685 1
    <P> Following the previous step, the selected particles are distributed over 
d1690 1
a1690 1
	In this batch file, <a href="../combinegoodclasses.rct">combinegoodclasses.rct</a>, 
d1693 1
a1693 1
    </P>
d1702 1
a1702 1
    <P> If in you final iteration of multireference alignment, 
d1708 1
a1708 1
    </P>
d1710 1
a1710 1
    <P> <U>HINT</U>: It may be useful to re-classify only the good particles, 
d1712 1
a1712 1
	In that case, re-run classifyview using <B>goodsel***</B> instead of <B>selview***</B>.
d1718 1
a1718 1
    </P>
d1721 1
a1721 1
<LI><P><B>Average selected images</B></P></LI>
d1723 1
a1723 1
    <P> In this step, we will generate averages of the good particle images. 
d1727 1
a1727 1
    </P>
d1729 1
a1729 1
    <P> The batch file <a href="../viewaverages.rct">viewaverages.rct</a> 
d1735 1
a1735 1
    </P>
d1748 1
a1748 1
    <P> If in you final iteration of multireference alignment, 
d1754 1
a1754 1
    </P>
d1757 1
a1757 1
<LI><P><B>Center tilted-specimen particles</B></P></LI>
d1759 1
a1759 1
    <P> The goal of any 3D reconstruction technique is, for each 2D image, 
d1767 1
a1767 1
    </P>
d1769 2
a1770 2
    <P> The batch file <a href="../centertilt.rct">centertilt.rct</a> uses the command
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsa.html">'AP SA'</a>, 
d1773 1
a1773 1
    </P>
d1797 1
a1797 1
    <P> Following the reference-free translational alignment, 
d1799 3
a1801 3
	depending on the parameter <B><I>[cg-option]</I></B>. 
	The default, option <B><I>1</I></B>, uses the command 
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html">'CG PH'</a>, 
d1803 1
a1803 1
	As an alternative, option <B><I>2</I></B> for <B><I>[cg-option]</I></B> 
d1806 1
a1806 1
	option <B><I>0</I></B> bypasses the center-of-gravity calculation altogether. 
d1810 1
a1810 1
    </P>
d1812 2
a1813 2
    <P> The parameters regarding filtration are to help the reference-free alignment command, 
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsa.html">'AP SA'</a>. 
d1816 1
a1816 1
    </P>
d1818 1
a1818 1
    <P> If this batch file runs slowly, you can save time by centering only the selected particles.  
d1822 3
a1824 3
	A commented-out version of this label <B><I>[selection_list]</I></B> 
	is present in the batch file.
    </P>
d1826 1
a1826 1
    <P> To look at the centered tilted particles, type:<BR>
d1828 1
a1828 1
    </P>
d1831 1
a1831 1
<LI><P><B>[Optional] Generate symmetry files</B></P></LI>
d1833 2
a1834 2
    <P> This step is primarily for the 
	<a href= "http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
d1836 1
a1836 1
	The batch file <a href="../d6symmetry.rct">d6symmetry.rct</a> will generate files that 
d1838 1
a1838 1
    </P>
d1840 1
a1840 1
    <P> The worm hemoglobin used in the Nature Protocols data set has D6 symmetry, 
d1847 1
a1847 1
    </P>
d1860 2
a1861 2
    <P> To generate a doc file corresponding to a different symmetry, use the command 
	<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/sy.html">
d1863 1
a1863 1
    </P>
d1866 1
a1866 1
<LI><P><B>Store Euler angles</B></P></LI>
d1868 1
a1868 1
    <P> In this step, the batch file <a href="../storeangles.rct">storeangles.rct</a>
d1874 1
a1874 1
	adjust the batch file as necessary). 
d1876 1
a1876 1
    </P>
d1890 1
a1890 1
    <P> Changing parameter <B><I>[mirror-yn]</I></B> will reverse the handedness of the structure. 
d1897 1
a1897 1
    </P>
d1900 1
a1900 1
<LI><P><B>Compute 3D reconstructions for each class</B></P></LI>
d1902 1
a1902 1
    <P> The batch file <a href="../bpclass.rct">bpclass.rct</a> and 
d1910 1
a1910 1
    </P>
d1920 2
a1921 2
    <P> For the <a href= "http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
	Nature Protocols RCT data set</a>, edit the batch file <a href="../bpclass.rct">bpclass.rct</a> 
d1923 1
a1923 1
	Then, go to the end of the batch file and make sure that 
d1925 1
a1925 1
	(by default in the batch file, classes 1 &amp; 3) and that 
d1928 1
a1928 1
    </P>
d1931 1
a1931 1
<LI><P><B>Filter 3D reconstructions</B></P></LI>
d1933 1
a1933 1
    <P> The batch file <a href="../volfilt.rct">volfilt.rct</a> Fourier filters one or all reconstructions 
d1936 1
a1936 1
    </P>
d1954 1
a1954 1
		    <BR>The default value of <B><I>0</I></B> will filter all class volumes.
d1972 1
a1972 1
    <P> The reason for the usage of the file <font class="output">Volumes/docvolfilt</font> is that 
d1978 1
a1978 1
    </P>
d1981 1
a1981 1
<LI><P><B>[Optional] Run projection onto convex sets (POCS)</B></P>
d1983 1
a1983 1
    <P> Detailed <a href="misc.htm#pocs">information about POCS can be found here</a>. 
d1986 1
a1986 1
    </P>
d1988 5
a1992 5
      <OL>
	<LI>Generate a binary mask</LI>
	<LI>[Optional] Choose a projection by which to gauge the progress of POCS</LI>
	<LI>Run POCS</LI>
      </OL>
d1994 1
a1994 1
<LI><P><B>[If multiple classes] Align volumes to each other</B></P>
d1996 1
a1996 1
    <P> If you have multiple classes, it remains to be seen whether the classes correspond to the same structure. 
d1998 1
a1998 1
	The batch file <a href="../volalignprj.rct">volalignprj.rct</a> and 
d2002 1
a2002 1
    </P>
d2004 1
a2004 1
    <P>Note that this batch file aligns two volumes to each other.
d2007 1
a2007 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/pj3q.html">'PJ 3Q'</a>,
d2009 1
a2009 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>
d2011 1
a2011 1
    </P>
d2035 1
a2035 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsh.html">
d2063 1
a2063 1
    <P>The first row of each slice in <B>mproj***</B> shows the reference projection. 
d2067 1
a2067 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>.</P>
d2069 1
a2069 1
    <P>If the better alignment solution is not solution #1, then 
d2072 1
a2072 1
       set this value to <I>0</I> in <font class="output">Volumes/Alignment/list2merge</font>.</P>
d2074 1
a2074 1
    <P> The aligned class volume <font class="output">Volumes/Alignment/vali***</font> 
d2080 2
a2081 2
	by setting the parameter in that batch file <B><I>[classvols-yn]</I></B> is set to <B><I>1</I></B>. 
    </P>
d2083 2
a2084 2
    <P>The re-projections <B>prj_***</B> will illustrate the missing-cone artifact better than 
       isosurface presentations.</P>
d2087 1
a2087 1
<LI><P><B>[Optional] Merged particles from aligned class volumes into one reconstruction</B></P></LI>
d2089 2
a2090 2
    <P> You will need to decide subjectively whether the aligned class volumes are sufficiently similar to merge. 
	The batch file <a href="../mergevols.rct">mergevols.rct</a> combines data from many steps.</P>
d2129 1
a2129 1
    <P>If the parameter <B><I>[classvols-yn]</I></B> is set to <B><I>1</I></B>, 
d2132 1
a2132 1
       They should look very similar to the <B>vali***</B> reconstructions from the previous step, 
d2137 1
a2137 1
    </P>
d2139 1
a2139 1
    <P>Filter parameters are used like in <a href="../volfilt.rct">volfilt.rct</a> above.</P>
d2142 1
a2142 1
<LI><P><B>Prepare files for reference-based alignment</B></P></LI>
d2144 1
a2144 1
    <P> Now that you have a low-resolution structure to used a reference, 
d2146 1
a2146 1
    </P>
d2148 1
a2148 1
    <P> Before running the next batch file, 
d2150 1
a2150 1
	(<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/batcharch">from here</a>) 
d2153 1
a2153 1
    </P>
d2155 1
a2155 1
    <P> The tarball will create a directory called <font class="output">myproject/</font>
d2158 2
a2159 2
	Feel free to change the name, but remember to change it in the ensuing batch file.
    </P>
d2161 1
a2161 1
    <P> The batch file <a href="../prepare-prjmatch.rct">prepare-prjmatch.rct</a> 
d2164 1
a2164 1
    </P>
d2196 1
a2196 1
	<P> The total list of particles <font class="input">listparticles</font> will be used 
d2200 1
a2200 1
	</P>
d2202 1
a2202 1
	<P> Only the tilted particles will be used in the projection-matching step. 
d2208 3
a2210 3
	    However, if you needed to high-pass filter the <B>Winrot/</B> images, 
	    you will need to go back and filter the <B>Unrot/</B> images similarly.
	</P>
d2245 1
a2245 1
	<P> As of yet, CTF-correction is not implemented here. 
d2251 1
a2251 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
d2253 1
a2253 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apshgrp.spi">
d2255 1
a2255 1
	</P>
d2257 2
a2258 2
	<P> You should now have the files in a form that can be understood by the 
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html">
d2260 1
d2262 1
a2262 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html#SH">
d2264 1
a2264 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/sel_by_group.spi">
d2271 1
a2271 1
	    "<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html#AUTO">Particle 
d2273 1
a2273 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/pfilt.spi">
d2275 1
a2275 1
	    the next step, entitled <B>"Verify the automatically selected particles"</B>. 
d2277 1
a2277 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/batch/instr-apsh.htm">
d2279 1
a2279 1
	    "<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/batch/instr-apsh.htm#particles">Particle-picking</a>"
d2281 1
a2281 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/batch/Particles/numberparticles.spi">
d2283 1
a2283 1
	</P>
d2285 2
a2286 2
	<P>Good luck!</P>
</UL>
d2288 1
a2288 1
<HR>
d2290 1
a2290 1
<B><P><a name="misc"><a href="misc.htm">Miscellaneous batch files</a></a></P></B>
d2292 4
a2295 4
<UL>
    <LI><a href="misc.htm#pocs">Projection onto convex sets</a></LI>
    <LI><a href="misc.htm#other">Other batch files</a> -- under construction</LI>
</UL>
d2297 1
a2297 1
<HR>
d2299 1
a2299 1
<B><P><a name="mods">Modifications log</a></P></B>
d2301 5
a2305 4
<UL>
    <LI>2012-12-20 -- posted to local Techniques directory</LI>
    <LI>2012-12-20 -- made SPIRE configuration file</LI>
</UL>
d2307 1
a2307 1
<HR>
d2309 2
a2310 2
<B><P><a name="refs">References</a></P></B>
<OL>
d2312 1
a2312 1
    <LI>Frank J. (2006) 
d2314 1
a2314 1
        (Oxford University Press, New York, NY).</LI>
d2316 1
a2316 1
    <LI>Marco S, Chagoyen M, de la Fraga LG, Carazo JM, Carrascosa JL. (1996) 
d2318 1
a2318 1
        <I>Ultramicroscopy</I> <B>66</B>: 5-10.</LI>
d2320 1
a2320 1
    <LI>Radermacher M, Wagenknecht T, Verschoor A, Frank J. 
d2323 1
a2323 1
        <I>J Microsc.</I>  <B>146</B>:113-36.</LI>
d2325 1
a2325 1
<!--    <LI>AUTHOR 1, AUTHOR 2. (YEAR) 
d2327 2
a2328 2
        <I>JOURNAL</I> <B>VOLUME</B>: PG0-PG.</LI>-->
    <LI>Shaikh TR, LeBarron JS, Trujillo R, Baxter WT, and Frank J. (2008a) 
d2330 2
a2331 2
        <I>J Struct Biol </I> <B>161</B>: 41-48.</LI>
    <LI>Shaikh TR, Gao H, Baxter WT, Asturias F, Boisset N, Leith A, and Frank J. (2008b) 
d2333 2
a2334 2
        <I>Nature Protocols</I> <B>3</B>: 1941-74.</LI>
    <LI>Huang T, Shaikh TR, Gupta K, Contreras-Martin LM, Grassucci RA, Van Duyne GD, Frank J, Belfort M .
d2336 2
a2337 2
        <I>Nucleic Acids Res.</I> <B>39</B>: 2845-54.</LI>
</OL>
d2339 1
a2339 1
<HR>
d2342 11
a2352 12

<p>
Source: rct.htm        &nbsp;&nbsp;&nbsp;
Page updated: 2013/07/31 &nbsp;&nbsp;&nbsp;
Tapu Shaikh
</p>

<p>
<address>&copy; <a href="http://www.wadsworth.org/spider_doc/spider/docs/copyright.html">Copyright notice</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a>
</address>
</p>
d2355 2
a2356 2
</BODY>
</HTML>
@


1.3
log
@Added quick & dirty instructions on setting up SPIRE.
@
text
@d101 2
d2352 1
a2352 1
Page updated: 2012/12/26 &nbsp;&nbsp;&nbsp;
@


1.2
log
@fixed path for tar_archive
@
text
@d245 2
a246 2
    <LI>Create a new directory, and change to that directory before unpackaging the 
	batch-file tarball.</LI>
d251 1
d253 48
a300 6
    <LI>The <font class="guitool">SPIRE</font> libraries are required for various Python scripts, such as
	<a href="../mkfilenums.py">mkfilenums.py</a> and <a href="../tree.py">tree.py</a>. 
	These steps can be substituted with SPIRE-independent analogs. 
	Installation instructions for <font class="guitool">SPIRE</font> can be found 
	<a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html#FullInstall">here</a>.</LI>
</UL>
d2350 1
a2350 1
Page updated: 2012/12/21 &nbsp;&nbsp;&nbsp;
@


1.1
log
@Initial revision
@
text
@d64 1
a64 1
    <li><a href="../../tar_archive/archive.htm">
d277 1
a277 1
    <p>Download the latest <a href="../../tar_archive/archive.htm">batch-file archive</a>, 
d333 1
a333 1
	Download the <a href="../../tar_archive/data20060817.tar">data archive</a>
d517 1
a517 1
		    (For the <a href="../../tar_archive/data20060817.tar">sample micrograph</a>, 
d2307 1
a2307 1
Page updated: 2012/12/18 &nbsp;&nbsp;&nbsp;
@
